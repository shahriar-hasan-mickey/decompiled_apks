define(["jquery","underscore","Backbone","collections/transfer/getAuthModeCollections","collections/servicerequest/validateChequeLeafNumberCollections","text!views/service/positivePay/positivePayInit.tpl"],function(e,t,i,a,n,s){var o=!1,r=new EncryptedLocalStorage("secret"),l=i.View.extend({el:"#container",events:{"click #positivePayInit_CancelBtn":"gotoPreviousPage","click #positivePayInit_SubmitBtn":"gotoPositivePayVerifyPage","blur #positivePayInit_ChequeNum":"validateChequeNumber"},initialize:function(){},update:function(){var e=this;e.getPositivePayAuthMode()},getPositivePayAuthMode:function(t){"object"==typeof t&&t.stopImmediatePropagation();var i=this,n=function(e){hideSpinner(),i.loadPositivePayTemplate();var a=r.get("securitySettingList");!isNull(a)&&a.length>0?r.set("IsAuthMode","true"):(r.set("alertType",null),r.set("IsAuthMode","false")),i.populateAuthMode(t)},s=function(e){hideSpinner(),r.set("authModeFlag","true"),i.errorresponse()};showSpinner(),i.collection=new a,i.collection.fetch({data:e.param({access_token:r.get("access_token"),transactionAmount:null,tenantServiceCode:"POSITIVE_PAY"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?n(e):s(e)},error:s})},loadPositivePayTemplate:function(){this.$el.html(t.template(s)),e("html").removeClass().addClass("app fntzoom"),r.set("isValidChequeLeafNumber","false")},populateAuthMode:function(t){"object"==typeof t&&t.stopImmediatePropagation();var i="",a="",n=r.get("securitySettingList"),s="<label for='username'>"+e.i18n.t("app.transfer.managebeneficiary.selectauthorisationmode")+"</label>";s+="<div class='custRadio_pass'>",!isNull(n)&&n.length>0?(e("#positivePay_SelectAuthModeDiv").html(""),e.each(n,function(t,n){"SMS"==n?(i="sms",a=e.i18n.t("app.transfer.managebeneficiary.sms")):"EMAIL"==n?(i="mail",a=e.i18n.t("app.transfer.managebeneficiary.mail")):"TOKEN"==n?(i="fScan",a=e.i18n.t("app.transfer.managebeneficiary.token")):"ESIGN"==n&&(i="esign",a=e.i18n.t("app.transfer.managebeneficiary.esign")),s+='<div class="box"><div class="radio"><label>',s+=0==t?'<input type="radio" name="positivePay_AuthMode" id="optionsRadios'+t+'" value="'+n+'" checked>':'<input type="radio" name="positivePay_AuthMode" id="optionsRadios'+t+'" value="'+n+'">',s+='<div class="row bg"><div class="col-xs-12 p0"><span class="menu_icon ico-xs '+i+'"></span><span class="small">'+a+"</span></div></div></label></div></div>"}),e("#positivePay_SelectAuthModeDiv").html(s)):e("#positivePay_SelectAuthModeDiv").html("")},gotoPreviousPage:function(e){e.stopImmediatePropagation(),i.history.navigate("#/wealth")},gotoPositivePayVerifyPage:function(t){t.stopImmediatePropagation(),o=!1,e("#acntNumErr").html(""),e("#chequeNumErr").html(""),e("#beneNameErr").html(""),e("#amountErr").html("");var a=e("#positivePayInit_selAcc option:selected").val(),n=e("#positivePayInit_selAcc option:selected").html(),s=e("#positivePayInit_ChequeNum").val(),l=e("#positivePayInit_BeneName").val(),u=e("#positivePayInit_Amount").val().replace(/,/g,""),c=e("input[name='positivePay_AuthMode']:checked").val();if(isNull(a)&&(o=!0,e("#acntNumErr").html("Please select an account Number")),isNull(s)&&(o=!0,e("#chequeNumErr").html("Please enter a Cheque Leaf Number")),isNull(s)||((s.length>8||s.length<1)&&(o=!0,e("#chequeNumErr").html("Please enter a valid Cheque Leaf Number")),"false"==r.get("isValidChequeLeafNumber")&&(o=!0,e("#chequeNumErr").html("Please enter a valid Cheque Leaf Number"))),isNull(l)&&(o=!0,e("#beneNameErr").html("Please enter the Beneficiary Name")),!isNull(l)){var m=l.charAt(0),h=l.charAt(l.length-1);if(l.length>70&&(o=!0,e("#beneNameErr").html("Beneficiary Name should have maximum of 70 characters")),l.length<3&&(o=!0,e("#beneNameErr").html("Beneficiary Name should have minimum of 3 characters")),!m.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return e("#beneNameErr").html(e.i18n.t("validation.newregistration.firstspaceind")),!1;if(!h.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return e("#beneNameErr").html(e.i18n.t("validation.newregistration.lastspaceind")),!1}isNull(u)&&(o=!0,e("#amountErr").html("Please enter the Amount")),isNull(u)||(0==u||"0"==u)&&(o=!0,e("#amountErr").html("Please enter an amount greater than 0")),o||(r.set("positivePayAccNum",a),r.set("positivePayAccNumber",n),r.set("positivePayChequeNum",s),r.set("positivePayBeneName",l),r.set("positivePayAmount",u),r.set("alertType",c),i.history.navigate("#/positivepayverify"))},validateChequeNumber:function(t){var i=this;t.stopImmediatePropagation(),e("#acntNumErr").html(""),e("#chequeNumErr").html("");var a=e("#positivePayInit_selAcc option:selected").val(),s=e("#positivePayInit_ChequeNum").val();if(isNull(a))return void e("#acntNumErr").html("Please select an account number");if(isNull(s))return void e("#chequeNumErr").html("Please enter a Cheque Leaf Number");if(!isNull(a)&&!isNull(s)){var o=function(e){hideSpinner(),r.set("isValidChequeLeafNumber","true")},l=function(t){hideSpinner(),r.set("isValidChequeLeafNumber","false"),e("#positivePayInit_ChequeNum").val(""),i.errorresponse()};showSpinner(),i.collection=new n,i.collection.fetch({data:e.param({access_token:r.get("access_token"),chequeLeafAccount:a,chequeLeafNum:s}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?o(e):l(e)},error:l})}},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return i.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return l});