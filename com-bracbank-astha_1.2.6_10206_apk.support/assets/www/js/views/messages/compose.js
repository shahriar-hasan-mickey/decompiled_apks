define(["jquery","underscore","Backbone","text!views/messages/compose.tpl","collections/messages/composeCollections","collections/messages/sendItemsCollections"],function(e,t,s,n,c,o){var r=new EncryptedLocalStorage("secret"),i=s.View.extend({el:"#mobcontent",events:{"click #composeForm":"gotoSend"},initialize:function(){},render:function(){var s=this,o=function(e){s.$el.html(t.template(n)).i18n(),s.$el.trigger("create")},i=function(e){s.errorresponse()};showSpinner(),s.collection=new c([],{});e("form").serialize();timestamp=(new Date).getTime(),s.collection.fetch({data:e.param({access_token:r.get("access_token"),benetype:"TENANT"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?(hideSpinner(),o(e)):i(e)},error:i})},gotoSend:function(){e("#errrecp").hide(),e("#errsub").hide(),e("#errmsg").hide();var t=(e("#sender :checked").val(),e("#recipient :checked").val(),e("#subject").val()),s=e("#message").val();return""===t?(e("#errsub").show(),!1):""===s?(e("#errmsg").show(),!1):void this.gotoSendMessage()},gotoSendMessage:function(){var t=(e("#sender :checked").val(),e("#recipient :checked").val()),n=e("#subject").val(),c=e("#message").val(),i=this,a=function(e){s.history.navigate("#/mailsuccess")},l=function(e){i.errorresponse()};i.collection=new o([],{});e("form").serialize();timestamp=(new Date).getTime(),showSpinner(),i.collection.fetch({data:e.param({access_token:r.get("access_token"),subjectId:t,messageSubject:n,messageBody:c}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?(hideSpinner(),a(e)):l(e)},error:l})},errorresponse:function(){hideSpinner(),s.history.navigate("#/exception")}});return i});