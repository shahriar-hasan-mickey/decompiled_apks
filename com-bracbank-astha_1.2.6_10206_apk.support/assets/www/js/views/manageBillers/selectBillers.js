define(["jquery","underscore","Backbone","collections/bills/getBillerCollections","collections/bills/billerOperationCollections","collections/bills/getBillAmountCollections","text!views/manageBillers/selectBillers.tpl"],function(e,t,l,i,n,a,r){var s=new EncryptedLocalStorage("secret"),c=l.View.extend({el:"#container",events:{"click #manageBillerDeleteBtn":"showDeleteConfirmation","click #manageBillerEditBtn":"gotoEditBillerPage","click #delete_biller_close_btn":"hideDeleteConfirmation","click #delete_biller_ok_btn":"gotoDeleteBillerSuccessPage","click #delete_biller_cancel_btn":"hideDeleteConfirmation","click #addBillerBtn_Manage":"gotoAddBillerPage","keyup #biller_search_box":"filterBillerList","click #manage_biller_billpay_btn":"gotoBillPayInitPage"},initialize:function(){},render:function(){var t=this;if("false"==s.get("isGetBeneficiaryList")){showSpinner();var l=function(e){hideSpinner(),s.set("isGetBeneficiaryList","true"),t.loadTemplate()},n=function(e){t.errorresponse()};t.collection=new i,t.collection.fetch({data:e.param({access_token:s.get("access_token"),categoryId:s.get("selectedBillerListId"),billerType:s.get("selectedBillerListName")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?l(e):n(e)},error:n})}else e("html").removeClass().addClass("app"),t.loadTemplate()},loadTemplate:function(){e("html").removeClass().addClass("app"),this.$el.html(t.template(r)),s.set("isOpenBookPage","false");var l=e("#bills_add_btn_div").find("span").attr("id");enableScroll(l);var i,n="";e('input[type="checkbox"]').change(function(t){var l=t.currentTarget.id;i=e(t.currentTarget).attr("id"),isNull(n)||n==l||(e("#"+n).prop("checked",!1),e("#bills_btn_div_"+n).hide()),n=l;var a=e('input[type="checkbox"]:checked').length;0==a?(e("#bills_btn_div_"+i).hide(),e("#bills_add_btn_div").show()):(e("#bills_btn_div_"+i).show(),e("#bills_add_btn_div").show())})},filterBillerList:function(t){t.stopImmediatePropagation();jQuery.expr[":"].contains=function(e,t,l){return jQuery(e).text().toUpperCase().indexOf(l[3].toUpperCase())>=0};var l=t.target.value;l.length>0?(e(".search_clear").is(":visible")||(e(".search_clear").show(),e(".search_clear").on("click",function(){e("#biller_search_box").val(""),e(".billerBeneItems").show(),e("#biller_search_box").focus(),e(".search_clear").hide(),e(".nodata").hide()})),e(".billerBeneItems").hide(),e('.billerBeneItems:contains("'+l+'")').length>0?(e(".nodata").hide(),e('.billerBeneItems:contains("'+l+'")').show()):e(".nodata").show()):(e(".search_clear").hide(),e(".nodata").hide(),e(".billerBeneItems").show())},gotoBillPayInitPage:function(t){t.stopImmediatePropagation(),s.set("isManageBene","true");var i=e("input[name='selectBilller']:checked").attr("billerId");s.set("selectBillID",i);var n=e("input[name='selectBilller']:checked").attr("id");if(s.set("selectBillIndex",n),"BRAC University"==s.get("selectedBillerListName"))var a=e("input[name='selectBilller']:checked").attr("payslipNum");else var a=e("input[name='selectBilller']:checked").attr("billNum");s.set("selectBillNumber",a);var r=e("input[name='selectBilller']:checked").attr("billId");s.set("selectBillerId",r);var c=e("input[name='selectBilller']:checked").attr("billServId");s.set("selectBillServiceId",c);var o=e("input[name='selectBilller']:checked").attr("billServName");s.set("selectBillServiceName",o);var d=e("input[name='selectBilller']:checked").attr("billServInfo");s.set("selectBillConnectionType",d);var p=this;"Mobile / Telephone"==s.get("selectedBillerTypeName")||"MetLife"==s.get("selectedBillerListName")?l.history.navigate("#/billpaytobillerinit"):p.getBillAmount()},getBillAmount:function(){var t=this,i=function(e){hideSpinner(),l.history.navigate("#/billpaytobillerinit")},n=function(e){t.errorresponse()};showSpinner(),t.collection=new a([],{}),t.collection.fetch({data:e.param({access_token:s.get("access_token"),toAccountNumber:s.get("selectBillNumber"),conntype:s.get("selectBillConnectionType"),billerServiceId:s.get("selectBillServiceId"),billerId:s.get("selectBillerId")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):n(e)},error:n})},gotoAddBillerPage:function(e){e.stopImmediatePropagation(),s.set("thisInputId",null),s.set("formDatasInEls",null),s.set("isGetBeneficiaryList","true"),s.set("isBillPayOneOffSuccess","false"),s.set("selectedBillerServiceType",null),s.set("billpaySuccessBillerName",null),l.history.navigate("#/addbiller")},showDeleteConfirmation:function(t){t.stopImmediatePropagation(),e("#delete_popup").modal("show")},hideDeleteConfirmation:function(t){t.stopImmediatePropagation(),e("#delete_popup").modal("hide"),e("div").removeClass("modal-backdrop fade in")},gotoDeleteBillerSuccessPage:function(t){t.stopImmediatePropagation();var l=e("input[name='selectBilller']:checked").attr("billerId"),i=this;showSpinner();var a=function(e){hideSpinner(),i.hideDeleteConfirmation(t),i.navigateToDeleteSuccessPage()},r=function(e){i.errorresponse()};i.collection=new n,i.collection.fetch({data:e.param({access_token:s.get("access_token"),nickname:s.get("selectedBillerShortName"),billerInstId:l,operationFlag:"D"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):r(e)},error:r})},navigateToDeleteSuccessPage:function(){s.set("beneSuccessFlag","true"),l.history.navigate("#/deletebillersuccess")},gotoEditBillerPage:function(t){t.stopImmediatePropagation(),s.set("istransferPageFlag","false");var i=e("input[name='selectBilller']:checked"),n=e(i).attr("billerId");s.set("selectedBillerId",n);var a=e(i).attr("id");s.set("selectedBillerInd",a);var r=e(i).val();s.set("selectedBillerNumber",r);var c=e(i).attr("shortName");s.set("selectedBillerShortName",c);var o=e(i).attr("billServId");s.set("selectedBillerServId",o);var d=e(i).attr("billId");s.set("selectedBillId",d),l.history.navigate("#/editbiller")},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return l.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return c});