define(["jquery","underscore","Backbone","collections/bills/fetchBillerCollections","collections/bills/billerValidationCollections","collections/bills/getBillAmountCollections","collections/transfer/getAuthModeCollections","text!views/manageBillers/addBiller.tpl"],function(e,l,t,a,i,r,s,n){var c=new EncryptedLocalStorage("secret"),o=t.View.extend({el:"#container",events:{"change #manageBiller_BillerService":"getAddBillerInputMetaData","click #addBiller_CancelBtn":"gotoViewBillersPage","click #addBiller_NextBtn":"gotoAddBillerVerifyPage","click #addBillerphonebookbtn":"addBilleropenPhonebook"},initialize:function(){},addBilleropenPhonebook:function(l){l.stopImmediatePropagation(),c.set("thisInputId",e("input.phonebookNo").attr("id")),c.set("formDatasInEls",serializeFormDatas()),t.history.navigate("#/contactlist")},render:function(){var e=this;e.getAuthmode()},getAuthmode:function(){var l=this;c.set("IsAuthMode","false"),e("#biller_add_authmodeDiv").html("");var t=function(e){var t=c.get("securitySettingList");!isNull(t)&&t.length>0?c.set("IsAuthMode","true"):(c.set("alertType",null),c.set("IsAuthMode","false")),l.loadTemplate()},a=function(e){c.set("IsAuthMode","false"),l.loadTemplate()};showSpinner(),l.collection=new s,l.collection.fetch({data:e.param({access_token:c.get("access_token"),transactionAmount:null,tenantServiceCode:"BPI"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?t(e):a(e)},error:a})},populateAuthMode:function(){var t="",a="",i=this;this.$el.html(l.template(n)),"true"==c.get("isBillPayOneOffSuccess")?c.set("isValid","true"):c.set("isValid","false"),"true"==c.get("isBillPayOneOffSuccess")&&("Mobile / Telephone"==c.get("billpaySuccessBillerSubcatName")?(e("#manageBillerSubCat").empty().append("<option id='"+c.get("billpaySuccessBillerSubcatId")+"' selected>"+c.get("billpaySuccessBillerSubcatName")+"</option>"),e("#manageBiller_BillerName").empty().append("<option id='"+c.get("billpaySuccessBillerOprId")+"' selected>"+c.get("billpaySuccessBillerOprName")+"</option>"),e("#manageBiller_BillerService option[id='"+c.get("billpaySuccessBillerServId")+"']").attr("selected","selected")):"Water"==c.get("billpaySuccessBillerSubcatName")||"Electricity"==c.get("billpaySuccessBillerSubcatName")?"WASA"==c.get("billpaySuccessBillerName")?(e("#manageBiller_BillerName").empty().append("<option id='"+c.get("billpaySuccessBillerId")+"' selected>"+c.get("billpaySuccessBillerName")+"</option>"),e("#manageBiller_BillerService option[id='"+c.get("billpaySuccessBillerServId")+"']").attr("selected","selected")):"DPDC"==c.get("billpaySuccessBillerName")?(e("#manageBiller_BillerService option[id='"+c.get("billpaySuccessBillerServId")+"']").attr("selected","selected"),e("#DPDC_BillerName").html("").html("<div class='form-group'><label>Biller Name</label><p>DPDC</p></div>")):"DESCO"==c.get("billpaySuccessBillerName")||"NESCO"==c.get("billpaySuccessBillerName")?e("#manageBiller_BillerService option[id='"+c.get("billpaySuccessBillerServId")+"']").attr("selected","selected"):"WZPDCL"==c.get("billpaySuccessBillerName")&&e("#manageBiller_BillerService option[id='"+c.get("billpaySuccessBillerServId")+"']").attr("selected","selected"):"Internet"==c.get("billpaySuccessBillerSubcatName")||"Insurance"==c.get("billpaySuccessBillerSubcatName")?(e("#manageBillerSubCat").empty().append("<option id='"+c.get("billpaySuccessBillerSubcatId")+"' selected>"+c.get("billpaySuccessBillerSubcatName")+"</option>"),e("#manageBiller_BillerName").empty().append("<option id='"+c.get("billpaySuccessBillerId")+"' selected>"+c.get("billpaySuccessBillerName")+"</option>"),e("#manageBiller_BillerService option:eq(1)").attr("selected","selected"),i.getAddBillerInputMetaData()):"Tuition Fees"==c.get("billpaySuccessBillerSubcatName")?e("#manageBiller_BillerService option:eq(1)").attr("selected","selected"):"Gas"==c.get("billpaySuccessBillerSubcatName")&&"Jalalabad Gas"==c.get("billpaySuccessBillerName")&&e("#manageBiller_BillerService option:eq(1)").attr("selected","selected"),i.getAddBillerInputMetaData()),e("html").removeClass().addClass("app"),isNull(c.get("selectedBillerServiceType"))||e("#manageBiller_BillerService").val(c.get("selectedBillerServiceType")).trigger("change");var r=c.get("securitySettingList"),s="<label for='username'>"+e.i18n.t("app.transfer.managebeneficiary.selectauthorisationmode")+"</label>";s+="<div class='custRadio_pass'>",!isNull(r)&&r.length>0?(e("#biller_add_authmodeDiv").html(""),e.each(r,function(l,i){"SMS"==i?(t="sms",a=e.i18n.t("app.transfer.managebeneficiary.sms")):"EMAIL"==i?(t="mail",a=e.i18n.t("app.transfer.managebeneficiary.mail")):"TOKEN"==i?(t="fScan",a=e.i18n.t("app.transfer.managebeneficiary.token")):"ESIGN"==i&&(t="esign",a=e.i18n.t("app.transfer.managebeneficiary.esign")),s+='<div class="box"><div class="radio"><label>',s+=0==l?'<input type="radio" name="biller_add_authmode" id="optionsRadios'+l+'" value="'+i+'" checked>':'<input type="radio" name="biller_add_authmode" id="optionsRadios'+l+'" value="'+i+'">',s+='<div class="row bg"><div class="col-xs-12 p0"><span class="menu_icon ico-xs '+t+'"></span><span class="small">'+a+"</span></div></div></label></div></div>"}),e("#biller_add_authmodeDiv").html(s)):e("#biller_add_authmodeDiv").html(""),("DPDC"==c.get("selectedBillerListName")||"DESCO"==c.get("selectedBillerListName")||"NESCO"==c.get("selectedBillerListName")||"Jalalabad Gas"==c.get("selectedBillerListName")||"WZPDCL"==c.get("selectedBillerListName"))&&i.getAddBillerInputMetaData()},loadTemplate:function(){var l=this,t=function(e){hideSpinner(),l.populateAuthMode()},i=function(e){l.errorresponse()};l.collection=new a,l.collection.fetch({data:e.param({access_token:c.get("access_token"),type:"SERVICE",billId:c.get("selectedBillerListId"),newversion:"Y"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?t(e):i(e)},error:i})},getBillAmount:function(l){"object"==typeof l&&l.stopImmediatePropagation(),e("#billerCusName").html(""),c.set("billerCustomerName",null);var t=this,a="",i="",s=new RegExp("^[A-Za-z0-9]+$");if("WASA"==c.get("selectedBillerListName")?(a=e("input[name='Biller ID/Number']").val(),isNull(a)&&(a=e("input[name='Bill ID']").val())):"DPDC"==c.get("selectedBillerListName")||"DPDC"==c.get("billpaySuccessBillerName")?(i=e("input[name='Connection Type']:checked").val(),a=e("input[name='Customer Number']").val(),c.set("addBillerCustomerNumber",a)):"DESCO"==c.get("selectedBillerListName")||"Jalalabad Gas"==c.get("selectedBillerListName")||"WZPDCL"==c.get("selectedBillerListName")?(i=e("input[name='Connection Type']:checked").val(),a=e("input[name='Account Number']").val(),c.set("addBillerCustomerNumber",a)):"NESCO"==c.get("selectedBillerListName")||"NESCO"==c.get("billpaySuccessBillerName")?(i=e("input[name='Connection Type']:checked").val(),a=e("input[name='Consumer Number']").val(),c.set("addBillerCustomerNumber",a)):a="Guardian Life"==c.get("selectedBillerListName")||"Guardian Life"==c.get("billpaySuccessBillerName")?e("input[name='Policy Number']").val():"Jalalabad Gas"==c.get("selectedBillerListName")||"Jalalabad Gas"==c.get("billpaySuccessBillerName")?e("input[name='Account Number']").val():e("input[name='Payslip Number']").val(),!isNull(a)&&s.test(a)){e(".inputClass").each(function(l,t){var a=e(t).attr("id"),i=e(t).attr("name");e("#biller_input_error_"+a).html("");var r=e("#"+a).val();e("#"+a).is(":disabled")||(isNull(r)?(isError=!0,e("#biller_input_error_"+a).html("Please enter a "+i.toLowerCase())):e("#biller_input_error_"+a).html(""))});var n=function(a){hideSpinner(),c.set("isValid","true"),e("#billerCusName").html("");var r=c.get("additionalInfo");"true"!=c.get("isBillPayOneOffSuccess")&&("WASA"==c.get("selectedBillerListName")||"Guardian Life"==c.get("selectedBillerListName")?t.navigateToVerifyPage(l):"DPDC"==c.get("selectedBillerListName")?"PREPAID"==i?(e("#billerCusName").html(r.CustomerName),c.set("billerCustomerName",r.CustomerName)):"POSTPAID"==i&&(e("#billerCusName").html(r.CUSTOMER_NAME),c.set("billerCustomerName",r.CUSTOMER_NAME)):"DESCO"==c.get("selectedBillerListName")?"PREPAID"==i?(e("#billerCusName").html(r.customerName),c.set("billerCustomerName",r.customerName)):"POSTPAID"==i&&(e("#billerCusName").html(r.NAME),c.set("billerCustomerName",r.NAME)):"NESCO"==c.get("selectedBillerListName")?"POSTPAID"==i&&(e("#billerCusName").html(r.customer_name),c.set("billerCustomerName",r.customer_name)):(e("input[name='Student Id']").val(r.studentId),e("input[name='Student Name']").val(r.studentName)))},o=function(l){t.errorresponse(),c.set("isValid","false"),("Water"!=c.get("selectedBillerTypeName")||"Electricity"!=c.get("selectedBillerTypeName"))&&(e("input[name='Payslip Number']").val(""),e("input[name='Student Id']").val(""),e("input[name='Student Name']").val("")),"DPDC"==c.get("selectedBillerListName")&&(e("#billerCusName").html(""),c.set("billerCustomerName",null),e("input[name='Customer Number']").val("")),("DESCO"==c.get("selectedBillerListName")||"NESCO"==c.get("selectedBillerListName")||"WZPDCL"==c.get("selectedBillerListName")||"Jalalabad Gas"==c.get("selectedBillerListName"))&&e("input[name='Account Number']").val("")};showSpinner(),t.collection=new r([],{}),t.collection.fetch({data:e.param({access_token:c.get("access_token"),toAccountNumber:a,module:"ADD",conntype:i,billerServiceId:c.get("selectedBillerServiceID"),billerId:c.get("selectedBillerListId")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?n(e):o(e)},error:o})}},getAddBillerInputMetaData:function(l){"object"==typeof l&&l.stopImmediatePropagation();var t;if("DPDC"==c.get("selectedBillerListName")||"DESCO"==c.get("selectedBillerListName")||"NESCO"==c.get("selectedBillerListName")){var i=c.get("menuList");e.each(i,function(e,l){"Electricity"==l.code&&(t=l.code)})}else t=e("#manageBiller_BillerService option:selected").val();if(""==t)return void e("#authMode").hide();e("#billerServiceError, #billerDPDCError").html("");var r=e("#manageBiller_BillerService option:selected").attr("id");c.set("selectedBillerServiceID",r);var t=e("#manageBiller_BillerService option:selected").val();c.set("selectedBillerServiceType",t);var s=this;showSpinner();var n=function(t){hideSpinner(),e("#authMode").show(),s.createInputDiv(l)},o=function(e){s.errorresponse()};s.collection=new a,s.collection.fetch({data:e.param({access_token:c.get("access_token"),type:"METADATA",billId:c.get("selectedBillerServiceID"),newversion:"Y"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?n(e):o(e)},error:o})},createInputDiv:function(l){var t=this;"object"==typeof l&&l.stopImmediatePropagation();var a=c.get("menuList");c.set("metaDataDTO",a),e("#inputDiv").html("");var i="";e.each(a,function(l,t){if("N"==t.dataType)if(i+="<label>"+t.dataLabel+"</label>","Mobile Number"==t.dataLabel)i+="<div class='form-group'><div class='input-group'>",i+="true"==c.get("isBillPayOneOffSuccess")?"<input id='"+t.metaDataId+"' data='"+t.dataType+"' name='"+t.dataLabel+"' type='tel' minlength='"+t.dataMinLength+"' maxlength='"+t.dataMaxLength+"' class='form-control numericlengthcontrol inputClass phonebookNo' value='"+c.get("billpaySuccessBillID")+"'/><span class='input-group-addon phonebook_ioc_outer'><a href='javascript:void(0);' id='addBillerphonebookbtn' class='phonebook_ioc'></a></span>":"<input id='"+t.metaDataId+"' data='"+t.dataType+"' name='"+t.dataLabel+"' type='tel' minlength='"+t.dataMinLength+"' maxlength='"+t.dataMaxLength+"' class='form-control numericlengthcontrol inputClass phonebookNo'/><span class='input-group-addon phonebook_ioc_outer'><a href='javascript:void(0);' id='addBillerphonebookbtn' class='phonebook_ioc'></a></span>",i+="</div></div><div class='form-group has-error'><p class='help-block error-message has-error' style='color:#a94442' id='biller_input_error_"+t.metaDataId+"'></p></div>";else{if(i+="<div class='form-group'>",i+="true"==c.get("isBillPayOneOffSuccess")?"<input id='"+t.metaDataId+"' data='"+t.dataType+"' name='"+t.dataLabel+"' type='tel' minlength='"+t.dataMinLength+"' maxlength='"+t.dataMaxLength+"' class='form-control numericlengthcontrol inputClass' value='"+c.get("billpaySuccessBillID")+"'/>":"<input id='"+t.metaDataId+"' data='"+t.dataType+"' name='"+t.dataLabel+"' type='tel' minlength='"+t.dataMinLength+"' maxlength='"+t.dataMaxLength+"' class='form-control numericlengthcontrol inputClass'/>","DPDC"==c.get("selectedBillerListName")||"DPDC"==c.get("billpaySuccessBillerName")||"DESCO"==c.get("selectedBillerListName")||"DESCO"==c.get("billpaySuccessBillerName")||"NESCO"==c.get("selectedBillerListName")||"NESCO"==c.get("billpaySuccessBillerName")){if(i+="<div class='row'><div class='col-xs-12 small'>","true"==c.get("isBillPayOneOffSuccess")){if("DPDC"==c.get("billpaySuccessBillerName")){c.get("billPaySuccessDPDCCustName");i+="<span class='small text-muted'><i class='fa fa-user' aria-hidden='true'></i> <span id='billerCusName'>"+c.get("billPaySuccessDPDCCustName")+"</span></span>",c.set("billerCustomerName",c.get("billPaySuccessDPDCCustName"))}else if("DESCO"==c.get("billpaySuccessBillerName")){c.get("billPaySuccessDESCOCustName");i+="<span class='small text-muted'><i class='fa fa-user' aria-hidden='true'></i> <span id='billerCusName'>"+c.get("billPaySuccessDESCOCustName")+"</span></span>",c.set("billerCustomerName",c.get("billPaySuccessDESCOCustName"))}else if("NESCO"==c.get("billpaySuccessBillerName")){c.get("billPaySuccessNESCOCustName");i+="<span class='small text-muted'><i class='fa fa-user' aria-hidden='true'></i> <span id='billerCusName'>"+c.get("billPaySuccessNESCOCustName")+"</span></span>",c.set("billerCustomerName",c.get("billPaySuccessNESCOCustName"))}}else i+="<span class='small text-muted'><i class='fa fa-user' aria-hidden='true'></i> <span id='billerCusName'></span></span>";i+="</div></div>"}i+="</div><div class='form-group has-error'><p class='help-block error-message has-error' style='color:#a94442' id='biller_input_error_"+t.metaDataId+"'></p></div>"}else"L"==t.dataType?(i+="<label>"+t.dataLabel+"</label>",i+="<div class='row'>",e.each(t.arrDescription,function(e,l){i+="<div class='col-xs-6'><label class='radio-label trans_label'>",i+="true"==c.get("isBillPayOneOffSuccess")&&c.get("billpaySuccessConnectionType")==l?"<input type='radio' name='"+t.dataLabel+"' class='billerConnType' metaID='"+t.metaDataId+"' data='"+t.dataType+"' value="+l+" checked='checked'>"+l:"<input type='radio' name='"+t.dataLabel+"' class='billerConnType' metaID='"+t.metaDataId+"' data='"+t.dataType+"' value="+l+">"+l,i+="<span class='checkmark'></span></label></div>"}),i+="</div><div class='form-group has-error'><p class='help-block error-message has-error' style='color:#a94442' id='biller_input_error_"+t.metaDataId+"'></p></div>"):(i+="<label>"+t.dataLabel+"</label><div class='form-group'>",i+="Tuition Fees"!=c.get("selectedBillerTypeName")||"Student Id"!=t.dataLabel&&"Student Name"!=t.dataLabel?"true"==c.get("isBillPayOneOffSuccess")&&"Policy Number"==t.dataLabel?"<input id='"+t.metaDataId+"' data='"+t.dataType+"' name='"+t.dataLabel+"' type='text' minlength='"+t.dataMinLength+"' maxlength='"+t.dataMaxLength+"' class='form-control alphanumericlengthcontrol inputClass' value='"+c.get("billpaySuccessBillID")+"'/>":"<input id='"+t.metaDataId+"' data='"+t.dataType+"' name='"+t.dataLabel+"' type='text' minlength='"+t.dataMinLength+"' maxlength='"+t.dataMaxLength+"' class='form-control alphanumericlengthcontrol inputClass'/>":"<input id='"+t.metaDataId+"' data='"+t.dataType+"' name='"+t.dataLabel+"' type='text' disabled class='form-control alphanumericlengthcontrol inputClass'/>",i+="</div><div class='form-group has-error'><p class='help-block error-message has-error' style='color:#a94442' id='biller_input_error_"+t.metaDataId+"'></p></div>")}),e("#inputDiv").html(i),e(".numericlengthcontrol").inputnumericlength(),"true"==c.get("isBillPayOneOffSuccess")&&"Tuition Fees"==c.get("billpaySuccessBillerSubcatName")&&(e("input[name='Student Id']").val(c.get("billPaySuccessBracUnivStuID")),e("input[name='Student Name']").val(c.get("billPayBracUnivStuName")));var r;if("true"==c.get("isBillPayOneOffSuccess")&&("DPDC"==c.get("billpaySuccessBillerName")?(r=e("input[name='Customer Number']").val(),c.set("addBillerCustomerNumber",r)):"DESCO"==c.get("billpaySuccessBillerName")||"Jalalabad Gas"==c.get("billpaySuccessBillerName")||"WZPDCL"==c.get("billpaySuccessBillerName")?(r=e("input[name='Account Number']").val(),c.set("addBillerCustomerNumber",r)):"NESCO"==c.get("billpaySuccessBillerName")&&(r=e("input[name='Consumer Number']").val(),c.set("addBillerCustomerNumber",r))),"true"!=c.get("isBillPayOneOffSuccess")&&(e("input[name='Payslip Number']").on("blur",function(e){t.getBillAmount(e)}),"DPDC"==c.get("selectedBillerListName")&&e("input[name='Customer Number']").on("blur",function(e){t.getBillAmount(e)}),"DESCO"==c.get("selectedBillerListName")&&e("input[name='Account Number']").on("blur",function(e){t.getBillAmount(e)}),"NESCO"==c.get("selectedBillerListName")&&e("input[name='Consumer Number']").on("blur",function(e){t.getBillAmount(e)}),"WZPDCL"==c.get("selectedBillerListName")&&e("input[name='Account Number']").on("blur",function(e){t.getBillAmount(e)}),"Jalalabad Gas"==c.get("selectedBillerListName")&&e("input[name='Account Number']").on("blur",function(e){t.getBillAmount(e)})),isNull(c.get("formDatasInEls"))||fillFormDatas(c.get("formDatasInEls")),"true"==c.get("isBillPayOneOffSuccess")){var s=c.get("billpaySuccessConnectionType");e("input[name='Connection Type'][value="+s+"]").prop("checked",!0)}else e("input[name='Connection Type']:first").prop("checked",!0);e(".billerConnType").on("click",function(){e("input[name='Account Number']").val("")}),("Mobile / Telephone"==c.get("selectedBillerTypeName")||"MetLife"==c.get("selectedBillerListName"))&&c.set("isValid","true"),"true"==c.get("isBillPayOneOffSuccess")&&("WASA"==c.get("selectedBillerListName")||"Guardian Life"==c.get("selectedBillerListName"))&&c.set("isValid","true"),("WZPDCL"==c.get("selectedBillerListName")||"Jalalabad Gas"==c.get("selectedBillerListName")||"Land Tax"==c.get("selectedBillerListName"))&&c.set("isValid","true")},gotoViewBillersPage:function(e){e.stopImmediatePropagation(),c.set("thisInputId",null),c.set("formDatasInEls",null),t.history.navigate("#/viewbillerlist")},gotoAddBillerVerifyPage:function(l){l.stopImmediatePropagation(),e("#billerServiceError, #billerDPDCError").html("");var t=e("input[name='biller_add_authmode']:checked").val();c.set("alertType",t);var a=(e("input[name='Connection Type']:checked").val(),e("#manageBiller_BillerService option:selected").val()),i=e("#manageBiller_BillerService option:selected").attr("id");c.set("selectedBillerServiceID",i);var r=/^[a-z0-9 ]*$/i,s=/(^(\+8801|8801|01|008801))[1|3-9]{1}(\d){8}$/,n=/^[0-9 ]*$/i;if(""==a||null==a)return void("Mobile / Telephone"==c.get("selectedBillerTypeName")?e("#billerServiceError").html("Please select a connection type"):e("#billerServiceError").html("Please select a Biller Service"));var o=!1,u=[],d=[],m=[],p=[];e(".inputClass").each(function(l,t){var a=e(t).attr("id"),i=e(t).attr("name"),c=e(t).attr("minlength"),g=e(t).attr("maxlength"),b=e(t).attr("type");e("#biller_input_error_"+a).html("");var h=e("#"+a).val();if(!e("#"+a).is(":disabled"))if(isNull(h))o=!0,e("#biller_input_error_"+a).html("Please enter a "+i.toLowerCase());else if(h.length<c)o=!0,e("#biller_input_error_"+a).html("The "+i.toLowerCase()+" should contain minimum of "+c+" characters");else if(h.length>g)o=!0,e("#biller_input_error_"+a).html("The "+i.toLowerCase()+" should contain maximum of "+g+" characters");else if("Short Name"==i){var B=h.charAt(0),N=h.charAt(h.length-1);r.test(h)||(o=!0,e("#biller_input_error_"+a).html(e.i18n.t("app.sadad.managebills.alphanumericerr"))),B.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i)||(o=!0,e("#biller_input_error_"+a).html(e.i18n.t("validation.newregistration.firstspaceind"))),N.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i)||(o=!0,e("#biller_input_error_"+a).html(e.i18n.t("validation.newregistration.lastspaceind")))}else"Mobile Number"==i?s.test(h)||(o=!0,e("#biller_input_error_"+a).html("Please enter a valid "+i.toLowerCase())):"Biller ID/Number"==i?n.test(h)||(o=!0,e("#biller_input_error_"+a).html("Please enter a valid "+i.toLowerCase())):"Customer Number"==i?"tel"==b?n.test(h)||(o=!0,e("#biller_input_error_"+a).html("Please enter a valid "+i.toLowerCase())):r.test(h)||(o=!0,e("#biller_input_error_"+a).html("Please enter a valid "+i.toLowerCase())):"Policy Number"==i?"tel"==b?n.test(h)||(o=!0,e("#biller_input_error_"+a).html("Please enter a valid "+i.toLowerCase())):r.test(h)||(o=!0,e("#biller_input_error_"+a).html("Please enter a valid "+i.toLowerCase())):"Customer Name"==i?r.test(h)||(o=!0,e("#biller_input_error_"+a).html("Please enter a valid "+i.toLowerCase())):"Bill Number"==i?n.test(h)||(o=!0,e("#biller_input_error_"+a).html("Please enter a valid "+i.toLowerCase())):"Payslip Number"==i&&("tel"==b?n.test(h)||(o=!0,e("#biller_input_error_"+a).html("Please enter a valid "+i.toLowerCase())):r.test(h)||(o=!0,e("#biller_input_error_"+a).html("Please enter a valid "+i.toLowerCase())));u.push(e("#"+a).attr("id")),d.push(e.trim(e("#"+a).val())),m.push(e("#"+a).attr("name")),p.push(e("#"+a).attr("data"))});var g=c.get("metaDataDTO");if(e.each(g,function(l,t){if(!isNull(t.arrDescription)){var a=e("input:radio.billerConnType:checked").attr("metaID"),i=e("input:radio.billerConnType:checked").attr("name"),r=e("input:radio.billerConnType:checked").val(),s=e("input:radio.billerConnType:checked").attr("data");isNull(r)&&(o=!0,e("#biller_input_error_"+a).html("Please select a "+i.toLowerCase())),u.push(a),d.push(r),m.push(i),p.push(s)}}),!o){for(var b=0;b<m.length;b++)"Short Name"==m[b]&&c.set("billerShortName",d[b]);c.set("inputValueArr",d.reverse()),c.set("inputIDArr",u.reverse()),c.set("inputLabelArr",m.reverse()),c.set("inputDataTypeArr",p.reverse());var h=this;"WASA"==c.get("selectedBillerListName")||"Guardian Life"==c.get("selectedBillerListName")?"true"==c.get("isValid")?h.navigateToVerifyPage(l):h.getBillAmount(l):h.navigateToVerifyPage(l)}},navigateToVerifyPage:function(l){if(l.stopImmediatePropagation(),"false"!=c.get("isValid")){var a=c.get("inputValueArr"),r=a.join(","),s=c.get("inputIDArr"),n=s.join(","),o=c.get("inputLabelArr"),u=o.join(","),d=c.get("inputDataTypeArr"),m=d.join(","),p=this;showSpinner();var g=function(e){hideSpinner(),c.set("formDatasInEls",null),c.set("thisInputId",null),t.history.navigate("#/addbillerverify")},b=function(e){p.errorresponse()};p.collection=new i,p.collection.fetch({data:e.param({access_token:c.get("access_token"),metadataCode:null,utilityNumber:null,billerId:c.get("selectedBillerListId"),billerserviceid:c.get("selectedBillerServiceID"),metaDataId:n,dataType:m,userInput:r,dataLabel:u}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?g(e):b(e)},error:b})}},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return t.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return o});