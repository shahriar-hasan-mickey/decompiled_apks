define(["jquery","underscore","Backbone","collections/bills/cardSummaryCollections","collections/transfer/getTransactionLimitCollections","collections/transfer/getAccountBalanceCollections","collections/bills/billPaymentCollections","collections/bills/fetchBillerCollections","collections/bills/getBillAmountCollections","collections/transfer/getAuthModeCollections","collections/bills/fetchConnectionTypeCollections","text!views/billsAndFees/billPayoneTimePay.tpl","models/validation/billsandFees/billsAndFeesValidationModel"],function(e,l,t,a,i,n,o,s,r,d,f,c,m){var u=new EncryptedLocalStorage("secret"),O=t.View.extend({el:"#container",events:{"click #oneTimePay_NextBtn":"gotoBillPayOneTimeVerifyPage","change #From_billpay_acc":"getAccountBalance","click #oneTimePayInit_CancelBtn":"gotoPreviousPage","click #billOneTimephonebookbtn":"billOneTimeopenPhonebook","click #billPayOneTimeTandCPopup":"billPayOneTimePayOpenTandCPopup","click .billerConnType":"toggleLabel","blur #billerOneOffBillNum":"getOneTimePayBillAmount","keyup #oneTimePay_BillerId":"getDPDCBillAmount","blur #oneTimePay_BillAmount":"getOneTimePayBillAmount"},initialize:function(){},update:function(){var l=this;if("false"==u.get("isCreditPrepaidCardData")){var t=function(e){hideSpinner(),u.set("isCreditPrepaidCardData","true"),u.set("billerOneOffBillMonth",null),"Mobile / Telephone"==u.get("selectedBillerTypeName")?l.getServiceType():"DPDC"==u.get("selectedBillerListName")?l.getOneTimeConnectionType():l.transactionlimit()},i=function(e){l.errorresponse()};showSpinner(),l.collection=new a([],{});getDeviceId();l.collection.fetch({data:e.param({newversion:"Y",access_token:u.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){if("0000"==ackStatus){var l=u.get("errorcode");t("9999"==l?e:e)}else i(e)},error:i})}else hideSpinner(),"Mobile / Telephone"==u.get("selectedBillerTypeName")?l.getServiceType():"DPDC"==u.get("selectedBillerListName")?l.getOneTimeConnectionType():l.transactionlimit()},getOneTimeConnectionType:function(){var l=this;showSpinner();var t=function(e){hideSpinner(),l.transactionlimit()},a=function(e){l.errorresponse()};l.collection=new f,l.collection.fetch({data:e.param({access_token:u.get("access_token"),type:"CONNTYPE"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?t(e):a(e)},error:a})},loadOneTimeDPDCConnectionList:function(){var l="",t=u.get("connectionTypeList");e("#billerOnOffConnTypeDiv").html(""),l+="<label>Connection Type</label>",l+="<div class='row'>",e.each(t,function(e,t){l+="<div class='col-xs-6'><label class='radio-label trans_label'><input type='radio' name='ConnectionType' class='billerConnType' value="+t.dataLabel+">"+t.dataLabel+"<span class='checkmark'></span></label></div>"}),l+="</div>",e("#billerOnOffConnTypeDiv").html(l),e("input[name='ConnectionType']:first").prop("checked",!0)},billOneTimeopenPhonebook:function(l){l.stopImmediatePropagation(),isNull(e("#availbalance").html())||u.set("accountBalance",e.trim(e("#availbalance").html())),u.set("thisInputId","oneTimePay_BillerId"),u.set("formDatasInEls",serializeFormDatas("section")),t.history.navigate("#/contactlist")},getOneTimeDPDCAuthMode:function(){var l=this,t="",a="";u.set("IsAuthMode","false"),u.set("authModeFlag","false"),e("#biller_onetime_transferDiv").html("");var i=e("#oneTimePay_BillerId").val(),a=(e("#From_billpay_acc option:selected").val(),e("input[name='ConnectionType']:checked").val()),n=e("#From_billpay_acc option:selected").attr("acctype");if(u.set("DPDCOneOffConnType",a),"PREPAID"==a&&(t=e("#oneTimePay_BillAmount").val().replace(/,/g,"")),isNull(n))return void e("#billerFromAcc").html("Please select an account number");if(u.set("transferType","billPayOneOff"),!(isNull(i)||isNull(t)&&"PREPAID"==a)){var o=function(t){hideSpinner();var i=u.get("securitySettingList");!isNull(i)&&i.length>0?u.set("IsAuthMode","true"):(u.set("alertType",null),u.set("IsAuthMode","false")),l.populateAuthMode(),"DPDC"==u.get("selectedBillerListName")&&("PREPAID"==a?l.populateDPDCPrepaidAddInfoDiv():"POSTPAID"==a&&(e("#oneTimePay_BillAmount").val(u.get("transactionAmount")),l.populateDPDCPostpaidAddInfoDiv()))},s=function(t){hideSpinner(),u.set("authModeFlag","true"),l.errorresponse(),e("#DPDCOneOffAddInfo").html(""),e("#oneTimePay_BillAmount").val("")};showSpinner(),l.collection=new d,l.collection.fetch({data:e.param({dpdcflag:"DPDC",connectiontype:a,transactionAmount:t,source:n,customerNo:i,access_token:u.get("access_token"),billerId:u.get("selectedBillerListId"),tenantServiceCode:u.get("tenantServiceCode")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?o(e):s(e)},error:s})}},getAuthMode:function(l){"object"==typeof l&&l.stopImmediatePropagation();var t=this,a="",i=new RegExp("^[0-9.,]+$");if(u.set("IsAuthMode","false"),u.set("authModeFlag","false"),e("#biller_onetime_transferDiv").html(""),"Mobile / Telephone"==u.get("selectedBillerTypeName")||"MetLife"==u.get("selectedBillerListName")||"DPDC"==u.get("selectedBillerListName")&&"PREPAID"==u.get("DPDCOneOffConnType")?a=e("#oneTimePay_BillAmount").val().replace(/,/g,""):(a=u.get("transactionAmount"),-1!=a.indexOf(",")&&(a=a.replace(/,/g,""))),u.set("transferType","billPayOneOff"),!isNull(a)){if(!i.test(a))return void e("#billAmountError").html(e.i18n.t("validation.transfer.validamount"));var n=parseFloat(a),o=parseFloat(u.get("minAmountPerTransaction")),s=parseFloat(u.get("maxAmountPerTransaction"));if(o>n)return void e("#billAmountError").html(e.i18n.t("validation.sadad.amtgreaterthanminamt"));if(n>s)return void e("#billAmountError").html(e.i18n.t("validation.sadad.amtlessthanmaxamt"));var r=function(e){hideSpinner();var l=u.get("securitySettingList");!isNull(l)&&l.length>0?u.set("IsAuthMode","true"):(u.set("alertType",null),u.set("IsAuthMode","false")),t.populateAuthMode()},f=function(e){hideSpinner(),u.set("authModeFlag","true"),t.errorresponse()};showSpinner(),t.collection=new d,t.collection.fetch({data:e.param({access_token:u.get("access_token"),transactionAmount:a,tenantServiceCode:u.get("tenantServiceCode")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):f(e)},error:f})}},populateAuthMode:function(){var l="",t="";("DPDC"==u.get("selectedBillerListName")&&"POSTPAID"==u.get("DPDCOneOffConnType")||"DESCO"==u.get("selectedBillerListName")&&"POSTPAID"==u.get("DESCOOneOffConnType"))&&(e("#oneTimePay_BillAmount").val(u.get("transactionAmount")),e("#oneTimePay_BillAmount").attr("disabled","true"));var a=u.get("securitySettingList"),i="<label for='username'>"+e.i18n.t("app.transfer.managebeneficiary.selectauthorisationmode")+"</label>";i+="<div class='custRadio_pass'>",!isNull(a)&&a.length>0?(e("#biller_onetime_transferDiv").html(""),e.each(a,function(a,n){"SMS"==n?(l="sms",t=e.i18n.t("app.transfer.managebeneficiary.sms")):"EMAIL"==n?(l="mail",t=e.i18n.t("app.transfer.managebeneficiary.mail")):"TOKEN"==n?(l="fScan",t=e.i18n.t("app.transfer.managebeneficiary.token")):"ESIGN"==n&&(l="esign",t=e.i18n.t("app.transfer.managebeneficiary.esign")),i+='<div class="box"><div class="radio"><label>',i+=0==a?'<input type="radio" name="biller_onetime_transfer" id="optionsRadios'+a+'" value="'+n+'" checked>':'<input type="radio" name="biller_onetime_transfer" id="optionsRadios'+a+'" value="'+n+'">',i+='<div class="row bg"><div class="col-xs-12 p0"><span class="menu_icon ico-xs '+l+'"></span><span class="small">'+t+"</span></div></div></label></div></div>"}),e("#biller_onetime_transferDiv").html(i)):e("#biller_onetime_transferDiv").html("")},getServiceType:function(){var l=this;showSpinner();var t=function(e){hideSpinner(),l.transactionlimit()},a=function(e){l.errorresponse()};l.collection=new s,l.collection.fetch({data:e.param({access_token:u.get("access_token"),type:"SERVICE",billId:u.get("selectedBillerListId"),newversion:"Y"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?t(e):a(e)},error:a})},transactionlimit:function(){var l=this,t="";"Teletalk"==u.get("selectedBillerListName")?(t="TT",u.set("tenantServiceCode","MB_OT"),u.set("billPayOneTimeTransferType","MOBILE_TOPUP_RECHARGE_ONE_OFF")):"Grameenphone"==u.get("selectedBillerListName")?(t="GP",u.set("tenantServiceCode","MB_OT"),u.set("billPayOneTimeTransferType","MOBILE_TOPUP_RECHARGE_ONE_OFF")):"Robi"==u.get("selectedBillerListName")?(t="RI",u.set("tenantServiceCode","MB_OT"),u.set("billPayOneTimeTransferType","MOBILE_TOPUP_RECHARGE_ONE_OFF")):"Banglalink"==u.get("selectedBillerListName")?(t="BL",u.set("tenantServiceCode","MB_OT"),u.set("billPayOneTimeTransferType","MOBILE_TOPUP_RECHARGE_ONE_OFF")):"Airtel"==u.get("selectedBillerListName")?(t="AL",u.set("tenantServiceCode","MB_OT"),u.set("billPayOneTimeTransferType","MOBILE_TOPUP_RECHARGE_ONE_OFF")):"WASA"==u.get("selectedBillerListName")?(t="BW",u.set("tenantServiceCode","WASA_OT"),u.set("billPayOneTimeTransferType","WASA_ONE_OFF")):"Carnival"==u.get("selectedBillerListName")?(t="CL",u.set("tenantServiceCode","CL_OT"),u.set("billPayOneTimeTransferType","CARNIVAL_ONE_OFF")):"MetLife"==u.get("selectedBillerListName")?(t="ML",u.set("tenantServiceCode","ML_OT"),u.set("billPayOneTimeTransferType","METLIFE_ONE_OFF")):"Guardian Life"==u.get("selectedBillerListName")?(t="GL",u.set("tenantServiceCode","GL_OT"),u.set("billPayOneTimeTransferType","GUARDIANLIFE_ONE_OFF")):"BRAC University"==u.get("selectedBillerListName")?(t="BU",u.set("tenantServiceCode","BU_OT"),u.set("billPayOneTimeTransferType","BRAC_UNIVERSITY_ONE_OFF")):"DPDC"==u.get("selectedBillerListName")?(t="DPDC",u.set("tenantServiceCode","DPDC_ONE_OFF"),u.set("billPayOneTimeTransferType","DPDC_ONE_OFF")):"DESCO"==u.get("selectedBillerListName")?(t="DESCO",u.set("tenantServiceCode","DESCO_ONE_OFF"),u.set("billPayOneTimeTransferType","DESCO_ONE_OFF")):"NESCO"==u.get("selectedBillerListName")?(t="NESCO",u.set("tenantServiceCode","NESCO_ONE_OFF"),u.set("billPayOneTimeTransferType","NESCO_ONE_OFF")):"Jalalabad Gas"==u.get("selectedBillerListName")?(t="JALALABAD_GAS_ONE_OFF",u.set("tenantServiceCode","JALALABAD_GAS_ONE_OFF"),u.set("billPayOneTimeTransferType","JALALABAD_GAS_ONE_OFF")):"WZPDCL"==u.get("selectedBillerListName")?(t="WZPDCL_ONE_OFF",u.set("tenantServiceCode","WZPDCL_ONE_OFF"),u.set("billPayOneTimeTransferType","WZPDCL_ONE_OFF")):"Land Tax"==u.get("selectedBillerListName")&&(t="LAND_TAX_ONE_OFF",u.set("tenantServiceCode","LAND_TAX_ONE_OFF"),u.set("billPayOneTimeTransferType","LAND_TAX_ONE_OFF"));var a=function(e){hideSpinner(),l.loadViewBillerTemplate()},n=function(e){l.errorresponse()};showSpinner(),l.collection=new i,l.collection.fetch({data:e.param({access_token:u.get("access_token"),payeeType:"BILLPAY",subtype:t}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):n(e)},error:n})},getAccountBalance:function(l){l.stopImmediatePropagation(),e("#billerFromAcc").html("");var t=e("#From_billpay_acc option:selected").val(),a=e("#WB_OneTimePay_FromAcc option:selected").attr("frName");u.set("fromname",a),u.set("accountID1",t);var i=e("#From_billpay_acc option:selected").attr("acctype");u.set("paymentType12",i);var o=this;if(""==t)return e("#availbalance").html(""),e("#availBalDiv").hide(),void u.set("accountBalance",null);var s=function(t){hideSpinner(),e("billerFromAcc").html(""),e("#availBalDiv").show();var a=u.get("availableBalance"),n=parseFloat(a.slice(0,-2));n=0==n?"0":n;var s,r,d=null==u.get("accountCurrency")||""==u.get("accountCurrency")?"":u.get("accountCurrency");if("CASA"==i?(s=checkAmount(e.formatNumber(n,{format:"#,###.00",locale:"us"})),r=s+" "+d,u.set("fromAcntAvailBal",n)):"PC"==i?(s=checkAmount(e.formatNumber(a,{format:"#,###.00",locale:"us"})),r=s+" "+d,u.set("fromAcntAvailBal",a)):"CC"==i&&(s=checkAmount(e.formatNumber(a,{format:"#,###.00",locale:"us"})),r=s+" "+d,u.set("fromAcntAvailBal",a)),e("#availbalance").html(r),"false"==u.get("tbillerOneOffIsValid")){var f=e("input[name='ConnectionType']:checked").val();"DPDC"==u.get("selectedBillerListName")&&"PREPAID"==f?o.getOneTimeDPDCAuthMode():"Jalalabad Gas"!=u.get("selectedBillerListName")&&o.getOneTimePayBillAmount(l)}},r=function(e){o.errorresponse()};showSpinner(),o.collection=new n,o.collection.fetch({data:e.param({access_token:u.get("access_token"),accountId:t,accountType:i,beneficiaryInstructionId:null}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?s(e):r(e)},error:r})},gotoBillPayOneTimeVerifyPage:function(l){l.stopImmediatePropagation();var t=!1;e("#tandcErr").html(""),e("#billerFromAcc").html(""),e("#mobileremarkError").html(""),e("#idNullError").html(""),e("#billAmountError").html(""),e("#purposeError").html(""),e("#billerServiceError").html(""),e("#ConnTpeNullError").html(""),e("#billerOneOffBillerTypeErr").html(""),e("#billPeriodError").html("");var a=e("#mobileremark").val(),i=a.charAt(0),n=a.charAt(a.length-1);u.set("RemarkS1",a);var o=/(^(\+8801|8801|01|008801))[1|3-9]{1}(\d){8}$/,s=e("input[name='biller_onetime_transfer']:checked").val();u.set("alertType",s);var r=e("#From_billpay_acc option:selected").val(),d=e("#oneTimePay_BillerId").val(),f=isNull(e("#oneTimePay_BillAmount").val())?"":parseFloat(e("#oneTimePay_BillAmount").val().replace(/,/g,"")),c=parseFloat(u.get("fromAcntAvailBal")),m=parseFloat(u.get("dailyAvailableLimit")),O=parseFloat(u.get("minAmountPerTransaction")),p=parseFloat(u.get("maxAmountPerTransaction")),P=u.get("dailyAvailableCount"),D=u.get("monthlyAvailableCount"),C=e("input[name='ConnectionType']:checked").val(),b="Mobile / Telephone"==u.get("selectedBillerTypeName")?"a mobile number":"Insurance"==u.get("selectedBillerTypeName")?"a policy number":"Jalalabad Gas"==u.get("selectedBillerListName")?"a billing account number":"Tuition Fees"==u.get("selectedBillerTypeName")?"a payslip number":"WASA"==u.get("selectedBillerListName")||"NESCO"==u.get("selectedBillerListName")?"a Bill ID":"Land Tax"==u.get("selectedBillerListName")?"a Payment Token Number":"DPDC"==u.get("selectedBillerListName")?"a Customer Number":"WZPDCL"==u.get("selectedBillerListName")?"a Billing Account Number":"DESCO"==u.get("selectedBillerListName")&&"POSTPAID"==e("input[name='ConnectionType']:checked").val()?"a Bill Number":"DESCO"==u.get("selectedBillerListName")?"an Account Number":"a subscriber Id",v=new RegExp("^[A-Za-z0-9 ]+$");if(isNull(r)&&(t=!0,e("#billerFromAcc").html("Please select an account number")),!isNull(a)){if(a.length>16)return void e("#mobileremarkError").html("The Remarks should contain maximum of 16 characters");if(!i.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return void e("#mobileremarkError").html(e.i18n.t("validation.newregistration.firstspaceind"));if(!n.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return void e("#mobileremarkError").html(e.i18n.t("validation.newregistration.lastspaceind"))}if(!isNull(a)&&!v.test(a))return void e("#mobileremarkError").html(e.i18n.t("validation.managebene.remarksspecialchar"));if(isNull(d)&&(t=!0,e("#idNullError").html("Please enter "+b)),"Mobile / Telephone"==u.get("selectedBillerTypeName")&&(d.length<11?(t=!0,e("#idNullError").html("The mobile number should contain minimum of 11 characters")):d.length>13?(t=!0,e("#idNullError").html("The mobile number should contain maximum of 13 characters")):o.test(d)||(t=!0,e("#idNullError").html("Please enter a valid "+b))),isNull(f)&&!e("#oneTimePay_BillAmount").is(":disabled"))if(t=!0,"DPDC"==u.get("selectedBillerListName")){var C=e("input[name='ConnectionType']:checked").val();"PREPAID"==C?e("#billAmountError").html("Please enter the Pay Amount"):e("#billAmountError").html("Please enter the Bill Amount")}else e("#billAmountError").html("Please enter the Bill Amount");else{if(!isNull(f)&&parseFloat(f)<O)return void e("#billAmountError").html(e.i18n.t("validation.sadad.amtgreaterthanminamt"));if(!isNull(f)&&parseFloat(f)>c)return void e("#billAmountError").html(e.i18n.t("validation.transfer.nobal"));if(!isNull(f)&&parseFloat(f)>m)return void e("#billAmountError").html("Limit has been exhausted. Please try again later or contact the bank");if(!isNull(f)&&parseFloat(f)>p)return void e("#billAmountError").html(e.i18n.t("validation.sadad.amtlessthanmaxamt"))}if(!isNull(f)&&"0"==P)return void e("#billAmountError").html("You have exceeded your daily transaction count.");if(!isNull(f)&&"0"==D)return void e("#billAmountError").html("Transaction count exceeded Monthly Available Count.");if("Insurance"==u.get("selectedBillerTypeName")){var T=e("#toBillerPurposeOfPayment option:selected").val();if(isNull(T))return void e("#purposeError").html("Please select a purpose of payment")}if("Mobile / Telephone"==u.get("selectedBillerTypeName")){var g=e("#billPay_BillerService option:selected").val();if(""==g)return void e("#billerServiceError").html("Please select a connection type")}if("DPDC"==u.get("selectedBillerListName")||"DESCO"==u.get("selectedBillerListName")||"NESCO"==u.get("selectedBillerListName")){var B=e("input[name='ConnectionType']:checked").val();if(isNull(B))return void e("#ConnTpeNullError").html("Please select a connection type");if("DPDC"==u.get("selectedBillerListName")&&"POSTPAID"==B||"NESCO"==u.get("selectedBillerListName")&&"POSTPAID"==B){if("NESCO"!=u.get("selectedBillerListName")){var N=e("#billerOneOffBillerType option:selected").val();if(isNull(N))return void e("#billerOneOffBillerTypeErr").html("Please Select Bill Type");if("Monthly"==N||"Energy"==N){var y=e("#billPeriod option:selected").val();e("#billPeriod option:selected").text();if(isNull(y))return void e("#billPeriodError").html("Please select a month");if("DESCO"==u.get("selectedBillerListName")&&"Others"==N){var A=e("#billerOneOffBillNum").val();if(isNull(A))return void e("#billerOneOffBillNumErr").html("Please enter a bill number")}}}if("DESCO"==u.get("selectedBillerListName")&&"POSTPAID"==e("input[name='ConnectionType']:checked").val()){var A=e("#oneTimePay_BillerId").val();if(isNull(A))return void e("#idNullError").html("Please enter a bill number");e("#idNullError").html("")}else if("NESCO"==u.get("selectedBillerListName")&&"POSTPAID"==B){var y=e("#billPeriod option:selected").val();e("#billPeriod option:selected").text();if(isNull(y))return void e("#billPeriodError").html("Please select a month")}}}var h=e("#termsand").prop("checked");if(!h)return void e("#tandcErr").html("Please check the Terms and Conditions");if("true"!=u.get("authModeFlag")){var S=e("#From_billpay_acc option:selected").attr("frName"),E=e("#From_billpay_acc option:selected").attr("data"),I=e("#From_billpay_acc option:selected").html(),L=e("#currency option:selected").val(),T=e("#toBillerPurposeOfPayment option:selected").text(),_=e("#toBillerPurposeOfPayment option:selected").val(),k=e("#billPay_BillerService option:selected").attr("id"),g=e("#billPay_BillerService option:selected").val();if(!t){u.set("oneTimePay_BillAmount",f),u.set("oneTimePay_FromAccName",S),u.set("oneTimePay_FromAccNumber",I),u.set("oneTimePay_BillerCurrency",L),u.set("oneTimePay_BillerIDNumber",d),u.set("oneTimePay_BillerPaymentofPurpose",T),u.set("oneTimePay_BillerPaymentofPurposeval",_),u.set("oneTimePay_BillerServiceId",k),u.set("oneTimePay_BillerServiceName",g),u.set("oneTimeBillerFromAccCurr",E),u.set("oneTimePay_BillerToCurr","BDT");var F=this;F.oneTimePayBillPaymentValidation(l)}}},loadViewBillerTemplate:function(){var t=this;e("html").removeClass().addClass("app"),this.$el.html(l.template(c)),u.set("tbillerOneOffIsValid","false"),u.set("DESCOOneOffConnType",null),u.set("DPDCOneOffConnType",null),u.set("billerOneOffBillMonth",null),u.set("NESCOOneOffConnType",null);var a=u.get("downtimeNotification");if(!isNull(a)&&a.length>0){var i=(a[0].downtimeNotificationDetail,"");e.each(a,function(e,l){if("REGISTERED"==l.subTransactionType||"BOTH"==l.subTransactionType){var t=l.downtimeNotificationDetail,a=t[e].messageMobile;isNull(a)||(i+="<p>"+a+"</p>")}}),e("#notificationMessage").html(e.parseHTML(i))}if(e("#DPDCBillAmtLabel").html("Bill Amount"),e("#DPDCOneOffAddInfo").html(""),e("#DESCOOneOffAddInfo").html(""),e("#billPayOneOffShortNotesUIDiv").hide(),"Mobile / Telephone"==u.get("selectedBillerTypeName")&&(fillFormDatas(u.get("formDatasInEls")),isNull(e("#oneTimePay_BillAmount").val())||t.getAuthMode()),"DPDC"==u.get("selectedBillerListName")){t.loadOneTimeDPDCConnectionList();var n=e("input[name='ConnectionType']:checked").val();"POSTPAID"==n&&(e("#oneTimePay_BillAmount").attr("disabled",!0),u.set("connectionType",n),t.populateBillerTypeDropdown(event))}else if("DESCO"==u.get("selectedBillerListName")){var n=e("input[name='ConnectionType']:checked").val();"POSTPAID"==n?(e("#oneTimePay_BillAmount").attr("disabled",!0),u.set("connectionType",n),e("#DescoBillerIdLabel").html("Bill Number")):"PREPAID"==n&&(e("#oneTimePay_BillAmount").attr("disabled",!1),u.set("connectionType",n),e("#DescoBillerIdLabel").html("Enter Account Number"))}else if("NESCO"==u.get("selectedBillerListName")){var n=e("input[name='ConnectionType']:checked").val();"POSTPAID"==n&&(e("#oneTimePay_BillAmount").attr("disabled",!0),u.set("connectionType",n),t.populateBillPeriod())}("Mobile / Telephone"==u.get("selectedBillerTypeName")||"MetLife"==u.get("selectedBillerListName")||"DPDC"==u.get("selectedBillerListName"))&&e("#oneTimePay_BillAmount").blur(function(){e("#billAmountError").html("");var l=e("input[name='ConnectionType']:checked").val();"DPDC"==u.get("selectedBillerListName")&&"PREPAID"==l?t.getOneTimeDPDCAuthMode():"DESCO"!==u.get("selectedBillerListName")&&t.getAuthMode()});var n=e("input[name='ConnectionType']:checked").val();if("Mobile / Telephone"==u.get("selectedBillerTypeName")){var o=e.parseJSON(window.localStorage.getItem("shortNotesObj"));isNull(o.MOBILEONEOFF)||(e("#billPayOneOffShortNotesUIDiv").show(),e("#billPayOneOffShortNotesDiv").html(o.MOBILEONEOFF))}isNull(u.get("accountBalance"))?e("#availBalDiv").hide():(e("#availbalance").html(u.get("accountBalance")),e("#availBalDiv").show()),"Mobile / Telephone"==u.get("selectedBillerTypeName")||"MetLife"==u.get("selectedBillerListName")||"DPDC"==u.get("selectedBillerListName")&&"PREPAID"==n||"DESCO"==u.get("selectedBillerListName")&&"PREPAID"==n?e("#oneTimePay_BillAmount").attr("disabled",!1):e("#oneTimePay_BillAmount").attr("disabled",!0),"MetLife"!=u.get("selectedBillerListName")&&e("#oneTimePay_BillerId").on("blur",function(){var l=e("input[name='ConnectionType']:checked").val();"DPDC"==u.get("selectedBillerListName")&&"PREPAID"==l?t.getOneTimeDPDCAuthMode():"DPDC"!=u.get("selectedBillerListName")&&"DESCO"!=u.get("selectedBillerListName")&&"NESCO"!=u.get("selectedBillerListName")||"POSTPAID"!=l?t.getOneTimePayBillAmount(event):t.populateBillNumber(event)})},navigateToVerifyPage:function(e){e.stopImmediatePropagation(),u.set("beneSuccessFlag","true"),u.set("thisInputId",null),u.set("formDatasInEls",null),u.set("accountBalance",null),t.history.navigate("#/billonetimepayverify")},oneTimePayBillPaymentValidation:function(l){if(l.stopImmediatePropagation(),"Mobile / Telephone"==u.get("selectedBillerTypeName")||"MetLife"==u.get("selectedBillerListName"));else if("false"==u.get("tbillerOneOffIsValid"))return;var t,a;"DPDC"==u.get("selectedBillerListName")?(t=u.get("oneOffBillNumber"),a=u.get("DPDCOneOffConnType")):"DESCO"==u.get("selectedBillerListName")?(t=u.get("oneOffBillNumber"),a=u.get("DESCOOneOffConnType")):"NESCO"==u.get("selectedBillerListName")&&(t=u.get("oneOffBillNumber"),a=u.get("NESCOOneOffConnType"));var i=this,n=null;"Mobile / Telephone"!=u.get("selectedBillerTypeName")&&"MetLife"!=u.get("selectedBillerListName")&&(n="PREPAID"==u.get("DPDCOneOffConnType")?null:u.get("uniqueId"));var s,r,d=(parseFloat(u.get("fromAcntAvailBal")),function(e){hideSpinner(),i.navigateToVerifyPage(l)}),f=function(e){i.errorresponse()};"DESCO"==u.get("selectedBillerListName")?("POSTPAID"==a&&(s=""),r=additionalInfo.bll_no):"WZPDCL"==u.get("selectedBillerListName")||"Jalalabad Gas"==u.get("selectedBillerListName")||"Land Tax"==u.get("selectedBillerListName")?(s=additionalInfo.bllr_accno,r=""):(s="",r=""),showSpinner(),i.collection=new o,i.collection.fetch({data:e.param({access_token:u.get("access_token"),remarks:u.get("RemarkS1"),billerId:u.get("selectedBillerListId"),transactionCurrency:u.get("oneTimePay_BillerCurrency"),fromAccountId:u.get("accountID1"),fromAcountbalance:u.get("fromAcntAvailBal"),fromAccountOwnerName:u.get("oneTimePay_FromAccName"),billername:u.get("selectedBillerListName"),billInstId:u.get("oneTimePay_BillerIDNumber"),paymentMode:"oneTimePay",validtype:"Validation",amount:u.get("oneTimePay_BillAmount"),globalid:null,uniqueid:n,billerserviceId:u.get("oneTimePay_BillerServiceId"),purpose:u.get("oneTimePay_BillerPaymentofPurposeval"),studentId:u.get("studentID"),connType:a,bill_number:t,billMonth:u.get("billerOneOffBillMonth"),bllr_accno:s,bll_no:r}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?d(e):f(e)},error:f})},gotoPreviousPage:function(e){e.stopImmediatePropagation(),u.set("thisInputId",null),u.set("formDatasInEls",null);var l=u.get("downtimeNotification");!isNull(l)&&l.length>0?t.history.navigate("#/viewbillpaylists"):"Land Tax"==u.get("selectedBillerListName")?t.history.navigate("#/viewbillpaylists"):t.history.navigate("#/selectbillpayPage")},getOneTimePayBillAmount:function(l){"object"==typeof l&&l.stopImmediatePropagation();var t=this,a=e("input[name='ConnectionType']:checked").val();"Mobile / Telephone"!=u.get("selectedBillerTypeName")&&"MetLife"!=u.get("selectedBillerListName")&&("DPDC"==u.get("selectedBillerListName")&&"PREPAID"==a?u.set("tbillerOneOffIsValid","true"):"DESCO"==u.get("selectedBillerListName")&&"PREPAID"==a?e("#oneTimePay_BillAmount").on("blur",function(e){t.getBillAmount(e)}):t.getBillAmount(l))},getBillAmount:function(l){"object"==typeof l&&l.stopImmediatePropagation(),e("#billerFromAcc").html(""),e("#oneTimeAddInfo").css("display","none"),e("#oneTimeTutition").css("display","none"),e("#studentID, #studentName, #oneTimeWaterBill, #oneTimeSurcharge, #oneTimeVat, #oneTimeConFee, #oneTimeSewerbill").html(""),e("#LandTaxHoldingNumber,#LandTaxHoldingVAT").html("");var t,a=e("#From_billpay_acc option:selected").val(),i=e("input[name='ConnectionType']:checked").val();if(t="POSTPAID"==i?u.get("billerOneOffBillNum"):e("#oneTimePay_BillerId").val(),""==a)return void e("#billerFromAcc").html("Please select an account number");if(isNull(t))l.preventDefault();else{if("Mobile / Telephone"!=u.get("selectedBillerTypeName")){if("DPDC"==u.get("selectedBillerListName")||"DESCO"==u.get("selectedBillerListName")||"NESCO"==u.get("selectedBillerListName")){var i=e("input[name='ConnectionType']:checked").val();"DPDC"==u.get("selectedBillerListName")?(u.set("DPDCOneOffConnType",i),u.set("connectionType",i)):"DESCO"==u.get("selectedBillerListName")?(u.set("DESCOOneOffConnType",i),u.set("connectionType",i)):"NESCO"==u.get("selectedBillerListName")&&(u.set("NESCOOneOffConnType",i),u.set("connectionType",i))}else"DPDC"==u.get("selectedBillerListName")?(u.set("DPDCOneOffConnType",null),u.set("connectionType",null)):"DESCO"==u.get("selectedBillerListName")?(u.set("DESCOOneOffConnType",null),u.set("connectionType",null)):"NESCO"==u.get("selectedBillerListName")&&(u.set("NESCOOneOffConnType",null),u.set("connectionType",null));var t,n;if("DESCO"==u.get("selectedBillerListName")){if("POSTPAID"==u.get("DESCOOneOffConnType")){var o=e("#billPeriod option:selected").val(),s=e("#oneTimePay_BillerId").val();if(isNull(s))return;if(("Monthly"==d||"Energy"==d)&&isNull(o))return;"Monthly"==d?t=u.get("billerOneOffBillNum"):"Others"==d&&(t=e("#billerOneOffBillNum").val())}else"PREPAID"==u.get("DESCOOneOffConnType")&&(t=e("#oneTimePay_BillerId").val(),n=e("#oneTimePay_BillAmount").val().replace(/,/g,""),u.set("getBillAmtOneOff",n));u.set("oneOffBillNumber",t)}else if("DPDC"==u.get("selectedBillerListName")){if("POSTPAID"==u.get("DPDCOneOffConnType")){var d=e("#billerOneOffBillerType option:selected").val(),o=e("#billPeriod option:selected").val(),s=e("#oneTimePay_BillerId").val();if(isNull(d)||isNull(s))return;if(("Monthly"==d||"Energy"==d)&&isNull(o))return;t=u.get("billerOneOffBillNum"),u.set("oneOffBillNumber",t)}}else if("NESCO"==u.get("selectedBillerListName")){if("POSTPAID"==u.get("NESCOOneOffConnType")){var o=e("#billPeriod option:selected").val(),s=e("#oneTimePay_BillerId").val();if(isNull(s)||isNull(o))return;t=u.get("billerOneOffBillNum")}u.set("oneOffBillNumber",t)}else t=e("#oneTimePay_BillerId").val()}if("PREPAID"==u.get("DESCOOneOffConnType")){var f=u.get("getBillAmtOneOff");if(isNull(f))return}var c=this;u.set("billBreakDown","");var m=function(t){u.set("tbillerOneOffIsValid","true"),hideSpinner();var a=e("input[name='ConnectionType']:checked").val();if("PREPAID"==a?e("#oneTimePay_BillAmount").removeAttr("disabled"):(e("#oneTimePay_BillAmount").val(u.get("transactionAmount")),e("#oneTimePay_BillAmount").attr("disabled","true")),"Insurance"==u.get("selectedBillerTypeName")&&"Guardian Life"==u.get("selectedBillerListName")){e("#showTheguardianceDiv").html("");var i=u.get("additionalInfo");u.set("studentID",null);var n='<div class="form-group"><label>Commencement Date</label><div class="clearfix"></div><span class="small">'+i.commencementDate+'</span></div><div class="form-group"><label>Due Date</label><div class="clearfix"></div><span class="small">'+i.dueDate+'</span></div><div class="form-group"><label>Policy Status</label><div class="clearfix"></div><span class="small">'+i.policyStatus+"</span></div>";e("#showTheguardianceDiv").html(n)}if("Electricity"==u.get("selectedBillerTypeName"))if("WASA"==u.get("selectedBillerListName")){e("#oneTimeAddInfo").css("display","block");var o=u.get("billBreakDown");u.set("studentID",null),e("#oneTimeWaterBill").html(checkAmount(e.formatNumber(o[4].value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span>"),e("#oneTimeSurcharge").html(checkAmount(e.formatNumber(o[1].value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span>"),e("#oneTimeVat").html(checkAmount(e.formatNumber(o[0].value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span>"),e("#oneTimeConFee").html(checkAmount(e.formatNumber(u.get("convenienceFee"),{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span>"),e("#oneTimeSewerbill").html(checkAmount(e.formatNumber(o[5].value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span>")}else"DPDC"==u.get("selectedBillerListName")?"PREPAID"==u.get("DPDCOneOffConnType")?c.populateDPDCPrepaidAddInfoDiv(l):"POSTPAID"==u.get("DPDCOneOffConnType")&&c.populateDPDCPostpaidAddInfoDiv(l):"DESCO"==u.get("selectedBillerListName")?"POSTPAID"==u.get("DESCOOneOffConnType")?c.populateDescoPostpaidAddInfoDiv(l):"PREPAID"==u.get("DESCOOneOffConnType")&&c.populateDescoPrepaidAddInfoDiv(l):"NESCO"==u.get("selectedBillerListName")&&"POSTPAID"==u.get("NESCOOneOffConnType")&&c.populateNescoPostpaidAddInfoDiv(l);if("Tuition Fees"==u.get("selectedBillerTypeName")){e("#oneTimeTutition").css("display","block");var i=u.get("additionalInfo");e("#studentID").html(i.studentId),u.set("studentID",i.studentId),u.set("bracUnivStudentID",i.studentId),e("#studentName").html(i.studentName),u.set("bracunivStudentName",i.studentName)}if("Land Tax"==u.get("selectedBillerListName")){e("#oneTimeLandTax").css("display","block");var i=u.get("additionalInfo"),o=u.get("billBreakDown");u.set("landTaxOneOffBillBreakdown",JSON.stringify(o)),u.set("landTaxOneOffAdditionalInfo",JSON.stringify(i)),e("#LandTaxLateFee").html(checkAmount(e.formatNumber(o[2].value,{format:"#,###.00",locale:"us"}))),e("#LandTaxBillAmount").html(checkAmount(e.formatNumber(o[0].value,{format:"#,###.00",locale:"us"}))),e("#LandTaxHoldingVAT").html(checkAmount(e.formatNumber(o[1].value,{format:"#,###.00",locale:"us"}))),e("#LandTaxHoldingNumber").html(i.bll_add)}("WASA"==u.get("selectedBillerListName")||"Land Tax"==u.get("selectedBillerListName")||"WZPDCL"==u.get("selectedBillerListName")||"Jalalabad Gas"==u.get("selectedBillerListName")||"Guardian Life"==u.get("selectedBillerListName")||"BRAC University"==u.get("selectedBillerListName")||"NESCO"==u.get("selectedBillerListName")&&"POSTPAID"==u.get("NESCOOneOffConnType"))&&c.getAuthMode(),
"Jalalabad Gas"==u.get("selectedBillerListName")&&c.populateJalalabadGasAddInfoDiv(l),"WZPDCL"==u.get("selectedBillerListName")&&c.populateWZPDCLAddInfoDiv(l)},O=function(l){u.set("tbillerOneOffIsValid","false"),e("#oneTimePay_BillerId").val(""),c.errorresponse(),"Electricity"==u.get("selectedBillerTypeName")&&("WASA"==u.get("selectedBillerListName")?e("#oneTimeAddInfo").css("display","none"):"DPDC"==u.get("selectedBillerListName")?"PREPAID"==u.get("DPDCOneOffConnType")?e("#DPDCOneOffAddInfo").html(""):"POSTPAID"==u.get("DPDCOneOffConnType")&&(e("#DPDCOneOffAddInfo").html(""),e("#billerOneOffBillNum").val("")):"DESCO"==u.get("selectedBillerListName")?"POSTPAID"==u.get("DESCOOneOffConnType")?(e("#DESCOOneOffAddInfo").html(""),e("#billerOneOffBillNum").val("")):"PREPAID"==u.get("DESCOOneOffConnType")&&(e("#DESCOOneOffAddInfo").html(""),e("#oneTimePay_BillAmount").val("")):"NESCO"==u.get("selectedBillerListName")&&"POSTPAID"==u.get("NESCOOneOffConnType")&&(e("#NESCOOneOffAddInfo").html(""),e("#oneTimePay_BillerId").val("")))};showSpinner(),c.collection=new r([],{}),c.collection.fetch({data:e.param({access_token:u.get("access_token"),toAccountNumber:t,conntype:u.get("connectionType"),billerServiceId:null,billerId:u.get("selectedBillerListId"),amount:u.get("getBillAmtOneOff"),billMonth:u.get("billerOneOffBillMonth")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?m(e):O(e)},error:O})}},populateDPDCPrepaidAddInfoDiv:function(l){"object"==typeof l&&l.stopImmediatePropagation(),e("#idNullError").html("");var t=u.get("additionalInfo"),a=u.get("billBreakDown"),i="";e("#DPDCOneOffAddInfo").html(""),i+="<div class='form-group'><label>Customer Number</label><p>"+t.CustomerNo+"</p></div><div class='form-group'><label>Customer Name</label><p>"+t.CustomerName+"</p></div><div class='form-group'><label>Meter Number</label><p>"+t.MeterNo+"</p></div><div class='form-group'><label>Meter Type</label><p>"+t.MeterType+"</p></div><div class='form-group'><label>Tariff</label><p>"+t.TariffProgram+"</p></div><div class='form-group'><label>Mobile Number</label><p>"+t.Mobile+"</p></div>",e("#DPDCOneOffAddInfo").html(i),u.set("DPDCPrepaidOneOffBillBreakdown",JSON.stringify(a)),u.set("DPDCPrepaidOneOffAdditionalInfo",JSON.stringify(t)),u.set("DPDCPrepaidCustomerName",t.CustomerName),u.set("DPDCPostpaidOneOffBillNumber",null),u.set("DPDCPostpaidOneOffLocationCode",null),u.set("DPDCPostpaidOneOffTotalDPDCAmt",null),u.set("DPDCPostpaidOneOffVATAmnt",null),u.set("DPDCPostpaidOneOffMobileNumber",null),u.set("DPDCPostpaidOneOffBillBreakdown",null),u.set("DPDCPostpaidOneOffAdditionalInfo",null),u.set("DPDCPostpaidOneOffCustName",null),u.set("DESCOPostpaidOneOffBillStatus",null),u.set("DESCOPostpaidOneOffName",null),u.set("DESCOPostpaidOneOffVAT",null),u.set("DESCOPostpaidOneOffDeptDetails",null),u.set("DESCOPostpaidOneOffDueDate",null),u.set("DESCOPostpaidOneOffAddress",null),u.set("DESCOPostpaidOneOffTotalBillAmount",null),u.set("DESCOPostpaidOneOffBillBreakdown",null),u.set("DESCOPostpaidOneOffAdditionalInfo",null)},populateDPDCPostpaidAddInfoDiv:function(l){"object"==typeof l&&l.stopImmediatePropagation();var t=this;e("#idNullError").html("");var a=u.get("additionalInfo"),i=u.get("billBreakDown"),n="";e("#DPDCOneOffAddInfo").html(""),n+="<div class='form-group'><label>Customer Name</label><p>"+a.CUSTOMER_NAME+"</p></div><div class='form-group'><label>Customer Number</label><p>"+a.CUSTOMER_NO+"</p></div><div class='form-group'><label>Bill Number</label><p>"+a.BILL_NUMBER+"</p></div><div class='form-group'><label>Connection Type</label><p>POSTPAID</p></div><div class='form-group'><label>Bill Due Date</label><p>"+a.LAST_PAY_DATE+"</p></div>",e.each(i,function(l,t){"total_dpdc_amount"==t.key.toLowerCase()&&(n+="<div class='form-group'><label>Energy Cost</label><p>"+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span></p></div>",u.set("DPDCPostpaidOneOffTotalDPDCAmt",t.value))}),e.each(i,function(l,t){"vat_amount"==t.key.toLowerCase()&&(n+="<div class='form-group'><label>VAT Amount</label><p>"+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span></p></div>",u.set("DPDCPostpaidOneOffVATAmnt",t.value))}),e("#DPDCOneOffAddInfo").html(n),u.set("DPDCPostpaidOneOffBillNumber",a.BILL_NUMBER),u.set("DPDCPostpaidOneOffLocationCode",a.location_code),u.set("DPDCPostpaidOneOffMobileNumber",a.MOBILE_NO),u.set("DPDCPostpaidOneOffBillBreakdown",JSON.stringify(i)),u.set("DPDCPostpaidOneOffAdditionalInfo",JSON.stringify(a)),u.set("DPDCPostpaidOneOffCustName",a.CUSTOMER_NAME),u.set("DESCOPostpaidOneOffBillStatus",null),u.set("DESCOPostpaidOneOffName",null),u.set("DESCOPostpaidOneOffVAT",null),u.set("DESCOPostpaidOneOffDeptDetails",null),u.set("DESCOPostpaidOneOffDueDate",null),u.set("DESCOPostpaidOneOffAddress",null),u.set("DESCOPostpaidOneOffTotalBillAmount",null),u.set("DESCOPostpaidOneOffBillBreakdown",null),u.set("DESCOPostpaidOneOffAdditionalInfo",null),u.set("DPDCPrepaidOneOffBillBreakdown",null),u.set("DPDCPrepaidOneOffAdditionalInfo",null),u.set("DPDCPrepaidCustomerName",null),u.set("DESCOPrepaidOneOffAccNum",null),u.set("DESCOPrepaidOneOffCusName",null),u.set("DESCOPrepaidOneOffMeterNumber",null),u.set("DESCOPrepaidOneOffTariff",null),u.set("DESCOPrepaidOneOffEnergyCost",null),u.set("DESCOPrepaidOneOffVAT",null),u.set("DESCOPrepaidOneOffTotalAmt",null),u.set("DESCOPrepaidOneOffBillBreakdown",null),u.set("DESCOPrepaidOneOffAdditionalInfo",null),t.getAuthMode(l)},populateDescoPostpaidAddInfoDiv:function(l){"object"==typeof l&&l.stopImmediatePropagation();var t=this,a=u.get("additionalInfo"),i=u.get("billBreakDown"),n="";e("#DESCOOneOffAddInfo").html(""),n+="<div class='form-group'><label>Address</label><p>"+a.bll_add+"</p></div>",n+="<div class='form-group'><label>Account Number</label><p>"+a.bllr_accno+"</p></div>",n+="<div class='form-group'><label>Mobile Number</label><p>"+a.bll_mobno+"</p></div>",n+="<div class='form-group'><label>Bill Due Date</label><p>"+a.bll_dt_due+"</p></div>",e.each(i,function(l,t){"bll_amnt"==t.key.toLowerCase()&&(n+="<div class='form-group'><label>Bill Amount</label><p>"+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span></p></div>",u.set("WZPDCLOneOffBillAmnt",t.value)),"bll_vat"==t.key.toLowerCase()&&(n+="<div class='form-group'><label>VAT Amount</label><p>"+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span></p></div>",u.set("WZPDCLOneOffVATAmnt",t.value)),"bll_late_fee"==t.key.toLowerCase()&&(n+="<div class='form-group'><label>Late Fee</label><p>"+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span></p></div>",u.set("WZPDCLOneOffLateFee",t.value))}),e("#DESCOOneOffAddInfo").html(n),u.set("DESCOPostpaidOneOffBillStatus",a.bill_number),u.set("DESCOPostpaidOneOffName",a.NAME),u.set("DESCOPostpaidOneOffAccNum",a.ACCOUNT_NO),u.set("DESCOPostpaidOneOffVAT",i[0].value),u.set("DESCOPostpaidOneOffEnergyCost",i[2].value),u.set("DESCOPostpaidOneOffLPC",i[1].value),u.set("DESCOPostpaidOneOffDeptDetails",a.DEPT_ID),u.set("DESCOPostpaidOneOffTariff",a.TARIFF),u.set("DESCOPostpaidOneOffDueDate",a.DUE_DATE),u.set("DESCOPostpaidOneOffAddress",a.STREET_ADDRESS),u.set("DESCOPostpaidOneOffTotalBillAmount",i[3].value),u.set("DESCOPostpaidOneOffBillBreakdown",JSON.stringify(i)),u.set("DESCOPostpaidOneOffAdditionalInfo",JSON.stringify(a)),u.set("DPDCPrepaidOneOffBillBreakdown",null),u.set("DPDCPrepaidOneOffAdditionalInfo",null),u.set("DPDCPrepaidCustomerName",null),u.set("DESCOPrepaidOneOffAccNum",null),u.set("DESCOPrepaidOneOffCusName",null),u.set("DESCOPrepaidOneOffMeterNumber",null),u.set("DESCOPrepaidOneOffTariff",null),u.set("DESCOPrepaidOneOffEnergyCost",null),u.set("DESCOPrepaidOneOffVAT",null),u.set("DESCOPrepaidOneOffTotalAmt",null),u.set("DESCOPrepaidOneOffBillBreakdown",null),u.set("DESCOPrepaidOneOffAdditionalInfo",null),u.set("DPDCPostpaidOneOffBillNumber",null),u.set("DPDCPostpaidOneOffLocationCode",null),u.set("DPDCPostpaidOneOffTotalDPDCAmt",null),u.set("DPDCPostpaidOneOffVATAmnt",null),u.set("DPDCPostpaidOneOffMobileNumber",null),u.set("DPDCPostpaidOneOffBillBreakdown",null),u.set("DPDCPostpaidOneOffAdditionalInfo",null),u.set("DPDCPostpaidOneOffCustName",null),t.getAuthMode(l)},populateDescoPrepaidAddInfoDiv:function(l){"object"==typeof l&&l.stopImmediatePropagation();var t=this,a=u.get("additionalInfo"),i=u.get("billBreakDown"),n="";e("#DESCOOneOffAddInfo").html(""),n+='<div class="form-group"><label>Customer Name</label><p>'+a.customerName+'</p></div><div class="form-group"><label>Account Number</label><p>'+a.accountNo+'</p></div><div class="form-group"><label>Meter Number</label><p>'+a.meterNo+'</p></div><div class="form-group"><label>Tariff</label><p>'+a.tariff+"</p></div>",e.each(i,function(l,t){"energyamount"==t.key.toLowerCase()&&(n+='<div class="form-group"><label>Energy Cost</label><p>'+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+' <span class="cur">BDT</span></p></div>',u.set("DESCOPrepaidOneOffEnergyCost",t.value))}),e.each(i,function(l,t){"vat"==t.key.toLowerCase()&&(n+='<div class="form-group"><label>VAT Amount</label><p>'+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+' <span class="cur">BDT</span></p></div>',u.set("DESCOPrepaidOneOffVAT",t.value))}),e.each(i,function(e,l){if(!isNull(l.key)&&l.key.includes("charges_")){var t=l.key.replace("charges_","");n+='<div class="form-group"><label>'+t+"</label><p>"+l.value+'<span class="cur"> BDT</span></p></div>'}}),e("#DESCOOneOffAddInfo").html(n),u.set("DESCOPostpaidOneOffBillStatus",null),u.set("DESCOPostpaidOneOffName",null),u.set("DESCOPostpaidOneOffVAT",null),u.set("DESCOPostpaidOneOffDeptDetails",null),u.set("DESCOPostpaidOneOffDueDate",null),u.set("DESCOPostpaidOneOffAddress",null),u.set("DESCOPostpaidOneOffTotalBillAmount",null),u.set("DESCOPostpaidOneOffBillBreakdown",null),u.set("DESCOPostpaidOneOffAdditionalInfo",null),u.set("DPDCPrepaidOneOffBillBreakdown",null),u.set("DPDCPrepaidOneOffAdditionalInfo",null),u.set("DPDCPrepaidCustomerName",null),u.set("DPDCPostpaidOneOffBillNumber",null),u.set("DPDCPostpaidOneOffLocationCode",null),u.set("DPDCPostpaidOneOffTotalDPDCAmt",null),u.set("DPDCPostpaidOneOffVATAmnt",null),u.set("DPDCPostpaidOneOffMobileNumber",null),u.set("DPDCPostpaidOneOffBillBreakdown",null),u.set("DPDCPostpaidOneOffAdditionalInfo",null),u.set("DPDCPostpaidOneOffCustName",null),u.set("DESCOPrepaidOneOffAccNum",a.accountNo),u.set("DESCOPrepaidOneOffCusName",a.customerName),u.set("DESCOPrepaidOneOffMeterNumber",a.meterNo),u.set("DESCOPrepaidOneOffTariff",a.tariff),u.set("DESCOPrepaidOneOffTotalAmt",u.get("getBillAmtOneOff")),u.set("DESCOPrepaidOneOffBillBreakdown",JSON.stringify(i)),u.set("DESCOPrepaidOneOffAdditionalInfo",JSON.stringify(a)),t.getAuthMode(l)},populateNescoPostpaidAddInfoDiv:function(l){"object"==typeof l&&l.stopImmediatePropagation();var t=u.get("additionalInfo"),a=u.get("billBreakDown"),i="";e("#NESCOOneOffAddInfo").html(""),i+='<div class="form-group"><label>Consumer Name</label><p>'+t.customer_name+'</p></div><div class="form-group"><label>Consumer Number</label><p>'+t.account_number+'</p></div><div class="form-group"><label>Bill Number</label><p>'+t.bill_number+'</p></div><div class="form-group"><label>Bill Due Date</label><p>'+t.due_date+"</p></div>",e.each(a,function(l,t){"bill_amount"==t.key.toLowerCase()&&(i+='<div class="form-group"><label>Energy Cost</label><p>'+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+' <span class="cur">BDT</span></p></div>',u.set("NESCOPostpaidOneOffEnergyCost",t.value))}),e.each(a,function(l,t){"vat_amount"==t.key.toLowerCase()&&(i+='<div class="form-group"><label>VAT Amount</label><p>'+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+' <span class="cur">BDT</span></p></div>',u.set("NESCOPostpaidOneOffVatAmt",t.value))}),e.each(a,function(l,t){"lpc_amount"==t.key.toLowerCase()&&(isNull(t.value)||"0"==t.value?u.set("NESCOPostpaidOneOffLatePaymentCharge",null):(i+='<div class="form-group"><label>Late Payment Charges</label><p>'+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+' <span class="cur">BDT</span></p></div>',u.set("NESCOPostpaidOneOffLatePaymentCharge",t.value)))}),e("#NESCOOneOffAddInfo").html(i),u.set("NESCOPostpaidOneOffCusName",t.customer_name),u.set("NESCOPostpaidOneOffConsumerNumber",t.account_number),u.set("NESCOPostpaidOneOffBillDueDate",t.due_date),u.set("NESCOPostpaidOneOffBillPayStatus",t.status_title),u.set("NESCOPostpaidOneOffTotalNescoAmt",u.get("transactionAmount")),u.set("NESCOPostpaidOneOffEnergyCost",a[0].value),u.set("NESCOPostpaidOneOffLatePaymentCharge",a[3].value),u.set("NESCOPostpaidOneOffVatAmt",a[4].value),u.set("NESCOPostpaidOneOffTotalBillAmt",u.get("transactionAmount")),u.set("NESCOPostpaidOneOffAdditionalInfo",JSON.stringify(t)),u.set("NESCOPostpaidOneOffBillBreakdown",JSON.stringify(a)),u.set("DESCOPostpaidOneOffBillStatus",null),u.set("DESCOPostpaidOneOffName",null),u.set("DESCOPostpaidOneOffVAT",null),u.set("DESCOPostpaidOneOffDeptDetails",null),u.set("DESCOPostpaidOneOffDueDate",null),u.set("DESCOPostpaidOneOffAddress",null),u.set("DESCOPostpaidOneOffTotalBillAmount",null),u.set("DESCOPostpaidOneOffBillBreakdown",null),u.set("DESCOPostpaidOneOffAdditionalInfo",null),u.set("DPDCPrepaidOneOffBillBreakdown",null),u.set("DPDCPrepaidOneOffAdditionalInfo",null),u.set("DPDCPrepaidCustomerName",null),u.set("DESCOPrepaidOneOffAccNum",null),u.set("DESCOPrepaidOneOffCusName",null),u.set("DESCOPrepaidOneOffMeterNumber",null),u.set("DESCOPrepaidOneOffTariff",null),u.set("DESCOPrepaidOneOffEnergyCost",null),u.set("DESCOPrepaidOneOffVAT",null),u.set("DESCOPrepaidOneOffTotalAmt",null),u.set("DESCOPrepaidOneOffBillBreakdown",null),u.set("DESCOPrepaidOneOffAdditionalInfo",null),u.set("DPDCPostpaidOneOffBillNumber",null),u.set("DPDCPostpaidOneOffLocationCode",null),u.set("DPDCPostpaidOneOffTotalDPDCAmt",null),u.set("DPDCPostpaidOneOffVATAmnt",null),u.set("DPDCPostpaidOneOffMobileNumber",null),u.set("DPDCPostpaidOneOffBillBreakdown",null),u.set("DPDCPostpaidOneOffAdditionalInfo",null),u.set("DPDCPostpaidOneOffCustName",null),u.set("jalalabadOneOffVATAmnt",null),u.set("jalalabadOneOffLateFee",null),u.set("jalalabadOneOffBillBreakdown",null),u.set("jalalabadOneOffAdditionalInfo",null)},populateWZPDCLAddInfoDiv:function(l){"object"==typeof l&&l.stopImmediatePropagation(),e("#idNullError").html("");var t=u.get("additionalInfo"),a=u.get("billBreakDown"),i="";e("#WZPDCLOneOffAddInfo").html(""),i+="<div class='form-group'><label>Address</label><p>"+t.bll_add+"</p></div>",i+="<div class='form-group'><label>Bill Number</label><p>"+t.bll_no+"</p></div>",i+="<div class='form-group'><label>Location Code</label><p>"+t.bll_loc_cd+"</p></div>",i+="<div class='form-group'><label>Bill Due Date</label><p>"+t.bll_dt_due+"</p></div>",e.each(a,function(l,t){"bll_amnt"==t.key.toLowerCase()&&(i+="<div class='form-group'><label>Bill Amount</label><p>"+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span></p></div>",u.set("WZPDCLOneOffBillAmnt",t.value)),"bll_vat"==t.key.toLowerCase()&&(i+="<div class='form-group'><label>VAT Amount</label><p>"+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span></p></div>",u.set("WZPDCLOneOffVATAmnt",t.value)),"bll_late_fee"==t.key.toLowerCase()&&(i+="<div class='form-group'><label>Late Fee</label><p>"+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span></p></div>",u.set("WZPDCLOneOffLateFee",t.value))}),i+='<div class="form-group"><label>Connection Type</label><div class="clearfix"></div><span class="cur">Post-Paid</span></div>',e("#WZPDCLOneOffAddInfo").html(i),u.set("jalalabadOneOffVATAmnt",null),u.set("jalalabadOneOffLateFee",null),u.set("jalalabadOneOffBillBreakdown",null),u.set("jalalabadOneOffAdditionalInfo",null),u.set("jalalabadOneOffBillAmnt",null),u.set("WZPDCLOneOffBillBreakdown",JSON.stringify(a)),u.set("WZPDCLOneOffAdditionalInfo",JSON.stringify(t)),u.set("DPDCPostpaidOneOffBillBreakdown",null),u.set("DPDCPostpaidOneOffAdditionalInfo",null),u.set("DPDCPrepaidCustomerName",null),u.set("DPDCPostpaidOneOffBillNumber",null),u.set("DPDCPostpaidOneOffLocationCode",null),u.set("DPDCPostpaidOneOffTotalDPDCAmt",null),u.set("DPDCPostpaidOneOffVATAmnt",null),u.set("DPDCPostpaidOneOffMobileNumber",null),u.set("DPDCPostpaidOneOffBillBreakdown",null),u.set("DPDCPostpaidOneOffAdditionalInfo",null),u.set("DPDCPostpaidOneOffCustName",null),u.set("DESCOPostpaidOneOffBillStatus",null),u.set("DESCOPostpaidOneOffName",null),u.set("DESCOPostpaidOneOffVAT",null),u.set("DESCOPostpaidOneOffDeptDetails",null),u.set("DESCOPostpaidOneOffDueDate",null),u.set("DESCOPostpaidOneOffAddress",null),u.set("DESCOPostpaidOneOffTotalBillAmount",null),u.set("DESCOPostpaidOneOffBillBreakdown",null),u.set("DESCOPostpaidOneOffAdditionalInfo",null)},populateJalalabadGasAddInfoDiv:function(l){"object"==typeof l&&l.stopImmediatePropagation(),e("#idNullError").html("");var t=u.get("additionalInfo"),a=u.get("billBreakDown"),i="";e("#JalalabadOneOffAddInfo").html(""),i+="<div class='form-group'><label>Mobile Number</label><p>"+t.bll_mobno+"</p></div>",e.each(a,function(l,t){"bll_amnt"==t.key.toLowerCase()&&(i+="<div class='form-group'><label>Bill Amount</label><p>"+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span></p></div>",u.set("jalalabadOneOffBillAmnt",t.value)),"bll_vat"==t.key.toLowerCase()&&(i+="<div class='form-group'><label>VAT Amount</label><p>"+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span></p></div>",u.set("jalalabadOneOffVATAmnt",t.value)),"bll_late_fee"==t.key.toLowerCase()&&(i+="<div class='form-group'><label>Late Fee</label><p>"+checkAmount(e.formatNumber(t.value,{format:"#,###.00",locale:"us"}))+" <span class='cur'>BDT</span></p></div>",u.set("jalalabadOneOffLateFee",t.value))}),i+='<div class="form-group"><label>Connection Type</label><div class="clearfix"></div><span class="cur">Post-Paid</span></div>',e("#JalalabadOneOffAddInfo").html(i),u.set("jalalabadOneOffBillBreakdown",JSON.stringify(a)),u.set("jalalabadOneOffAdditionalInfo",JSON.stringify(t)),u.set("DPDCPostpaidOneOffBillBreakdown",null),u.set("DPDCPostpaidOneOffAdditionalInfo",null),u.set("DPDCPrepaidCustomerName",null),u.set("DPDCPostpaidOneOffBillNumber",null),u.set("DPDCPostpaidOneOffLocationCode",null),u.set("DPDCPostpaidOneOffTotalDPDCAmt",null),u.set("DPDCPostpaidOneOffVATAmnt",null),u.set("DPDCPostpaidOneOffMobileNumber",null),u.set("DPDCPostpaidOneOffBillBreakdown",null),u.set("DPDCPostpaidOneOffAdditionalInfo",null),u.set("DPDCPostpaidOneOffCustName",null),u.set("DESCOPostpaidOneOffBillStatus",null),u.set("DESCOPostpaidOneOffName",null),u.set("DESCOPostpaidOneOffVAT",null),u.set("DESCOPostpaidOneOffDeptDetails",null),u.set("DESCOPostpaidOneOffDueDate",null),u.set("DESCOPostpaidOneOffAddress",null),u.set("DESCOPostpaidOneOffTotalBillAmount",null),u.set("DESCOPostpaidOneOffBillBreakdown",null),u.set("DESCOPostpaidOneOffAdditionalInfo",null)},errorresponse:function(){hideSpinner(),openErrorPopup()},billPayOneTimePayOpenTandCPopup:function(e){e.stopImmediatePropagation(),"Mobile / Telephone"==u.get("selectedBillerTypeName")?u.set("tandctype","mobileoneoff"):"Electricity"==u.get("selectedBillerTypeName")?"DESCO"==u.get("selectedBillerListName")?u.set("tandctype","descooneoff"):"NESCO"==u.get("selectedBillerListName")?u.set("tandctype","nescooneoff"):"DPDC"==u.get("selectedBillerListName")?u.set("tandctype","dpdconeoff"):"WZPDCL"==u.get("selectedBillerListName")&&u.set("tandctype","wzpdcloneoff"):"Internet"==u.get("selectedBillerTypeName")?u.set("tandctype","internetoneoff"):"Insurance"==u.get("selectedBillerTypeName")?u.set("tandctype","insuranceoneoff"):"Tuition Fees"==u.get("selectedBillerTypeName")?u.set("tandctype","tuitionfeeoneoff"):"Water"==u.get("selectedBillerTypeName")?u.set("tandctype","utilityoneoff"):"Government E-Services"==u.get("selectedBillerTypeName")?"Land Tax"==u.get("selectedBillerListName")&&u.set("tandctype","landTaxoneoff"):"Gas"==u.get("selectedBillerTypeName")&&u.set("tandctype","gasoneoff"),openTermsAndConditionsPopup()},toggleLabel:function(l){var t=this;l.stopImmediatePropagation(),e("#billAmountError").html(""),e("#DPDCOneOffAddInfo").html(""),e("#DESCOOneOffAddInfo").html(""),e("#oneTimePay_BillerId").val(""),e("#oneTimePay_BillAmount").val(""),e("#idNullError").html("");var a=e("input[name='ConnectionType']:checked").val();"PREPAID"==a?(e("#oneTimePay_BillAmount").attr("disabled",!1),u.set("connectionType",a),e("#billerTypeDiv").html(""),e("#billerOneOffBillerType").val(""),e("#billerOneOffMonthlyDiv").html(""),e("#billPeriod").val(""),e("#billerOneOffBillNum").val(""),e("#billerOneOffBillNumDiv").html(""),"DESCO"==u.get("selectedBillerListName")&&e("#DescoBillerIdLabel").html("Enter Account Number")):"POSTPAID"==a&&(e("#oneTimePay_BillAmount").attr("disabled",!0),u.set("connectionType",a),t.populateBillerTypeDropdown(l),"DESCO"==u.get("selectedBillerListName")&&(e("#DescoBillerIdLabel").html("Bill Number"),e("#oneTimePay_BillerId").attr("maxLength","12"),e("#totalBillAmtDesco").html("Total Bill Amount")))},populateBillerTypeDropdown:function(l){"object"==typeof l&&l.stopImmediatePropagation();var t=this;e("#billerTypeDiv").html("");var a=u.get("billerTypeList");if("POSTPAID"==u.get("connectionType")&&"DPDC"==u.get("selectedBillerListName")){var i="<label> Bill Type </label>";"DESCO"==u.get("selectedBillerListName")?(i+='<select name="desco_billerType" id="billerOneOffBillerType" class="form-control">',i+='<option value=""  selected="selected">Select a Bill Type</option>',e.each(a,function(e,l){i+='<option value="'+l.code+'">'+l.values+"</option>"}),i+="</select>"):"DPDC"==u.get("selectedBillerListName")&&(i+='<select name="desco_billerType" id="billerOneOffBillerType" class="form-control" disabled>',i+='<option value=""  selected="selected">Select a Bill Type</option>',e.each(a,function(e,l){"Energy"==l.code&&(i+='<option value="'+l.code+'" selected>'+l.values+"</option>")}),i+="</select>"),i+='<div class="form-group has-error"><p class="help-block error-message has-error" style="color:#a94442" id="billerOneOffBillerTypeErr"></p></div>'}e("#billerTypeDiv").html(i),e("#billerOneOffBillerType").on("change",function(l){var a=e("#billerOneOffBillerType option:selected").val();"Monthly"==a||"Energy"==a?t.populateBillPeriod(l):"Others"==a&&(e("#billerOneOffMonthlyDiv").html(""),t.populateBillNumberInput(l))}),"DPDC"==u.get("selectedBillerListName")&&"POSTPAID"==u.get("connectionType")&&t.populateBillPeriod(l)},populateBillNumberInput:function(l){e("#billerOneOffBillNumDiv").html("");var t="";t+='<label>Bill Number</label><div class="form-group"><input type="text" autocomplete="off" class="form-control numericlengthcontrol" id="billerOneOffBillNum" pattern="[0-9]*" name="billNumber" maxLength="20"></div><div class="form-group has-error"><p class="help-block error-message has-error" style="color:#a94442" id="billerOneOffBillNumErr"></p></div>',e("#billerOneOffBillNumDiv").html(t),e(".numericlengthcontrol").inputnumericlength()},populateBillPeriod:function(l){"object"==typeof l&&l.stopImmediatePropagation(),e("#billerOneOffMonthlyDiv").html("");var t=this,a=u.get("periodList"),i=["January","February","March","April","May","June","July","August","September","October","November","December"],n=new Date,o=n.getMonth()-1,s=i[o],r="";r+='<label> Bill Period </label><select id="billPeriod" class="form-control"><option value="">Select Bill Period</option>',e.each(a,function(e,l){var t=l.values.split(" "),a=t[0];r+=a==s?'<option value="'+l.code+'" selected>'+l.values+"</option>":'<option value="'+l.code+'">'+l.values+"</option>"}),r+='</select><div class="form-group has-error"><p class="help-block error-message has-error" style="color:#a94442" id="billPeriodError"></p></div>',e("#billerOneOffMonthlyDiv").html(r),t.populateBillNumber(l),e("#billPeriod").on("change",function(e){t.populateBillNumber(e)})},populateBillNumber:function(l){"object"==typeof l&&l.stopImmediatePropagation();var t=e("input[name='ConnectionType']:checked").val();if(!("DPDC"==u.get("selectedBillerListName")&&"PREPAID"==t||"DPDC"==u.get("selectedBillerListName")&&"POSTPAID"==t&&"true"==u.get("tbillerOneOffIsValid"))){var a=this,i=e("#billerOneOffBillerType option:selected").val(),n=e("#billPeriod option:selected").val(),o=e("#oneTimePay_BillerId").val();if(u.set("billerOneOffBillNum",o),"Monthly"!=i&&"Energy"!=i||isNull(n)||isNull(o)){if("Others"==i)"DESCO"==u.get("selectedBillerListName")&&e("#billerOneOffBillNum").val("");else if("NESCO"==u.get("selectedBillerListName")){var n=e("#billPeriod option:selected").val(),s=n.slice(0,4),r=n.slice(-2),d=o+r+s,f=s+r;u.set("billerOneOffBillNum",d),u.set("billerOneOffBillMonth",f)}}else if("DESCO"==u.get("selectedBillerListName")||"DPDC"==u.get("selectedBillerListName")){var c=n.slice(2,4),r=n.slice(-2);if("DESCO"==u.get("selectedBillerListName"))var d=r+c+o;else if("DPDC"==u.get("selectedBillerListName"))var d=o;var f=n;e("#billerOneOffBillNum").val(d),u.set("billerOneOffBillNum",d),u.set("billerOneOffBillMonth",f)}if("DESCO"==u.get("selectedBillerListName")||"DPDC"==u.get("selectedBillerListName")&&"POSTPAID"==u.get("DPDCOneOffConnType"))var d=u.get("billerOneOffBillNum");else if("NESCO"==u.get("selectedBillerListName"))var d=u.get("billerOneOffBillNum");"DESCO"==u.get("selectedBillerListName")&&"POSTPAID"==u.get("DPDCOneOffConnType")&&a.getBillAmount(l),u.set("getBillAmtOneOff",null),isNull(d)||a.getOneTimePayBillAmount(l)}},getDPDCBillAmount:function(l){"object"==typeof l&&l.stopImmediatePropagation();var t=this,a=e("input[name='ConnectionType']:checked").val();"DPDC"==u.get("selectedBillerListName")&&"POSTPAID"==a&&e("#oneTimePay_BillerId").keyup(function(e){var l=this.value.length;8==l&&(e.preventDefault(),t.populateBillNumber(e))})},disposeView:function(e){return t.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return O});