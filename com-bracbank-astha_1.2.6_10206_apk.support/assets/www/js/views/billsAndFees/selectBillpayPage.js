define(["jquery","underscore","Backbone","collections/bills/getBillerCollections","collections/bills/getBillAmountCollections","text!views/billsAndFees/selectBillpayPage.tpl"],function(e,t,l,i,a,r){var s=new EncryptedLocalStorage("secret"),n=l.View.extend({el:"#container",events:{"click #billPaySelectNextBtn":"gotobillPayToBeneInitiatePage","click #addBillerBtn_BillPay":"gotoAddBillerPage","click .markSelect":"loadselectbene","click #billPayOneTimeBtn":"loadBillPayOneTimeUI","keyup #billpay_search_box":"filterBillPayList","click #billpay_edit_biller_btn":"gotoEditBillerPage"},initialize:function(){s.set("thisInputId",null),s.set("formDatasInEls",null),s.set("accountBalance",null)},loadBillPayOneTimeUI:function(e){l.history.navigate("#/billpayonetimepay")},render:function(){var t=this;showSpinner();var a,r=function(e){s.set("downtimeTransType","BILLPAY");var i=s.get("downtimeNotification");if(!isNull(i)&&i.length>0){var a=i[0].subTransactionType;s.set("subTransType",a),"BOTH"==a?(hideSpinner(),l.history.navigate("#/downtimeboth")):"REGISTERED"==a?l.history.navigate("#/billpayonetimepay"):"ONE-OFF"==a&&(hideSpinner(),t.loadTemplate())}else hideSpinner(),t.loadTemplate()},n=function(e){t.errorresponse()};if("Mobile/Telephone"==s.get("selectedBillerTypeName"))a="MOBILE_BILLER";else if("Tuition Fees"==s.get("selectedBillerTypeName"))a="BRAC_UNIVERSITY";else if("Insurance"==s.get("selectedBillerTypeName"))if("Guardian Life"==s.get("selectedBillerListName"))a="GUARDIANLIFE";else var a=s.get("selectedBillerListName").toUpperCase();else if("Gas"==s.get("selectedBillerTypeName"))if("Jalalabad Gas"==s.get("selectedBillerListName"))a="JALALABAD_GAS";else var a=s.get("selectedBillerListName").toUpperCase();else if("Government E-Services"==s.get("selectedBillerTypeName"))if("Land Tax"==s.get("selectedBillerListName"))a="LAND_TAX";else var a=s.get("selectedBillerListName").toUpperCase();else a=s.get("selectedBillerListName").toUpperCase();t.collection=new i,t.collection.fetch({data:e.param({access_token:s.get("access_token"),categoryId:s.get("selectedBillerListId"),billerType:s.get("selectedBillerListName"),serviceCode:a}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):n(e)},error:n})},gotoAddBillerPage:function(e){e.stopImmediatePropagation(),s.set("thisInputId",null),s.set("formDatasInEls",null),s.set("isTransfer","true"),s.set("selectedBillerServiceType",null),s.set("billpaySuccessBillerName",null),s.set("selectedBillerListId",s.get("selectedBillerListId")),l.history.navigate("#/addbiller")},loadselectbene:function(t){t.stopImmediatePropagation();var l=e(t.currentTarget).val();s.set("selectBillID",l);var i=e(t.currentTarget).attr("data");if(s.set("selectBillIndex",i),"BRAC University"==s.get("selectedBillerListName"))var a=e(t.currentTarget).attr("payslipNum");else var a=e(t.currentTarget).attr("billNum");s.set("selectBillNumber",a);var r=e(t.currentTarget).attr("billerId");s.set("selectBillerId",r);var n=e(t.currentTarget).attr("billServId");s.set("selectBillServiceId",n);var c=e(t.currentTarget).attr("billServName");s.set("selectBillServiceName",c);var o=e(t.currentTarget).attr("billServInfo");s.set("selectBillConnectionType",o)},loadTemplate:function(){e("html").removeClass().addClass("app"),this.$el.html(t.template(r)),s.set("isOpenBookPage","false");var l=s.get("downtimeNotification");if(!isNull(l)&&l.length>0){var i=(l[0].downtimeNotificationDetail,"");e.each(l,function(e,t){if("ONE-OFF"==t.subTransactionType){var l=t.downtimeNotificationDetail,a=l[e].messageMobile;isNull(a)||(i+="<p>"+a+"</p>")}}),e("#notificationMessage").html(e.parseHTML(i))}var a=e("#bills_transfer_add_btn_div").find("span").attr("id");enableScroll(a);var n,c="";e('input[type="checkbox"]').change(function(t){var l=t.currentTarget.id;n=e(t.currentTarget).attr("data"),isNull(c)||c==l||(e("#"+c).prop("checked",!1),e("#bills_transfer_btn_div_"+c).hide()),c=l;var i=e('input[type="checkbox"]:checked').length;0==i?(e("#bills_transfer_btn_div_"+n).hide(),e("#bills_transfer_add_btn_div").show()):(e("#bills_transfer_btn_div_"+n).show(),e("#bills_transfer_add_btn_div").show())})},filterBillPayList:function(t){t.stopImmediatePropagation();jQuery.expr[":"].contains=function(e,t,l){return jQuery(e).text().toUpperCase().indexOf(l[3].toUpperCase())>=0};var l=t.target.value;l.length>0?(e(".search_clear").is(":visible")||(e(".search_clear").show(),e(".search_clear").on("click",function(){e("#billpay_search_box").val(""),e(".billPayItems").show(),e("#billpay_search_box").focus(),e(".search_clear").hide(),e(".nodata").hide()})),e(".billPayItems").hide(),e('.billPayItems:contains("'+l+'")').length>0?(e(".nodata").hide(),e('.billPayItems:contains("'+l+'")').show()):e(".nodata").show()):(e(".search_clear").hide(),e(".nodata").hide(),e(".billPayItems").show())},gotoEditBillerPage:function(t){t.stopImmediatePropagation(),s.set("istransferPageFlag","true");var i=e("input[name='choice']:checked").val();s.set("selectedBillerId",i);var a=e("input[name='choice']:checked").attr("id");s.set("selectedBillerInd",a);var r=e("input[name='choice']:checked").attr("billNum");s.set("selectedBillerNumber",r);var n=e("input[name='choice']:checked").attr("shortName");s.set("selectedBillerShortName",n);var c=e("input[name='choice']:checked").attr("billServId");s.set("selectedBillerServId",c);var o=e("input[name='choice']:checked").attr("billerId");s.set("selectedBillId",o),l.history.navigate("#/editbiller")},gotobillPayToBeneInitiatePage:function(e){e.stopImmediatePropagation(),s.set("isManageBene","false");var t=this;"Mobile / Telephone"==s.get("selectedBillerTypeName")||"MetLife"==s.get("selectedBillerListName")||"DPDC"==s.get("selectedBillerListName")||"DESCO"==s.get("selectedBillerListName")||"NESCO"==s.get("selectedBillerListName")?l.history.navigate("#/billpaytobillerinit"):t.getBillAmount()},getBillAmount:function(){var t=this,i=function(e){hideSpinner(),l.history.navigate("#/billpaytobillerinit")},r=function(e){t.errorresponse()};showSpinner(),t.collection=new a([],{}),t.collection.fetch({data:e.param({access_token:s.get("access_token"),toAccountNumber:s.get("selectBillNumber"),conntype:s.get("selectBillConnectionType"),billerServiceId:s.get("selectBillServiceId"),billerId:s.get("selectBillerId")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):r(e)},error:r})},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return l.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return n});