define(["jquery","underscore","Backbone","text!views/accounts/accdetailstatement.tpl","text!views/accounts/accdetailstatementview.tpl","text!views/accounts/accdetailstatementPagination.tpl","collections/accounts/casaEmailStmtShareCollections","collections/accounts/casaEmailStmtSharehistoryCollection",,"views/errors/exception"],function(e,t,a,i,o,n,r,s,l){var c=new EncryptedLocalStorage("secret"),m=a.View.extend({el:"#container",events:{"click #dwldDetailPDF":"PDFDownload","click #shareBtn":"showSharePopUp","click #shareHistory":"gotoShareHistory","click #usernametip":"showPasswordTipPopUp","click #DS_sendBtn1":"showMailSentSuccessPopUp","click #ok":"backToSharePopUp","click #otherMail":"showOtherMailDiv","click #myMail":"showMyMailDiv"},initialize:function(){},update:function(){hideSpinner(),c.set("pageno","1"),c.set("tranback","0"),c.set("currentpage","1"),e("html").removeClass("app state").addClass("app"),this.$el.html(t.template(o)),e("#pagingcontent").html(t.template(n))},PDFDownload:function(e){e.stopImmediatePropagation();var t="",a=c.get("app.context.path");t=a+"account/ministatement/download.pdf";var i,o;"true"==c.get("isFromStatementDwld")?(i=c.get("selAccID"),o=c.get("selAccBranchDesc")):(i=c.get("accountId"),o=c.get("branchDesc"));var n="access_token="+c.get("access_token")+"&emailRequired=&accountID="+i+"&appchecksum=&fromAmount="+c.get("frmAmt")+"&toAmount="+c.get("toamt")+"&lastnTxn=&type=CASA&toDate="+c.get("stmtToDate")+"&fromDate="+c.get("stmtFromDate")+"&debitCreditFlag=B&cardtype=&authtype=&statementType=Detail&branch="+o+"&module=FILTERED&filterby="+c.get("filterBy")+"&sortBy=&sortOrder=ASC",r=encodeURI(n);fileDownLoadAndViewer(t,r,1,c.get("access_token"))},showSharePopUp:function(t){t.stopImmediatePropagation(),e("#shareme").modal("show"),e("#myMail").prop("checked",!0),e("#myMailDiv").show(),e("#otherMailDiv").hide()},showPasswordTipPopUp:function(t){t.stopImmediatePropagation(),e("#shareme").modal("hide"),e("#usernameTips").modal("show")},showMailSentSuccessPopUp:function(t){t.stopImmediatePropagation();var a=!1;e("#emailNullError").html(""),e("#PwdNullError").html(""),e("#emailNullErrorDiv, #PwdNullErrorDiv").hide();var i=this,o=e("input[name='mailOptions']:checked").val();c.get("pwdpolicy");if("myMail"==o)c.set("emailadd",null),c.set("emailpwd",null),c.set("salttime",null),i.gotoEmailSharing();else if("otherMail"==o){var n=e("#emailId").val(),r=e("#passwd").val();if((null==n||""==n)&&(a=!0,e("#emailNullErrorDiv").show(),e("#emailNullError").html(e.i18n.t("validation.login.emailnullerror"))),(""==r||null==r)&&(a=!0,e("#PwdNullErrorDiv").show(),e("#PwdNullError").html(e.i18n.t("validation.login.passwordisnotnull"))),a)return;if(""!==n&&""!==r){var s=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!s.test(n))return e("#emailNullErrorDiv").show(),void e("#emailNullError").html(e.i18n.t("validation.login.validemailerror"))}c.set("emailadd",n);var l=(new Date).getTime();c.set("salttime",l),mailpassword=EncryptWithDynamicSalt(r,l),c.set("emailpwd",mailpassword),i.gotoEmailSharing()}},backToSharePopUp:function(t){t.stopImmediatePropagation(),e("#usernameTips").modal("hide"),e("#shareme").modal("show")},showOtherMailDiv:function(t){t.stopImmediatePropagation(),e("#otherMailDiv").show(),e("#myMailDiv").hide(),e("#emailId, #passwd").val("")},showMyMailDiv:function(t){t.stopImmediatePropagation(),e("#otherMailDiv").hide(),e("#myMailDiv").show()},gotoEmailSharing:function(){var t,a=c.get("stmtFromDate"),i=c.get("stmtToDate"),o=a.split("-"),n=o[0],s=o[1],l=o[2],m=l+"-"+s+"-"+n,p=i.split("-"),d=p[0],h=p[1],u=p[2],w=u+"-"+h+"-"+d,g=this,v=function(e){hideSpinner(),g.openMailSentSuccessPopUp()},D=function(e){g.errorresponse()};t="true"==c.get("isFromStatementDwld")?c.get("selAccID"):c.get("accountId"),showSpinner(),g.collection=new r,g.collection.fetch({data:e.param({access_token:c.get("access_token"),accountID:t,toDate:w,fromDate:m,debitCreditFlag:"B",emailValue:c.get("emailadd"),emailPassValue:c.get("emailpwd"),salt:c.get("salttime"),module:"FILTERED",filterby:c.get("filterBy"),sortOrder:"ASC"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?v(e):D(e)},error:D})},openMailSentSuccessPopUp:function(){e("#shareme").modal("hide"),e("#mailSent").modal("show")},gotoShareHistory:function(t){t.stopImmediatePropagation();var i,o=this;i="true"==c.get("isFromStatementDwld")?c.get("selAccID"):c.get("accountId");var n=function(e){hideSpinner(),a.history.navigate("#/sharehistory")},r=function(e){o.errorresponse()};showSpinner(),o.collection=new s([],{}),o.collection.fetch({data:e.param({access_token:c.get("access_token"),acctType:"CASA",accountID:i}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?n(e):r(e)},error:r})},errorresponse:function(){e("#shareme").modal("hide"),hideSpinner(),openErrorPopup()},disposeView:function(e){return a.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return m});