define(["jquery","underscore","Backbone","collections/wealth/loansummeryCollections","collections/logout/feedbackSurveyCollections","collections/transfer/loadWalletInfoCollection","collections/bills/fetchBillerCollections","collections/logout/logoutCollections","text!views/accounts/loans/loan.tpl","views/errors/exception"],function(e,t,o,s,i,a,r,n,l,c){var u=new EncryptedLocalStorage("secret"),d=o.View.extend({el:"#container",events:{"click #accounts_tab":"gotoWealthPage","click #creditcard_tab":"gotoCreditCardSummary","click #termdeposit_tab":"gotoTermDepositSummary","click #slide_out_savings":"savingUI","click #slide_out_creditcard":"creditUI","click #slide_out_prepaidcard":"prepaidUI","click #slide_out_deposits":"depositsUI","click #prepaid_tab":"gotoPrepaidCardSummary","click #slide_out_managebene":"loadmanagebeneUi","click #slide_out_transfers":"transfer","click #slide_out_billpay":"billpay","click #slide_out_transactions":"gotoTransferHistory","click #slide_out_statementCertificate":"gotoStatementAndCertificate","click #slide_out_positivePay":"gotopositivePay","click #slide_out_transferlimit":"gotoTransferLimit","click #slideout_more":"gotoMore","click #slideout_contact":"gotoPostLoginContactUs","click #slide_out_services":"servicesUI","click #services":"gotoServiceRequest","click #menu_more":"gotoMore","click #slide_out_user_settings":"gotoUserSettings","click #logout":"gotoFeedbackPopup","click #pushNotifications":"pushNotificationsUI","click #footerMenu_bKash":"gotobKashWalletPayment","click #footerMenu_MobileTopup":"gotoMobileTopup","click #footerMenu_billPay":"gotoBillPayPage","click #footerMenu_ccPay":"gotoCreditCardPayment","click #footerMenu_transfer":"gotoTransfer","click #footerMenu_ApplyDeposit":"gotoApplyDepositFooterMenu","click #footerMenu_Transactions":"gotoTransactionHistory","click #footerMenu_CardManagement":"gotoCardManagement","click #footerMenu_PositivePay":"gotopositivePay","click #footerMenu_BBLApps":"gotoBBLApps","click #footerMenu_getCertificate":"gotoStatementAndCertificate","click #activateCard":"gotoCardManagementPage"},initialize:function(){},savingUI:function(){o.history.navigate("#/accounttypelist")},creditUI:function(){o.history.navigate("#/creditcardtype")},prepaidUI:function(){o.history.navigate("#/prepaidcardlist")},depositsUI:function(){u.set("depositType","FDR"),u.set("isFromFooterMenu","false"),o.history.navigate("#/deposittype")},pushNotificationsUI:function(){o.history.navigate("#/pushNotifications")},render:function(){var t=this;u.set("pageid","loans");var o=function(e){hideSpinner(),t.loan()},i=function(e){t.errorresponse()};showSpinner(),t.collection=new s([],{});getDeviceId();t.collection.fetch({data:e.param({access_token:u.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?o(e):i(e)},error:i})},loan:function(){e("html").removeClass().addClass("primarybg hasBoth dashWrap fntzoom"),e("#container").html(t.template(l))},gotoWealthPage:function(){o.history.navigate("#/wealth")},gotoCreditCardSummary:function(){o.history.navigate("#/creditcardsummary")},gotoTermDepositSummary:function(){o.history.navigate("#/termdepositsummary")},gotoPrepaidCardSummary:function(){o.history.navigate("#/prepaidcardsummary")},gotoServiceRequest:function(){o.history.navigate("#/servicerequest")},transfer:function(){"N"==u.get("fullRightsFlag")?(u.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(u.set("isFromFooterMenu","false"),o.history.navigate("#/transfer"))},billpay:function(){"N"==u.get("fullRightsFlag")?(u.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(u.set("isFromFooterMenu","false"),o.history.navigate("#/billpay"))},gotoTransferHistory:function(e){e.stopImmediatePropagation(),"N"==u.get("fullRightsFlag")?(u.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(u.set("isFromFooterMenu","false"),o.history.navigate("#/transhistory"))},servicesUI:function(){u.set("isFromFooterMenu","false"),o.history.navigate("#/servicerequest")},loadmanagebeneUi:function(){"N"==u.get("fullRightsFlag")?(u.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):o.history.navigate("#/managebene")},gotoMore:function(){o.history.navigate("#/more")},gotoUserSettings:function(){o.history.navigate("#/usersettings")},gotobKashWalletPayment:function(t){if(t.stopImmediatePropagation(),u.set("isFromFooterMenu","true"),"N"==u.get("fullRightsFlag"))return u.set("isServiceReqMenu","false"),void o.history.navigate("#/viewonlymode");var s=this,i=function(t){hideSpinner();var s=u.get("walletList");e.each(s,function(e,t){if("bKash"==t.description){var s=t.id,i=t.description;u.set("walletId",s),u.set("walletType",i),o.history.navigate("#/wallettransfertobeneselect")}})},r=function(e){s.errorresponse()};showSpinner(),s.collection=new a,s.collection.fetch({data:e.param({access_token:u.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):r(e)},error:r})},gotoMobileTopup:function(t){if(t.stopImmediatePropagation(),u.set("isFromFooterMenu","true"),"N"==u.get("fullRightsFlag"))return u.set("isServiceReqMenu","false"),void o.history.navigate("#/viewonlymode");var s=this;showSpinner();var i=function(t){hideSpinner();var s=u.get("menuList");e.each(s,function(e,t){if("Mobile / Telephone"==t.description){var s=t.id,i=t.dataLabel,a=t.description;u.set("selectedBillerTypeId",s),u.set("selectedBillerTypeName",a),u.set("selectedBillerDateLabel",i),o.history.navigate("#/viewbillpaylists")}})},a=function(e){s.errorresponse()};s.collection=new r,s.collection.fetch({data:e.param({access_token:u.get("access_token"),type:"MENU",billId:null,newversion:"Y"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):a(e)},error:a})},gotoBillPayPage:function(e){e.stopImmediatePropagation(),"N"==u.get("fullRightsFlag")?(u.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(u.set("isFromFooterMenu","true"),o.history.navigate("#/billpay"))},gotoCreditCardPayment:function(e){e.stopImmediatePropagation(),"N"==u.get("fullRightsFlag")?(u.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(u.set("isFromFooterMenu","true"),o.history.navigate("#/transferbbicardviewdetail"))},gotoTransfer:function(e){e.stopImmediatePropagation(),"N"==u.get("fullRightsFlag")?(u.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(u.set("isFromFooterMenu","true"),o.history.navigate("#/transfer"))},gotoApplyDepositFooterMenu:function(e){e.stopImmediatePropagation(),"N"==u.get("fullRightsFlag")?(u.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(u.set("isFromFooterMenu","true"),o.history.navigate("#/applyForDeposit"))},gotoTransactionHistory:function(e){e.stopImmediatePropagation(),u.set("isFromFooterMenu","true"),o.history.navigate("#/transhistory")},gotoCardManagement:function(e){e.stopImmediatePropagation(),u.set("isFromFooterMenu","true"),o.history.navigate("#/cardmanage")},gotopositivePay:function(e){e.stopImmediatePropagation(),"N"==u.get("fullRightsFlag")?(u.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(u.set("isFromFooterMenu","true"),o.history.navigate("#/positivepayinit"))},gotoTransferLimit:function(e){e.stopImmediatePropagation(),"N"==u.get("fullRightsFlag")?(u.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(u.set("isFromFooterMenu","true"),o.history.navigate("#/transferlimits"))},gotoPostLoginContactUs:function(e){e.stopImmediatePropagation(),o.history.navigate("#/contact")},gotoBBLApps:function(e){e.stopImmediatePropagation(),u.set("isFromFooterMenu","true"),o.history.navigate("#/bblpartnerapps")},gotoStatementAndCertificate:function(e){e.stopImmediatePropagation(),u.set("isFromFooterMenu","true"),o.history.navigate("#/statementcertificate")},gotoCardManagementPage:function(e){e.stopImmediatePropagation(),"N"==u.get("fullRightsFlag")&&(u.set("isFromViewOnlyMode","true"),u.set("isFromWealthActiavteCard","true")),o.history.navigate("#/cardmanage")},gotoFeedbackPopup:function(t){t.stopImmediatePropagation(),showSpinner(),u.set("surveyStatus",null),u.set("surveyMesage",null),u.set("surveyQuestionIds",null),u.set("surveyQuestionRatings",null);var o=this,s=function(e){hideSpinner(),"Y"==u.get("disppop")?o.gotoPopulateFeedbackPopup(t):"N"==u.get("disppop")&&o.logout(t)},a=function(e){o.errorresponse()};o.collection=new i([],{});(new Date).getTime();o.collection.fetch({data:e.param({access_token:u.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?s(e):a(e)},error:a})},gotoPopulateFeedbackPopup:function(t){t.stopImmediatePropagation();var o=u.get("surveyList");e("#feedbackPopup").html("");var s=this,i=/iPad|iPhone|iPod/.test(navigator.userAgent),a='<div class="modal fade feedbackPop" id="feedback" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><form method="post" action="#"> <div class="modal-content"><div class="modal-header"> <button type="button" class="close" aria-label="Close" id="surveySkipButton"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">Rate Your Experience</h4></div><div class="modal-body"><div class="survey-ques"><div class="row"><div class="col-sm-12 col-md-6">';e.each(o,function(e,t){a+='<div class="ques"><span class="ques-cout">'+(e+1)+'</span><div class="rat-cnt" ques="'+t.surveyQuestion+'"><p>'+t.surveyQuestion+'</p></div><div class="rate-area rateAreaClass" id="'+t.surveyQuestionId+'_rating_value"><input type="radio" id="'+t.surveyQuestionId+'_rat1" name="rating'+(e+1)+'" value="10" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat1" title="Excellent">10 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat2" name="rating'+(e+1)+'" value="9" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat2" title="Excellent">9 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat3" name="rating'+(e+1)+'" value="8" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat3" title="Good">8 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat4" name="rating'+(e+1)+'" value="7" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat4" title="Good">7 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat5" name="rating'+(e+1)+'" value="6" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat5" title="Average">6 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat6" name="rating'+(e+1)+'" value="5" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat6" title="Average">5 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat7" name="rating'+(e+1)+'" value="4" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat7" title="Not Good">4 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat8" name="rating'+(e+1)+'" value="3" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat8" title="Not Good">3 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat9" name="rating'+(e+1)+'" value="2" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat9" title="Poor">2 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat10" name="rating'+(e+1)+'" value="1" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat10" title="Poor">1 star</label></div></div>',a+='<div class="form-group has-error"><p class="help-block error-message" style="color:#a94442" id="surveyQuesErr'+(e+1)+'"></p></div>'}),a+='</div></div><div class="form-group"><textarea class="form-control inputlengthcontrol" id="feedbackComment" placeholder="Leave a comment ( Max 500 character)" maxlength="500"></textarea><p class="text-muted small">Special characters (Space, Dot, Comma, Brackets) are allowed only.</p></div><div class="alert alert-info" role="alert">',a+=i?'<small><a href="javascript:void(0);" id="gotoStoreBtn" class="btn btn-primary btn-sm" target="_blank"><i class="fa fa-external-link"></i> Click Here</a> &nbsp;to rate us on Apple Store <img src="images/common/ios-app-store.svg" width="32" /></small>':'<small><a href="javascript:void(0);" id="gotoStoreBtn" class="btn btn-primary btn-sm" target="_blank"><i class="fa fa-external-link"></i> Click Here</a> &nbsp;to rate us on Play Store <img src="images/common/google-play.svg" width="32" /></small>',a+='</div></div></div><div class="modal-footer"><div class="row"><div class="col-xs-6 pr5"><a href="javascript:void(0);" class="btn btn-default btn-block" id="surveyLaterButton">Later</a></div><div class="col-xs-6 pl5"><a href="javascript:void(0);" class="btn btn-primary btn-block" id="surveySubmitButton">Submit</a></div></div></div></div></form></div></div>',e("#feedbackPopup").html(a),e("#feedback").modal("show"),e("#surveySkipButton").on("click",function(){u.set("surveyStatus","SKIPPED"),u.set("surveyMesage",null),u.set("surveyQuestionIds",null),u.set("surveyQuestionRatings",null),e("#feedback").modal("hide"),s.logout(t)}),e("#surveyLaterButton").on("click",function(){u.set("surveyStatus","MARKED_LATER"),u.set("surveyMesage",null),u.set("surveyQuestionIds",null),u.set("surveyQuestionRatings",null),e("#feedback").modal("hide"),s.logout(t)}),e("#surveySubmitButton").on("click",function(){u.set("surveyStatus","COMPLETED"),s.gotoGetSurveyDetails(t)}),e("#gotoStoreBtn").on("click",function(){s.gotoRateUsFunction(t)})},gotoGetSurveyDetails:function(t){t.stopImmediatePropagation();var o=!1,s=[],i=[];if(e(".rateAreaClass").each(function(t,a){e("#surveyQuesErr"+(t+1)).html("");var r=e(this).attr("id"),n=e("#"+r+" input[type='radio']:checked").attr("quesId"),l=e("#"+r+" input[type='radio']:checked").val();isNull(l)&&(o=!0,e("#surveyQuesErr"+(t+1)).html("Kindly share the valuable feedback rating")),o||(s.push(n),i.push(l))}),!o){e("#feedback").modal("hide"),u.set("surveyQuestionIds",s),u.set("surveyQuestionRatings",i);var a=e.trim(e("#feedbackComment").val());u.set("surveyMesage",a);var r=this;r.logout(t)}},gotoRateUsFunction:function(e){e.stopImmediatePropagation();var t=u.get("appInfoDTO");if(null!=t.url&&void 0!=t.url&&""!=t.url){var o=/iPad|iPhone|iPod/.test(navigator.userAgent);o?window.location.href=t.url:window.open(t.url,"_system","location=no")}},logout:function(){event.stopImmediatePropagation(),showSpinner();var t=u.get("surveyQuestionIds");if(!isNull(t))var s=t.join("~"),i=u.get("surveyQuestionRatings"),a=i.join("~");var r=this,l=function(e){hideSpinner(),u.set("isLogin",!1),u.set("defaultSessionTimeOut",0),u.set("timeoutFlagsessioncount",""),stopSessionTimer(),this.model=new accSummaryModel;var t=u.get("touchIdReg");"A"==t?o.history.navigate("#/landing"):o.history.navigate("#/applogin")},c=function(e){r.errorresponse()};r.collection=new n([],{});(new Date).getTime();r.collection.fetch({data:e.param({usersession:u.get("access_token"),access_token:u.get("access_token"),status:u.get("surveyStatus"),message:u.get("surveyMesage"),questionIds:s,questionRatings:a}),dataType:"json",type:"POST",cache:!1,success:function(e){if("0000"==ackStatus){u.get("errorcode");l("0000"==ackStatus?e:e)}else c(e)},error:c})},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return o.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return d});