define(["jquery","underscore","Backbone","collections/accounts/termDeposit/getDepositNomineeDetailsCollections","collections/accounts/termDeposit/getMaturityAmountDetailsCollections","text!views/accounts/termDeposit/applyDPSDepositInitiate.tpl","collections/accounts/termDeposit/createFDAccountCollections","collections/accounts/termDeposit/getTenuresDetailsCollections","collections/accounts/termDeposit/getProductDetailsCollections","collections/transfer/getAuthModeCollections","collections/wealth/otpPostLoginGenerationCollections","collections/wealth/otpPostLoginVerificationCollections","collections/transfer/getTransactionLimitCollections","collections/transfer/getAccountBalanceCollections","views/errors/exception"],function(e,t,o,a,r,n,i,s,l,c,p,d,u,m,h){var f=null,y=!1,g=new EncryptedLocalStorage("secret"),v=o.View.extend({el:"#container",events:{"click #backButon":"gotoPreviousPage","click #applyDPSdepositcancel":"gotoPreviousPage","click #applyDPSdepositverify":"applyDPSdepositverify","change #dpsamt":"resetValue","change #DPSSelectAcc":"DPSSelectAccOption","change #DPSProductTypeSelect":"DPSProductTypeSelect","change #tenure":"DPSTenorSelect","click #applydepositinitiatecancel":"applydepositinitiatecancel","blur #dpsamt":"amtvalidation","click #applydepositconfirm":"depositVerifySuccessPopUp","click #fd_close_btn":"revokeDepositOTPSpinner","click #fd_cancel_btn":"revokeDepositOTPSpinner","click #addDepositTandCPopup":"addDepositOpenTandCPopup"},initialize:function(){},render:function(){f=null;var o=this;e("html").removeClass().addClass("app fntzoom"),o.$el.html(t.template(n)),e("#nomine_Details").html(""),e("#renewalType").css({display:"none"}),e("#credAccount").css({display:"block"}),e("#roitext").css({display:"none"}),o.getFDAuthMode(),g.set("transamount",""),g.set("nomineeDetailsList",""),g.set("DepositAccID",""),g.set("DepositAccNumber",""),g.set("selectAccType",""),g.set("productTypeID",""),g.set("productTypeValue",""),g.set("prodSubHeadCode",""),g.set("prodTblCode",""),g.set("TenorSelect",""),g.set("prodSubHeadCode",""),g.set("prodTblCode",""),g.set("renewalopt",""),g.set("TenorSelectVal",""),g.set("depositminamt",""),e("#nomine_Relation").css({display:"none"}),g.set("depositmaxamt",""),g.set("depositmultiplesamt",""),e("#DPSProductTypeSelect").html('<option value=""  selected="selected">'+e.i18n.t("app.product.termdeposits.sltprodtype")+"</option>"),e("#tenure").html('<option value=""  selected="selected">'+e.i18n.t("app.product.termdeposits.slttenure")+"</option>"),e("#applyDPSdepositverify").prop("disabled",!1).css({"background-color":"#0072bc"}),e("#DPSProductTypeSelect").prop("disabled",!1),e("#availBalDiv").hide()},DPSSelectAccOption:function(t){"object"==typeof t&&t.stopImmediatePropagation();var o=e("#DPSSelectAcc option:selected").val(),r=e("#DPSSelectAcc option:selected").text(),n=e("#DPSSelectAcc option:selected").attr("data"),i=e("#DPSSelectAcc option:selected").attr("accstatus");e("#DPSProductTypeSelect").html('<option value=""  selected="selected">'+e.i18n.t("app.product.termdeposits.sltprodtype")+"</option>"),e("#tenure").html('<option value=""  selected="selected">'+e.i18n.t("app.product.termdeposits.slttenure")+"</option>"),g.set("DepositAccID",o),g.set("DepositAccNumber",r),g.set("selectAccType","CASA"),g.set("depoAccCurency",n),e("#nomineeError").html(""),e("#accError").html("");var s=this;e("#transAmutError").html(""),e("#credAccontSelt").val(o).change(),e("#dpsamt").val(""),g.set("productTypeID",""),g.set("productTypeValue",""),g.set("prodSubHeadCode",""),g.set("prodTblCode",""),e("#availBalDiv").hide(),e("#availbalance").html(""),g.set("depositminamt",""),g.set("nomineeDetailsList",""),e("#nomine_Details").html(""),e("#nomine_Relation").css({display:"none"}),e("#tc_check").prop("checked",!1);var l=function(t){var o=g.get("nomineeDetailsList");if(!isNull(o)&&o.length>0){e("#nomine_Details").html("");var a='<li class="list-group-item"><h4>Nominee</h4><li>';e.each(o,function(e,t){a+='<li class="list-group-item"><p class="small">'+t.nomineeName+"</span></p></li>"}),e("#nomine_Details").html(a),e("#nomine_Relation").css({display:"block"}),e("#applyDPSdepositverify").prop("disabled",!1).css({"background-color":"#0072bc"})}else e("#nomine_Details").html(""),e("#nomine_Relation").css({display:"none"}),e("#applyDPSdepositverify").prop("disabled",!0).css({"background-color":"#337ab7"}),isNull(o)&&0==o.length?e("#nomineeError").html(e.i18n.t("app.product.termdeposits.nominedetailerr")):e("#nomineeError").html(e.i18n.t("app.product.termdeposits.nominedoberror"));s.getAccountBalance()},c=function(t){e("#nomine_Details").html(""),e("#nomine_Relation").css({display:"none"}),e("#nomineeError").html(e.i18n.t("app.product.termdeposits.nominedetailerr")),e("#applydepositverify").prop("disabled",!0).css({"background-color":"#337ab7"})};s.collection=new a,isNull(o)||"A"!=i?(isError=!0,e("#availBalDiv").hide(),e("#availbalance").html(""),e("#accError").html(e.i18n.t("app.product.termdeposits.dpsaccproderr")),e("#DPSProductTypeSelect").html('<option value=""  selected="selected">'+e.i18n.t("app.product.termdeposits.sltprodtype")+"</option>"),e("#DPSProductTypeSelect").prop("disabled",!0),e("#tenure").html('<option value=""  selected="selected">'+e.i18n.t("app.product.termdeposits.slttenure")+"</option>"),e("#maturitAmt").val(""),e("#roiValue").html(""),g.set("TenorSelect",""),e("#roitext").css({display:"none"}),e("#tpamt").val(""),e("#dpsamt").val(""),g.set("nomineeDetailsList",""),e("#nomine_Details").html(""),e("#nomine_Relation").css({display:"none"}),e("#tc_check").prop("checked",!1)):isNull(o)?(isError=!0,e("#accError").html(e.i18n.t("app.product.termdeposits.accerr"))):(showSpinner(),s.collection.fetch({data:e.param({access_token:g.get("access_token"),acctid:o}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?l(e):c(e)},error:c}))},getMaturityAmount:function(t){"object"==typeof t&&t.stopImmediatePropagation();var o=this,a=function(t){hideSpinner(),e("#maturitAmt").val(g.get("maturityAmount")),e("#tpamt").val(g.get("totalPrincipalAmount")),isNull(g.get("interestRate"))?e("#roitext").css({display:"none"}):(e("#roitext").css({display:"block"}),e("#roiValue").html(g.get("interestRate")))},n=function(e){hideSpinner(),o.errorresponse()};showSpinner(),o.collection=new r,o.collection.fetch({data:e.param({access_token:g.get("access_token"),producttypeid:g.get("productTypeID"),tenure:g.get("TenorSelect"),amount:e("#dpsamt").val().replace(/,/g,""),productype:g.get("selectDepositType"),accountid:g.get("DepositAccID")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):n(e)},error:n})},createFDAccount:function(t){"object"==typeof t&&t.stopImmediatePropagation(),e("#verify .close").trigger("click");var a=this,r=g.get("nomineeDetailsList"),n=r[0].nomineeAdrressList,s=function(e){hideSpinner(),o.history.navigate("#/applyDepositConfirm")},l=function(e){hideSpinner(),a.errorresponse()};showSpinner(),a.collection=new i,a.collection.fetch({data:e.param({access_token:g.get("access_token"),accountid:g.get("DepositAccID"),producttype:g.get("selectDepositType"),productcode:g.get("productTypeID"),tenure:g.get("TenorSelect"),acctCategory:g.get("selectAccType"),transactionamount:g.get("transamount"),renewalopt:"",creditaccountid:g.get("DepositAccID"),nomineeaddress:n[0].nomineeAddressTypeAddress1,regnum:r[0].regNum,nomineereltype:r[0].nomineeRelType,nomineename:r[0].nomineeName,nomineecity:n[0].nomineeAddressTypeCity,nomineestateprov:n[0].nomineeAddressTypeStateProv,nomineepostalcode:n[0].nomineeAddressTypePostalCode,nomineecountry:n[0].nomineeAddressTypeCountry,nomineeminorflg:r[0].nomineeMinorFlg,nomineebirthdt:r[0].nomineeBirthDt,nomineepercentvalue:r[0].nomineePercentValue,tdGenLedgerSubHead:g.get("prodSubHeadCode"),intTblCode:g.get("prodTblCode"),fromActName:g.get("profileName"),depsubtype:g.get("productTypeValue"),renewaltype:g.get("renewalopt"),authMode:g.get("authmode")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?s(e):l(e)},error:l})},amtvalidation:function(t){"object"==typeof t&&t.stopImmediatePropagation(),y=!1;var o=this;e("#transAmutError").html(""),e("#tenure").html('<option value=""  selected="selected">'+e.i18n.t("app.product.termdeposits.slttenure")+"</option>");var a=parseFloat(g.get("depofromAcntAvailBal")),r=e("#dpsamt").val().replace(/,/g,""),n=(parseFloat(g.get("depositminamt")),parseFloat(g.get("depositmultiplesamt")),parseFloat(g.get("dailyAvailableLimit")));isNull(g.get("depofromAcntAvailBal"))&&(a=0),isNull(r)?(isError=!0,y=!0,e("#transAmutError").html(e.i18n.t("app.product.termdeposits.transamterror"))):!isNull(r)&&parseFloat(r)>a?(isError=!0,y=!0,e("#transAmutError").html(e.i18n.t("validation.transfer.nobal"))):!isNull(r)&&parseFloat(r)>n&&(isError=!0,y=!0,e("#transAmutError").html(e.i18n.t("app.product.termdeposits.dailylimit")+checkAmount(e.formatNumber(n,{format:"#,###",locale:"us"})))),o.resetValue(t),1==y||isNull(g.get("productTypeID"))||o.getTenures(t)},DPSProductTypeSelect:function(t){"object"==typeof t&&t.stopImmediatePropagation(),e("#prodTypeError").html(""),e("#transAmutError").html("");var o=this,a=e("#DPSProductTypeSelect option:selected").val(),r=e("#DPSProductTypeSelect option:selected").text(),n=e("#DPSProductTypeSelect option:selected").attr("subheadcode"),i=e("#DPSProductTypeSelect option:selected").attr("tblcode");g.set("productTypeID",a),g.set("productTypeValue",r),g.set("prodSubHeadCode",n),g.set("prodTblCode",i),isNull(a)&&(isError=!0,e("#prodTypeError").html(e.i18n.t("app.product.termdeposits.seltprodtypeerr"))),o.resetValue(t)},getTenures:function(t){"object"==typeof t&&t.stopImmediatePropagation();var o=this,a=function(t){hideSpinner();var o=g.get("tenorList"),a='<option value=""  selected="selected">'+e.i18n.t("app.product.termdeposits.slttenure")+"</option>";isNull(o)?e("#tenure").html(a):(e.each(o,function(e,t){a+="<option value="+t.code+" id="+e+" data="+t.description+" subheadcode="+t.tdGenLedgerSubHeadCode+" tblcode="+t.intTblCode+" minDepositAmount ="+t.minDepositAmount+" multiples="+t.multiples+" maxSlabAmount="+t.maxSlabAmount+">"+t.description+"</option>"}),e("#tenure").html(a),e("#tenure").prop("selectedIndex",0))},r=function(e){hideSpinner(),o.errorresponse()};o.collection=new s,o.collection.fetch({data:e.param({access_token:g.get("access_token"),accountid:g.get("DepositAccID"),producttype:g.get("selectProductType"),producttypeid:g.get("productTypeID"),amount:e("#dpsamt").val().replace(/,/g,"")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):r(e)},error:r})},getProductType:function(t){"object"==typeof t&&t.stopImmediatePropagation();var o=this,a=function(t){hideSpinner();var o=g.get("productTypeList");if(!isNull(o)&&o.length>0){var a='<option value=""  selected="selected">'+e.i18n.t("app.product.termdeposits.sltprodtype")+"</option>";e.each(o,function(e,t){a+="<option value="+t.code+" id="+e+" data="+t.description+" subheadcode="+t.tdGenLedgerSubHeadCode+" tblcode="+t.intTblCode+" >"+t.description+"</option>"}),e("#DPSProductTypeSelect").html(a),e("#DPSProductTypeSelect").prop("selectedIndex",0),e("#DPSProductTypeSelect").prop("disabled",!1)}else isError=!0,e("#availBalDiv").hide(),e("#availbalance").html(""),e("#accError").html(e.i18n.t("app.product.termdeposits.dpsaccproderr")),e("#DPSProductTypeSelect").html('<option value=""  selected="selected">'+e.i18n.t("app.product.termdeposits.sltprodtype")+"</option>"),e("#DPSProductTypeSelect").prop("disabled",!0),e("#tenure").html('<option value=""  selected="selected">'+e.i18n.t("app.product.termdeposits.slttenure")+"</option>")},r=function(e){hideSpinner(),o.errorresponse()};showSpinner(),o.collection=new l,o.collection.fetch({data:e.param({access_token:g.get("access_token"),accountid:g.get("DepositAccID"),producttype:g.get("selectProductType")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):r(e)},error:r})},DPSTenorSelect:function(t){"object"==typeof t&&t.stopImmediatePropagation(),e("#tenorError").html("");var o=this,a=e("#tenure option:selected").val(),r=e("#tenure option:selected").text(),n=e("#dpsamt").val().replace(/,/g,""),i=parseFloat(g.get("dailyAvailableLimit")),s=e("#tenure option:selected").attr("maxSlabAmount").replace(/,/g,""),l=e("#tenure option:selected").attr("mindepositamount").replace(/,/g,""),c=e("#tenure option:selected").attr("multiples").replace(/,/g,"");s=checkAmount(e.formatNumber(s,{format:"####",locale:"us"})),g.set("TenorSelect",a),g.set("TenorSelectVal",r),g.set("depositmaxamt",s),g.set("depositminamt",l),g.set("depositmultiplesamt",c),0==y&&(!isNull(l)&&parseFloat(n)<parseFloat(l)?(isError=!0,y=!0,e("#transAmutError").html(e.i18n.t("app.product.termdeposits.transamtmindepoerr")+checkAmount(e.formatNumber(l,{format:"#,###",locale:"us"})))):isNull(c)||parseFloat(n)%parseFloat(c)==0?s>i?!isNull(n)&&parseFloat(n)>i&&(isError=!0,y=!0,e("#transAmutError").html(e.i18n.t("app.product.termdeposits.dailylimit")+checkAmount(e.formatNumber(i,{format:"#,###",locale:"us"})))):!isNull(n)&&parseFloat(n)>parseFloat(s)&&(isError=!0,y=!0,e("#transAmutError").html(e.i18n.t("app.product.termdeposits.availbalanceerror")+checkAmount(e.formatNumber(s,{format:"#,###",locale:"us"})))):(isError=!0,y=!0,e("#transAmutError").html(e.i18n.t("app.product.termdeposits.transamtmutipleerr")+checkAmount(e.formatNumber(c,{format:"#,###",locale:"us"}))))),isNull(g.get("productTypeID"))||isNull(a)||isNull(n)||1==y||o.getMaturityAmount(t),isNull(a)&&(e("#maturitAmt").val(""),e("#roiValue").html(""),e("#roitext").css({display:"none"}),e("#tpamt").val(""),g.set("TenorSelect",""))},applyDPSdepositverify:function(e){"object"==typeof e&&e.stopImmediatePropagation();var t=this,o=g.get("nomineeDetailsList");!isNull(g.get("DepositAccID"))&&!isNull(o)&&o.length>0?t.PaymentValidation():isNull(g.get("DepositAccID"))&&t.PaymentValidation()},applyDPSdepositcancel:function(e){"object"==typeof e&&e.stopImmediatePropagation(),o.history.navigate("#/applyForDeposit")},resetValue:function(t){"object"==typeof t&&t.stopImmediatePropagation();e("#tenure").prop("selectedIndex",0),e("#maturitAmt").val(""),e("#roiValue").html(""),g.set("TenorSelect",""),e("#roitext").css({display:"none"}),e("#tpamt").val("")},applydepositinitiatecancel:function(e){"object"==typeof e&&e.stopImmediatePropagation(),o.history.navigate("#/applyDPSDepositInitiate")},numberOnly:function(e){"object"==typeof e&&e.stopImmediatePropagation();var t=window.event?e.keyCode:e.which;return 8===e.keyCode||46===e.keyCode?!0:48>t||t>57?!1:!0},PaymentValidation:function(t){"object"==typeof t&&t.stopImmediatePropagation();var o=this,a=!1;e("#tcError").html(""),e("#transAmutError").html(""),e("#accError").html(""),e("#prodTypeError").html(""),e("#tenorError").html("");var r=e("#dpsamt").val().replace(/,/g,""),n=e("#tenure  option:selected").val(),i=e("#DPSProductTypeSelect  option:selected").val(),s=e("#DPSSelectAcc  option:selected").val(),l=(g.get("accountCurrency"),g.get("depoAccCurency"),parseFloat(g.get("depofromAcntAvailBal"))),c=parseFloat(g.get("depositminamt")),p=parseFloat(g.get("depositmultiplesamt")),d=parseFloat(g.get("dailyAvailableLimit")),u=parseFloat(g.get("depositmaxamt"));isNull(g.get("depofromAcntAvailBal"))&&(l=0),isNull(r)?(a=!0,e("#transAmutError").html(e.i18n.t("app.product.termdeposits.transamterror"))):!isNull(r)&&parseFloat(r)>l?(a=!0,e("#transAmutError").html(e.i18n.t("validation.transfer.nobal"))):!isNull(c)&&parseFloat(r)<parseFloat(c)?e("#transAmutError").html(e.i18n.t("app.product.termdeposits.transamtmindepoerr")+checkAmount(e.formatNumber(c,{format:"#,###",locale:"us"}))):isNull(p)||parseFloat(r)%parseFloat(p)==0?u>d?!isNull(r)&&parseFloat(r)>d&&(a=!0,e("#transAmutError").html(e.i18n.t("app.product.termdeposits.dailylimit")+checkAmount(e.formatNumber(d,{format:"#,###",locale:"us"})))):!isNull(r)&&parseFloat(r)>u&&(a=!0,e("#transAmutError").html(e.i18n.t("app.product.termdeposits.availbalanceerror")+checkAmount(e.formatNumber(u,{format:"#,###",locale:"us"})))):(a=!0,e("#transAmutError").html(e.i18n.t("app.product.termdeposits.transamtmutipleerr")+checkAmount(e.formatNumber(p,{format:"#,###",locale:"us"})))),isNull(s)&&(a=!0,e("#accError").html(e.i18n.t("app.product.termdeposits.accerr"))),isNull(i)&&(a=!0,e("#prodTypeError").html(e.i18n.t("app.product.termdeposits.seltprodtypeerr"))),isNull(n)&&(a=!0,e("#tenorError").html(e.i18n.t("app.product.termdeposits.selttenorerror"))),e("#tc_check").is(":checked")?e("#tcError").html(""):(a=!0,e("#tcError").html(e.i18n.t("app.product.termdeposits.termconerr"))),a||(g.set("transamount",r),o.validateFDCard())},getFDAuthMode:function(t){"object"==typeof t&&t.stopImmediatePropagation();var o=this;g.set("IsAuthMode","false"),e("#fd_auth_mode").html("");var a=e("#dpsamt").val().replace(/,/g,""),r=function(e){hideSpinner();var t=g.get("securitySettingList");!isNull(t)&&t.length>0?g.set("IsAuthMode","true"):(g.set("alertType",null),g.set("IsAuthMode","false")),o.populateAuthMode()},n=function(t){hideSpinner(),o.populateAuthMode(),e("#transAmutError").html(g.get("errordesc"))};showSpinner(),o.collection=new c,o.collection.fetch({data:e.param({access_token:g.get("access_token"),transactionAmount:a,tenantServiceCode:"ADD_DEPOSIT"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):n(e)},error:n}),o.getTransLimitView()},populateAuthMode:function(t){"object"==typeof t&&t.stopImmediatePropagation();var o="",a="",r=g.get("securitySettingList"),n="<label for='username'>"+e.i18n.t("app.transfer.managebeneficiary.selectauthorisationmode")+"</label>";n+="<div class='custRadio_pass'>",!isNull(r)&&r.length>0?(e("#within_onetime_transferDiv").html(""),e.each(r,function(t,r){"SMS"==r?(o="sms",a=e.i18n.t("app.transfer.managebeneficiary.sms")):"EMAIL"==r?(o="mail",a=e.i18n.t("app.transfer.managebeneficiary.mail")):"TOKEN"==r?(o="fScan",a=e.i18n.t("app.transfer.managebeneficiary.token")):"ESIGN"==r&&(o="esign",a=e.i18n.t("app.transfer.managebeneficiary.esign")),n+='<div class="box"><div class="radio"><label>',n+=0==t?'<input type="radio" name="fd_payment_authmode" id="optionsRadios'+t+'" value="'+r+'" checked>':'<input type="radio" name="fd_payment_authmode" id="optionsRadios'+t+'" value="'+r+'">',n+='<div class="row bg"><div class="col-xs-12 p0"><span class="menu_icon ico-xs '+o+'"></span><span class="small">'+a+"</span></div></div></label></div></div>"}),e("#fd_auth_mode").html(n)):e("#fd_auth_mode").html("")},depositVerifySuccessPopUp:function(t){"object"==typeof t&&t.stopImmediatePropagation();var o="",a="";e("#fd_otpNullError").html(""),e("#fd_otpNullErrorDiv").hide();var r=e("#fd_otp1").attr("data"),n=e("#fd_otp2").attr("data"),i=e("#fd_otp3").attr("data"),s=e("#fd_otp4").attr("data"),l=e("#fd_otp5").attr("data"),c=e("#fd_otp6").attr("data");if(isNull(r)||isNull(n)||isNull(i)||isNull(s)||isNull(l)||isNull(c))return e("#fd_otpNullErrorDiv").show(),void e("#fd_otpNullError").html(e.i18n.t("validation.newregistration.otpnotnull"));var p=r+n+i+s+l+c,u=e("input[name='fd_payment_authmode']:checked").val();"SMS"==u?(a=g.get("mobileNo"),o=null):"EMAIL"==u&&(a=null,o=g.get("emailId"));var m=this,h=function(o){hideSpinner(),m.revokeDepositOTPSpinner(),e("#verify .close").trigger("click"),m.createFDAccount(t)},f=function(t){hideSpinner(),isNull(g.get("errordesc"))||(e("#fd_otpNullErrorDiv").show(),e("#fd_otpNullError").html(g.get("errordesc")))},m=this;showSpinner(),m.collection=new d;getDeviceId(),(new Date).getTime();m.collection.fetch({data:e.param({access_token:g.get("access_token"),transactionType:"ADD_DEPOSIT",activationno:p,uniqueId:g.get("otpCode"),twoFAType:g.get("alertType")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?h(e):f(e)},error:f})},validateFDCard:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var o=this;if("false"==g.get("IsAuthMode"))return void o.createFDAccount();var a=e("input[name='fd_payment_authmode']:checked").val();g.set("authmode",a),"SMS"==a||"EMAIL"==a||"ESIGN"==a?o.dpsValidateCardPin("N"):"TOKEN"==a&&(g.set("otpCode",""),g.set("alertType",a),e("#verify").modal("show"),e("#fd_otp1, #fd_otp2, #fd_otp3, #fd_otp4, #fd_otp5, #fd_otp6").removeAttr("data"),"TOKEN"==g.get("alertType")&&(e("#fd_titleAuth").html(e.i18n.t("app.registration.opthelptokentext")),e("#dps_myModalLabel").html(e.i18n.t("app.registration.otptokenheadertext")),e("#fd_challengeText").html(""),e("#OTPcontainer1").hide(),e("#fd_resend_btn").hide()),e("#fd_otpNullError").html(""),e("#fd_otpNullErrorDiv").hide(),e(".inputs").on("input",function(t){t.stopImmediatePropagation();var o=t.currentTarget.id,a=e("#"+o).val();e("#"+o).attr("data",a),e("#"+o).val(a.replace(/[^\*]/,"."))}),e("#fd_otp1, #fd_otp2, #fd_otp3, #fd_otp4, #fd_otp5, #fd_otp6").val(""))},dpsValidateCardPin:function(t){e(".otp_msg_txt").html("");var o=e("input[name='fd_payment_authmode']:checked").val();g.set("alertType",o);var a=this,r=function(o){hideSpinner(),"Y"==t&&(e("#OTPcontainer1").slideDown("slow"),f.set(1),f.animate(0,function(){e("#OTPcontainer1").slideUp("slow")})),e("#verify").modal("show"),e("#fd_otp1, #fd_otp2, #fd_otp3, #fd_otp4, #fd_otp5, #fd_otp6").removeAttr("data"),"SMS"==g.get("alertType")?(e("#fd_titleAuth").html(e.i18n.t("app.registration.opthelptext")+" "+maskMobile(g.get("contactNumber"))),e("#dps_myModalLabel").html(e.i18n.t("app.transferss.verfici")),e("#fd_challengeText").html(""),e("#OTPcontainer1").show(),e("#fd_resend_btn").show()):"EMAIL"==g.get("alertType")?(e("#fd_titleAuth").html(e.i18n.t("app.registration.opthelpemailtext")+" "+maskEmailID(g.get("emailId"))),e("#dps_myModalLabel").html(e.i18n.t("app.transferss.verfici")),e("#fd_challengeText").html(""),e("#OTPcontainer1").show(),e("#fd_resend_btn").show()):"ESIGN"==g.get("alertType")&&(e("#fd_titleAuth").html(e.i18n.t("app.registration.otphelpesigntext")),e("#dps_myModalLabel").html(e.i18n.t("app.transferss.verfici")),e("#fd_challengeText").html(e.i18n.t("app.transferss.genratedTocn")+" "+g.get("otpCode")),e("#OTPcontainer1").hide(),e("#fd_resend_btn").hide()),setTimeout(function(){e("#fd_otp1").focus()},500),e("#fd_otpNullError").html(""),e("#fd_otpNullErrorDiv").hide(),e(".inputs").on("input",function(t){t.stopImmediatePropagation();var o=t.currentTarget.id,a=e("#"+o).val();e("#"+o).attr("data",a),e("#"+o).val(a.replace(/[^\*]/,"."))}),e("#fd_otp1, #fd_otp2, #fd_otp3, #fd_otp4, #fd_otp5, #fd_otp6").val(""),("SMS"==g.get("alertType")||"EMAIL"==g.get("alertType"))&&a.invokeOTPSpinner()},n=function(e){a.errorresponse()},a=this;showSpinner(),a.collection=new p;getDeviceId(),(new Date).getTime();a.collection.fetch({data:e.param({access_token:g.get("access_token"),transactionType:"ADD_DEPOSIT",resendflag:t,authMode:g.get("alertType")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):n(e)},error:n})},invokeOTPSpinner:function(t){"object"==typeof t&&t.stopImmediatePropagation();var o=this;return e("#fd_resend_btn").hide(),e("#OTPcontainer1").show(),e("#fd_otp1, #fd_otp2, #fd_otp3, #fd_otp4, #fd_otp5, #fd_otp6").val(""),null!=f?(f.set(1),void f.animate(0,function(){e("#OTPcontainer1").slideUp("slow")})):(f=new ProgressBar.Circle(OTPcontainer1,{color:"#333",strokeWidth:8,trailWidth:8,easing:"linear",duration:6e4*parseInt(g.get("otpExpiryPeriod")),text:{autoStyleContainer:!1},from:{color:"#ec5f59",width:8},to:{color:"#ec5f59",width:8},step:function(t,o){o.path.setAttribute("stroke",t.color),o.path.setAttribute("stroke-width",t.width);var a=Math.round(o.value()*(60*g.get("otpExpiryPeriod")));"0"==a?(o.setText(""),e("#fd_resend_btn").show()):(e("#fd_resend_btn").hide(),o.setText(a+"s"))}}),f.text.style.fontFamily='"Raleway", Helvetica, sans-serif',f.text.style.fontSize="12px",f.text.style.fontWeight="bold",f.set(1),f.animate(0,function(){e("#OTPcontainer1").slideUp("slow")}),void e("#fd_resend_btn").click(function(){o.dpsValidateCardPin("Y")}))},revokeDepositOTPSpinner:function(){null!=f&&f.stop()},getTransLimitView:function(t){"object"==typeof t&&t.stopImmediatePropagation();var o=this,a=function(e){hideSpinner()},r=function(e){};o.collection=new u,o.collection.fetch({data:e.param({access_token:g.get("access_token"),payeeType:"OA"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):r(e)},error:r})},getAccountBalance:function(t){"object"==typeof t&&t.stopImmediatePropagation();var o=g.get("selectAccType");"PC"==o?g.set("typeOfTransfer","PC"):"DC"==o?g.set("typeOfTransfer","DC"):"CC"==o?g.set("typeOfTransfer","CC"):"CASA"==o&&g.set("typeOfTransfer","CASA");var a=this,r=function(r){hideSpinner(),e("#accError").html(""),e("#availBalDiv").show(),isValidAccount=!1;var n,i,s=g.get("availableBalance"),l=parseFloat(s.slice(0,-2)),c=g.get("accountCurrency");"DC"==o?(n=checkAmount(e.formatNumber(l,{format:"#,###.00",locale:"us"})),i=n+" "+c,g.set("depofromAcntAvailBal",l)):"CASA"==o?(n=checkAmount(e.formatNumber(l,{format:"#,###.00",locale:"us"})),i=n+" "+c,g.set("depofromAcntAvailBal",l)):"PC"==o?(n=checkAmount(e.formatNumber(s,{format:"#,###.00",locale:"us"})),i=n+" "+c,g.set("depofromAcntAvailBal",s)):"CC"==o&&(n=checkAmount(e.formatNumber(s,{format:"#,###.00",locale:"us"})),i=n+" "+c,g.set("depofromAcntAvailBal",s)),e("#availbalance").html(i),a.getProductType(t),a.resetValue(t)},n=function(e){a.errorresponse()};showSpinner(),a.collection=new m,a.collection.fetch({data:e.param({access_token:g.get("access_token"),accountId:g.get("DepositAccID"),accountType:g.get("selectAccType"),beneficiaryInstructionId:null}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):n(e)},error:n})},addDepositOpenTandCPopup:function(e){e.stopImmediatePropagation(),g.set("tandctype","adddeposit"),openTermsAndConditionsPopup()},gotoPreviousPage:function(e){e.stopImmediatePropagation(),window.history.back()},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return o.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return v});