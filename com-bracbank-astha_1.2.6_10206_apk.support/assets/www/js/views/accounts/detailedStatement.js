define(["jquery","underscore","Backbone","collections/accounts/casaDetailStatementCollections","models/validation/statementFilterValidationModel","text!views/accounts/detailedStatement.tpl"],function(t,e,a,r,o,i){var n=new EncryptedLocalStorage("secret"),l=a.View.extend({el:"#container",events:{"click #getstatement":"getstatement","change #periodFilter":"getPeriodRange"},initialize:function(){t("html").removeClass().addClass("app")},update:function(t){this.$el.html(e.template(i))},getPeriodRange:function(){var e=this,a=t("#periodFilter option:selected").val();if(""==a)return t("#fromDate").val(""),void t("#toDate").val("");if("twoWeeks"==a){n.set("periodType","twoWeeks");var r=e.calculateFromDate();t("#fromDate").val(r),n.set("fromDate",r)}else if("oneMonth"==a){n.set("periodType","oneMonth");var r=e.calculateFromDate();t("#fromDate").val(r),n.set("fromDate",r)}else if("threeMonths"==a){n.set("periodType","threeMonths");var r=e.calculateFromDate();t("#fromDate").val(r),n.set("fromDate",r)}else if("sixMonths"==a){n.set("periodType","sixMonths");var r=e.calculateFromDate();t("#fromDate").val(r),n.set("fromDate",r)}else if("oneYear"==a){n.set("periodType","oneYear");var r=e.calculateFromDate();t("#fromDate").val(r),n.set("fromDate",r)}else if("lastFinYear"==a){n.set("periodType","lastFinYear");var e=this;return void e.calculateFinancialYear()}var o=new Date,i=o.getDate(),l=o.getMonth()+1,s=o.getFullYear(),c=("00"+i.toString()).slice(-2)+"-"+("00"+l.toString()).slice(-2)+"-"+("0000"+s.toString()).slice(-4);t("#toDate").val(c),n.set("toDate",c)},calculateFromDate:function(){var t=this,e=t.dateFunction(),a=e.getMonth()+1,r=e.getDate(),o=e.getFullYear(),i=("00"+r.toString()).slice(-2)+"-"+("00"+a.toString()).slice(-2)+"-"+("0000"+o.toString()).slice(-4);return i},dateFunction:function(){var t=n.get("periodType"),e=new Date;if("twoWeeks"==t){n.set("filterBy","L2W");var a=new Date(e.getFullYear(),e.getMonth(),e.getDate()-14)}else if("oneMonth"==t){n.set("filterBy","L1M");var a=new Date(e.getFullYear(),e.getMonth()-1,e.getDate())}else if("threeMonths"==t){n.set("filterBy","L3M");var a=new Date(e.getFullYear(),e.getMonth()-3,e.getDate())}else if("sixMonths"==t){n.set("filterBy","L6M");var a=new Date(e.getFullYear(),e.getMonth()-6,e.getDate())}else if("oneYear"==t){n.set("filterBy","L1Y");var a=new Date(e.getFullYear()-1,e.getMonth(),e.getDate())}return a},getstatement:function(){t("#fromAmtErr").html(""),t("#toAmtErr").html(""),t("#filterTypeError").html(""),t("#filterPeriodError").html(""),t("#fromDateError").html(""),t("#toDateError").html("");var e=this;this.model=new o({url:"json/"}),a.Validation.bind(this);var r=this.$("form").serializeObject();if(this.model.set(r,{validate:!0})){this.model.clear(),a.Validation.unbind(this);var i=t("#fromAmt").val(),l=t("#toAmt").val(),s=t("#typeFilter option:selected").val();n.set("Stype",s);var c=t("#periodFilter option:selected").val(),m=t("#fromDate").val();n.set("stmtFromDate",m);var f=t("#toDate").val();if(n.set("stmtToDate",f),parseFloat(i)>parseFloat(l))return void t("#fromAmtErr").html(t.i18n.t("validation.statementfilter.fromamt"));if(parseFloat(l)<parseFloat(i))return void t("#toAmtErr").html(t.i18n.t("validation.statementfilter.toamt"));if("specificDate"==c){var m=t("#fromDate").val(),f=t("#toDate").val(),d=m.split("-"),v=d[2],u=d[1],g=d[0],D=new Date(g,u,v),h=v+"-"+u+"-"+g;n.set("stmtFromDate",h);var p=f.split("-"),F=p[2],w=p[1],y=p[0],S=new Date(y,w,F),M=F+"-"+w+"-"+y;n.set("stmtToDate",M);var T=new Date,E=T.getDate(),Y=T.getMonth()+1,A=T.getFullYear(),V=new Date(A,Y,E),k=12*y-12*g,b=w-u,B=F-v;if((k>0||0===k||B>0)&&(b=b+k+B/30),D.getTime()>V.getTime())return void t("#fromDateError").html(t.i18n.t("validation.statementfilter.frmdat"));if(S.getTime()>V.getTime())return void t("#toDateError").html(t.i18n.t("validation.statementfilter.todat"));if(D.getTime()>S.getTime())return void t("#fromDateError").html(t.i18n.t("validation.statementfilter.frmdate1"));if(b>6)return void t("#toDateError").html(t.i18n.t("validation.statementfilter.fromsix"))}e.getDetailedStatement()}else this.$(".has-error").fadeIn(),event.preventDefault()},calculateFinancialYear:function(){n.set("filterBy","LFY");var e=new Date,a=(e.getDate(),e.getMonth()+1),r=e.getFullYear(),o="01",i="07",l="30",s="06";if(7>a)var c=r-2,m=r-1;else if(a>=7)var c=r-1,m=r;var f=("00"+o.toString()).slice(-2)+"-"+("00"+i.toString()).slice(-2)+"-"+("0000"+c.toString()).slice(-4),d=("00"+l.toString()).slice(-2)+"-"+("00"+s.toString()).slice(-2)+"-"+("0000"+m.toString()).slice(-4);t("#fromDate").val(f),t("#toDate").val(d),n.set("fromDate",f)},getDetailedStatement:function(){var e=t("#fromAmt").val(),o=t("#toAmt").val();isNull(e)?n.set("frmAmt",""):n.set("frmAmt",e),isNull(o)?n.set("toamt",""):n.set("toamt",o);var i=t("#typeFilter option:selected").val(),l=(t("#periodFilter option:selected").val(),n.get("accountId")),s=n.get("stmtFromDate"),c=n.get("stmtToDate"),m=l+s+c,f=null==m?"":m;checkSumEncrypt(f);var d=localStorage.getItem("FINALCHECKSUM"),v=this,u=function(t){hideSpinner(),n.set("isFromStatementDwld","false"),a.history.navigate("#/accdetailstatement")},g=function(t){v.errorresponse()};showSpinner(),v.collection=new r,v.collection.fetch({data:t.param({access_token:n.get("access_token"),acctCategory:n.get("accountCategory"),accountID:n.get("accountId"),debitCreditFlag:i,appchecksum:d,fromAmount:e,toAmount:o,lastnTxn:null,branch:n.get("branchDesc"),toDate:n.get("stmtToDate"),fromDate:n.get("stmtFromDate"),module:"FILTERED",filterby:n.get("filterBy"),sortBy:null,sortOrder:"ASC"}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?u(t):g(t)},error:g})},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(t){return a.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=t,this.currentView.delegateEvents(),this.currentView}});return l});