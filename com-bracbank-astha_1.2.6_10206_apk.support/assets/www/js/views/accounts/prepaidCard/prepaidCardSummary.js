define(["jquery","underscore","Backbone","collections/wealth/prepaidcardCollections","collections/logout/feedbackSurveyCollections","collections/transfer/loadWalletInfoCollection","collections/bills/fetchBillerCollections","collections/logout/logoutCollections","text!views/accounts/prepaidCard/prepaidCardSummary.tpl","views/errors/exception"],function(e,t,o,s,i,a,r,n,l,u){var c=new EncryptedLocalStorage("secret"),d=o.View.extend({el:"#container",events:{"click #accounts_tab":"gotoWealthPage","click #creditcard_tab":"gotoCreditCardSummary","click #termdeposit_tab":"gotoTermDepositSummary","click #loan_tab":"gotoLoanSummary","click #slide_out_savings":"savingUI","click #slide_out_creditcard":"creditUI","click #slide_out_loan":"loansUI","click #slide_out_deposits":"depositsUI","click #slide_out_managebene":"loadmanagebeneUi","click #slide_out_services":"servicesUI","click #slide_out_transfers":"transfer","click #slide_out_billpay":"billpay","click #slide_out_transactions":"gotoTransferHistory","click #slideout_more":"gotoMore","click #slide_out_statementCertificate":"gotoStatementAndCertificate","click #slide_out_positivePay":"gotopositivePay","click #slide_out_transferlimit":"gotoTransferLimit","click #slideout_contact":"gotoPostLoginContactUs","click #services":"gotoServiceRequest","click #slide_out_user_settings":"gotoUserSettings","click #menu_more":"gotoMore","click #logout":"gotoFeedbackPopup","click #pushNotifications":"pushNotificationsUI","click #footerMenu_bKash":"gotobKashWalletPayment","click #footerMenu_MobileTopup":"gotoMobileTopup","click #footerMenu_billPay":"gotoBillPayPage","click #footerMenu_ccPay":"gotoCreditCardPayment","click #footerMenu_transfer":"gotoTransfer","click #footerMenu_ApplyDeposit":"gotoApplyDepositFooterMenu","click #footerMenu_Transactions":"gotoTransactionHistory","click #footerMenu_CardManagement":"gotoCardManagement","click #footerMenu_PositivePay":"gotopositivePay","click #footerMenu_BBLApps":"gotoBBLApps","click #footerMenu_getCertificate":"gotoStatementAndCertificate"},initialize:function(){},savingUI:function(){o.history.navigate("#/accounttypelist")},creditUI:function(){o.history.navigate("#/creditcardtype")},loansUI:function(){o.history.navigate("#/loantype")},depositsUI:function(){c.set("depositType","FDR"),c.set("isFromFooterMenu","false"),o.history.navigate("#/deposittype")},pushNotificationsUI:function(){o.history.navigate("#/pushNotifications")},render:function(){c.set("pageid","prepaidcard");var t=this,o=function(o){hideSpinner(),e("html").removeClass().addClass("primarybg hasBoth dashWrap fntzoom"),t.loadPrepaidCardTemplate()},i=function(e){t.errorresponse()};showSpinner(),t.collection=new s([],{});getDeviceId();t.collection.fetch({data:e.param({newversion:"Y",access_token:c.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){if("0000"==ackStatus){var t=c.get("errorcode");o("9999"==t?e:e)}else i(e)},error:i})},loadPrepaidCardTemplate:function(){e("#container").html(t.template(l))},gotoWealthPage:function(){o.history.navigate("#/wealth")},gotoCreditCardSummary:function(){o.history.navigate("#/creditcardsummary")},gotoTermDepositSummary:function(){o.history.navigate("#/termdepositsummary")},gotoLoanSummary:function(){o.history.navigate("#/loansummary")},transfer:function(){"N"==c.get("fullRightsFlag")?(c.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(c.set("isFromFooterMenu","false"),o.history.navigate("#/transfer"))},billpay:function(){"N"==c.get("fullRightsFlag")?(c.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(c.set("isFromFooterMenu","false"),o.history.navigate("#/billpay"))},gotoTransferHistory:function(e){e.stopImmediatePropagation(),"N"==c.get("fullRightsFlag")?(c.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(c.set("isFromFooterMenu","false"),o.history.navigate("#/transhistory"))},servicesUI:function(){c.set("isFromFooterMenu","false"),o.history.navigate("#/servicerequest")},loadmanagebeneUi:function(){"N"==c.get("fullRightsFlag")?(c.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):o.history.navigate("#/managebene")},gotoServiceRequest:function(){o.history.navigate("#/servicerequest")},gotoMore:function(){o.history.navigate("#/more")},gotoUserSettings:function(){o.history.navigate("#/usersettings")},gotobKashWalletPayment:function(t){if(t.stopImmediatePropagation(),c.set("isFromFooterMenu","true"),"N"==c.get("fullRightsFlag"))return c.set("isServiceReqMenu","false"),void o.history.navigate("#/viewonlymode");var s=this,i=function(t){hideSpinner();var s=c.get("walletList");e.each(s,function(e,t){if("bKash"==t.description){var s=t.id,i=t.description;c.set("walletId",s),c.set("walletType",i),o.history.navigate("#/wallettransfertobeneselect")}})},r=function(e){s.errorresponse()};showSpinner(),s.collection=new a,s.collection.fetch({data:e.param({access_token:c.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):r(e)},error:r})},gotoMobileTopup:function(t){if(t.stopImmediatePropagation(),c.set("isFromFooterMenu","true"),"N"==c.get("fullRightsFlag"))return c.set("isServiceReqMenu","false"),void o.history.navigate("#/viewonlymode");var s=this;showSpinner();var i=function(t){hideSpinner();var s=c.get("menuList");e.each(s,function(e,t){if("Mobile / Telephone"==t.description){var s=t.id,i=t.dataLabel,a=t.description;c.set("selectedBillerTypeId",s),c.set("selectedBillerTypeName",a),c.set("selectedBillerDateLabel",i),o.history.navigate("#/viewbillpaylists")}})},a=function(e){s.errorresponse()};s.collection=new r,s.collection.fetch({data:e.param({access_token:c.get("access_token"),type:"MENU",billId:null,newversion:"Y"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):a(e)},error:a})},gotoBillPayPage:function(e){e.stopImmediatePropagation(),"N"==c.get("fullRightsFlag")?(c.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(c.set("isFromFooterMenu","true"),o.history.navigate("#/billpay"))},gotoCreditCardPayment:function(e){e.stopImmediatePropagation(),"N"==c.get("fullRightsFlag")?(c.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(c.set("isFromFooterMenu","true"),o.history.navigate("#/transferbbicardviewdetail"))},gotoTransfer:function(e){e.stopImmediatePropagation(),"N"==c.get("fullRightsFlag")?(c.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(c.set("isFromFooterMenu","true"),o.history.navigate("#/transfer"))},gotoApplyDepositFooterMenu:function(e){e.stopImmediatePropagation(),"N"==c.get("fullRightsFlag")?(c.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(c.set("isFromFooterMenu","true"),o.history.navigate("#/applyForDeposit"))},gotoTransactionHistory:function(e){e.stopImmediatePropagation(),c.set("isFromFooterMenu","true"),o.history.navigate("#/transhistory")},gotoCardManagement:function(e){e.stopImmediatePropagation(),c.set("isFromFooterMenu","true"),o.history.navigate("#/cardmanage")},gotopositivePay:function(e){e.stopImmediatePropagation(),"N"==c.get("fullRightsFlag")?(c.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(c.set("isFromFooterMenu","true"),o.history.navigate("#/positivepayinit"))},gotoTransferLimit:function(e){e.stopImmediatePropagation(),"N"==c.get("fullRightsFlag")?(c.set("isServiceReqMenu","false"),o.history.navigate("#/viewonlymode")):(c.set("isFromFooterMenu","true"),o.history.navigate("#/transferlimits"))},gotoPostLoginContactUs:function(e){e.stopImmediatePropagation(),o.history.navigate("#/contact")},gotoBBLApps:function(e){e.stopImmediatePropagation(),c.set("isFromFooterMenu","true"),o.history.navigate("#/bblpartnerapps")},gotoStatementAndCertificate:function(e){e.stopImmediatePropagation(),c.set("isFromFooterMenu","true"),o.history.navigate("#/statementcertificate")},gotoFeedbackPopup:function(t){t.stopImmediatePropagation(),showSpinner(),c.set("surveyStatus",null),c.set("surveyMesage",null),c.set("surveyQuestionIds",null),c.set("surveyQuestionRatings",null);var o=this,s=function(e){hideSpinner(),"Y"==c.get("disppop")?o.gotoPopulateFeedbackPopup(t):"N"==c.get("disppop")&&o.logout(t)},a=function(e){o.errorresponse()};o.collection=new i([],{});(new Date).getTime();o.collection.fetch({data:e.param({access_token:c.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?s(e):a(e)},error:a})},gotoPopulateFeedbackPopup:function(t){t.stopImmediatePropagation();var o=c.get("surveyList");e("#feedbackPopup").html("");var s=this,i=/iPad|iPhone|iPod/.test(navigator.userAgent),a='<div class="modal fade feedbackPop" id="feedback" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><form method="post" action="#"> <div class="modal-content"><div class="modal-header"> <button type="button" class="close" aria-label="Close" id="surveySkipButton"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">Rate Your Experience</h4></div><div class="modal-body"><div class="survey-ques"><div class="row"><div class="col-sm-12 col-md-6">';e.each(o,function(e,t){a+='<div class="ques"><span class="ques-cout">'+(e+1)+'</span><div class="rat-cnt" ques="'+t.surveyQuestion+'"><p>'+t.surveyQuestion+'</p></div><div class="rate-area rateAreaClass" id="'+t.surveyQuestionId+'_rating_value"><input type="radio" id="'+t.surveyQuestionId+'_rat1" name="rating'+(e+1)+'" value="10" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat1" title="Excellent">10 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat2" name="rating'+(e+1)+'" value="9" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat2" title="Excellent">9 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat3" name="rating'+(e+1)+'" value="8" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat3" title="Good">8 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat4" name="rating'+(e+1)+'" value="7" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat4" title="Good">7 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat5" name="rating'+(e+1)+'" value="6" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat5" title="Average">6 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat6" name="rating'+(e+1)+'" value="5" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat6" title="Average">5 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat7" name="rating'+(e+1)+'" value="4" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat7" title="Not Good">4 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat8" name="rating'+(e+1)+'" value="3" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat8" title="Not Good">3 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat9" name="rating'+(e+1)+'" value="2" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat9" title="Poor">2 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat10" name="rating'+(e+1)+'" value="1" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat10" title="Poor">1 star</label></div></div>',a+='<div class="form-group has-error"><p class="help-block error-message" style="color:#a94442" id="surveyQuesErr'+(e+1)+'"></p></div>'}),a+='</div></div><div class="form-group"><textarea class="form-control inputlengthcontrol" id="feedbackComment" placeholder="Leave a comment ( Max 500 character)" maxlength="500"></textarea><p class="text-muted small">Special characters (Space, Dot, Comma, Brackets) are allowed only.</p></div><div class="alert alert-info" role="alert">',a+=i?'<small><a href="javascript:void(0);" id="gotoStoreBtn" class="btn btn-primary btn-sm" target="_blank"><i class="fa fa-external-link"></i> Click Here</a> &nbsp;to rate us on Apple Store <img src="images/common/ios-app-store.svg" width="32" /></small>':'<small><a href="javascript:void(0);" id="gotoStoreBtn" class="btn btn-primary btn-sm" target="_blank"><i class="fa fa-external-link"></i> Click Here</a> &nbsp;to rate us on Play Store <img src="images/common/google-play.svg" width="32" /></small>',a+='</div></div></div><div class="modal-footer"><div class="row"><div class="col-xs-6 pr5"><a href="javascript:void(0);" class="btn btn-default btn-block" id="surveyLaterButton">Later</a></div><div class="col-xs-6 pl5"><a href="javascript:void(0);" class="btn btn-primary btn-block" id="surveySubmitButton">Submit</a></div></div></div></div></form></div></div>',e("#feedbackPopup").html(a),e("#feedback").modal("show"),e("#surveySkipButton").on("click",function(){c.set("surveyStatus","SKIPPED"),c.set("surveyMesage",null),c.set("surveyQuestionIds",null),c.set("surveyQuestionRatings",null),e("#feedback").modal("hide"),s.logout(t)}),e("#surveyLaterButton").on("click",function(){c.set("surveyStatus","MARKED_LATER"),c.set("surveyMesage",null),c.set("surveyQuestionIds",null),c.set("surveyQuestionRatings",null),e("#feedback").modal("hide"),s.logout(t)}),e("#surveySubmitButton").on("click",function(){c.set("surveyStatus","COMPLETED"),s.gotoGetSurveyDetails(t)}),e("#gotoStoreBtn").on("click",function(){s.gotoRateUsFunction(t)})},gotoGetSurveyDetails:function(t){t.stopImmediatePropagation();var o=!1,s=[],i=[];if(e(".rateAreaClass").each(function(t,a){e("#surveyQuesErr"+(t+1)).html("");var r=e(this).attr("id"),n=e("#"+r+" input[type='radio']:checked").attr("quesId"),l=e("#"+r+" input[type='radio']:checked").val();isNull(l)&&(o=!0,e("#surveyQuesErr"+(t+1)).html("Kindly share the valuable feedback rating")),o||(s.push(n),i.push(l))}),!o){e("#feedback").modal("hide"),c.set("surveyQuestionIds",s),c.set("surveyQuestionRatings",i);var a=e.trim(e("#feedbackComment").val());c.set("surveyMesage",a);var r=this;r.logout(t)}},gotoRateUsFunction:function(e){e.stopImmediatePropagation();var t=c.get("appInfoDTO");if(null!=t.url&&void 0!=t.url&&""!=t.url){var o=/iPad|iPhone|iPod/.test(navigator.userAgent);o?window.location.href=t.url:window.open(t.url,"_system","location=no")}},logout:function(){event.stopImmediatePropagation(),showSpinner();var t=c.get("surveyQuestionIds");if(!isNull(t))var s=t.join("~"),i=c.get("surveyQuestionRatings"),a=i.join("~");var r=this,l=function(e){hideSpinner(),c.set("isLogin",!1),c.set("defaultSessionTimeOut",0),c.set("timeoutFlagsessioncount",""),stopSessionTimer(),this.model=new accSummaryModel;var t=c.get("touchIdReg");"A"==t?o.history.navigate("#/landing"):o.history.navigate("#/applogin")},u=function(e){r.errorresponse()};r.collection=new n([],{});(new Date).getTime();r.collection.fetch({data:e.param({usersession:c.get("access_token"),access_token:c.get("access_token"),status:c.get("surveyStatus"),message:c.get("surveyMesage"),questionIds:s,questionRatings:a}),dataType:"json",type:"POST",cache:!1,success:function(e){if("0000"==ackStatus){c.get("errorcode");l("0000"==ackStatus?e:e)}else u(e)},error:u})},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return o.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return d});