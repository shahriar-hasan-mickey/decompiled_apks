define(["jquery","underscore","Backbone","collections/creditcard/creditCardSummaryCollections","collections/creditcard/resetPinCreditCardCollections","routers/creditcardrouter","routers/requestrouter","text!views/creditcard/resetPinCreditCard.tpl","models/validation/activateCreditCardValidationModel"],function(e,r,t,i,n,a,o,c,s){var l=new EncryptedLocalStorage("secret"),d=t.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #validateCardPin":"validateCardandPin","change input[type=radio][name=frmacno]":"changeCreditCard"},initialize:function(){new o},update:function(){l.set("currentPage","");var r=this,t=function(e){r.listcompile()},n=function(e){r.errorresponse()};r.collection=new i([],{}),showSpinner(),r.collection.fetch({data:e.param({status:"ACTIVE",cardType:"BOTH"}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(l.get("calltimeout")),success:function(e){var r=l.get("errorcode");"0000"==ackStatus?(t(e),hideSpinner()):null!=r&&"MTC-RT-0003"!=r?t(e):n(e)},error:n})},listcompile:function(){hideSpinner(),this.$("#mobcontent").html(r.template(c)).i18n(),e(".amtformatter").formatamount(),1==mycreditcards.length?e("#cardTypeDiv").show():e("#cardTypeDiv").hide()},changeCreditCard:function(){var r=e("input[name=frmacno]:checked").val().split("~")[2];null!=r&&(e("#ctype").text(r),e("#cardTypeDiv").show())},securityadvicecheck:function(r){"TWOFA"==e("#securityFlag").val()?this.loginotpverification(r,e("#securityFlag").val()):"TPIN"==e("#securityFlag").val()?this.loginotpverification(r,e("#securityFlag").val()):"SQ"==e("#securityFlag").val()&&this.loginotpverification(r,e("#securityFlag").val())},validateCardandPin:function(){e("#errorFromAct").hide(),e("#errorMonth").hide(),e("#errorYear").hide(),e("#errorFromDate").hide();var r=e("#month").val(),i=e("#year").val();if(mnthval=Number(r),yrval=Number(i),isNaN(mnthval))return e("#errorMonth").show(),!1;if(isNaN(yrval))return e("#errorYear").show(),!1;this.model=new s({url:"json/"}),this.$(".alert").hide(),e(".error-message").show(),t.Validation.bind(this);var n=this.$("form").serializeObject();if(this.model.set(n,{validate:!0})){this.model.clear(),t.Validation.unbind(this);var a=l.get("expirydate"),o=a.split("-"),c=o[0],d=o[1],r=e("#month").val(),i=e("#year").val();if(mnthval=Number(r),yrval=Number(i),isNaN(mnthval))return e("#errorMonth").show(),!1;if(isNaN(yrval))return e("#errorYear").show(),!1;var u,h,p=e("input[name=frmacno]:checked").val(),v="false";if("undefined"==typeof p?(v="true",e("#errorFromAct").show()):(u=p.split("~"),h=u[1]),"true"==v)return!1;if("undefined"==typeof h||""==h)return e("#errorFromDate").show(),!1;var m=u[3],f=DEcryptuserPin(h,m),o=f.split("-"),c=o[0],d=o[1],y=parseInt(c.substring(2)),w=!1;if(parseInt(i)!=y&&(w=!0,e("#errorYear").show()),parseInt(r)!=parseInt(d)&&(w=!0,e("#errorMonth").show()),1==w)return!1;showSpinner(),this.showOTP()}else this.$(".alert-error").fadeIn(),hideSpinner()},showOTP:function(){l.set("cc-rpcc-acno",""),l.set("cc-rpcc-cardpin",""),l.set("pinflag","");var r=e("#cardpin").val(),i=e("#confirmpin").val();if(r!=i)return e("#commonErrorCardPin").show(),hideSpinner(),e("#cardpin").val(""),e("#confirmpin").val(""),!1;var n=Encrypt(r),a=e("input[name=frmacno]:checked").val(),o=a.split("~"),c=o[0];l.set("cc-rpcc-acno",c),l.set("cc-rpcc-cardpin",n),l.set("ccrccfrmacno",c);var s="R";l.set("pinflag",s),hideSpinner(),t.history.navigate("#/resetPinCreditCardOtp")},errorresponse:function(){hideSpinner(),t.history.navigate("#/exception")},disposeView:function(e){return t.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return d});