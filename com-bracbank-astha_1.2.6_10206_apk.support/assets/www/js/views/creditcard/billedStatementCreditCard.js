define(["jquery","underscore","Backbone","collections/creditcard/creditCardSummaryCollections","collections/wealth/ccNicknameCollections","routers/creditcardrouter","routers/requestrouter","collections/creditcard/creditCardDetailsCollections","collections/creditcard/unbilledStatementCreditCardDetailsCollections","text!views/creditcard/billedStatementCreditCard.tpl","models/validation/nickNameValidationModel","views/errors/exception"],function(e,t,c,n,i,o,a,r,d,l,s,p){var u=new EncryptedLocalStorage("secret"),m=c.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #fromactno":"details","click #editname":"savenickname","change #monthlist":"MonthList","click #pdfdownload":"PDFDownload","click #xlsdownload":"XLSdownload","click #paynow":"paynow"},initialize:function(){new a},update:function(){u.set("currentPage","");var t=this,c=function(e){t.details()},i=function(e){t.errorresponse()};t.collection=new n([],{});var o=(new Date).getTime();showSpinner(),t.collection.fetch({data:e.param({status:"",requestid:o}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(u.get("calltimeout")),success:function(e){var n=u.get("errorcode");if("0000"==ackStatus){u.get("cccardacctno");"0000"==n?c(e):t.listcompile("0")}else null!=n&&"MTC-RT-0003"!=n?c(e):i(e)},error:i})},details:function(){hideSpinner();var t=this,c=function(e){t.MonthList("0")},n=function(e){t.errorresponse()};t.collection=new r([],{});var i,o=e("input[name=fromactno]:checked").val();if(void 0!=o){var a=o.split("~"),d=a[0];i=a[2]}if(""!=i&&void 0!=i&&null!=i)u.set("ccMask",i);else{var l=u.get("acctno");u.set("ccMask",l)}var s=u.get("cccardacctno"),p=u.get("acctno");("undefined"==o||void 0==o||null==o||""==o)&&(d=s,i=p),u.set("setccdetailsaccno",d);var m=(u.get("billingCycleDate"),getDeviceId()),h=d+""+m,v=CryptoJS.MD5(h);h=v+"",showSpinner(),t.collection.fetch({data:e.param({appchecksum:h,ccMaskedno:d,periodofstmt:"",accountId:d,moduletype:""}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(u.get("calltimeout")),success:function(e){var i=u.get("errorcode");u.get("errordesc");"0000"==ackStatus?"0000"==i?c(e):t.listcompile("0"):null!=i&&"MTC-RT-0003"!=i?c(e):n(e)},error:n})},MonthList:function(t){hideSpinner(),u.set("SelectedMonthCode","");var c,n,i=this;e("#monthlist option:selected").text();if("0"!=t){c=e("#monthlist").prop("selectedIndex");var o=e("#monthlist").val(),a=o.split("~");n=a[0];var r=a[1],l=a[2]}else c="0",n="00";u.set("SelectedMonthCode",n);var s=r,p=l,m="M";timestamp=(new Date).getTime();var h,v,f,g=e("input[name=fromactno]:checked").val(),w=u.get("cccardacctno"),S=u.get("billingCycleDate");"undefined"==typeof g?(v=w,g=w,f=S,u.set("selectedAcct",g)):(h=g.split("~"),v=h[0],f=h[1],u.set("selectedAcct",v)),showSpinner();var k=function(e){i.listcompile(c)},y=function(e){i.errorresponse()};i.collection=new d([],{});var C=getDeviceId(),D=v+""+C,M=CryptoJS.MD5(D);D=M+"",i.collection.fetch({data:e.param({appchecksum:D,accountNumber:v,monthcode:n,fromdate:s,todate:p,billcycledate:f,transactiontype:m,requestid:timestamp}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(u.get("calltimeout")),success:function(e){var t=(u.get("errordesc"),u.get("errorcode"));"0000"==ackStatus?"0000"==t?k(e):i.listcompile("0"):null!=t&&"MTC-RT-0003"!=t?k(e):y(e)},error:y})},savenickname:function(t){e("#nickerror").hide();var c=this,n=function(e){c.errorresponse()};c.collection=new i([],{});var o=e("input[name=fromactno]:checked").val(),a=u.get("cccardacctno");"undefined"==typeof o&&(o=a),u.set("selectedAcct",o);var r=u.get("custno"),d=e("#nicknameid").val(),l=e("#NickNameService").val(),s="EN";if(timestamp=(new Date).getTime(),""!=d){var p=e("input[name=fromactno]:checked").val(),m=p.split("~"),h=m[0];showSpinner(),c.collection.fetch({data:e.param({creditcardnumber:h,customerno:r,nickname:d,hidservicename:l,language:s,requestid:timestamp}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(u.get("calltimeout")),success:function(t){var c=u.get("errordesc");"0000"==ackStatus?(e("#updname").val(d),e("#checknicknametype").val(d),hideSpinner()):"No Record Found"==c?(n(t),hideSpinner()):n(t)},error:n})}else e("#nickerror").show()},nicknamecompile:function(c){hideSpinner(),this.$el.html(t.template(l,{collection:this.collection.models})).i18n(),this.$el.trigger("create"),e(".amtformatter").formatamount(),this.update(accountnumber)},paynow:function(){hideSpinner(),c.history.navigate("#/ccPayments")},listcompile:function(c){hideSpinner(),this.$("#mobcontent").html(t.template(l)),e("#hidmonidx").val(c),idx=parseInt(e("#hidmonidx").val()),e("#monthlist").prop("selectedIndex",idx),e(".amtformatter").formatamount()},PDFDownload:function(e){var t="",c=u.get("app.context.path");t=c+"creditcard/ministatement/download.pdf";var n=u.get("appSessionId"),i=u.get("device_id"),o=u.get("lang_id"),a=u.get("cccardacctno"),r=u.get("SelectedMonthCode"),d=getDeviceId(),l=a+""+d,s=CryptoJS.MD5(l);l=s+"";var p="device_id="+i+"&appchecksum="+l+"&lang_id="+o+"&accountNumber="+a+"&hidperiod="+r+"&download=PDF&cardoract=CARD",m=encodeURI(p);fileDownLoadAndViewer(t,m,1,n)},XLSdownload:function(e){var t="",c=u.get("app.context.path");t=c+"creditcard/ministatement/download.xls";var n=u.get("appSessionId"),i=u.get("device_id"),o=u.get("lang_id"),a=u.get("cccardacctno"),r=u.get("SelectedMonthCode"),d=getDeviceId(),l=a+""+d,s=CryptoJS.MD5(l);l=s+"";var p="device_id="+i+"&appchecksum="+l+"&lang_id="+o+"&accountNumber="+a+"&hidperiod="+r+"&download=XLS&cardoract=CARD",m=encodeURI(p);fileDownLoadAndViewer(t,m,2,n)},errorresponse:function(){hideSpinner(),c.history.navigate("#/exception")},disposeView:function(e){return c.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return m});