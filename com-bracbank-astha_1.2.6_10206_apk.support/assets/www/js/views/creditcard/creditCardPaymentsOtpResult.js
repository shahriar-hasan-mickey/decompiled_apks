define(["jquery","underscore","Backbone","collections/creditcard/creditCardPaymentsOtpResultCollections","collections/creditcard/creditCardPaymentCardValidationCollections","collections/common/emailAdviceCollections","text!views/common/emailAdviceSuccessPage.tpl","text!views/creditcard/creditCardPaymentsOtpResult.tpl","text!views/creditcard/queuemodecreditcard.tpl","libs/security/crypto-js/md5"],function(e,t,a,c,r,n,i,o,s,m){var p=new EncryptedLocalStorage("secret"),l=a.View.extend({el:"#mobcontent",events:{"click #emailadvice":"EmailAdvice"},initialize:function(){this.on("error",function(e,t){})},update:function(){var t=(p.get("acctno"),p.get("CCpayfrmActNo")),a=p.get("CCpaytoActNo"),c=this,n=p.get("ccpayremarks"),i=p.get("CCpayconv"),o=(i.replace("KWD",""),p.get("CCpayamt")),s=p.get("CCpayexrate"),c=this,m=function(e){c.resultPageSuccess(t,a,o,i,s,n)},l=function(e){c.errorresponse()};c.collection=new r([],{});var d,u,g,y,h,f,v,C,w,S,k,A,P,D,T,V,x,N,b;(new Date).getTime();d="KWD",u="KWD",g="",x=p.get("cartpe"),"O"!=x&&(y=p.get("toAcctId")),h=p.get("frmAcctId"),f=p.get("toaccno"),v=p.get("paymentRemarksval"),C=p.get("CCpayamt"),w=p.get("convamtwithoutcomma"),S="creditcardpayments",k=p.get("CashPayAmount"),A=p.get("productName"),P=p.get("patypecode"),D="PAYNOW",T="KWD",V="KWD",N=p.get("time"),b=p.get("toaccnopar");var E=h+p.get("appdynamicToken");E=CryptoJS.SHA512(E)+"",showSpinner(),c.collection.fetch({data:e.param({appDynamicValue:E,otpModule:"card_payment",toCreditCardNumber:b,creditCardType:x,fromaccountId:h,toaccountId:y,remarks:v,transtype:D,paymentType:P,salt:N,validtype:"Posting",paydate:g,access_token:p.get("access_token"),transamount:C,transcurrency:V}),dataType:"json",type:"POST",timeout:parseInt(p.get("calltimeout")),cache:!1,success:function(e){p.get("errorcode");"0000"==ackStatus?m(e):l(e)},error:l})},resultPageSuccess:function(e,a,c,r,n,i){hideSpinner();var s=r.replace("KWD",""),m=p.get("frmaccpaymaskno"),l=p.get("toaccpaymaskno"),d=p.get("Setshrtname");return this.$el.html(t.template(o,{from:e,to:a,transamt:c,payremarks:i,convertedamt:s,exrate:n,frmaccpaymaskno:m,toaccpaymaskno:l,shrtname:d})),this},queuePage:function(){return hideSpinner(),p.set("makeanotherreq","1"),this.$el.html(t.template(s)),this},EmailAdvice:function(){p.set("currentPage","");var t=this,a=function(e){t.emailadvicecompile()},c=function(e){t.errorresponse()};t.collection=new n([],{});var r=(new Date).getTime(),i=e("#ref").text(),o=p.get("CCpayfrmActNo"),s=o,m="TRANSFER",l=p.get("emailid"),d=(p.get("loginid"),p.get("custno")),u=(p.get("lang_id"),getDeviceId()),g=s+""+u,y=CryptoJS.MD5(g);g=y+"",showSpinner(),t.collection.fetch({data:e.param({appchecksum:g,accountNumber:s,ftrefno:i,custmailid:l,transfertype:m,custuserid:d,requestid:r}),dataType:"json",type:"POST",timeout:parseInt(p.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?a(e):c(e)},error:c})},emailadvicecompile:function(){return p.set("backReqFromEmail","9"),hideSpinner(),this.$el.html(t.template(i)).i18n(),this.$el.trigger("create"),this},errorresponse:function(){hideSpinner(),a.history.navigate("#/exception")},disposeView:function(e){return a.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return l});