define(["jquery","underscore","Backbone","collections/creditcard/cashOnDemandCreditCardOtpResultCollections","collections/common/emailAdviceCollections","text!views/common/emailAdviceSuccessPage.tpl","text!views/creditcard/cashOnDemandCreditCardOtpResult.tpl","libs/security/crypto-js/md5"],function(e,t,c,n,a,i,r,o){var s=new EncryptedLocalStorage("secret"),d=c.View.extend({el:"#mobcontent",events:{"click #emailadvice":"EmailAdvice"},initialize:function(){this.on("error",function(e,t){alert(t)})},update:function(t,c,a){var t=s.get("amount"),i=(s.get("conamt"),s.get("cashremarks")),r=s.get("CashDemandfrmActNo"),o=s.get("CashDemandtoActNo"),d=(s.get("frmaccmaskno"),s.get("toaccmaskno"),s.get("CashDemandDate")),m="1.00",u=s.get("custno"),l=this,p=function(e){l.resultPageSuccess()},h=function(e){l.errorresponse()};l.collection=new n([],{}),timestamp=(new Date).getTime();var g="creditcard",f=u,v=r,D=o,y=d,w=d,C=t,S=i,k=t,A=m,E="KWD",N="KWD",O="19",V=s.get("credithidAccountNo"),b=s.get("otpModule");s.set("otpModule","");var x=getDeviceId(),P=v+""+D+C+x,T=CryptoJS.MD5(P);P=T+"",showSpinner(),l.collection.fetch({data:e.param({appchecksum:P,hidtranstype:g,customerno:f,hidcardno:v,hidtoacctno:D,hidtrandate:y,valuedate:w,hidamt:C,hidtransdetails:S,baseequivalent:k,transfee:s.get("feeAmount"),hidexchangerate:A,fromcurr:E,tocurr:N,limitservicetype:O,creditcardaccountno:V,timestamp:timestamp,isOtpUsed:s.get("isOtpUsed"),opttype:b}),dataType:"json",type:"POST",timeout:parseInt(s.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?p(e):h(e)},error:h})},resultPageSuccess:function(){s.set("currentPage","transferConfirm");var c=s.get("amount"),n=s.get("conamt"),a=s.get("cashremarks"),i=(s.get("CashDemandfrmActNo"),s.get("CashDemandtoActNo"),s.get("frmaccmaskno")),o=s.get("toaccmaskno"),d=s.get("CashDemandDate"),m="1.00";s.get("custno");hideSpinner(),e(this.el).html(t.template(r,{frmcc:i,tocc:o,currency:c,remarks:a,Excrate:m,conamt:n,paydate:d})).i18n()},EmailAdvice:function(){s.set("currentPage","");var t=this,c=function(e){t.emailadvicecompile()},n=function(e){t.errorresponse()};t.collection=new a([],{});var i=(new Date).getTime(),r=e("#id1").text(),o=s.get("CashDemandfrmActNo"),d=o,m="TRANSFER",u=s.get("emailid"),l=(s.get("loginid"),s.get("custno")),p=(s.get("lang_id"),getDeviceId()),h=d+""+p,g=CryptoJS.MD5(h);h=g+"",showSpinner(),t.collection.fetch({data:e.param({appchecksum:h,accountNumber:d,ftrefno:r,custmailid:u,transfertype:m,custuserid:l,requestid:i}),dataType:"json",type:"POST",timeout:parseInt(s.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?c(e):n(e)},error:n})},emailadvicecompile:function(){return s.set("backReqFromEmail","9"),hideSpinner(),this.$el.html(t.template(i)).i18n(),this.$el.trigger("create"),this},errorresponse:function(){hideSpinner(),c.history.navigate("#/exception")},disposeView:function(e){return c.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return d});