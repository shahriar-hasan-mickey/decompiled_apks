define(["jquery","underscore","Backbone","collections/creditcard/creditCardSummaryCollections","collections/wealth/ccNicknameCollections","routers/creditcardrouter","routers/requestrouter","collections/creditcard/creditCardDetailsCollections","text!views/creditcard/creditCardDetails.tpl","models/validation/nickNameValidationModel","views/errors/exception"],function(e,t,i,n,c,a,r,o,s,l,d){var u=new EncryptedLocalStorage("secret"),m=i.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"change #fromactno":"details","click #editname":"savenickname","click #updatebtn":"updatebtn","click #increaselimit":"increaselimit","click #paynow":"paynow"},initialize:function(){new r},update:function(){u.set("currentPage",""),showSpinner();var t=this,i=function(e){t.details()},c=function(e){t.listcompile()},a=function(e){t.errorresponse()};t.collection=new n([],{});var r=(new Date).getTime();t.collection.fetch({data:e.param({status:"",requestid:r}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(u.get("calltimeout")),success:function(e){var t=u.get("errorcode");"0000"==ackStatus?"0000"==t?i(e):c(e):null!=t&&"MSI-ES-1001"!=t?i(e):a(e)},error:a})},details:function(){hideSpinner();var t=this,i=function(e){t.listcompile()},n=function(e){t.errorresponse()};t.collection=new o([],{});var c,a=e("input[name=fromactno]:checked").val();if(void 0!=a){var r=a.split("~"),s=r[0];c=r[1];var l=r[2]}if(""!=l&&void 0!=l&&null!=l)u.set("shortnamesum",l);else{var l=u.get("shortNamesummary");u.set("shortnamesum",l)}if(""!=c&&void 0!=c&&null!=c)u.set("ccMask",c);else{var d=u.get("acctno");u.set("ccMask",d)}var m=u.get("cccardacctno"),p=u.get("acctno");("undefined"==s||void 0==s||null==s||""==s)&&(s=m,c=p),u.set("setccdetailsaccno",s),showSpinner();var h=getDeviceId(),v=s+""+h,f=CryptoJS.MD5(v);v=f+"",t.collection.fetch({data:e.param({appchecksum:v,ccMaskedno:s,accountId:s,moduletype:""}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(u.get("calltimeout")),success:function(e){var t=u.get("errorcode");"0000"==ackStatus?(i(e),hideSpinner()):null!=t&&"MTC-RT-0003"!=t?i(e):n(e)},error:n})},listcompile:function(){hideSpinner(),this.$("#mobcontent").html(t.template(s)),e(".amtformatter").formatamount()},updatebtn:function(){hideSpinner(),i.history.navigate("#/creditCardusagecontrolrequest")},increaselimit:function(){hideSpinner(),i.history.navigate("#/temporarylimitcontrolrequest")},paynow:function(){hideSpinner(),i.history.navigate("#/ccPayments")},savenickname:function(t){this.model=new l({url:"json/"}),this.$(".alert").hide(),i.Validation.bind(this);var n=this.$("form").serializeObject();if(this.model.set(n,{validate:!0})){this.model.clear(),i.Validation.unbind(this);var a=this,r=function(e){a.errorresponse()};a.collection=new c([],{});var o=u.get("custno"),s=e("input[name=fromactno]:checked").val();if(void 0!=s)var d=s.split("~"),m=d[0];var p=u.get("cccardacctno");("undefined"==m||void 0==m||null==m||""==m)&&(m=p),u.set("setccdetailsaccno",m);var h=e("#nicknameid").val(),v=(e("#NickNameService").val(),e("#checknicknametype").val());v=""==v?"NickNameAdd":"NickNameUpdate";var f="",g=u.get("lang_id");"en-US"==g?f="EN":"en-AR"==g&&(f="AR");var k=getDeviceId(),S=h.split(" ").join("+")+""+k,w=CryptoJS.MD5(S);if(S=w+"",S="E-"+S,timestamp=(new Date).getTime(),""!=h){showSpinner(),a.collection.fetch({data:e.param({creditcardnumber:m,customerno:o,nickname:h,hidservicename:v,appchecksum:S,language:f,requestid:timestamp}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(u.get("calltimeout")),success:function(t){"0000"==ackStatus?(e("#updname").val(h),e("#checknicknametype").val(h),hideSpinner()):r(t)},error:r})}else hideSpinner(),e("#nickerror").show()}else hideSpinner(),this.$(".alert-error").fadeIn()},nicknamecompile:function(e){hideSpinner(),this.$el.html(t.template(creditCardDetails,{collection:this.collection.models})).i18n(),this.$el.trigger("create"),this.update(accountnumber)},errorresponse:function(){hideSpinner(),i.history.navigate("#/exception")},disposeView:function(e){return i.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return m});