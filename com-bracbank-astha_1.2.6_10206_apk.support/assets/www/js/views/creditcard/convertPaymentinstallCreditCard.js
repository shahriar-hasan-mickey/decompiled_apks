define(["jquery","underscore","Backbone","collections/creditcard/ccusagectrlcreditCardSummaryCollections","collections/creditcard/ccusagectrlCreditCardDetailsCollections","routers/creditcardrouter","routers/requestrouter","text!views/creditcard/convertPaymentinstallCreditCard.tpl","views/errors/exception"],function(t,e,n,i,r,a,s,c,o){var m=new EncryptedLocalStorage("secret"),d=n.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"change #fromactno":"details","change #cardtype":"details","click #convertemi":"inputPage"},initialize:function(){new s},update:function(){m.set("currentPage",""),m.set("creditCardActNo",""),m.set("frmacntval",""),m.set("selectedAcct",""),m.set("eppeligiblecardflagg",""),m.set("acctnomaskk",""),m.set("ecurrencyCode",""),m.set("eamount",""),m.set("emerchant",""),m.set("transactionDate",""),m.set("valueDate",""),m.set("txncode",""),m.set("authcode",""),m.set("recnbr",""),m.set("plannbr",""),m.set("transcode",""),m.set("transactionkey",""),m.set("txnidcode",""),m.set("recordtype",""),m.set("mtsinbr",""),m.set("mtmrchntstore",""),m.set("mtmrchntorg",""),m.set("mtplan",""),m.set("cardseqnbr",""),m.set("transactionDescription",""),m.set("mtlogicmod",""),m.set("cardseqnbr",""),m.set("mtplan",""),m.set("mtdesc",""),m.set("transactionkey",""),m.set("refnbr",""),m.set("epp_flag","");var e=this,n=function(t){e.details()},r=function(t){e.listcompile()},a=function(t){e.errorresponse()};e.collection=new i([],{}),showSpinner(),e.collection.fetch({data:t.param({status:"ACTIVE",requestid:timestamp}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(m.get("calltimeout")),success:function(t){var e=m.get("errorcode");"0000"==ackStatus?"0000"==e?(creditcardsList=mycreditcards,null!=creditcardsList&&""!=creditcardsList&&void 0!=creditcardsList?n(t):r(t)):r(t):null!=e&&"MTC-RT-0003"!=e?n(t):a(t)},error:a})},details:function(){hideSpinner();var e=this;t("#minstmtshow").hide();var n=function(t){e.listcompile()},i=function(t){e.errorresponse()};e.collection=new r([],{});var a=t("input[name=fromactno]:checked").val();if(""!=a&&void 0!=a&&null!=a){var s=a.split("~"),a=s[0],c=s[1],o=s[2];s[3];m.set("creditCardActNo",c),m.set("frmacntval",a),m.set("selectedAcct",a),m.set("eppeligiblecardflagg",o)}else if(creditcardsList.length>0){var d=!1;creditcardsList.forEach(function(t){if("Yes"==t.eppeligiblecardflag&&0==d){d=!0;var e=t.creditCardActNo;m.set("creditCardActNo",e);var n=t.accountNumber;a=n,m.set("frmacntval",n),m.set("selectedAcct",a);var i=t.eppeligiblecardflag;m.set("eppeligiblecardflagg",i);m.get("acctnomask")}})}var l=(m.get("accountNumber"),"00"),u="C";timestamp=(new Date).getTime();var p=getDeviceId(),g=a+""+p,h=CryptoJS.MD5(g);g=h+"",showSpinner(),e.collection.fetch({data:t.param({appchecksum:g,sortBy:"",accountNumber:a,monthcode:l,transactiontype:u,requestid:timestamp}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(m.get("calltimeout")),success:function(e){var r=m.get("errorcode");"0000"==ackStatus?(m.set("availableCreditCardLimit",carddet.availableCreditLimit),ministatement.length&&(miniStatements=ministatement),n(e),t("#minstmtshow").show()):null!=r&&"MTC-RT-0003"!=r?n(e):(i(e),t("#minstmtshow").show())},error:i})},listcompile:function(){hideSpinner(),this.$("#mobcontent").html(e.template(c)),t(".amtformatter").formatamount()},inputPage:function(e){if(0!==t(e.currentTarget).find("a.convertemi").length){var i=t(e.currentTarget).data("index"),r=t("input[name=fromactno]:checked").val(),a=r.split("~"),r=a[0],s=a[1],c=a[2];a[3];m.set("creditCardActNo",s),m.set("frmacntval",miniStatements[i].ccardnumberenc),m.set("selectedAcct",miniStatements[i].ccardnumberenc),m.set("eppeligiblecardflagg",c),m.set("acctnomaskk",miniStatements[i].creditCardNoMasked),m.set("ecurrencyCode",miniStatements[i].currencyCode),m.set("eamount",miniStatements[i].transactionAmount),m.set("emerchant",miniStatements[i].transactionDescription),m.set("transactionDate",miniStatements[i].transactionDate),m.set("valueDate",miniStatements[i].valueDate),m.set("txncode",miniStatements[i].txncode),m.set("authcode",miniStatements[i].authcode),m.set("recnbr",miniStatements[i].recnbr),m.set("plannbr",miniStatements[i].plannbr),m.set("transcode",miniStatements[i].transcode),m.set("transactionkey",miniStatements[i].transactionkey),m.set("txnidcode",miniStatements[i].txnidcode),m.set("recordtype",miniStatements[i].recordtype),m.set("mtsinbr",miniStatements[i].mtsinbr),m.set("mtmrchntstore",miniStatements[i].mtmrchntstore),m.set("mtmrchntorg",miniStatements[i].mtmrchntorg),m.set("mtplan",miniStatements[i].mtplan),m.set("cardseqnbr",miniStatements[i].cardseqnbr),m.set("transactionDescription",miniStatements[i].transactionDescription),m.set("mtlogicmod",miniStatements[i].mtlogicmod),m.set("cardseqnbr",miniStatements[i].cardseqnbr),m.set("mtplan",miniStatements[i].mtplan),m.set("mtdesc",miniStatements[i].mtdesc),m.set("transactionkey",miniStatements[i].transactionkey),m.set("refnbr",miniStatements[i].refnbr),m.set("epp_flag",miniStatements[i].eppflag),n.history.navigate("#/convertPaymentinstallCreditCardEMI")}},errorresponse:function(){hideSpinner(),n.history.navigate("#/exception")},disposeView:function(t){return n.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=t,this.currentView.delegateEvents(),this.currentView}});return d});