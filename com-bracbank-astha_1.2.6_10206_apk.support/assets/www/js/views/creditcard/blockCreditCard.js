define(["jquery","underscore","Backbone","collections/creditcard/creditCardSummaryCollections","routers/creditcardrouter","text!views/creditcard/blockCreditCard.tpl","models/validation/activateCreditCardValidationModel","views/errors/exception"],function(e,t,r,i,n,a,o,c){var s=new EncryptedLocalStorage("secret"),d=r.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #validateCardPin":"validateCardandPin","change #frmacno":"details"},initialize:function(){},update:function(){s.set("currentPage","");var t=this,r=function(e){t.listcompile()},n=function(e){t.errorresponse()};t.collection=new i([],{}),showSpinner(),t.collection.fetch({data:e.param({status:"ACTIVE",cardType:"BOTH"}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(s.get("calltimeout")),success:function(e){var t=s.get("errorcode");"0000"==ackStatus?(r(e),hideSpinner()):null!=t&&"MTC-RT-0003"!=t?r(e):n(e)},error:n})},details:function(){e("#ctype").empty(),e("#cardname").empty(),e("#year").empty(),e("#expiry").empty(),e("#hidacno").empty();var t=e("input[name=frmacno]:checked").val(),r=t.split("~"),i=r[0],n=r[1];s.set("date",n);var a=r[2];s.set("type",a);var o=r[3];s.set("name",o);for(var c="",d="",l=0;l<n.length;l++)"-"!=n[l]&&5>l?c+=n[l]:"-"!=n[l]&&7>l&&(d+=n[l]);e("#ctype").text(a),e("#cardname").text(o),e("#year").text(c),e("#expiry").text(d),e("#hidacno").val(i)},listcompile:function(){hideSpinner();var r=s.get("expirydate"),i=r,n="",o="";if(null!=i)for(var c=0;c<i.length;c++)"-"!=i[c]&&5>c?n+=i[c]:"-"!=i[c]&&7>c&&(o+=i[c]);this.$("#mobcontent").html(t.template(a,{year:n,month:o})),e(".amtformatter").formatamount()},errorresponse:function(){hideSpinner(),r.history.navigate("#/exception")},validateCardandPin:function(){e("#errorFromAct").hide();var t=e("input[name=frmacno]:checked").val(),i="false";if("undefined"==typeof t&&(i="true",e("#errorFromAct").show()),"true"==i)return!1;this.model=new o({url:"json/"}),this.$(".alert").hide(),r.Validation.bind(this);var n=this.$("form").serializeObject();this.model.set(n,{validate:!0})?(this.model.clear(),r.Validation.unbind(this),showSpinner(),this.showOTP()):this.$(".alert-error").fadeIn()},showOTP:function(){var t=e("input[name=frmacno]:checked").val(),i=t.split("~"),n=i[0];s.set("ccbccacno",n);var a=i[1];s.set("date",a);var o=i[2];s.set("type",o);var c=i[3];s.set("name",c),hideSpinner(),r.history.navigate("#/blockcreditcardotp")},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return d});