define(["jquery","underscore","Backbone","routers/creditcardrouter","routers/requestrouter","collections/creditcard/eppmerchantplancodeCollections","text!views/creditcard/convertPaymentinstallCreditCardEMI.tpl","views/errors/exception"],function(e,n,o,a,i,s,c,l){var d=new EncryptedLocalStorage("secret"),u=o.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"change #tenorTypes":"tenorChange","click #convertPaymentinstallCreditCardverify":"convertPaymentinstallCreditCardverify","click #termandcondition":"applytermsandconurl"},initialize:function(){new i},applytermsandconurl:function(){d.get("lang_id")},tenorChange:function(){var n=e("#tenorTypes option:selected").val(),o=n.split("~"),a=o[0],i=o[1],s=o[2];d.set("tenoreplan",i),d.set("tenorEpp",a),d.set("tenoreprofitt",s);var c=d.get("eppProfitRate"),l=(parseFloat(c),d.get("eamount")),u=parseFloat(a.replace(/^0+/,""));parseFloat(c/1200);if(0==c){p=parseFloat(l),t=parseFloat(u);var m=parseFloat(p/t);d.set("emiAmountval",m);var v=checkAmount(e.formatNumber(m,{format:"#,###.000",locale:"us"}));e("#displayamt").html("<span class='cur'>KWD</span>&nbsp;"+v),document.getElementById("convDivId").style.display="block"}else{r=parseFloat(c/100),p=parseFloat(l),t=parseFloat(u);var m=(p+.01*p*t)/t;d.set("emiAmountval",m);var v=checkAmount(e.formatNumber(m,{format:"#,###.000",locale:"us"}));e("#displayamt").html("<span class='cur'>KWD</span>&nbsp;"+v),document.getElementById("convDivId").style.display="block"}},update:function(){d.set("currentPage","");var t=this,r=function(e){t.listcompile()},n=function(e){t.errorresponse()};t.collection=new s([],{});var o=(new Date).getTime();showSpinner(),t.collection.fetch({data:e.param({merchname:d.get("emerchant"),requestid:o}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(d.get("calltimeout")),success:function(e){d.set("eppProfitRate1",eppMerchantplns[0].epp_PROFIT),d.set("eppProfitRate",eppMerchantplns[0].epp_PLANNO.substring(1,2));var t=d.get("errorcode");"0000"==ackStatus?(r(e),hideSpinner()):null!=t&&"MTC-RT-0003"!=t?r(e):n(e)},error:n})},convertPaymentinstallCreditCardverify:function(){e("#errortenorsel").hide(),e("#errortermscond").hide();var t=e("#tenorTypes option:selected").val();return""==t?(e("#errortenorsel").show(),!1):e("#iagreee").prop("checked")?void o.history.navigate("#/convertPaymentinstallCreditCardverify"):(e("#errortermscond").show(),!1)},listcompile:function(){hideSpinner(),this.$("#mobcontent").html(n.template(c)),e(".amtformatter").formatamount()},errorresponse:function(){hideSpinner(),o.history.navigate("#/exception")},disposeView:function(e){return o.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return u});