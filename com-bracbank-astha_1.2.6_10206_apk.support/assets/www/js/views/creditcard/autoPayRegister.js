define(["jquery","underscore","Backbone","backbonevalidation","collections/creditcard/creditCardSummaryCollections","collections/creditcard/ccPaymentCardSummaryCollections","routers/creditcardrouter","text!views/creditcard/autoPayRegister.tpl"],function(e,t,n,r,a,i,o,c){var s=new EncryptedLocalStorage("secret"),u=n.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #autopayregis":"autoPayRegisterConf"},initialize:function(){},update:function(){var e=this;showSpinner(),e.ownActCard()},ownActCard:function(){var t=this,n=function(e){hideSpinner(),t.cardSummary()},r=function(e){t.errorresponse()};t.collection=new i([],{}),timestamp=(new Date).getTime();var a="4",o="ACTIVE",c=s.get("segmentvalue"),u="05",d="",l=s.get("lang_id");"en-US"==l?d="EN":"en-AR"==l&&(d="AR"),showSpinner(),t.collection.fetch({data:e.param({trans_type:"CARD PAYMENT",beneficiarytype:a,beneficiarystatus:o,moduleType:"CC",segment:c,serviceid:u,language:d,status:"",requestid:timestamp}),dataType:"json",type:"POST",timeout:parseInt(s.get("calltimeout")),cache:!1,success:function(e){var t=s.get("errorcode");"0000"==ackStatus?n(e):null!=t&&"MTC-RT-0003"!=t?n(e):r(e)},error:r})},cardSummary:function(){var t=this,n=function(e){t.listcompile()},r=function(e){t.errorresponse()};t.collection=new a([],{});var i=(new Date).getTime();showSpinner(),t.collection.fetch({data:e.param({status:"",requestid:i}),dataType:"json",type:"POST",timeout:parseInt(s.get("calltimeout")),cache:!1,success:function(e){var t=(s.get("errordesc"),s.get("errorcode"));"0000"==ackStatus?n(e):null!=t&&"MTC-RT-0003"!=t?n(e):r(e)},error:r})},listcompile:function(){hideSpinner(),this.$("#mobcontent").html(t.template(c));var e=s.get("device.platform");return"Android"==e||"Ios"==e?this.datefunc():this.datefunc(),this},datefunc:function(t){e(".nativedatepicker").focus(function(t){t.preventDefault();var n,r=e(this);if(""!==r.val()){var a=r.val(),i=/(\d+)\/(\d+)\/(\d+)/.exec(a),o=new Date(+i[3],+i[2]-1,+i[1]);n=Date.parse(o)}else t.preventDefault(),n=new Date;"number"==typeof n&&(n=new Date(n)),window.plugins.datePicker.show({date:n,mode:"date",allowOldDates:!0},function(e){if(e){var t=new Date(e),n=t.getDate(),a=t.getMonth()+1,i=t.getFullYear(),o=""+(9>=n?"0"+n:n)+"/"+(9>=a?"0"+a:a)+"/"+i;r.val(o)}r.blur()}),this.undelegateEvents()})},errorresponse:function(){hideSpinner(),n.history.navigate("#/exception")},autoPayRegisterConf:function(){e("#errorFromAct").hide(),e("#errorToAct").hide();var t=e("input[name=frmacc]:checked").val(),r=e("input[name=toacc]:checked").val(),a=e("#payDate").val();if("undefined"==typeof t)return e("#errorFromAct").show(),!1;if("undefined"==typeof r)return e("#errorToAct").show(),!1;var i=t.split("~"),o=i[0],c=i[4],u=r.split("~"),d=u[1];s.set("frmaccno",o),s.set("frmaccname",c),s.set("toaccno",d),s.set("payDate",a),n.history.navigate("#/autopayregisterconfirm")},disposeView:function(e){return n.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return u});