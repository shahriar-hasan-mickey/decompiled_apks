define(["jquery","underscore","Backbone","text!views/creditcard/creditCardPaymentsOtp.tpl","text!views/creditcard/creditCardPaymentsOtpResult.tpl","collections/creditcard/creditCardPaymentsCollections","collections/creditcard/creditCardPaymentsOtpCollections","models/validation/creditCardLimitValidationModel"],function(t,e,n,i,r,c,o,a){var s=new EncryptedLocalStorage("secret"),d=n.View.extend({el:"#container",events:{"click #submitOTP":"submitOTP"},initialize:function(){this.on("error",function(t,e){alert(e)})},update:function(e,n,i,r,o,a){var d=s.get("custno"),l=this,u=function(t){l.blockccotp(e,n,i,r,o,a)},p=function(t){l.errorresponse()};l.collection=new c([],{}),timestamp=(new Date).getTime(),l.collection.fetch({data:t.param({custno:d,language:"EN",servicetype:"00"}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?u(t):p(t)},error:p})},blockccotp:function(t,n,r,c,o,a){this.$("#mobcontent").html(e.template(i,{fromacc:t,toacc:n,transAmt:r,payRemarks:c,conamount:o,exchangerate:a})).i18n()},submitOTP:function(){this.model=new a({url:"json/"}),this.$(".alert").hide(),n.Validation.bind(this);var e=this.$("form").serializeObject();if(this.model.set(e,{validate:!0})){this.model.clear(),n.Validation.unbind(this);var i=t("#txnotp").val(),r=this,c=function(t){r.OtpSuccess()},s=function(t){r.errorresponse()};r.collection=new o([],{}),timestamp=(new Date).getTime(),showSpinner(),r.collection.fetch({data:t.param({refno:i,otpModule:"card_payment",opttype:"OTP"}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?c(t):s(t)},error:s})}else this.$(".alert-error").fadeIn()},OtpSuccess:function(e,i,r,c,o,a){var s=t("#from").text(),i=t("#to").text(),d=t("#transamt").text(),l=t("#payremarks").text(),o=t("#convertedamt").text(),a=t("#exrate").text();n.history.navigate("#/creditCardPaymentsOtpResult/"+s+"/"+i+"/"+d+"/"+l+"/"+o+"/"+a),hideSpinner()},errorresponse:function(){n.history.navigate("#/exception"),hideSpinner()},disposeView:function(t){return n.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=t,this.currentView.delegateEvents(),this.currentView}});return d});