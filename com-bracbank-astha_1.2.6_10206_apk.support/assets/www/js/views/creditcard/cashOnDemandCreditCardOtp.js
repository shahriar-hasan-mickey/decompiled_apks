define(["jquery","underscore","Backbone","text!views/creditcard/cashOnDemandCreditCardOtp.tpl","text!views/creditcard/cashOnDemandCreditCardOtpResult.tpl","collections/creditcard/cashOnDemandCreditCardCollections","collections/creditcard/cashOnDemandCreditCardOtpCollections","models/validation/creditCardLimitValidationModel"],function(e,t,i,n,r,c,a,o){var s=new EncryptedLocalStorage("secret"),l=i.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #submitOTP":"submitOTP"},initialize:function(){this.on("error",function(e,t){alert(t)})},update:function(t,i,n,r,a,o){var l=s.get("custno"),d=this,u=function(e){d.blockccotp(t,i,n,r,a,o)},p=function(e){d.errorresponse()};d.collection=new c([],{}),timestamp=(new Date).getTime(),d.collection.fetch({data:e.param({custno:l,language:"EN",servicetype:"00"}),dataType:"json",type:"POST",timeout:parseInt(s.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?u(e):p(e)},error:p})},blockccotp:function(e,i,r,c,a,o){this.$("#mobcontent").html(t.template(n,{frmacno:e,toacc:i,currency:r,remarks:c,payDate:a,conamt:o})).i18n()},securityadvicecheck:function(t){"TWOFA"==e("#securityFlag").val()?this.loginotpverification(t,e("#securityFlag").val()):"TPIN"==e("#securityFlag").val()?this.loginotpverification(t,e("#securityFlag").val()):"SQ"==e("#securityFlag").val()&&this.loginotpverification(t,e("#securityFlag").val())},submitOTP:function(){e("#secError").hide();var t=s.get("device.platform");"Android"==t&&"true"==s.get("isOtpReceived")&&stopSMSListening(),showSpinner(),this.model=new o({url:"json/"}),this.$(".alert").hide(),i.Validation.bind(this);var n=this.$("form").serializeObject();if(this.model.set(n,{validate:!0})){this.model.clear(),i.Validation.unbind(this);var r=e("#txnotp").val(),c=this,l=function(e){c.OtpSuccess()},d=function(e){c.errorresponse()};c.collection=new a([],{}),timestamp=(new Date).getTime(),c.collection.fetch({data:e.param({refno:r,opttype:"OTP"}),dataType:"json",type:"POST",timeout:parseInt(s.get("calltimeout")),cache:!1,success:function(t){if("0000"==ackStatus)l(t);else{var i=s.get("errordesc");e("#showError").text(i),e("#secError").show(),hideSpinner()}},error:d})}else this.$(".alert-error").fadeIn()},OtpSuccess:function(){var t=e("#frmcc").text(),n=e("#tocc").text(),r=e("#currency").text(),c=e("#paydate").text(),a=e("#convamt").text();i.history.navigate("#/cashOnDemandCreditCardOtpResult/"+t+"/"+n+"/"+r+"/"+c+"/"+a),hideSpinner()},errorresponse:function(){hideSpinner(),i.history.navigate("#/exception")},disposeView:function(e){return i.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return l});