define(["jquery","underscore","Backbone","backbonevalidation","collections/creditcard/creditCardSummaryCollections","routers/creditcardrouter","routers/requestrouter","text!views/creditcard/creditCardLimit.tpl","views/creditcard/creditCardLimitConfirm","models/validation/creditCardLimitValidationModel"],function(e,i,t,r,n,a,o,c,l,d){var s=new EncryptedLocalStorage("secret"),u=t.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #validateCardPin":"validateCardandPin","change #frmacno":"currentLimit","blur  .newlimit":"limitCheck","click #newlimit":"openNumPad"},initialize:function(){new o},openNumPad:function(){var i=this;id="newlimit";var t=/iPad|iPhone|iPod/.test(navigator.userAgent),r=s.get("isKeyPadNeed");t&&r&&navigator.notification.keypadOpen(e("#"+id).val(),9,function(i){e("#"+id).val(i)},function(t){e("#"+id).val(t),i.limitCheck()})},update:function(){s.set("currentPage","");var i=this,t=function(e){i.listcompile()},r=function(e){i.errorresponse()};i.collection=new n([],{}),showSpinner(),i.collection.fetch({data:e.param({status:"ACTIVE"}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(s.get("calltimeout")),success:function(e){var i=s.get("errorcode");"0000"==ackStatus?(t(e),hideSpinner()):null!=i&&"MTC-RT-0003"!=i?t(e):r(e)},error:r})},listcompile:function(){hideSpinner(),this.$("#mobcontent").html(i.template(c)).i18n(),e(".amtformatter").formatamount()},limitCheck:function(){var i=e("#newlimit").val(),t=0;i!=t&&e("#newlimit").val(Number(i).toFixed(2))},validateCardandPin:function(){e("#errorFromAct").hide(),e("#errorLimitIncrease").hide(),e("#errorLimit").hide(),e("#limitRequired").hide(),e("#newLimitDiv").removeClass("has-error"),e("#errincreaseLimit").hide();var i=e("input[name=frmacno]:checked").val(),r="false",n=e("#newlimit").val();"undefined"==typeof i&&(r="true",e("#errorFromAct").show()),(""==n||0>=n||null==n)&&(e("#limitRequired").show(),e("#newLimitDiv").addClass("has-error"),r="true");var a,o=e("#curtlimitamt").text(),c=e("#currentlimit").val();a=""!=c&&"undefined"!=c&&null!=c?c.replace("KWD",""):o.replace("KWD","");var l=0;if("true"==r)return!1;if(n!=l&&parseFloat(a)>=parseFloat(n))return e("#errorLimit").show(),!1;this.model=new d({url:"json/"}),this.$(".alert").hide(),e(".error-message").show(),t.Validation.bind(this);var s=this.$("form").serializeObject();this.model.set(s,{validate:!0})?(this.model.clear(),t.Validation.unbind(this),showSpinner(),this.showOTP()):this.$(".alert-error").fadeIn()},currentLimit:function(){e("#currentlimit1").empty();var i=e("input[name=frmacno]:checked").val(),t=i.split("~"),r=t[1],n=t[2],a=n+"   "+r;e("#currentlimitcode").text(n),e("#curtlimitamt").text(r),e("#currentlimit1").text(a),e("#currentlimit").val(r),e("#defalutAmtId").hide(),e("#limitamtId").show()},showOTP:function(){var i=e("input[name=frmacno]:checked").val();if(e("#errorFromAct").hide(),e("#limitRequired").hide(),e("#newLimitDiv").removeClass("has-error"),"undefined"==typeof i)return e("#errorFromAct").show(),!1;var t=i.split("~"),r=t[0];s.set("ccselectlim",r);var n=t[2],a=e.i18n.t("app.creditcard.cclimit.permanent"),o=e("#currentlimit").val(),c=e("#newlimit").val(),d=e("#reason").val();("undefined"==o||""==o)&&(o="0.00"),("undefined"==a||""==a)&&(a="0.00"),("undefined"==c||""==c)&&(c="0.00"),("undefined"==i||""==i)&&(o="0.00"),s.set("selectlim",r),s.set("inclimit",a),s.set("limit",o),s.set("newlimit",c),s.set("reason",d),s.set("ccode",n),hideSpinner(),this.subview=this.disposeView(new l),this.subview.$el.trigger("create"),this.subview.update(),this.undelegateEvents()},errorresponse:function(){hideSpinner(),t.history.navigate("#/exception")},disposeView:function(e){return t.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return u});