define(["jquery","underscore","Backbone","collections/creditcard/creditCardSummaryCollections","collections/creditcard/activateCreditCardCollections","routers/creditcardrouter","routers/requestrouter","text!views/creditcard/activateCreditCardNotify.tpl","models/validation/activateCreditCardValidationModel"],function(e,t,r,i,n,a,c,o,s){var d=new EncryptedLocalStorage("secret"),l=r.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #validateCardPin":"validateCardandPin"},initialize:function(){new c},update:function(){d.set("currentPage","");var t=this,r=function(e){t.activecardcompile()},n=function(e){t.errorresponse()};t.collection=new i([],{}),showSpinner(),t.collection.fetch({data:e.param({status:"INACTIVE",cardType:"BOTH"}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(d.get("calltimeout")),success:function(e){var t=d.get("errorcode");"0000"==ackStatus?(r(e),hideSpinner()):null!=t&&"MTC-RT-0003"!=t?r(e):n(e)},error:n})},activecardcompile:function(){hideSpinner(),this.$("#mobcontent").html(t.template(o)),e(".amtformatter").formatamount()},errorresponse:function(){hideSpinner(),r.history.navigate("#/exception")},validateCardandPin:function(){e("#errorMonth").hide(),e("#errorYear").hide(),e("#errorFromAct").hide(),this.model=new s({url:"json/"}),this.$(".alert").hide(),r.Validation.bind(this);var t=this.$("form").serializeObject();if(this.model.set(t,{validate:!0})){this.model.clear(),r.Validation.unbind(this);var i="",n=e("input[name=frmacno]:checked").val(),a=n.split("~"),n=a[0],c=a[2];d.set("frmname",c);var o=d.get("tocreditcard");e.each(o,function(e){return o[e].creditCardNoMasked==n?(i=o[e].expiryDate,!1):void 0}),d.set("expiryddmmyy",i);var l=i.substring(2,4),u=i.substring(5,7),h=e("#month").val(),m=e("#year").val();if(m!=l)return e("#errorYear").show(),!1;if(h!=u)return e("#errorMonth").show(),!1;var v=e("input[name=frmacno]:checked").val(),p="false";if("undefined"==typeof v&&(p="true",e("#errorFromAct").show()),"true"==p)return!1;showSpinner(),this.showOTP()}else this.$(".alert-error").fadeIn()},showOTP:function(){var t=e("input[name=frmacno]:checked").val(),i=t.split("~"),t=i[0],n=i[1];d.set("acctno",n),d.set("encryptedAcctno",n),d.set("ccaccfrmacno",t),d.set("cc-acc-frmacno",t);var a=e("#month").val();d.set("cc-acc-mm",a);var c=e("#year").val();d.set("cc-acc-yy",c),hideSpinner(),r.history.navigate("#/activateCreditCardOTP")},errorresponse:function(){r.history.navigate("#/exception"),hideSpinner()},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return l});