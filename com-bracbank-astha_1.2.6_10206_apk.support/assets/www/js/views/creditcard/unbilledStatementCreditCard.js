define(["jquery","underscore","Backbone","collections/creditcard/ccusagectrlcreditCardSummaryCollections","collections/creditcard/ccusagectrlCreditCardDetailsCollections","routers/creditcardrouter","routers/requestrouter","text!views/creditcard/unbilledStatementCreditCard.tpl","views/errors/exception"],function(t,e,n,a,i,c,r,s,o){var d=new EncryptedLocalStorage("secret"),m=n.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"change #fromactno":"details","change #cardtype":"details","click #convertemi":"inputPage","click #pdfdownload":"PDFDownload","click #xlsdownload":"XLSdownload"},initialize:function(){new r},update:function(){d.set("currentPage","");var e=this,n=function(t){e.details()},i=function(t){e.listcompile()},c=function(t){e.errorresponse()};e.collection=new a([],{}),showSpinner(),e.collection.fetch({data:t.param({status:"ACTIVE",requestid:timestamp}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(d.get("calltimeout")),success:function(t){var e=d.get("errorcode");"0000"==ackStatus?"0000"==e?n(t):i(t):null!=e&&"MTC-RT-0003"!=e?n(t):c(t)},error:c})},details:function(){hideSpinner();var e=this;t("#minstmtshow").hide();var n=function(t){e.listcompile()},a=function(t){e.errorresponse()};e.collection=new i([],{});var c=t("input[name=fromactno]:checked").val();if(void 0!=c){var r=c.split("~"),c=r[0],s=r[1],o=r[2],m=r[3];d.set("creditCardActNo",s),d.set("frmacntval",c),d.set("eppeligiblecardflagg",o),d.set("acctnomaskk",m)}else{var s=d.get("creditCardActNo");d.set("creditCardActNo",s);var l=d.get("cccardacctno");d.set("frmacntval",l);var o=d.get("eppeligiblecardflag");d.set("eppeligiblecardflagg",o);var u=d.get("acctnomask");d.set("acctnomaskk",u)}var l=d.get("cccardacctno"),p=t("#acccardmaskno").val();d.set("acccardmaskno",p),"undefined"==typeof c&&(c=l),d.set("selectedAcct",c);var g=(d.get("accountNumber"),"00"),v="C";timestamp=(new Date).getTime();var S=getDeviceId(),h=c+""+S,f=CryptoJS.MD5(h);h=f+"",showSpinner(),e.collection.fetch({data:t.param({appchecksum:h,ccMaskedno:c,sortBy:"",accountNumber:c,monthcode:g,transactiontype:v,requestid:timestamp}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(d.get("calltimeout")),success:function(e){var i=d.get("errorcode");"0000"==ackStatus?(d.set("availableCreditCardLimit",carddet.availableCreditLimit),ministatement.length&&(miniStatements=ministatement),n(e),t("#minstmtshow").show()):null!=i&&"MTC-RT-0003"!=i?n(e):(a(e),t("#minstmtshow").show())},error:a})},listcompile:function(){hideSpinner(),this.$("#mobcontent").html(e.template(s)),t(".amtformatter").formatamount()},inputPage:function(e){if(0!==t(e.currentTarget).find("a.convertemi").length){var a=t(e.currentTarget).data("index");d.set("acctnomaskk",miniStatements[a].creditCardNoMasked),d.set("frmacntval",miniStatements[a].ccardnumberenc),d.set("selectedAcct",miniStatements[a].ccardnumberenc),d.set("ecurrencyCode",miniStatements[a].currencyCode),d.set("eamount",miniStatements[a].transactionAmount),d.set("emerchant",miniStatements[a].transactionDescription),d.set("transactionDate",miniStatements[a].transactionDate),d.set("valueDate",miniStatements[a].valueDate),d.set("txncode",miniStatements[a].txncode),d.set("authcode",miniStatements[a].authcode),d.set("recnbr",miniStatements[a].recnbr),d.set("plannbr",miniStatements[a].plannbr),d.set("transcode",miniStatements[a].transcode),d.set("transactionkey",miniStatements[a].transactionkey),d.set("txnidcode",miniStatements[a].txnidcode),d.set("recordtype",miniStatements[a].recordtype),d.set("mtsinbr",miniStatements[a].mtsinbr),d.set("mtmrchntstore",miniStatements[a].mtmrchntstore),d.set("mtmrchntorg",miniStatements[a].mtmrchntorg),d.set("mtplan",miniStatements[a].mtplan),d.set("cardseqnbr",miniStatements[a].cardseqnbr),d.set("transactionDescription",miniStatements[a].transactionDescription),d.set("mtlogicmod",miniStatements[a].mtlogicmod),d.set("cardseqnbr",miniStatements[a].cardseqnbr),d.set("mtplan",miniStatements[a].mtplan),d.set("mtdesc",miniStatements[a].mtdesc),d.set("transactionkey",miniStatements[a].transactionkey),d.set("refnbr",miniStatements[a].refnbr),d.set("epp_flag",miniStatements[a].eppflag),n.history.navigate("#/convertPaymentinstallCreditCardEMI")}},PDFDownload:function(t){var e="",n=d.get("app.context.path");e=n+"creditcard/ministatement/download.pdf";var a=d.get("appSessionId"),i=d.get("device_id"),c=d.get("lang_id"),r=d.get("cccardacctno"),s=getDeviceId(),o=r+""+s,m=CryptoJS.MD5(o);o=m+"";var l="device_id="+i+"&appchecksum="+o+"&lang_id="+c+"&accountNumber="+r+"&download=PDF&cardoract=CARD",u=encodeURI(l);fileDownLoadAndViewer(e,u,1,a)},XLSdownload:function(t){var e="",n=d.get("app.context.path");e=n+"creditcard/ministatement/download.xls";var a=d.get("appSessionId"),i=d.get("device_id"),c=d.get("lang_id"),r=d.get("cccardacctno"),s=getDeviceId(),o=r+""+s,m=CryptoJS.MD5(o);o=m+"";var l="device_id="+i+"&lang_id="+c+"&accountNumber="+r+"&download=XLS&cardoract=CARD",u=encodeURI(l);fileDownLoadAndViewer(e,u,2,a)},errorresponse:function(){hideSpinner(),n.history.navigate("#/exception")},disposeView:function(t){return n.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=t,this.currentView.delegateEvents(),this.currentView}});return m});