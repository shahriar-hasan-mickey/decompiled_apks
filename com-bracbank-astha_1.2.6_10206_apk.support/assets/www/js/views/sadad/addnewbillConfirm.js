define(["jquery","underscore","Backbone","collections/sadad/manageAddConfirmCollections","text!views/sadad/addnewbillConfirm.tpl","text!views/sadad/addbillOTPSuccess.tpl","text!views/sadad/addnewbillOTP.tpl"],function(e,t,i,n,a,o,s){var r=new EncryptedLocalStorage("secret"),l=i.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #submitConfirm":"addNewBills","click #back":"back"},initialize:function(){this.on("error",function(e,t){alert(t)})},update:function(){this.addbillOTP()},addbillOTP:function(){hideSpinner(),this.$("#mobcontent").html(t.template(a,{})).i18n()},submitConfirm:function(){i.history.navigate("#/addnewbillOtp")},back:function(){showSpinner(),this.subview=this.disposeView(new addbills),this.subview.render(),e.mobile.loading("hide"),this.undelegateEvents(),hideSpinner()},otpValidation:function(t){showSpinner(),this.model=new OTPValidationModel({url:"json/"}),this.$(".alert").hide(),i.Validation.bind(this);var n=this.$("form").serializeObject();if(this.model.set(n,{validate:!0})){this.model.clear(),i.Validation.unbind(this);var a=(e("#otp").val(),this),o=function(e){a.addNewBills()},s=function(e){a.errorresponse()};a.collection=new OTPValidateCollections([],{});var l=(new Date).getTime(),c="SMS",d="0",u=e("#otp").val(),p=r.get("custno");a.collection.fetch({data:e.param({opttype:c,refno:d,activationno:u,customerno:p,requestid:l}),dataType:"json",type:"POST",timeout:parseInt(r.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?o(e):s(e)},error:s})}else hideSpinner(),this.$(".alert-error").fadeIn(),t.preventDefault()},addNewBills:function(){i.history.navigate("#/addnewbillOtp")},addNewBills11:function(){var t=this;showSpinner();var i=function(e){t.OtpSuccess()},a=function(e){t.errorresponse()};t.collection=new n([],{}),timestamp=(new Date).getTime();var o=r.get("access_token"),s=r.get("language"),l=getDeviceId(),c=r.get("billercategoryID"),d=r.get("billerServiceId"),u=r.get("add_managebill_details"),p=u[5],h=u[4];t.collection.fetch({data:e.param({access_token:o,serviceproviderno:h,nickname:p,validType:"Posting",billercategoryid:c,operationFlag:"A",serviceid:d,device_id:l,lang_id:s,requestid:timestamp}),dataType:"json",type:"POST",timeout:parseInt(r.get("sadadcalltimeout")),cache:!1,success:function(e){"0000"==ackStatus?i(e):a(e)},error:a})},OtpSuccess:function(){return hideSpinner(),this.$("#mobcontent").html(t.template(o)).i18n(),this},errorresponse:function(){hideSpinner(),i.history.navigate("#/exception")},disposeView:function(e){return i.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return l});