define(["jquery","underscore","Backbone","collections/sadad/addBillsCollections","collections/sadad/billerSubCategoryCollections","collections/sadad/billerCategoryCollections","collections/sadad/sadadEnquireCollections","collections/sadad/billerInDetailsCollections","text!views/sadad/addbills.tpl","models/validation/sadad/postpaidValidationModel","models/validation/sadad/prepaidValidationModel"],function(e,t,r,i,a,l,o,s,n,d,c){var u=new EncryptedLocalStorage("secret"),p=r.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"change #serviceType":"biller","click #confirm":"onConfirm","change #idSubsNo":"idSubsNo","click #billercomp":"changeBillerComp"},initialize:function(){},update:function(){u.set("currentPage","");var t=this;showSpinner();var r=function(e){t.OTPayment()},i=function(e){t.errorresponse()};t.collection=new l([],{});var a=(new Date).getTime(),o="01",s="",n="SADAD",d=u.get("custno");t.collection.fetch({data:e.param({serviceid:o,inqflag:"",language:s,paramcode:n,userid:d,requestid:a}),dataType:"json",timeout:parseInt(u.get("calltimeout")),type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):i(e)},error:i})},OTPayment:function(){hideSpinner(),this.$("#mobcontent").html(t.template(n)).i18n()},idSubsNo:function(){u.get("billerserviceType");u.set("billerMobLenMax",billerMobLenMax),u.set("billerIdLenMax",billerIdLenMax),u.set("billerSubLenMax",billerSubLenMax);var t=(u.get("billerMobLenMax"),u.get("billerSubLenMin")),r=document.getElementById("idSubsNo"),i=e("#idSubsNo").val();r=r.value.length;var a=t-r;if(t>r){for(var l=0;a>l;l++)i="0"+i;e("#idSubsNo").val(""),u.set("idSubsNoval",i),""!=r&&void 0!=r&&e("#idSubsNo").val(i)}},biller:function(){e("#billercompany").hide(),e("#idSubsNoDiv").hide(),e("#idNickNameDiv").hide(),e("#buttonDiv").hide(),e("#Error_IdSubsNo").hide(),e("#Error_IdNicName").hide(),e("#Error_Common").hide(),e("#Error_IdPattern").hide();var r=this,i=(e("#hiddenservice").val(),function(e){r.errorresponse()});r.collection=new a([],{});var l=e("#hiddenservice").val(),o=(new Date).getTime(),s=(u.get("custno"),"");r.collection.fetch({data:e.param({paramcode:l,language:s,requestid:o}),data:e.param({inqflag:"BILLER",paramcode:l,language:s,requestid:o}),dataType:"json",type:"POST",timeout:parseInt(u.get("calltimeout")),cache:!1,success:function(r){if("0000"==ackStatus){if(e("#billercompany").removeAttr("style"),e(".selectHolder").empty(),e("#billercompany").empty(),e("#dynamicbillercompany").html('<div class="dropselectbiller" data-title="'+e.i18n.t("app.sadad.onetimepay.billercompany")+'" id="billercompany" style="display:none;"></div>'),0!=t.size(billercategory)){var a=0,l="";t.each(billercategory,function(e,t){l+='<label class="list-group-item" id="billerComp">',l+='<input type="radio" id="billercomp" name="billercomp" value="'+e.strBillerServiceCode+"~"+e.strBillerServiceDesc+"~"+t+'" />',l+='<span id="billerdesc" class="nme" id="nme'+t+'" >'+e.strBillerServiceDesc+"</span> </label>",a++}),e("#billercompany").html(l),e("#billercompany").show(),e(".dropselectbiller").dropselectbiller()}hideSpinner()}else i(r)},error:i})},changeBillerComp:function(){var t=e("input[name=billercomp]:checked").val(),r=t.split("~"),i=r[1],a=r[2];e("#nme"+a).text(i),this.showBillerinDetails()},showBillerinDetails:function(){e("#idSubsNoDiv").hide(),e("#idNickNameDiv").hide(),e("#buttonDiv").hide(),e("#Error_IdSubsNo").hide(),e("#Error_IdNicName").hide(),e("#Error_Common").hide(),e("#Error_IdPattern").hide(),showSpinner();var t=this,r=(e("#hiddenservice").val(),function(e){t.errorresponse()});t.collection=new s([],{});var i=(e("#hiddenservice").val(),(new Date).getTime()),a=(u.get("custno"),""),l=e("input[name=billercomp]:checked").val(),o=l.split("~"),n=o[0];t.collection.fetch({data:e.param({paramcode:n,language:a,requestid:i}),dataType:"json",timeout:parseInt(u.get("calltimeout")),type:"POST",cache:!1,success:function(t){if("0000"==ackStatus){e("#idSubsNo").val("");var i=u.get("billerDetails_cache"),a=(i[0].strBillerType,i[0].strBillerSubNoLable);if("undefind"==typeof a||""==a)e("#Error_Common").show();else{e("#BillerSubLenMin").val(i[0].strBillerSubLenMin),e("#BillerSubLenMax").val(i[0].strBillerSubLenMax),i[0].strPrepaid_start_with?e("#strPrepaidStartWith").val(i[0].strPrepaid_start_with):e("#strPrepaidStartWith").val(""),i[0].strPostpaid_start_with?e("#strPostpaidStartWith").val(i[0].strPostpaid_start_with):e("#strPostpaidStartWith").val(""),i[0].strPostpaid_start_des_en?e("#strPostpaidStartDesEn").val(i[0].strPostpaid_start_des_en):e("#strPostpaidStartDesEn").val(""),i[0].strPrepaid_start_des_en?e("#strPrepaidStartDesEn").val(i[0].strPrepaid_start_des_en):e("#strPrepaidStartDesEn").val(""),i[0].strPostpaid_start_des_ar?e("#strPostpaidStartDesAr").val(i[0].strPostpaid_start_des_ar):e("#strPostpaidStartDesAr").val(""),i[0].strPrepaid_start_des_ar?e("#strPrepaidStartDesAr").val(i[0].strPrepaid_start_des_ar):e("#strPrepaidStartDesAr").val(""),e("#idSubsNoDiv").show(),e("#idSubsNo").attr("placeholder",i[0].strBillerSubNoLable),e("#idSubsNo").attr("maxlength",parseInt(i[0].strBillerSubLenMax));var l=u.get("device.platform");"Android"==l||e(".lenthcontrol").inputlength(),e("#idNickNameDiv").show(),e("#buttonDiv").show()}hideSpinner()}else r(t)},error:r})},onConfirm:function(t){e("#Error_IdSubsNo").hide(),e("#Error_IdNicName").hide(),e("#Error_Common").hide(),e("#Error_IdPattern").hide();var r,i,i,a;i=e("#BillerSubLenMin").val(),BillerSubLenMax=e("#BillerSubLenMax").val();var l=e("#strPostpaidStartWith").val(),o=e("#strPostpaidStartDesEn").val(),s=e("#strPostpaidStartDesAr").val();r=e("#idSubsNo").val();var n=u.get("language_id"),d="false";if("en-US"==n)if("undefined"==typeof r||""==r)"0"==i?(e("#Error_IdSubsNo").text(e.i18n.t("validation.sadad.otpfieldlengthmust")+" "+BillerSubLenMax),e("#Error_IdSubsNo").show(),d="true"):(e("#Error_IdSubsNo").text(e.i18n.t("validation.sadad.otpfieldlengthbetween")+" "+i+"-"+BillerSubLenMax),e("#Error_IdSubsNo").show(),d="true");else{var c=r.length,p=parseInt(i),b=parseInt(BillerSubLenMax),h=l.replace(new RegExp(",","g"),"|"),v=(l.replace(new RegExp(",","g")," or "),"/^("+h+")"),S=new RegExp(v.replace(new RegExp("/","g"),""));S.test(r)?0==p?c!=b&&(e("#Error_IdSubsNo").text(e.i18n.t("validation.sadad.otpfieldlengthmust")+" "+BillerSubLenMax),e("#Error_IdSubsNo").show(),d="true"):c>=p&&b>=c||(e("#Error_IdSubsNo").text(e.i18n.t("validation.sadad.otpfieldlengthbetween")+" "+i+"-"+BillerSubLenMax),e("#Error_IdSubsNo").show(),d="true"):(e("#Error_IdPattern").text(o),e("#idSubsNo").focus(),e("#Error_IdPattern").show(),d="true")}else if("undefined"==typeof r||""==r)"0"==i?(e("#Error_IdSubsNo").text(BillerSubLenMax+" "+e.i18n.t("validation.sadad.otpfieldlengthmust")),e("#Error_IdSubsNo").show(),d="true"):(e("#Error_IdSubsNo").text(BillerSubLenMax+"-"+i+" "+e.i18n.t("validation.sadad.otpfieldlengthbetween")),e("#Error_IdSubsNo").show(),d="true");else{var c=r.length,p=parseInt(i),b=parseInt(BillerSubLenMax),h=l.replace(new RegExp(",","g"),"|"),v=(l.replace(new RegExp(",","g")," or "),"/^("+h+")"),S=new RegExp(v.replace(new RegExp("/","g"),""));S.test(r)?0==p?c!=b&&(e("#Error_IdSubsNo").text(BillerSubLenMax+" "+e.i18n.t("validation.sadad.otpfieldlengthmust")),e("#Error_IdSubsNo").show(),d="true"):c>=p&&b>=c||(e("#Error_IdSubsNo").text(BillerSubLenMax+"-"+i+" "+e.i18n.t("validation.sadad.otpfieldlengthbetween")),e("#Error_IdSubsNo").show(),d="true"):(e("#Error_IdPattern").text(s),e("#idSubsNo").focus(),e("#Error_IdPattern").show(),d="true")}return a=e("#idNicName").val(),("undefined"==typeof a||""==a)&&(e("#Error_IdNicName").show(),d="true"),"true"==d?!1:void this.showOTP()},showOTP:function(){var t=e("input[name=billercomp]:checked").val(),i=t.split("~"),a=i[1],l=e("#serviceType option:selected").val(),o=e("#billerComp option:selected").val(),s=e("#serviceType option:selected").text(),n=e("#idSubsNo").val(),d=e("#idNicName").val(),c=u.get("billerDetails_cache"),p=new Array;p[0]=l,p[1]=s,p[2]=o,p[3]=a,p[4]=n,p[5]=d,p[6]=c[0].strBillerServiceCode,p[7]=c[0].strBillerServiceDesc,u.set("add_managebill_details",p),r.history.navigate("#/addbillConfirm")},errorresponse:function(){hideSpinner(),r.history.navigate("#/exception")},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return p});