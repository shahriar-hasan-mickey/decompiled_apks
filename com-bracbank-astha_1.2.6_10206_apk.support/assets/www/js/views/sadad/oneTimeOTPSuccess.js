define(["jquery","underscore","Backbone","collections/sadad/duebillPaySuccessCollections","collections/common/emailAdviceCollections","text!views/sadad/oneTimeOTPSuccess.tpl","text!views/common/emailAdviceSuccessPage.tpl","libs/security/crypto-js/md5"],function(e,t,i,n,c,a,r,o){var s=new EncryptedLocalStorage("secret"),d=i.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #pay":"pay","click #back":"back","click #emailAdvice":"EmailAdvice"},initialize:function(){},update:function(t,i,c,a,r,o,d,l){showSpinner();var u=this,p=function(e){u.onetimepaysuccess()},m=function(e){u.errorresponse()};u.collection=new n([],{}),timestamp=(new Date).getTime();var y,g,v,f=s.get("opt_bill_details"),h=s.get("custno"),A="KWD",w=f[13];"ACCT"==w?(w="ACCOUNT",paymethod="ACTDEB",y=f[0],g="",v=""):(w="CREDITCARD",paymethod="CCARD",y="",g=f[11],v=f[12]);var S="",b="",T=new Array;T[0]=f[10];var C=JSON.stringify(T),P=C.replace(/"/g,""),E=new Array;E[0]=f[6];var R=JSON.stringify(E),D=R.replace(/"/g,""),N=new Array;N[0]=f[1];var O=JSON.stringify(N),k=O.replace(/"/g,""),I=s.get("billerId");if("017"!=I){var V=new Array;V[0]=f[2];var q,x=JSON.stringify(V),J=s.get("demon"),j=s.get("demonnamount"),B=s.get("servicetype");if("PREPAID"==B)q=null!=J&&""!=J&&void 0!=J?j:x.replace(/"/g,"");else{var x=s.get("idPayAmountPost");q=x}}else var x=s.get("idPayAmountPost"),q="["+x+"]";var F=s.get("otpModule");s.set("otpModule","");var M=s.get("srvtype"),U="0.00",_=s.get("iqamaID"),z=s.get("selectedIdProof"),G=s.get("pmttype");"RCHG"==G&&"[001]"==D&&(D="[149]"),("undefined"==y||void 0==y)&&(y=""),("undefined"==g||void 0==g)&&(g=""),("undefined"==v||void 0==v)&&(v="");var H=getDeviceId(),K=w+""+y+g+v+paymethod+P+D+k+q+U+H,L=CryptoJS.MD5(K);K=L+"";var W=s.get("BillerName"),Y=s.get("BillerType");u.collection.fetch({data:e.param({appchecksum:K,custno:h,billername:W,billertype:Y,fromcurrname:A,paymentmode:w,processdate:S,paymethod:paymethod,hidduedate:P,hidbillercode:D,hidbillername:k,hidpayamount:q,hidservicetype:M,currentdate:b,transfee:U,custaccountno:y,creditcardnumber:g,creditcardacctnumber:v,requestid:timestamp,owneridno:_,hididtypecode:z,billingaccno:k,pmttype:G,isOtpUsed:s.get("isOtpUsed"),paymode:"ONETIMEPAY",opttype:F}),dataType:"json",type:"POST",timeout:parseInt(s.get("sadadcalltimeout")),cache:!1,success:function(e){"0000"==ackStatus?p(e):m(e)},error:m})},onetimepaysuccess:function(){hideSpinner(),this.$("#mobcontent").html(t.template(a,{})).i18n()},EmailAdvice:function(){s.set("currentPage",""),showSpinner();var t=this,i=function(e){t.emailadvicecompile()},n=function(e){t.errorresponse()};t.collection=new c([],{});var a,r=(new Date).getTime(),o=e("#txnrefno").val(),d=e("#fromacct").val(),l="TRANSFER";a="Account"==l?"ACCOUNT":"TRANSFER"==l?"TRANSFER":"CARD";var u=s.get("emailid"),p=(s.get("loginid"),s.get("custno"));s.get("lang_id");t.collection.fetch({data:e.param({ftrefno:o,transfertype:a,accountNumber:d,custmailid:u,custuserid:p,requestid:r}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(s.get("calltimeout")),success:function(e){"0000"==ackStatus?i(e):n(e)},error:n})},emailadvicecompile:function(){s.set("backReqFromEmail","6"),hideSpinner(),i.history.navigate("#/emailAdviceSuccessPage")},errorresponse:function(){hideSpinner(),i.history.navigate("#/exception")},disposeView:function(e){return i.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return d});