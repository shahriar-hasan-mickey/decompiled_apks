define(["jquery","underscore","Backbone","collections/sadad/addBillsCollections","collections/sadad/billerSubCategoryCollections","collections/sadad/billerCategoryCollections","collections/sadad/sadadEnquireCollections","collections/sadad/billerInDetailsCollections","text!views/sadad/addnewbill.tpl","models/validation/sadad/postpaidValidationModel","models/validation/sadad/prepaidValidationModel","collections/sadad/manageAddConfirmCollections"],function(e,i,r,t,o,a,l,n,s,c,d,v){var p=new EncryptedLocalStorage("secret"),u=r.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #confirm":"onConfirm","change #idSubsNo":"idSubsNo","click #billercomp":"changeBillerComp","change #serviceType":"changeBillerCategory"},initialize:function(){},update:function(){p.set("currentPage","");var i=this;showSpinner();var r=function(e){i.OTPayment()},t=function(e){i.errorresponse()};i.collection=new a([],{});(new Date).getTime();i.collection.fetch({data:e.param({access_token:p.get("access_token")}),dataType:"json",timeout:parseInt(p.get("calltimeout")),type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):t(e)},error:t})},openNumPad:function(){var i=/iPad|iPhone|iPod/.test(navigator.userAgent),r=p.get("isKeyPadNeed");i&&r&&navigator.notification.keypadOpen(e("#"+id).val(),9,function(i){e("#"+id).val(convertNumbers2English(i))},function(i){e("#"+id).val(convertNumbers2English(i))})},OTPayment:function(){hideSpinner(),this.$("#mobcontent").html(i.template(s)).i18n()},changeBillerCategory:function(){e("#dynamicbillercompany").hide(),e("#serviceProviderType").val(""),e("#idSubsNo").val(""),e("#idNicName").val(""),e("#servicetypediv").hide();var r=e("#serviceType option:selected").val(),t=r.split("~"),o=t[0];p.set("billercategoryID",o);var a=t[1];p.set("billercode",a);var l=t[2],n=p.get("billerCategories");if(""!=l&&null!=l&&void 0!=l&&"undefined"!=l){e("#dynamicbillercompany").show();var s=n[l].billerServices;e("#billercomp").val();if(e("#billercompany").removeAttr("style"),e(".selectHolder").empty(),e("#billercompany").empty(),e("#dynamicbillercompany").html('<div class="dropselectbiller" data-title="'+e.i18n.t("app.sadad.onetimepay.billercompany")+'" id="billercompany" style="display:none;"></div>'),0!=i.size(s)){var c=0,d="";i.each(s,function(e,i){d+='<label class="list-group-item" id="billerComp">',d+='<input type="radio" id="billercomp" name="billercomp" value="'+e.code+"~"+e.serviceName+"~"+e.serviceId+"~"+e.serviceType+"~"+i+'" />',d+='<span id="billerdesc" class="nme" id="nme'+i+'" >'+e.serviceName+"</span> </label>",c++}),e("#billercompany").html(d),e("#billercompany").show(),e(".dropselectbiller").dropselectbiller();e("#billercomp").val()}}else e("#dynamicbillercompany").hide(),e("#billercompany").hide(),e("#billercompany").empty(),e("#serviceProviderType").val("")},idSubsNo:function(){var i=p.get("billerserviceType");p.set("billerMobLenMax",billerMobLenMax),p.set("billerIdLenMax",billerIdLenMax),p.set("billerSubLenMax",billerSubLenMax);var r=p.get("billerMobLenMax"),t=p.get("billerSubLenMin"),o=document.getElementById("idSubsNo"),a=e("#idSubsNo").val();if("PREPAID"==i){o=o.value.length;var l=r-o;if(r>o&&(a="0"+a,e("#idSubsNo").val(a)),r>o){for(var n=0;l>n;n++)a="0"+a;e("#idSubsNo").val(a),p.set("idSubsNoval",a)}}else{o=o.value.length;var l=t-o;if(t>o){for(var n=0;l>n;n++)a="0"+a;e("#idSubsNo").val(""),p.set("idSubsNoval",a),""!=o&&void 0!=o&&e("#idSubsNo").val(a)}}},changeBillerComp:function(){e("#servicetypediv").hide();var i=e("input[name=billercomp]:checked").val(),r=i.split("~"),t=r[1],o=r[2],a=r[3];p.set("servicetype",a),e("#nme"+o).text(t),this.showBillerinDetails();var l=[];e("#serviceProviderType option").each(function(){e.inArray(this.value,l)>-1?e(this).remove():l.push(this.value)})},showBillerinDetails:function(){e("#idSubsNoDiv").hide(),e("#idNickNameDiv").hide(),e("#serviceProviderTypeDiv").hide(),e("#buttonDiv").hide(),e("#servicetypediv").hide(),e("#Error_IdSubsNo").hide(),e("#Error_IdNicName").hide(),e("#Error_Common").hide(),e("#Error_IdPattern").hide();var r=e("#serviceType option:selected").val(),t=r.split("~"),o=t[0];p.set("billercategoryID",o);var a=t[1],l=t[2],n=p.get("billerCategories");if(""!=l&&null!=l&&void 0!=l){var s=n[l].billerServices;if(p.set("billerservices",s),e("#idSubsNoDiv").show(),e("#idNickNameDiv").show(),e("#buttonDiv").show(),"TELECOM"==a){if(e("#servicetypediv").show(),e("#serviceProviderType").empty(),0!=i.size(s)){var c=0;i.each(s,function(i){var r=p.get("servicetype");i.serviceType==r&&e("#serviceProviderType").append('<option selected id="serviceTypeVal'+c+'"value="'+i.serviceType+'">'+i.serviceType+"</option>"),c++}),e("#servicetypediv").show()}e("#serviceProviderType").show()}else e("#servicetypediv").hide(),e("#serviceProviderType").empty(),e("#idSubsNoDiv").show(),e("#idNickNameDiv").show(),e("#buttonDiv").show()}else e("#servicetypediv").hide(),e("#idSubsNoDiv").show(),e("#idNickNameDiv").show(),e("#buttonDiv").show()},onConfirm:function(i){e("#Error_IdSubsNo").hide(),e("#Error_IdNicName").hide(),e("#Error_Common").hide(),e("#Error_IdPattern").hide(),e("#Error_BillerCat").hide(),e("#Error_ServiceType").hide(),e("#Error_BillCompany").hide(),e("#secErrorlastnickname").hide(),e("#secErrorfirstnickname").hide();var r,t,t,o,a,l;t=e("#BillerSubLenMin").val(),BillerSubLenMax=e("#BillerSubLenMax").val();e("#strPostpaidStartWith").val(),e("#strPostpaidStartDesEn").val(),e("#strPostpaidStartDesAr").val();r=e("#idSubsNo").val();var n=(p.get("language_id"),"false");if(("undefined"==typeof r||""==r)&&(e("#Error_IdSubsNo").show(),n="true"),o=e("#idNicName").val(),"undefined"==typeof o||""==o)return e("#Error_IdNicName").show(),e("#secErrorlastnickname").hide(),e("#secErrorfirstnickname").hide(),n="true",!1;var s=o.charAt(0),c=o.charAt(o.length-1);if("undefined"!=typeof o&&""!=o){if(!s.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return e("#showErrorfirstnickname").text(e.i18n.t("app.login.firstspaceind")),e("#secErrorfirstnickname").show(),e("#secErrorlastnickname").hide(),e("#Error_IdNicName").hide(),!1;if(!c.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return e("#showErrorlastnickname").text(e.i18n.t("app.login.lastspaceind")),e("#secErrorlastnickname").show(),e("#secErrorfirstnickname").hide(),e("#Error_IdNicName").hide(),!1}return a=e("#serviceType").val(),("undefined"==typeof a||"-1"===a||""==a)&&(e("#Error_BillerCat").show(),n="true"),l=e("#serviceProviderType").val(),("undefined"==typeof l||"-1"===l||""==l)&&(e("#Error_ServiceType").show(),n="true"),"true"==n?!1:void this.showOTP()},showOTP:function(){e("#Error_BillCompany").hide();var i=e("input[name=billercomp]:checked").val();("undefined"==typeof i||""==i)&&(e("#Error_BillCompany").show(),is_error="true");var r=i.split("~"),t=r[2];p.set("billerServiceId",t);var o=i.split("~"),a=o[1],l=e("#serviceType option:selected").val(),n=e("#billerComp option:selected").val(),s=e("#serviceType option:selected").text(),c=e("#idSubsNo").val(),d=e("#idNicName").val(),u=e("#serviceProviderType option:selected").text(),h=(p.get("billerDetails_cache"),new Array);h[0]=l,h[1]=s,h[2]=n,h[3]=a,h[4]=c,h[5]=d,h[8]=u,p.set("add_managebill_details",h);var m=this;showSpinner();var b=function(e){m.validate()},y=function(e){m.errorresponse()};m.collection=new v([],{}),timestamp=(new Date).getTime();var f=p.get("access_token"),g=p.get("language"),N=getDeviceId(),w=p.get("billercategoryID");p.get("benstatus");m.collection.fetch({data:e.param({access_token:f,serviceproviderno:c,nickname:d,validType:"Validation",billercategoryid:w,operationFlag:"A",serviceid:t,device_id:N,lang_id:g,requestid:timestamp}),dataType:"json",type:"POST",timeout:parseInt(p.get("sadadcalltimeout")),cache:!1,success:function(e){"0000"==ackStatus?b(e):y(e)},error:y})},validate:function(){hideSpinner(),r.history.navigate("#/addnewbillconfirm")},errorresponse:function(){hideSpinner(),r.history.navigate("#/exception")},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return u});