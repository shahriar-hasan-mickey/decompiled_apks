define(["jquery","underscore","Backbone","collections/sadad/duebillPayInquiryCollections","collections/sadad/historyBillPayInquiryCollections","text!views/sadad/duebillpay.tpl","routers/sadadrouter","models/validation/sadad/sadadValidationModel","text!views/common/queuemode.tpl"],function(e,t,i,a,n,r,l,o,s){var c=new EncryptedLocalStorage("secret"),u=i.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #pay":"pay","click #history":"history","keyup #billamountent":"resett","click #numkeyPad input":"openNumPad"},openNumPad:function(t){id=t.target.id;var i=/iPad|iPhone|iPod/.test(navigator.userAgent),a=c.get("isKeyPadNeed");if(i&&a){var n=e("#"+id).val();navigator.notification.keypadOpen(n,9,function(t){e("#"+id).val(t)},function(e){})}},initialize:function(){new l},resett:function(){},render:function(){c.set("currentPage",""),c.set("billpayhistype","");var e=c.get("queueMode");if("P"==e){var i=this;showSpinner();var n=function(e){i.billpay()},r=function(e){i.errorresponse()};i.collection=new a,i.collection.fetch({dataType:"json",type:"POST",timeout:parseInt(c.get("sadadcalltimeout")),cache:!1,success:function(e){if("0000"==ackStatus){var t=biller;c.set("billerListDTO",t);var i=billerRangeDTO;c.set("billerRangeDTO",i),n(e)}else r(e)},error:r})}else c.set("queueModeModule","duebillpay"),this.$("#mobcontent").html(t.template(s)).i18n()},billpay:function(){hideSpinner(),this.$("#mobcontent").html(t.template(r)).i18n()},history:function(){var t=this;showSpinner();var i=function(e){t.historyBillpay()},a=function(e){t.errorresponse()};t.collection=new n;var r=e("#histbillerid").val(),l=e("#histscrbeno").val();t.collection.fetch({data:e.param({billerid:r,biller:l}),dataType:"json",type:"POST",timeout:parseInt(c.get("sadadcalltimeout")),cache:!1,success:function(e){"0000"==ackStatus?i(e):a(e)},error:a})},historyBillpay:function(){hideSpinner();var t=e("#billernickname").text(),a=e("#billernickname").text();i.history.navigate("#/duebillpayhistory/"+t+"/"+a)},pay:function(){var t=e("#hidamtdue").val();c.set("totamtdue",t);var a=c.get("billerRangeDTO"),n=c.get("billerListDTO");n.forEach(function(t,i){e("#validminmsg"+i).hide(),e("#validmaxmsg"+i).hide()});var r=e("input[name=checkbillpay]").is(":checked");if(0==r)return e("#chkboxid").show(),!1;var l=[];e(":checkbox:checked").each(function(t){l[t]=e(this).val()});for(var o="false",s=!1,u={},d=0,p=0;p<l.length;p++){var h=l[p],v=h.split("~"),f=new Array,y=0;e.each(v,function(e,t){f[y]=t,y++}),""==f[3]&&(f[3]="-"),"undefined"==typeof f[3]&&(f[3]="-"),null==f[3]&&(f[3]="-"),c.set("BillerName",f[4]),c.set("BillerType",f[9]);c.get("dbFlag");if("NO"==f[6]){var m=a[f[0]],b="",g="",w="";m&&m.billerid==f[10]&&(b=m.lower,g=m.upper,w=m.dbFlag);var k=e("#billamountent"+f[0]).val();if(-1!=k.indexOf(".")||(k+=".00"),parseFloat(k)<=0){o="true";break}parseFloat(b)>0&&parseFloat(k)<parseFloat(b)&&(parseFloat(f[8])<b&&parseFloat(f[8])>0||(e("#validminmsg"+f[0]).show(),s=!0)),parseFloat(g)>0&&parseFloat(k)>parseFloat(g)&&(e("#validmaxmsg"+f[0]).show(),s=!0),f[8]=k,d=parseFloat(d)+parseFloat(k)}else{if(parseFloat(f[8])<=0){o="true";break}d=parseFloat(d)+parseFloat(f[8])}d+="",-1!=d.indexOf(".")||(d+=".00"),c.set("hidTotalAmt",d),u[p+""]=f}if("true"==o)return e("#amountvalidation").show(),!1;if(1==s)return!1;c.set("BillerLists",u);var F=c.get("hidTotalAmt");i.history.navigate("#/duebillpayinquiry1/"+F)},errorresponse:function(){hideSpinner(),i.history.navigate("#/exception")},disposeView:function(e){return i.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return u});