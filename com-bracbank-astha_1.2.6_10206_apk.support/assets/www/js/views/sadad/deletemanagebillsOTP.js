define(["jquery","underscore","Backbone","backbonevalidation","collections/common/otpGenerateCollections","collections/common/otpValidateCollections","views/sadad/billpayInquiryverify","text!views/sadad/deletemanagebillsOTP.tpl","models/validation/OTPValidationModel","models/validation/softOTPValidationModel","text!views/sadad/deletemanagebillconfirm.tpl","collections/common/secureaccessvalidateCollections","text!views/sadad/billpaySEQ.tpl","collections/sadad/manageDeleteConfirmCollections"],function(e,t,o,i,s,n,a,r,c,l,d,u,p,m){var h=new EncryptedLocalStorage("secret"),v=0,f=o.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #payotp":"pay","click .smsotp":"OTPOption1","click .softToken":"OTPOption2","click #submit":"submitOTP","click #validatesubmit":"secureaccessvalidate","click #resendclick":"OTPOption"},initialize:function(){},update:function(){this.OTPOption();var e=h.get("questionBasketDetailDTO"),o=new Array,i=new Array;t.each(e,function(e,t){o[t]=e.id,i[t]=e.description}),h.set("Sec_Ques_Id",o),h.set("Sec_Ques_Des",i)},secureGate:function(){hideSpinner();var e=h.get("Sec_Ques_Id"),o=h.get("Sec_Ques_Des"),i=null==h.get("Sec_Quest_No")?"":h.get("Sec_Quest_No"),s="";if(s=Math.floor(5*Math.random())+1,5==i.length&&h.set("Sec_Quest_No",""),""==i||null==i||void 0==i)s+="";else{var n=!0;do s+="",-1!=i.indexOf(s)&&(s=Math.floor(5*Math.random())+1,n=!1);while(n)}var a=parseInt(s)-1,r=e[a],c=o[a];this.$("#mobcontent").html(t.template(p,{seq_id:r,seq_question:c})).i18n()},secureaccessvalidate:function(){hideSpinner();var t=e("#secques").val();if(""==t||void 0==t)return e("#showError").text(e.i18n.t("validation.forgotpassword.answernotnull")),e("#secError").show(),e("#errorimage").hide(),e("#secErrorlast").hide(),e("#secErrorfirst").hide(),!1;var o=t.charAt(0),i=t.charAt(t.length-1);if(!o.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return e("#showErrorfirst").text(e.i18n.t("app.login.firstspaceind")),e("#secErrorfirst").show(),e("#secErrorlast").hide(),!1;if(!i.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return e("#showErrorlast").text(e.i18n.t("app.login.lastspaceind")),e("#secErrorlast").show(),e("#secErrorfirst").hide(),!1;var s=e("#secquesid").val(),n=e("#secques").val(),a=this;getDeviceId();showSpinner();var r=function(e){a.SuccessPage()},c=function(e){a.errorresponse()};a.collection=new u;var l=(new Date).getTime(),d=EncryptWithDynamicSalt(n,l),p=h.get("ulpID")+s+n;p=null==p?"":p,checkSumEncrypt(p);var m=localStorage.getItem("FINALCHECKSUM");getDeviceId();a.collection.fetch({data:e.param({access_token:h.get("access_token"),qstnId:s,answer:d,appchecksum:m,salt:l}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):c(e)},error:c})},deletemanagebillsOTPTemplate:function(){return hideSpinner(),this.$("#mobcontent").html(t.template(r)).i18n(),this},OTPOption1:function(t){e(".smsotp_block").show(),e("#hidotp").val("otp"),e(".softTock").hide(),e(".smsotp").addClass("active"),e(".softToken").removeClass("active"),document.getElementById("softTockId").style.display="none",document.getElementById("smsDivId").style.display="inline",this.OTPOption(),t.preventDefault()},OTPOption2:function(){e(".smsotp_block").hide(),e("#hidotp").val("softotp"),e(".softTock").show(),e(".softToken").addClass("active"),e(".smsotp").removeClass("active"),e("#hiddotpvalue").val("Y"),document.getElementById("softTockId").style.display="inline"},OTPOption:function(){e("#secError").hide(),e("#submit").removeAttr("disabled"),e("#hidotp").val("otp"),e("#otp").val(""),e("#showError").text("");var t=this,o=function(e){t.errorresponse()},i=function(e){t.deletemanagebillsOTPTemplate()};t.collection=new s([],{}),timestamp=(new Date).getTime(),showSpinner(),t.collection.fetch({data:e.param({access_token:h.get("access_token"),moduletype:"BILLER"}),dataType:"json",type:"POST",timeout:parseInt(h.get("calltimeout")),cache:!1,success:function(s){"0000"==ackStatus?(e("#submit").removeAttr("disabled"),"SMS"==status?i(s):"SQ"==status?t.secureGate():t.SuccessPage()):(e("#submit").removeAttr("disabled"),o(s))},error:o})},submitOTP:function(e){this.ownsubmitotp()},ownsubmitotp:function(){e("#secError").hide(),e("#showError").text(""),this.model=new c({url:"json/"}),o.Validation.bind(this);var t=this.$("form").serializeObject();if(this.model.set(t,{validate:!0})){showSpinner(),this.model.clear(),o.Validation.unbind(this);var i=this,s=function(e){i.SuccessPage()},a=function(e){i.errorresponse()};i.collection=new n([],{});var r=((new Date).getTime(),e("#otp").val()),l=(new Date).getTime();r=EncryptWithDynamicSalt(r,l),i.collection.fetch({data:e.param({access_token:h.get("access_token"),transactionData1:"SMS",salt:l,activationno:r}),dataType:"json",type:"POST",timeout:parseInt(h.get("calltimeout")),cache:!1,success:function(t){h.get("errorcod");if("0000"==ackStatus)s(t),startTimer("submit",!1);else{hideSpinner(),v++;var i=h.get("errordesc");e("#showError").text(i),e("#secError").show(),v>2&&(v=0,o.history.navigate("#/wrongOTPExceptionpost/sadad"),startTimer("submit",!1))}},error:a})}else this.$(".alert-error").fadeIn()},ownsoftotp:function(){this.model=new l({url:"json/"}),o.Validation.bind(this);var t=this.$("form").serializeObject();if(this.model.set(t,{validate:!0})){showSpinner(),this.model.clear(),o.Validation.unbind(this);var i=this,s=function(e){i.SuccessPage()},a=function(e){i.errorresponse()};i.collection=new n([],{});var r=(new Date).getTime(),c="SOFTOTP";h.set("otpModule",c);var d=e("#softotp").val(),u=h.get("custno");i.collection.fetch({data:e.param({opttype:c,refno:h.get("token_serno"),activationno:d,customerno:u,requestid:r}),dataType:"json",type:"POST",timeout:parseInt(h.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?s(e):a(e)},error:a})}else this.$(".alert-error").fadeIn()},SuccessPage:function(){var t=this,o=function(e){t.billdeletesuccess()},i=function(e){t.errorresponse()};t.collection=new m([],{});var s=(new Date).getTime(),n=h.get("access_token"),a=h.get("language"),r=h.get("scrbeno"),c=h.get("serviceId"),l=h.get("shortName"),d=h.get("categoryId"),u=h.get("benstatus");showSpinner();var p=u+h.get("appdynamicToken");p=CryptoJS.SHA512(p)+"",t.collection.fetch({data:e.param({appDynamicValue:p,access_token:n,serviceproviderno:r,nickname:l,validType:"Posting",billercategoryid:d,billerUniqueId:u,operationFlag:"D",serviceid:c,requestid:s,lang_id:a}),dataType:"json",type:"POST",timeout:parseInt(h.get("sadadcalltimeout")),cache:!1,success:function(e){"0000"==ackStatus?o(e):i(e)},error:i})},billdeletesuccess:function(){return hideSpinner(),this.$("#mobcontent").html(t.template(d)).i18n(),this},errorresponse:function(){hideSpinner(),o.history.navigate("#/exception")},disposeView:function(e){return o.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return f});