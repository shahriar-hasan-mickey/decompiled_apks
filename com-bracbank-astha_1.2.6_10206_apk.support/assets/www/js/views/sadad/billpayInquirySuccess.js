define(["jquery","underscore","Backbone","collections/sadad/oneTimePayValidationCollections","collections/common/emailAdviceCollections","text!views/sadad/billpayInquirySuccess.tpl","text!views/common/emailAdviceSuccessPage.tpl","libs/security/crypto-js/md5"],function(e,t,n,i,r,a,c,o){var l=new EncryptedLocalStorage("secret"),s=n.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #pay":"pay","click #emailadvice":"EmailAdvice"},initialize:function(){},update:function(){showSpinner();var n=this,r=function(e){n.successPage()},a=function(e){n.errorresponse()};n.collection=new i([],{}),timestamp=(new Date).getTime();var c,o=new Array,s=new Array,u=new Array,d=new Array,g=new Array,m=new Array,p=new Array,v=l.get("modepay");c="A"==v?"ACCOUNT":"CREDITCARD";var y=new Array;new Array;y=l.get("BillerLists");var f=t.size(y);l.set("billersizechck",f);var h=0;t.each(y,function(e){l.set("ConfirmBillers",e),null!=y[h]&&(o[h]=e[4],s[h]=e[9],u[h]=e[8],d[h]=e[5],g[h]=e[11],m[h]=e[10],p[h]=e[6],h++)});var w=JSON.stringify(o),b=JSON.stringify(s),A=JSON.stringify(u),S=JSON.stringify(d),C=JSON.stringify(g),I=JSON.stringify(m),k=JSON.stringify(p),d=(w.replace(/"/g,""),b.replace(/"/g,""),A.replace(/"/g,""),S.replace(/"/g,""));l.set("billerId",d);var T=C.replace(/"/g,"");l.set("billerDueDate",T);var N=I.replace(/"/g,"");l.set("billerCode",N);var D=k.replace(/"/g,"");l.set("billerCateId",D);var P=l.get("ConfirmBillers"),V=P[5];l.set("billid",V);var O=P[6];l.set("billcate",O);var E,J,q,B;E="ACTDEB",J=l.get("FrmAcctNoMode");var _=(l.get("custno"),l.get("transfees"),l.get("frmacntval")),R=(l.get("hidTotalAmt"),l.get("language"));("undefined"==J||void 0==J)&&(J=""),("undefined"==q||void 0==q)&&(q=""),("undefined"==B||void 0==B)&&(B="");var j,x=(getDeviceId(),l.get("id_type"),l.get("iqama_number"),l.get("frmacntid")),F=l.get("denominationCurrency"),z=l.get("denominationId"),M=l.get("denominationAmount"),$=l.get("sellingPrice");j=""!=$&&"null"!=$&&null!=$&&"undefined"!=$&&void 0!=$?$:l.get("amtValchck");var L,H=l.get("sellingCurrency");L=""!=H&&"null"!=H&&null!=H&&"undefined"!=H&&void 0!=H?H:l.get("basecurr");var U=x+l.get("appdynamicToken");U=CryptoJS.SHA512(U)+"",n.collection.fetch({data:e.param({appDynamicValue:U,access_token:l.get("access_token"),validtype:"Posting",billerCategoryId:O,fromAcountId:x,fromAcountbalance:_,amount:j,billerId:V,denominationId:z,denominationAmount:M,denominationCurrency:F,sellingPrice:j,sellingCurrency:L,billeruniqueId:l.get("Billeruniquid"),serviceproviderno:l.get("Billerservicesref"),remarks:"BillPayment",lang_id:R,requestid:timestamp}),dataType:"json",type:"POST",timeout:parseInt(l.get("sadadcalltimeout")),cache:!1,success:function(e){"0000"==ackStatus?r(e):a(e)},error:a})},successPage:function(){hideSpinner();var e=l.get("duebilltotamt"),n=(l.get("duebillfromacc"),l.get("acno"));this.$("#mobcontent").html(t.template(a,{amt:e,acno:n})).i18n()},EmailAdvice:function(){l.set("currentPage",""),showSpinner();var t=this,n=function(e){t.emailadvicecompile()},i=function(e){t.errorresponse()};t.collection=new r([],{});var a=(new Date).getTime(),c=e("#ftrefno").val(),o="TRANSFER";l.get("duebillpaymode");custaccountno=l.get("FrmAcctNoMode");var s=l.get("emailid"),u=(l.get("loginid"),l.get("custno")),d=(l.get("lang_id"),getDeviceId()),g=custaccountno+""+d,m=CryptoJS.MD5(g);g=m+"",t.collection.fetch({data:e.param({appchecksum:g,accountNumber:custaccountno,ftrefno:c,custmailid:s,transfertype:o,custuserid:u,requestid:a}),dataType:"json",type:"POST",timeout:parseInt(l.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?n(e):i(e)},error:i})},emailadvicecompile:function(){return l.set("backReqFromEmail","6"),this.$("#mobcontent").html(t.template(c)).i18n(),this.$("#mobcontent").trigger("create"),hideSpinner(),this},errorresponse:function(){hideSpinner(),n.history.navigate("#/exception")},disposeView:function(e){return n.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return s});