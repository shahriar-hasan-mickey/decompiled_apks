define(["jquery","underscore","Backbone","collections/common/otpValidateCollections","collections/common/otpGenerateCollections","text!views/sadad/editmanagebillAuth.tpl","models/validation/OTPValidationModel","collections/common/secureaccessvalidateCollections","text!views/sadad/billpaySEQ.tpl","collections/sadad/manageEditConfirmCollections","models/validation/softOTPValidationModel"],function(e,t,i,n,o,s,a,r,c,l,d){var u=new EncryptedLocalStorage("secret"),m=0,p=i.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click .smsotp":"OTPOption1","click .softToken":"OTPOption2","click #submit":"submitOTP","click #validatesubmit":"secureaccessvalidate","click #resendclick":"OTPOption"},initialize:function(){this.on("error",function(e,t){alert(t)})},update:function(){this.OTPOption();var e=u.get("questionBasketDetailDTO"),i=new Array,n=new Array;t.each(e,function(e,t){i[t]=e.id,n[t]=e.description}),u.set("Sec_Ques_Id",i),u.set("Sec_Ques_Des",n)},secureGate:function(){hideSpinner();var e=u.get("Sec_Ques_Id"),i=u.get("Sec_Ques_Des"),n=null==u.get("Sec_Quest_No")?"":u.get("Sec_Quest_No"),o="";if(o=Math.floor(5*Math.random())+1,5==n.length&&u.set("Sec_Quest_No",""),""==n||null==n||void 0==n)o+="";else{var s=!0;do o+="",-1!=n.indexOf(o)&&(o=Math.floor(5*Math.random())+1,s=!1);while(s)}var a=parseInt(o)-1,r=e[a],l=i[a];this.$("#mobcontent").html(t.template(c,{seq_id:r,seq_question:l})).i18n()},secureaccessvalidate:function(){hideSpinner();var t=e("#secques").val();if(""==t||void 0==t)return e("#showError").text(e.i18n.t("validation.forgotpassword.answernotnull")),e("#secError").show(),e("#errorimage").hide(),e("#secErrorlast").hide(),e("#secErrorfirst").hide(),!1;var i=t.charAt(0),n=t.charAt(t.length-1);if(!i.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return e("#showErrorfirst").text(e.i18n.t("app.login.firstspaceind")),e("#secErrorfirst").show(),e("#secErrorlast").hide(),!1;if(!n.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return e("#showErrorlast").text(e.i18n.t("app.login.lastspaceind")),e("#secErrorlast").show(),e("#secErrorfirst").hide(),!1;var o=e("#secquesid").val(),s=e("#secques").val(),a=this;getDeviceId();showSpinner();var c=function(e){a.SuccessPage()},l=function(e){a.errorresponse()};a.collection=new r;var d=(new Date).getTime(),m=EncryptWithDynamicSalt(s,d),p=u.get("ulpID")+o+s;p=null==p?"":p,checkSumEncrypt(p);var h=localStorage.getItem("FINALCHECKSUM");getDeviceId();a.collection.fetch({data:e.param({access_token:u.get("access_token"),qstnId:o,answer:m,appchecksum:h,salt:d}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?c(e):l(e)},error:l})},editmanagebillcompile:function(){var e=u.get("billnickname"),i=u.get("billsbillername"),n=u.get("scrbeno");return hideSpinner(),this.$("#mobcontent").html(t.template(s,{nickname:e,billername:i,scrbeno:n})).i18n(),this},OTPOption1:function(t){e(".smsotp_block").show(),e(".softTock").hide(),e(".smsotp").addClass("active"),e(".softToken").removeClass("active"),document.getElementById("softTockId").style.display="none",document.getElementById("smsDivId").style.display="inline",this.OTPOption(),t.preventDefault()},OTPOption2:function(){e(".smsotp_block").hide(),e(".softTock").show(),e(".softToken").addClass("active"),e(".smsotp").removeClass("active"),e("#hiddotpvalue").val("Y"),document.getElementById("softTockId").style.display="inline"},OTPOption:function(){e("#secError").hide(),e("#submit").removeAttr("disabled"),e("#hidotp").val("otp"),e("#otp").val(""),e("#showError").text(""),showSpinner();var t=this,i=function(e){t.errorresponse()};t.collection=new o([],{});var n=function(e){t.editmanagebillcompile()};timestamp=(new Date).getTime(),t.collection.fetch({data:e.param({access_token:u.get("access_token"),moduletype:"BILLER"}),dataType:"json",type:"POST",timeout:parseInt(u.get("calltimeout")),cache:!1,success:function(o){"0000"==ackStatus?(e("#submit").removeAttr("disabled"),"SMS"==status?n(o):"SQ"==status?t.secureGate():t.SuccessPage()):(e("#submit").removeAttr("disabled"),i(o))},error:i})},editbillOTP:function(i){hideSpinner();var n=e("#firstName").val(),o=e("#scrbeno").val();return this.$("#mobcontent").html(t.template(editmanagebillOTPTemplate,{nickname:i,firstName:n,scrbeno:o})).i18n(),this},ownsubmitotp11:function(){this.model=new a({url:"json/"}),this.$(".alert").hide(),i.Validation.bind(this);var t=this.$("form").serializeObject();if(this.model.set(t,{validate:!0})){showSpinner(),this.model.clear(),i.Validation.unbind(this);var o=this,s=function(e){o.SuccessPage()},r=function(e){o.errorresponse()};o.collection=new n([],{});var c=(new Date).getTime(),l="SMS",d="0",m=e("#otp").val(),p=u.get("custno");o.collection.fetch({data:e.param({opttype:l,refno:d,otpModule:"sadad_manage_profile",activationno:m,customerno:p,requestid:c}),dataType:"json",type:"POST",timeout:parseInt(u.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?s(e):r(e)},error:r})}else this.$(".alert-error").fadeIn(),hideSpinner()},submitOTP:function(e){this.ownsubmitotp()},ownsubmitotp:function(){e("#secError").hide(),e("#showError").text(""),this.model=new a({url:"json/"}),i.Validation.bind(this);var t=this.$("form").serializeObject();if(this.model.set(t,{validate:!0})){this.model.clear(),i.Validation.unbind(this);var o=this,s=function(e){o.SuccessPage()},r=function(e){o.errorresponse()};o.collection=new n([],{});var c=((new Date).getTime(),e("#otp").val()),l=(new Date).getTime();c=EncryptWithDynamicSalt(c,l),showSpinner(),o.collection.fetch({data:e.param({access_token:u.get("access_token"),transactionData1:"SMS",salt:l,activationno:c}),dataType:"json",type:"POST",timeout:parseInt(u.get("calltimeout")),cache:!1,success:function(t){u.get("errorcod");if("0000"==ackStatus)s(t),startTimer("submit",!1);else{m++;var n=u.get("errordesc");e("#showError").text(n),e("#secError").show(),m>2&&(m=0,i.history.navigate("#/wrongOTPExceptionpost/sadad"),startTimer("submit",!1)),hideSpinner()}},error:r})}else this.$(".alert-error").fadeIn()},ownsoftotp:function(){this.model=new d({url:"json/"}),i.Validation.bind(this);var t=this.$("form").serializeObject();if(this.model.set(t,{validate:!0})){showSpinner(),this.model.clear(),i.Validation.unbind(this);var o=this,s=function(e){o.SuccessPage()},a=function(e){o.errorresponse()};o.collection=new n([],{});var r=(new Date).getTime(),c="SOFTOTP",l=e("#softotp").val(),m=u.get("custno");o.collection.fetch({data:e.param({opttype:c,refno:u.get("token_serno"),activationno:l,customerno:m,requestid:r}),dataType:"json",type:"POST",timeout:parseInt(u.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?s(e):a(e)},error:a})}else this.$(".alert-error").fadeIn(),hideSpinner()},SuccessPage:function(){var t=this;showSpinner();var i=function(e){t.editSuccess()},n=function(e){t.errorresponse()};t.collection=new l([],{});var o=u.get("scrbeno"),s=u.get("editBillList");shortName=s[3];var a=u.get("benstatus");timestamp=(new Date).getTime();var r=u.get("access_token"),c=u.get("language"),d=(getDeviceId(),u.get("serviceId")),m=u.get("categoryId"),p=a+u.get("appdynamicToken");p=CryptoJS.SHA512(p)+"",t.collection.fetch({data:e.param({appDynamicValue:p,access_token:r,serviceproviderno:o,nickname:shortName,validType:"Posting",billercategoryid:m,billerUniqueId:a,operationFlag:"M",serviceid:d,requestid:timestamp,lang_id:c}),dataType:"json",type:"POST",timeout:parseInt(u.get("sadadcalltimeout")),cache:!1,success:function(e){"0000"==ackStatus?i(e):n(e)},error:n})},editSuccess:function(){hideSpinner(),i.history.navigate("#/editmanagesuccess")},errorresponse:function(){hideSpinner(),i.history.navigate("#/exception")},disposeView:function(e){return i.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return p});