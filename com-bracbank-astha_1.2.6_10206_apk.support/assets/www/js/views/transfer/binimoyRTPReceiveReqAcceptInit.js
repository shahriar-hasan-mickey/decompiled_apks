define(["jquery","underscore","Backbone","collections/transfer/getAccountBalanceCollections","collections/transfer/getIdtpAccountsCollections","collections/transfer/getAmountInWordsCollections","collections/transfer/getIDTPLimitCollections","text!views/transfer/binimoyRTPReceiveReqAcceptInit.tpl"],function(e,c,t,r,a,n,i,o){var s=new EncryptedLocalStorage("secret"),l=!1,p=t.View.extend({el:"#container",events:{"click .acccardnum_rtpRecReqAccept":"rtpReceiveReqAccFromAcc","click #rtpRecReqAcc_TandCPopup":"openRTPReceiveReqAcceptTancCPopup","click #rtpRecReqAcc_CancelBtn":"gotoPreviousPage","click #rtpRecReqAcc_ProceedBtn":"gotoRTPReceiveReqAccVerifyPage"},initialize:function(){},update:function(){var c=this,t=function(e){hideSpinner(),c.getIDTPTaggedAccounts()},r=function(e){c.errorresponse()};showSpinner(),c.collection=new i,c.collection.fetch({data:e.param({access_token:s.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?t(e):r(e)},error:r})},getIDTPTaggedAccounts:function(){var c=this,t=function(e){hideSpinner(),c.loadTemplate()},r=function(e){c.errorresponse()};showSpinner(),c.collection=new a,c.collection.fetch({data:e.param({access_token:s.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?t(e):r(e)},error:r})},loadTemplate:function(){for(var t=s.get("idtpAccounts"),r=getAccountDTO(),a=[],n=0;n<t.length;n++)for(var i=0;i<r.length;i++)r[i].accountNumber==t[n]&&a.push(r[i]);s.set("filteredIDTPTagAccounts",a),this.$el.html(c.template(o)),e("html").removeClass().addClass("app"),s.set("rtpReceiveAccFromAccID",null),s.set("rtpReceiveAccFromAccInd",null),s.set("rtpReceiveAccFromAccType",null),s.set("rtpReceiveAccFromAccNum",null),s.set("rtpReceiveAccFromAccCur",null);var l=this,r=s.get("filteredIDTPTagAccounts"),p=[],u=s.get("defaultRTPAccount");p=r.filter(function(e){return e.accountNumber==u});var m=p[0].id;s.set("rtpReceiveAccFromAccID",m);var A="CASA";s.set("rtpReceiveAccFromAccType",A);var d=p[0].accountNumber;s.set("rtpReceiveAccFromAccNum",d);var v='<div class="qr_acc_outer">\n <ul class="list-unstyled m0">\n <li class="list-group-item">\n <div class="col-xs-2 first-col">\n<span class="menu_icon account"></span>\n</div>\n <div class="col-xs-10">\n<p class="acc_txt"> '+p[0].accountShortName+'</p>\n<p class="acc_cat"> <span class="selectAccNumber"> '+p[0].accountNumber+" </span></p>\n</div>\n </li>\n </ul>\n </div>";e("#seltpayval").html(v),e('li.acccardnum_rtpRecReqAccept[accide="'+m+'"]').find("input").attr("checked","checked"),l.rtpReceiveReqAccInitAccBalance()},rtpReceiveReqAccFromAcc:function(c){"object"==typeof c&&(c.preventDefault(),c.stopImmediatePropagation());var t=this,r=e(c.target).closest("li.acccardnum_rtpRecReqAccept").attr("Accide");s.set("rtpReceiveAccFromAccID",r);var a=e(c.target).closest("li.acccardnum_rtpRecReqAccept").attr("id");s.set("rtpReceiveAccFromAccInd",a);var n=e(c.target).closest("li.acccardnum_rtpRecReqAccept").attr("acctype");s.set("rtpReceiveAccFromAccType",n);var i=e(c.target).closest("li.acccardnum_rtpRecReqAccept").attr("accNum");s.set("rtpReceiveAccFromAccNum",i);var o=e(c.target).closest("li.acccardnum_rtpRecReqAccept").attr("data");s.set("rtpReceiveAccFromAccCur",o),s.set("rtpReceiveAccFromAccType",n),t.rtpReceiveReqAccInitAccBalance(c),e('li.acccardnum_rtpRecReqAccept[accide="'+r+'"]').find("input").attr("checked","checked");var l=e(c.target).closest("li.acccardnum_rtpRecReqAccept").find(".row").clone().html(),p='<div class="qr_acc_outer">\n <ul class="list-unstyled m0">\n <li class="list-group-item">\n'+l+"</li>\n </ul>\n </div>";e("#seltpayval").html(p),e("#card_account .close").trigger("click")},rtpReceiveReqAccInitAccBalance:function(c){"object"==typeof c&&(c.preventDefault(),c.stopImmediatePropagation()),e("#acntNumErr").html("");var t=s.get("rtpReceiveAccFromAccID");if(""==t)return e("#availbal").html(""),void e("#availBalDiv").hide();var a=this,n=function(c){hideSpinner(),e("#availBalDiv").hide(),e("#availbal").html("");var t,r,a=s.get("availableBalance"),n=parseFloat(a.slice(0,-2)),i=null==s.get("accountCurrency")||""==s.get("accountCurrency")?"":s.get("accountCurrency"),o=s.get("rtpReceiveAccFromAccType");s.set("rtpReceiveAccFromAccType",o),"CASA"==o&&(t=checkAmount(e.formatNumber(n,{format:"#,###.00",locale:"us"})),r=t+" "+i,s.set("rtpReceiveAccFromAcntAvailBal",n)),e("#availbal").html(r),e("#availBalDiv").show()},i=function(c){a.errorresponse(),e("#card_account .close").trigger("click")};showSpinner(),a.collection=new r,a.collection.fetch({data:e.param({access_token:s.get("access_token"),accountId:t,accountType:s.get("rtpReceiveAccFromAccType"),beneficiaryInstructionId:null}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?n(e):i(e)},error:i})},openRTPReceiveReqAcceptTancCPopup:function(e){e.stopImmediatePropagation(),s.set("tandctype","binimoyRTPAccept"),openTermsAndConditionsPopup()},gotoPreviousPage:function(e){e.stopImmediatePropagtion(),t.history.navigate("#/binimoyrtpreceivelist")},gotoRTPReceiveReqAccVerifyPage:function(c){c.stopImmediatePropagation(),e("#acntNumErr").html(""),e("#rtpRecReqAcc_TandCErr").html(""),e("#rtpAccAmtErr").html("");var t=this;l=!1;var r=e("#rtpRecReqAcc_ToVID").val(),a=(e("#rtpRecReqAcc_Amount").val(),e("#rtpRecReqAcc_Remarks").val()),n=e("#rtpRecReqAcc_RefID").val(),i=e("#rtpRecReqAcc_TandC").prop("checked"),o=s.get("rtpReceiveAccFromAcntAvailBal"),p=parseFloat(e("#rtpRecReqAcc_Amount").val().replace(/,/g,""));if(isNull(s.get("rtpReceiveAccFromAccID"))&&(l=!0,e("#acntNumErr").html("Please select a From Account")),!isNull(p)){p>o&&(l=!0,e("#rtpAccAmtErr").html(e.i18n.t("validation.transfer.nobal")));var u=parseFloat(s.get("idtpMin")),m=parseFloat(s.get("idtpMax"));if(u>p)return void e("#rtpAccAmtErr").html(e.i18n.t("validation.sadad.amtgreaterthanminamt"));if(p>m)return void e("#rtpAccAmtErr").html(e.i18n.t("validation.sadad.amtlessthanmaxamt"))}i||(l=!0,e("#rtpRecReqAcc_TandCErr").html("Please check the Terms and Conditions")),l||(s.set("rtpRecReqAcc_ToVID",r),s.set("rtpRecReqAcc_ToVIDName",s.get("RTPAcceptSenderName")),s.set("rtpRecReqAcc_Amount",p),s.set("rtpRecReqAcc_Remarks",a),s.set("rtpRecReqAcc_RefID",n),t.getAmountInWords(c))},getAmountInWords:function(c){c.stopImmediatePropagation();var t=this;showSpinner();var t=this,r=function(e){hideSpinner(),t.navigateToVerifyPage(c)},a=function(e){hideSpinner(),t.errorresponse()};showSpinner(),t.collection=new n,t.collection.fetch({data:e.param({access_token:s.get("access_token"),amount:s.get("rtpRecReqAcc_Amount")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):a(e)},error:a})},navigateToVerifyPage:function(e){e.stopImmediatePropagation(),t.history.navigate("#/binimoyrtpreceiveaccverify")},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return t.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return p});