define(["jquery","underscore","Backbone","collections/transfer/localTransferFTPCollections","collections/wealth/otpPostLoginGenerationCollections","collections/wealth/otpPostLoginVerificationCollections","text!views/transfer/otherbankonetimepayverify.tpl"],function(e,t,o,n,r,a,i){var s=null,c=new EncryptedLocalStorage("secret"),p=o.View.extend({el:"#container",events:{"click #otheronetransferbackbtn":"otheronetransferbackbtn","click #otherowncancelBtn":"gotootherCancelPage","click #otherownBene_Verify_ConfirmBtn":"otheronetypeopenpopup","click #otherownBene_OTPCancel":"otheronerevokeOTPSpinner","click #otherownBene_OTPCloseBtn":"otheronerevokeOTPSpinner","click #otherownBene_OTPVerify":"validateOTP"},initialize:function(){e("html").removeClass().addClass("app")},update:function(){s=null,"true"==c.get("beneSuccessFlag")?(e("#container").html(t.template(i)),c.set("beneSuccessFlag","false")):o.history.navigate("#/otherbankonetimepay")},otheronetypeopenpopup:function(t){t.stopImmediatePropagation();var o=this;"false"==c.get("IsAuthMode")?o.Posting(t):"SMS"==c.get("alertType")||"EMAIL"==c.get("alertType")||"ESIGN"==c.get("alertType")?o.validateCard("N"):(c.set("otpCode",""),e("#verify").modal("show"),e("#otpNullError").html(""),e("#otpNullErrorDiv").hide(),e("#otp1, #otp2, #otp3, #otp4, #otp5, #otp6").removeAttr("data"),e(".inputs").on("input",function(t){t.stopImmediatePropagation();var o=t.currentTarget.id,n=e("#"+o).val();e("#"+o).attr("data",n),e("#"+o).val(n.replace(/[^\*]/,"."))}),e("#otp1, #otp2, #otp3, #otp4, #otp5, #otp6").val(""))},validateCard:function(t){var o=this,n="",a=function(n){hideSpinner(),"Y"==t&&(e("#OTPcontainer1").slideDown("slow"),s.set(1),s.animate(0,function(){e("#OTPcontainer1").slideUp("slow")})),e("#verify").modal("show"),e("#otp1, #otp2, #otp3, #otp4, #otp5, #otp6").removeAttr("data"),setTimeout(function(){e("#otp1").focus()},500),e("#otpNullError").html(""),e("#otpNullErrorDiv").hide(),"ESIGN"==c.get("alertType")&&e("#challengeText").html(e.i18n.t("app.transferss.genratedTocn")+""+c.get("otpCode")),e(".inputs").on("input",function(t){t.stopImmediatePropagation();var o=t.currentTarget.id,n=e("#"+o).val();e("#"+o).attr("data",n),e("#"+o).val(n.replace(/[^\*]/,"."))}),e("#otp1, #otp2, #otp3, #otp4, #otp5, #otp6").val(""),("SMS"==c.get("alertType")||"EMAIL"==c.get("alertType"))&&o.invokeOTPSpinner()};n="BEFTN"==c.get("otherBankTransferType")?"OTHER_BANK_BEFTN_ONE_OFF":"RTGS"==c.get("otherBankTransferType")?"OTHER_BANK_RTGS_ONE_OFF":"OTHER_BANK_NPSB_ONE_OFF";var i=function(e){o.errorresponse()};showSpinner(),o.collection=new r;getDeviceId(),(new Date).getTime();o.collection.fetch({data:e.param({access_token:c.get("access_token"),transactionType:n,resendflag:t,authMode:c.get("alertType")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):i(e)},error:i})},invokeOTPSpinner:function(){var t=this;return e("#resend_btn7").hide(),e("#OTPcontainer1").show(),e("#otp1, #otp2, #otp3, #otp4, #otp5, #otp6").val(""),null!=s?(s.set(1),void s.animate(0,function(){e("#OTPcontainer1").slideUp("slow")})):(s=new ProgressBar.Circle(OTPcontainer1,{color:"#333",strokeWidth:8,trailWidth:8,easing:"linear",duration:6e4*parseInt(c.get("otpExpiryPeriod")),text:{autoStyleContainer:!1},from:{color:"#ec5f59",width:8},to:{color:"#ec5f59",width:8},step:function(t,o){o.path.setAttribute("stroke",t.color),o.path.setAttribute("stroke-width",t.width);var n=Math.round(o.value()*(60*c.get("otpExpiryPeriod")));"0"==n?(o.setText(""),e("#resend_btn7").show()):(e("#resend_btn7").hide(),o.setText(n+"s"))}}),s.text.style.fontFamily='"Raleway", Helvetica, sans-serif',s.text.style.fontSize="12px",s.text.style.fontWeight="bold",s.set(1),s.animate(0,function(){e("#OTPcontainer1").slideUp("slow")}),void e("#resend_btn7").click(function(){t.validateCard("Y")}))},otheronerevokeOTPSpinner:function(){null!=s&&s.stop()},validateOTP:function(t){var o=this,n="";e("#otpNullError").html(""),e("#otpNullErrorDiv").hide(),t.stopImmediatePropagation();var r=e("#otp1").attr("data"),i=e("#otp2").attr("data"),s=e("#otp3").attr("data"),p=e("#otp4").attr("data"),l=e("#otp5").attr("data"),u=e("#otp6").attr("data"),d=r+""+i+s+p+l+u;if(isNull(r)||isNull(i)||isNull(s)||isNull(p)||isNull(l)||isNull(u))return e("#otpNullErrorDiv").show(),void e("#otpNullError").html(e.i18n.t("validation.newregistration.otpnotnull"));n="BEFTN"==c.get("otherBankTransferType")?"OTHER_BANK_BEFTN_ONE_OFF":"RTGS"==c.get("otherBankTransferType")?"OTHER_BANK_RTGS_ONE_OFF":"OTHER_BANK_NPSB_ONE_OFF";var h=function(e){o.otheronerevokeOTPSpinner(),o.Posting(t)},g=function(t){hideSpinner(),isNull(c.get("errordesc"))||(e("#otpNullErrorDiv").show(),e("#otpNullError").html(c.get("errordesc")))};showSpinner(),o.collection=new a;getDeviceId(),(new Date).getTime();o.collection.fetch({data:e.param({access_token:c.get("access_token"),transactionType:n,activationno:d,uniqueId:c.get("otpCode"),twoFAType:c.get("alertType")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?h(e):g(e)},error:g})},Posting:function(t){t.stopImmediatePropagation();var o=(c.get("paymentType"),c.get("beneficiaryDTO"),c.get("selectid1"),c.get("transDate"),c.get("paymentType12"),getDatemonthToday(),c.get("Toaccno"),c.get("transferAmount"),this),r=(c.get("paymentType12"),getDatemonthToday(),c.get("Toaccno"),function(n){hideSpinner(),e("#verify").modal("hide"),o.otheronerevokeOTPSpinner(),o.sucesspage(t)}),a=function(e){o.otheronerevokeOTPSpinner(),o.errorresponse(),o.otheronetransferbackbtn(t)};showSpinner(),o.collection=new n([],{}),o.collection.fetch({data:e.param({access_token:c.get("access_token"),fromaccountId:c.get("otherfromaccountID1"),paydate:"",transtype:"PAYNOW",validtype:"Posting",beneAcctType:c.get("beneAccType"),currSelection:"F",transcurrency:c.get("transCurr"),toaccountId:c.get("accnum"),remarks:c.get("otherownpurposetransferdiv"),trnasfertype:c.get("otherOneTimeTransferType"),transamount:c.get("Paymentamount"),uniqueId:c.get("uniqueId"),globalId:c.get("globalTranValidationId"),totalDebitAmount:c.get("totalDebitAmount"),onetimepay:"TRUE",benetype:"DOMESTIC",frmAcctName:c.get("accountTitle"),paymenttype:c.get("otherBankTransferType"),totalfee:c.get("fee"),benebankname:c.get("otherbenebank"),benebranchname:c.get("otherBeneBranch"),benebankcode:c.get("otherbankCode"),beneifsccode:c.get("OB_routingNum"),benename:c.get("othertoacc_name"),paymentAmount:c.get("debitAmountInBaseCurrency"),limitId:c.get("id"),salt:c.get("salttime")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):a(e)},error:a})},otheronetransferbackbtn:function(e){e.stopImmediatePropagation(),o.history.navigate("#/otherbankonetimepay")},gotootherCancelPage:function(e){e.stopImmediatePropagation(),o.history.navigate("#/otherbankselectbeneficiary")},sucesspage:function(e){e.stopImmediatePropagation(),c.set("beneSuccessFlag","true"),o.history.navigate("#/othertransferownresult")},errorresponse:function(){hideSpinner(),e("#verify").modal("hide"),openErrorPopup()},disposeView:function(e){return o.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return p});