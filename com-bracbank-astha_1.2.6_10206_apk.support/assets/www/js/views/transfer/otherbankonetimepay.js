define(["jquery","underscore","Backbone","models/validation/transfer/otherAccountOnetimepayValidationModel","collections/manageBeneficiaries/BenebanknameCollections","collections/manageBeneficiaries/BenebranchnameCollections","collections/manageBeneficiaries/BeneroutingCollections","collections/transfer/getTransactionLimitCollections","collections/transfer/getAccountBalanceCollections","collections/wealth/prepaidcardCollections","collections/transfer/localTransferFTPCollections","collections/transfer/currencyListsCollections","collections/transfer/getAuthModeCollections","text!views/transfer/otherbankonetimepay.tpl"],function(e,t,a,n,r,o,i,s,c,l,h,m,u,p){var d=!1,f=new EncryptedLocalStorage("secret"),v=a.View.extend({el:"#container",events:{"click #OB_OneTimePay_confirmbtn":"submitPay","click #other_bene":"loadTobeneUi","change #otheronefromaccnum":"getAccountBalance","change .transferChannel":"getBankDetailInfo","click #othercancelbtn":"gotoPreviousPage","change #otherpurposetransferdiv":"showOthersDiv","click .oneTimetype":"otherToggleLabel","blur #otherpaymentAmount":"getAuthMode","click #oneTime_trans_limit":"showOneTimeTransLimitPopup","click .onetimepopupSearch":"getPopupType","click .onetimeselectedvalue":"getSelectedValue","click #otherBankTandCPopup":"otherBankOneTimeOpenTandCPopup"},initialize:function(){},update:function(){var t=this;if("false"==f.get("isPrepaidCardData")){var a=function(e){hideSpinner(),d=!1,f.set("otherBankTransferType","NPSB"),t.getTransactionalLimit(),f.set("isPrepaidCardData","true")},n=function(e){t.errorresponse()};showSpinner(),t.collection=new l([],{});getDeviceId();t.collection.fetch({data:e.param({newversion:"Y",access_token:f.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):n(e)},error:n})}else hideSpinner(),d=!1,f.set("otherBankTransferType","NPSB"),t.getTransactionalLimit()},populateFromAccounts:function(){e("#otheronefromaccnum").html(""),e("#availBalDiv").hide();var t=getAccountDTO(),a=e("input[name='transfer']:checked").val(),n=f.get("prepaidCardAccountList"),r='<option value=""  selected="selected">'+e.i18n.t("app.transferss.selaccnum")+"</option>";isNull(t)||("npsb"==a&&(f.set("tenantServiceCode","NPSB_OT"),e.each(t,function(e,t){"Y"==t.npsbflag&&(r+='<option acctype="CASA" owName="'+t.productName+'" curCode="'+t.currencyCode+'" Accownide="'+t.id+'" id="'+e+'">'+t.accountNumber+"</option>")})),"beftn"==a&&(f.set("tenantServiceCode","BEFTN_OT"),e.each(t,function(e,t){"Y"==t.beftnflag&&(r+='<option acctype="CASA" owName="'+t.productName+'" curCode="'+t.currencyCode+'" Accownide="'+t.id+'" id="'+e+'">'+t.accountNumber+"</option>")})),"rtgs"==a&&(f.set("tenantServiceCode","RTGS_OT"),e.each(t,function(e,t){"Y"==t.rtgsflag&&(r+='<option acctype="CASA" owName="'+t.productName+'" curCode="'+t.currencyCode+'" Accownide="'+t.id+'" id="'+e+'">'+t.accountNumber+"</option>")}))),isNull(n)||("npsb"==a&&(f.set("tenantServiceCode","NPSB_OT"),e.each(n,function(e,t){"Y"==t.npsbflag&&(r+='<option acctype="PC" owName="'+t.cardHolderName+'" curCode="'+t.currencyCode+'" Accownide="'+t.id+'" id="'+e+'">'+t.accountNumber+"</option>")})),"beftn"==a&&(f.set("tenantServiceCode","BEFTN_OT"),e.each(n,function(e,t){"Y"==t.beftnflag&&(r+='<option acctype="PC" owName="'+t.cardHolderName+'" curCode="'+t.currencyCode+'" Accownide="'+t.id+'" id="'+e+'">'+t.accountNumber+"</option>")})),"rtgs"==a&&(f.set("tenantServiceCode","RTGS_OT"),e.each(n,function(e,t){"Y"==t.rtgsflag&&(r+='<option acctype="PC" owName="'+t.cardHolderName+'" curCode="'+t.currencyCode+'" Accownide="'+t.id+'" id="'+e+'">'+t.accountNumber+"</option>")}))),e("#otheronefromaccnum").html(r)},getAuthMode:function(t){var r=this;t.stopImmediatePropagation(),this.model=new n({url:"json/"}),a.Validation.bind(this);var o=this.$("form").serializeObject();this.model.set(o,{validate:!0})?(this.model.clear(),a.Validation.unbind(this)):this.$(".has-error").fadeIn();var i=e("#otherpaymentAmount").val().replace(/,/g,"");f.set("IsAuthMode","false"),f.set("authModeFlag","false"),e("#transAmountError").html(""),e("#other_onetime_transferDiv").html("");var s=new RegExp("^[0-9.,]+$");if(f.set("transferType","otherOneOff"),!isNull(i)){if(!isNull(i)&&!s.test(i))return void e("#transAmountError").html(e.i18n.t("validation.transfer.validamount"));var i=parseFloat(e("#otherpaymentAmount").val().replace(/,/g,"")),c=parseFloat(f.get("minAmountPerTransaction")),l=parseFloat(f.get("maxAmountPerTransaction"));if(c>i)return void e("#transAmountError").html(e.i18n.t("validation.sadad.amtgreaterthanminamt"));if(i>l)return void e("#transAmountError").html(e.i18n.t("validation.sadad.amtlessthanmaxamt"));var h=function(e){hideSpinner();var a=f.get("securitySettingList");!isNull(a)&&a.length>0?f.set("IsAuthMode","true"):(f.set("alertType",null),f.set("IsAuthMode","false")),r.populateAuthMode(t),r.submitPay(t)},m=function(t){hideSpinner(),f.set("authModeFlag","true"),e("#otherpaymentAmount").val(""),r.errorresponse()};showSpinner(),r.collection=new u,r.collection.fetch({data:e.param({access_token:f.get("access_token"),transactionAmount:i,tenantServiceCode:f.get("tenantServiceCode")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?h(e):m(e)},error:m})}},populateAuthMode:function(t){t.stopImmediatePropagation();var a="",n="",r=f.get("securitySettingList"),o="<label for='username'>"+e.i18n.t("app.transfer.managebeneficiary.selectauthorisationmode")+"</label>";o+="<div class='custRadio_pass'>",!isNull(r)&&r.length>0?(e("#other_onetime_transferDiv").html(""),e.each(r,function(t,r){"SMS"==r?(a="sms",n=e.i18n.t("app.transfer.managebeneficiary.sms")):"EMAIL"==r?(a="mail",n=e.i18n.t("app.transfer.managebeneficiary.mail")):"TOKEN"==r?(a="fScan",n=e.i18n.t("app.transfer.managebeneficiary.token")):"ESIGN"==r&&(a="esign",n=e.i18n.t("app.transfer.managebeneficiary.esign")),o+='<div class="box"><div class="radio"><label>',o+=0==t?'<input type="radio" name="other_onetime_transfer" id="optionsRadios'+t+'" value="'+r+'" checked>':'<input type="radio" name="other_onetime_transfer" id="optionsRadios'+t+'" value="'+r+'">',o+='<div class="row bg"><div class="col-xs-12 p0"><span class="menu_icon ico-xs '+a+'"></span><span class="small">'+n+"</span></div></div></label></div></div>"}),e("#other_onetime_transferDiv").html(o)):e("#other_onetime_transferDiv").html("")},gotoPreviousPage:function(e){e.stopImmediatePropagation(),a.history.navigate("#/otherbankselectbeneficiary")},showOthersDiv:function(t){t.stopImmediatePropagation();var a=e("#otherpurposetransferdiv option:selected").val();"others"==a?e("#othersDiv").show():e("#othersDiv").hide()},otherToggleLabel:function(t){t.stopImmediatePropagation();var a=e("input[name='payaccard']:checked").val();"account"==a?(e("#otherBeneTypeLabel").html("Pay to Account"),e("#otherBeneNameLabel").html("Account Holder Name")):"creditcard"==a&&(e("#otherBeneTypeLabel").html("Pay to Card"),e("#otherBeneNameLabel").html("Card Holder Name"))},showOneTimeTransLimitPopup:function(){e("#oneTimeMinAmount, #oneTimeDailyLimit, #oneTimePerTransLimit, #oneTimeMonthlyLimit, #oneTimeDailyAvailCount, #oneTimeDailyTransCount, #oneTimeMonthlyAvailLimit, #oneTimeMonthlyAvailCount").html(""),e("#OneTimeTransactionLimit").modal("show");var t=f.get("minAmountPerTransaction"),a=f.get("dailyAvailableLimit"),n=f.get("monthlyTransactionLimit"),r=f.get("maxAmountPerTransaction"),o=f.get("dailyAvailableCount"),i=f.get("dailyTransactionCount"),s=f.get("monthlyAvailableLimit"),c=f.get("monthlyAvailableCount");e("#oneTimeMinAmount").html(checkAmount(e.formatNumber(t,{format:"#,###.00",locale:"us"}))+" <span class='cur'>"+e.i18n.t("app.transferss.bdt")+"</span>"),e("#oneTimeDailyLimit").html(checkAmount(e.formatNumber(a,{format:"#,###.00",locale:"us"}))+" <span class='cur'>"+e.i18n.t("app.transferss.bdt")+"</span>"),e("#oneTimePerTransLimit").html(checkAmount(e.formatNumber(r,{format:"#,###.00",locale:"us"}))+" <span class='cur'>"+e.i18n.t("app.transferss.bdt")+"</span>"),e("#oneTimeMonthlyLimit").html(checkAmount(e.formatNumber(n,{format:"#,###.00",locale:"us"}))+" <span class='cur'>"+e.i18n.t("app.transferss.bdt")+"</span>"),e("#oneTimeMonthlyAvailLimit").html(checkAmount(e.formatNumber(s,{format:"#,###.00",locale:"us"}))+" <span class='cur'>"+e.i18n.t("app.transferss.bdt")+"</span>"),e("#oneTimeDailyAvailCount").html(o),e("#oneTimeDailyTransCount").html(i),e("#oneTimeMonthlyAvailCount").html(c)},getPopupType:function(t){t.stopImmediatePropagation();var a=this,n=e(t.currentTarget).attr("id");if("bankPopup"==n)f.set("popupType","bank"),a.populatePopup(t);else if("branchPopup"==n){f.set("popupType","branch");var r=e("input[name='banks']:checked").val();isNull(r)||a.getBeneBranchList(t)}},populatePopup:function(t){t.stopImmediatePropagation(),e("#bankBranchList").html("");var a;"bank"==f.get("popupType")?(a=getBankListDTO(),e("#myModalHeaderLabel").html(e.i18n.t("app.transfer.managebeneficiary.selectbeneficiarybank")),e("#searchTab").attr("placeholder","Search bank"),e("#searchTab").val("")):(a=getBranchListDTO(),e("#myModalHeaderLabel").html(e.i18n.t("app.transfer.managebeneficiary.selectbeneficiarybranch")),e("#searchTab").attr("placeholder","Search Branch"),e("#searchTab").val(""));var n="";e.each(a,function(e,t){n+="<div class='row searchItems'><div class='col-xs-12'><label class='radio-label'>",n+="bank"==f.get("popupType")?"<input type='radio' name='banks' value='"+t.bankName+"' class='onetimeselectedvalue' id='"+t.bankCode+"' maxlenAllowed='"+t.maxCharAllowed+"' hyphenAllowed='"+t.hypenAllowed+"'>"+t.bankName+"<span class='checkmark'></span>":"<input type='radio' name='banks' value='"+t.branchName+"' class='onetimeselectedvalue' id='"+t.branchCode+"'>"+t.branchName+"<span class='checkmark'></span>",n+="</label></div></div>"}),e("#bankBranchList").html(n),e("#bankBranchPopup").modal("show");var r=this;e(document).on("keyup","#searchTab",function(e){r.searchInPopup(e)})},searchInPopup:function(t){t.stopImmediatePropagation();var a=e("#searchTab").val();jQuery.expr[":"].contains=function(e,t,a){return jQuery(e).text().toUpperCase().indexOf(a[3].toUpperCase())>=0},a.length>0?(e(".searchItems").hide(),e('.searchItems:contains("'+a+'")').length>0?(e(".nodata").hide(),e('.searchItems:contains("'+a+'")').show()):e(".nodata").show()):(e(".nodata").hide(),e(".searchItems").show())},getSelectedValue:function(t){if(t.stopImmediatePropagation(),"bank"==f.get("popupType")){var a=e("input[name='banks']:checked").val(),n=e("input[name='banks']:checked").attr("id");f.set("otherbenebank",a),f.set("otherbankCode",n),e("#otherRoutingDistDiv").hide(),e("#OB_dist").html(""),e("#OB_routingNum").html(""),e("#otherBranchName").val(""),e("#otherBankName").val(f.get("otherbenebank"))}else if("branch"==f.get("popupType")){var r=e("input[name='banks']:checked").val(),o=e("input[name='banks']:checked").attr("id");f.set("otherbenebranch",r),f.set("otherbranchCode",o),e("#otherBranchName").val(f.get("otherbenebranch"))}setTimeout(function(){e("#bankBranchPopup").modal("hide")},600);var i=this;"branch"==f.get("popupType")&&i.getRoutingNumberInfo(t)},getTransactionalLimit:function(){var t=this,a=function(e){hideSpinner(),t.getBankList()},n=function(e){t.errorresponse()};showSpinner(),t.collection=new s,t.collection.fetch({data:e.param({access_token:f.get("access_token"),payeeType:"LOCAL_TRANSFER",transferChannel:f.get("otherBankTransferType")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):n(e)},error:n})},getBankList:function(){var t=this;showSpinner();var a=function(e){hideSpinner(),d||t.loadtempUi()},n=function(e){t.errorresponse()};showSpinner(),t.collection=new r([],{});getDeviceId();t.collection.fetch({data:e.param({access_token:f.get("access_token"),transferChannel:f.get("otherBankTransferType")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):n(e)},error:n})},loadtempUi:function(){function n(e){return"ONE-OFF"==e.subTransactionType?e:void 0}var r=this;f.set("otherBankTransferType","NPSB");var o=f.get("downtimeNotification");if(!isNull(o)&&o.length>0){var i=o.filter(n);3==i.length?(f.set("isOneOffAllDown","Y"),f.set("isBeneAllDown","N"),a.history.navigate("#/downtimeboth")):(f.set("isOneOffAllDown","N"),f.set("isBeneAllDown","N"),this.$el.html(t.template(p)))}else f.set("isOneOffAllDown","N"),f.set("isBeneAllDown","N"),this.$el.html(t.template(p));if(!isNull(o)&&o.length>0){var s=(o[0].downtimeNotificationDetail,"");e.each(o,function(e,t){if("ONE-OFF"==t.subTransactionType||"BOTH"==t.subTransactionType){var a=t.downtimeNotificationDetail,n=a[e].messageMobile;isNull(n)||(s+="<p>"+n+"</p>")}}),e("#notificationMessage").html(e.parseHTML(s))}e("html").removeClass().addClass("app"),e("#npsb").prop("checked",!0),e("#bankInfo").hide(),e("#availBalDiv").hide(),e("#otherRoutingDistDiv").hide(),e("#otherOneOffRTGSShortNotesDiv").hide(),e("#otherBankToBeneShortNotesDiv").hide(),e("#otherOneOffBEFTNShortNotesDiv").hide();var c=e.parseJSON(window.localStorage.getItem("shortNotesObj"));isNull(c.NPSBONEOFF)||(e("#otherBankToBeneShortNotesDiv").show(),e("#otherOneOffNPSBShortNotesDiv").show(),e("#otherOneOffNPSBShortNotesDiv").html(c.NPSBONEOFF)),e("#otherBeneTypeLabel").html("Pay to Account"),e("#otherBeneNameLabel").html("Account Holder Name"),f.set("otherBankTransferType","NPSB"),r.populateFromAccounts()},getBankDetailInfo:function(t){t.stopImmediatePropagation();var a=this;d=!0;var n=e("input[name='transfer']:checked").val();if(e("#otherpaymentAmount").val(""),"npsb"==n){f.set("tenantServiceCode","NPSB_OT"),f.set("otherBankTransferChannel","NPSB"),f.set("otherBankTransferType","NPSB"),e("#otherBankName").val(""),e("#bankInfo").hide(),e("#otherBankToBeneShortNotesDiv").hide(),e("#otherOneOffRTGSShortNotesDiv").hide(),e("#otherOneOffBEFTNShortNotesDiv").hide();var r=e.parseJSON(window.localStorage.getItem("shortNotesObj"));isNull(r.NPSBONEOFF)||(e("#otherBankToBeneShortNotesDiv").show(),e("#otherOneOffNPSBShortNotesDiv").show(),e("#otherOneOffNPSBShortNotesDiv").html(r.NPSBONEOFF)),e("#otherRoutingDistDiv").hide(),e("#OB_dist").html(""),e("#OB_routingNum").html(""),e("#otherbenebranch").attr("disabled",!0),e("#branchNullError").attr("disabled",!0),e("#otherbenebranch").val(""),e("#branchNullError").val(""),e("#OBOneOff_OtherRemarks").val(""),e("#otherRemaksNullError").html(""),e("#otheroneaccnumber").val(""),e("#OB_AccName").val("")}else if("beftn"==n){f.set("tenantServiceCode","BEFTN_OT"),f.set("otherBankTransferType","BEFTN"),f.set("otherBankTransferChannel","BEFTN"),e("#bankInfo").show(),e("#otherBankName").val(""),e("#otherBranchName").val(""),e("#otherRoutingDistDiv").hide(),e("#OB_dist").html(""),e("#OB_routingNum").html(""),e("#otherOneOffRTGSShortNotesDiv").hide(),e("#otherBankToBeneShortNotesDiv").hide(),e("#otherOneOffNPSBShortNotesDiv").hide();var r=e.parseJSON(window.localStorage.getItem("shortNotesObj"));isNull(r.BEFTNONEOFF)||(e("#otherBankToBeneShortNotesDiv").show(),e("#otherOneOffBEFTNShortNotesDiv").show(),e("#otherOneOffBEFTNShortNotesDiv").html(r.BEFTNONEOFF)),e("#otherbenebranch").attr("disabled",!1),e("#branchNullError").attr("disabled",!1),e("#OBOneOff_OtherRemarks").val(""),e("#otherRemaksNullError").html(""),e("#otheroneaccnumber").val(""),e("#OB_AccName").val(""),a.getBranchDetails(t)}else if("rtgs"==n){f.set("tenantServiceCode","RTGS_OT"),f.set("otherBankTransferType","RTGS"),f.set("otherBankTransferChannel","RTGS"),e("#bankInfo").show(),e("#otherBankName").val(""),e("#otherBranchName").val(""),e("#otherRoutingDistDiv").hide(),e("#OB_dist").html(""),e("#OB_routingNum").html(""),e("#otherBankToBeneShortNotesDiv").hide(),e("#otherOneOffNPSBShortNotesDiv").hide(),e("#otherOneOffBEFTNShortNotesDiv").hide();var r=e.parseJSON(window.localStorage.getItem("shortNotesObj"));isNull(r.RTGSONEOFF)||(e("#otherBankToBeneShortNotesDiv").show(),e("#otherOneOffRTGSShortNotesDiv").show(),e("#otherOneOffRTGSShortNotesDiv").html(r.RTGSONEOFF)),e("#otherbenebranch").attr("disabled",!1),e("#branchNullError").attr("disabled",!1),e("#OBOneOff_OtherRemarks").val(""),e("#otherRemaksNullError").html(""),e("#otheroneaccnumber").val(""),e("#OB_AccName").val(""),a.getBranchDetails(t)}a.populateFromAccounts(),a.getTransactionalLimit()},getBranchDetails:function(t){t.stopImmediatePropagation();var a=this;e("#otherbenebank").on("change",function(){a.getBeneBranchList(t)})},getBankCode:function(t){var a=e("#otherbenebank option:selected").html(),n=e("#otherbenebank option:selected").val();f.set("otherbenebank",a),f.set("otherbankCode",n)},getBeneBranchList:function(t){t.stopImmediatePropagation(),hideSpinner();var a=f.get("otherbenebank"),n=f.get("otherbankCode");f.set("otherbenebank",a),f.set("otherbankCode",n);var r=this;showSpinner();var i=function(e){hideSpinner(),r.populatePopup(t)},s=function(e){r.errorresponse()};showSpinner(),r.collection=new o([],{});getDeviceId();r.collection.fetch({data:e.param({newversion:"Y",access_token:f.get("access_token"),bankCode:f.get("otherbankCode"),transferchannnel:f.get("otherBankTransferType")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):s(e)},error:s})},populateBranchDropDown:function(t){t.stopImmediatePropagation();var a=getBranchListDTO();e("#otherbenebranch").empty();var n="<option value=''>Select Beneficiary Branch</option>";e.each(a,function(e,t){n+="<option value='"+t.branchCode+"'>"+t.branchName+"</option>"}),e("#otherbenebranch").append(n)},getRoutingNumberInfo:function(t){t.stopImmediatePropagation(),hideSpinner();var a=f.get("otherbenebranch"),n=f.get("otherbranchCode");f.set("otherbenebranch",a),f.set("otherbranchCode",n);var r=this;showSpinner();var o=function(t){hideSpinner();var a=f.get("domesticBankDTO"),n=a[0].routingNumber,r=a[0].bankDistrict;e("#otherRoutingDistDiv").show(),e("#OB_routingNum").html(n),e("#OB_dist").html(r)},s=function(e){r.errorresponse()};showSpinner(),r.collection=new i([],{});getDeviceId();r.collection.fetch({data:e.param({access_token:f.get("access_token"),bankCode:f.get("otherbankCode"),branchName:f.get("otherbranchCode")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?o(e):s(e)},error:s})},getAccountBalance:function(t){t.stopImmediatePropagation();var a=e("#otheronefromaccnum option:selected").attr("id");if(""==a)return e("#otheravailbalance").html(""),void e("#availBalDiv").hide();var n=e("#otheronefromaccnum option:selected").attr("Accownide");f.set("otherfromaccountID1",n);var r=e("#otheronefromaccnum option:selected").val();f.set("otherFromAccnumber",r);var o=e("#otheronefromaccnum option:selected").attr("owName");f.set("otherfromname",o);var i=e("#otheronefromaccnum option:selected").attr("curCode");f.set("otheronefromcurCode",i);var s=e("#otheronefromaccnum option:selected").attr("acctype");f.set("fromAccType",s);var l=this,h=function(t){hideSpinner(),e("#error_acc").html(""),e("#availBalDiv").show();var a,n,r=f.get("availableBalance"),o=parseFloat(r.slice(0,-2)),i=f.get("accountCurrency");"CASA"==s?(a=checkAmount(e.formatNumber(o,{format:"#,###.00",locale:"us"})),n=a+" "+i,f.set("fromAcntAvailBal",o)):"PC"==s&&(a=checkAmount(e.formatNumber(r,{format:"#,###.00",locale:"us"})),n=a+" "+i,f.set("fromAcntAvailBal",r)),e("#otheravailbalance").html(n);var i=e("#otheronefromaccnum option:selected").attr("curCode");"BDT"==i?f.set("fromCurr","BDT"):f.set("fromCurr",i)},m=function(e){l.errorresponse()};showSpinner(),l.collection=new c,l.collection.fetch({data:e.param({access_token:f.get("access_token"),accountId:n,accountType:s,beneficiaryInstructionId:null}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?h(e):m(e)},error:m})},getCurrencyList:function(){var t=this,a=function(e){hideSpinner(),t.populateCurrencyDropDown()},n=function(e){t.errorresponse()};showSpinner(),t.collection=new m,t.collection.fetch({data:e.param({access_token:f.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):n(e)},error:n})},populateCurrencyDropDown:function(){var t=f.get("currencyLists");e("#currency").empty();var a="",n=f.get("fromCurr");e.each(t,function(e,t){t.code==n&&(a+="<option value='"+t.code+"' selected>"+t.code+"</option>")}),e("#currency").append(a)},populateBDT:function(){e("#currency").empty();var t="";t+="<option value='BDT' selected>BDT</option>",e("#currency").append(t)},submitPay:function(t){t.stopImmediatePropagation(),e("#tandcErr").html(""),e("#transAmountError").html(""),e("#otherRemaksNullError").html(""),e("#branchNullError").html(""),e("#bankNullError").html(""),e("#accNameError").html(""),e("#accNumError").html("");var r=this,o=new RegExp("^[A-Za-z0-9]+$"),i=e("#otheroneaccnumber").val(),s=e("#OB_AccName").val(),c=new RegExp("^[0-9.,]+$"),l=new RegExp("^[A-Za-z0-9 ]+$"),h=e("#OBOneOff_OtherRemarks").val(),m=e("#otherpaymentAmount").val().replace(/,/g,""),u=e("input[name='other_onetime_transfer']:checked").val();f.set("alertType",u),f.set("toAccCurr","BDT"),this.model=new n({url:"json/"}),a.Validation.bind(this);var p=this.$("form").serializeObject();if(this.model.set(p,{validate:!0})){this.model.clear(),a.Validation.unbind(this);var d=e("#currency option:selected").val(),v=e("#termsand").prop("checked");if(!v)return void e("#tandcErr").html("Please check the Terms and Conditions");if(f.get("fromCurr")==d){var g=parseFloat(e("#otherpaymentAmount").val().replace(/,/g,"")),b=f.get("fromAcntAvailBal");if(g>b)return void e("#transAmountError").html(e.i18n.t("validation.transfer.nobal"))}if(!isNull(i)&&!o.test(i))return void e("#accNumError").html(e.i18n.t("validation.transfer.validaccount"));if(!isNull(m)&&!c.test(m))return void e("#transAmountError").html(e.i18n.t("validation.transfer.validamount"));if(!isNull(h)&&h.length>16)return void e("#otherRemaksNullError").html("The Remarks should contain maximum of 16 characters");if(!isNull(h)&&!l.test(h))return void e("#otherRemaksNullError").html(e.i18n.t("validation.managebene.remarksspecialchar"));if(!isNull(s)&&!l.test(s))return void e("#accNameError").html("Account Holder Name should contain only numbers and alphabets");var T=e("#otherBankName").val();if(isNull(T))return void e("#bankNullError").html(e.i18n.t("app.transfer.managebeneficiary.plbank"));if("BEFTN"==f.get("otherBankTransferType")||"RTGS"==f.get("otherBankTransferType")){var y=e("#otherBranchName").val();if(isNull(y))return void e("#branchNullError").html(e.i18n.t("app.transfer.managebeneficiary.plbranch"))}if("BEFTN"==f.get("otherBankTransferType")){var N=e("#OBOneOff_OtherRemarks").val();if(!isNull(N)){var k=N.charAt(0);N.charAt(N.length-1);if(0==N)return void e("#otherRemaksNullError").html("Invalid Remarks");if(/\s\s+$/.test(N))return void e("#otherRemaksNullError").html("Invalid Remarks");if(!k.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return void e("#otherRemaksNullError").html("Invalid Remarks");if(N.match(/\s\s/g))return void e("#otherRemaksNullError").html("Invalid Remarks");for(var B=!1,O=0;O<N.length;O++)if(0==N[O]){for(var S=N.length,A=0,O=0;S>O;O++)0==N[O]&&A++;A==S&&(B=!0)}if(B)return isError=!0,void e("#otherRemaksNullError").html("Invalid Remarks")}}if("BDT"==f.get("fromCurr")&&"BDT"==f.get("toAccCurr")){var C=parseFloat(f.get("dailyAvailableLimit")),w=parseFloat(f.get("minAmountPerTransaction")),D=parseFloat(f.get("maxAmountPerTransaction")),P=f.get("dailyAvailableCount"),E=f.get("monthlyAvailableCount"),g=parseFloat(e("#otherpaymentAmount").val().replace(/,/g,""));if(w>g)return e("#transAmountError").html(e.i18n.t("validation.sadad.amtgreaterthanminamt")),!1;if(g>C)return void e("#transAmountError").html(e.i18n.t("validation.transfer.notra"));if(g>D)return void e("#transAmountError").html(e.i18n.t("validation.sadad.amtlessthanmaxamt"));if("0"==P)return void e("#transAmountError").html("You have exceeded your daily transaction count.");if("0"==E)return void e("#transAmountError").html("Transaction count exceeded Monthly Available Count.")}var N=e("#otherpurposetransferdiv option:selected").val();if("true"==f.get("authModeFlag"))return;r.beneconfrom(t)}else this.$(".has-error").fadeIn(),t.preventDefault()},loadTobeneUi:function(e){e.stopImmediatePropagation(),a.history.navigate("#/otherbankselectbeneficiary")},beneconfrom:function(t){t.stopImmediatePropagation(),e("#routingnum_err").html("");var a=e("input[name='payaccard']:checked").val();f.set("paymentType12",a);var n=e("#otherpurposetransferdiv option:selected").html();f.set("otheronetimetransferreason",n);var r=e("#otherpaymentAmount").val().replace(/,/g,"");f.set("Paymentamount",r);var o=e("#otheronefromaccnum option:selected").attr("id");f.set("otherfromAcntIndex",o);var i=e("#otheronefromaccnum").val();f.set("otheraccno",i);var s=e("#otheroneaccnumber").val();f.set("Toaccno",s);var c=(e("#otherpurposetransferdiv option:selected").html(),e.trim(e("#OBOneOff_OtherRemarks").val()));f.set("otherownpurposetransferdiv",c);var l=e("#OB_AccName").val();f.set("othertoacc_name",l);var h=e("#currency option:selected").val();f.set("transCurr",h);var m=e("#OB_routingNum").html();f.set("OB_routingNum",m);var u=e("#OB_dist").html();f.set("OB_dist",u);var p=f.get("otherbenebank");f.set("otherbenebank",p);var d=f.get("otherbenebranch");"NPSB"==f.get("otherBankTransferType")?f.set("otherBeneBranch",""):f.set("otherBeneBranch",d);var v=f.get("fromAccType");"CASA"==v&&"account"==a?f.set("otherOneTimeTransferType","A2A"):"CASA"==v&&"creditcard"==a?f.set("otherOneTimeTransferType","A2C"):"PC"==v&&"creditcard"==a?f.set("otherOneTimeTransferType","P2C"):"PC"==v&&"account"==a&&f.set("otherOneTimeTransferType","P2A");var g=(new Date).getTime();f.set("salttime",g);var b=f.get("Toaccno");if("account"==a)f.set("beneAccType","CASA"),f.set("accnum",b);else if("creditcard"==a){var T=EncryptWithDynamicSalt(b,g);f.set("accnum",T),f.set("beneAccType","CC")}var y=this;y.gotoVerifyPage(t)},gotoVerifyPage:function(t){t.stopImmediatePropagation(),e("#transAmountError").html("");var n=this,r=new Date,o=r.getDate(),i=r.getMonth()+1,s=r.getFullYear(),c=(new Date(s,i,o),("00"+o.toString()).slice(-2)+"/"+("00"+i.toString()).slice(-2)+"/"+("0000"+s.toString()).slice(-4));f.set("payDate",c);var l=function(t){if("BDT"!==f.get("fromCurr")||"BDT"!==f.get("toAccCurr")){hideSpinner();var n=parseFloat(f.get("dailyAvailableLimit")),r=parseFloat(f.get("minAmountPerTransaction")),o=parseFloat(f.get("maxAmountPerTransaction")),i=parseFloat(f.get("paymentAmount"));if(r>i)return e("#transAmountError").html(e.i18n.t("validation.sadad.amtgreaterthanminamt")),!1;if(i>n)return void e("#transAmountError").html(e.i18n.t("validation.transfer.notra"));if(i>o)return void e("#transAmountError").html(e.i18n.t("validation.sadad.amtlessthanmaxamt"));f.set("beneSuccessFlag","true"),a.history.navigate("#/otherbankonetimepayverify")}else hideSpinner(),f.set("beneSuccessFlag","true"),a.history.navigate("#/otherbankonetimepayverify")},m=function(e){n.errorresponse()};showSpinner(),n.collection=new h([],{}),n.collection.fetch({data:e.param({access_token:f.get("access_token"),fromaccountId:f.get("otherfromaccountID1"),paydate:f.get("payDate"),transtype:"PAYNOW",validtype:"Validation",beneAcctType:f.get("beneAccType"),currSelection:"F",transcurrency:f.get("transCurr"),toaccountId:f.get("accnum"),remarks:f.get("otherownpurposetransferdiv"),trnasfertype:f.get("otherOneTimeTransferType"),transamount:f.get("Paymentamount"),uniqueId:null,globalId:null,totalDebitAmount:f.get("Paymentamount"),onetimepay:"TRUE",benetype:"DOMESTIC",frmAcctName:f.get("accountTitle"),paymenttype:f.get("otherBankTransferType"),benebankname:f.get("otherbenebank"),benebankcode:f.get("otherbankCode"),benebranchname:f.get("otherBeneBranch"),beneifsccode:f.get("OB_routingNum"),benename:f.get("othertoacc_name"),limitId:f.get("id"),salt:f.get("salttime")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?l(e):m(e)},error:m})},loadviewBeneficiaryUI:function(){a.history.navigate("#/otherbankonetimepay")},errorresponse:function(){hideSpinner(),openErrorPopup()},otherBankOneTimeOpenTandCPopup:function(e){e.stopImmediatePropagation(),"NPSB"==f.get("otherBankTransferType")?f.set("tandctype","npsboneoff"):"BEFTN"==f.get("otherBankTransferType")?f.set("tandctype","beftnoneoff"):"RTGS"==f.get("otherBankTransferType")&&f.set("tandctype","rtgsoneoff"),openTermsAndConditionsPopup()},disposeView:function(e){return a.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return v});