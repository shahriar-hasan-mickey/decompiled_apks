define(["jquery","underscore","Backbone","routers/wealthrouter","routers/transferrouter","collections/manageBeneficiaries/getBeneficiariesCollection","text!views/transfer/mobileWallet/walletTransferToBeneSelect.tpl","views/errors/exception"],function(e,t,a,n,r,l,i,s){var o=new EncryptedLocalStorage("secret"),c=a.View.extend({el:"#container",events:{"click #walletTransferSelectNextBtn":"gotoWalletTransferInitiatePage","click #walletTransferAddBeneBtn":"gotoAddWalletBeneficiaryPage","click #walletOneTimePay":"gotoOneTimePayInitPage","keyup #wallet_transfer_search_box":"filterWalletTransferList","click #wallet_transfer_edit_bene_btn":"gotoWalletEditBenePage"},initialize:function(){new n,new r;o.set("thisInputId",null),o.set("formDatasInEls",null),o.set("accountBalance",null)},render:function(){var t,n=this,r=function(e){o.set("downtimeTransType","WALLET");var t=o.get("downtimeNotification");if(!isNull(t)&&t.length>0){var r=t[0].subTransactionType;o.set("subTransType",r),"BOTH"==r?(hideSpinner(),a.history.navigate("#/downtimeboth")):"REGISTERED"==r?(o.set("selectedFromAccountValue",""),o.set("oneTimeFromAccId",""),o.set("fromAccInd",""),o.set("fromAccType",""),o.set("oneTimeFromAccCurr",""),a.history.navigate("#/walletonetimepayinit")):"ONE-OFF"==r&&(hideSpinner(),n.loadTemplate())}else hideSpinner(),n.loadTemplate()},i=function(e){n.errorresponse()},s=o.get("walletType").toUpperCase();t="OK WALLET"==s?"OKWALLET":o.get("walletType").toUpperCase(),showSpinner(),n.collection=new l,n.collection.fetch({data:e.param({access_token:o.get("access_token"),trSubTypeId:"MW",benetype:"T",serviceCode:t}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):i(e)},error:i})},loadTemplate:function(){e("html").removeClass().addClass("app");var a=o.get("mobileWalletInsttructionList"),n=a.filter(function(e){return e.imAccountType.toUpperCase()==o.get("walletType").toUpperCase()});o.set("selectedWalletBeneDTO",n),this.$el.html(t.template(i));var r=o.get("downtimeNotification");if(!isNull(r)&&r.length>0){var l="";r[0].downtimeNotificationDetail;e.each(r,function(e,t){if("ONE-OFF"==t.subTransactionType){var a=t.downtimeNotificationDetail,n=a[e].messageMobile;isNull(n)||(l+="<p>"+n+"</p>")}}),e("#notificationMessage").html(e.parseHTML(l))}var s=e("#wallet_transfer_add_btn_div").find("span").attr("id");enableScroll(s);var c,d="";e('input[type="checkbox"]').change(function(t){var a=t.currentTarget.id;c=e(t.currentTarget).attr("id"),isNull(d)||d==a||(e("#"+d).prop("checked",!1),e("#wallet_transfer_btn_div_"+d).hide()),d=a;var n=e('input[type="checkbox"]:checked').length;0==n?(e("#wallet_transfer_btn_div_"+c).hide(),e("#wallet_transfer_add_btn_div").show()):(e("#wallet_transfer_btn_div_"+c).show(),e("#wallet_transfer_add_btn_div").show())})},filterWalletTransferList:function(t){t.stopImmediatePropagation();jQuery.expr[":"].contains=function(e,t,a){return jQuery(e).text().toUpperCase().indexOf(a[3].toUpperCase())>=0};var a=t.target.value;a.length>0?(e(".search_clear").is(":visible")||(e(".search_clear").show(),e(".search_clear").on("click",function(){e("#wallet_transfer_search_box").val(""),e(".walletTransferItems").show(),e("#wallet_transfer_search_box").focus(),e(".search_clear").hide(),e(".nodata").hide()})),e(".walletTransferItems").hide(),e('.walletTransferItems:contains("'+a+'")').length>0?(e(".nodata").hide(),e('.walletTransferItems:contains("'+a+'")').show()):e(".nodata").show()):(e(".search_clear").hide(),e(".nodata").hide(),e(".walletTransferItems").show())},gotoWalletEditBenePage:function(t){t.stopImmediatePropagation(),o.set("isTransferPageFlag","true"),o.set("isWalletTransferSelectBenePage","true");var n=e("input[name='walletBene']:checked").attr("id");o.set("selectedWalletBeneInd",n);var r=e("input[name='walletBene']:checked").val();o.set("selectedWalletBeneId",r);var l=e("input[name='walletBene']:checked").attr("shortName");o.set("selectedWalletBeneShortName",l);var i=e("input[name='walletBene']:checked").attr("accNum");o.set("selectedWalletBeneAccNum",i),a.history.navigate("#/editwalletbene")},gotoOneTimePayInitPage:function(e){e.stopImmediatePropagation(),o.set("selectedFromAccountValue",""),o.set("oneTimeFromAccId",""),o.set("fromAccInd",""),o.set("fromAccType",""),o.set("oneTimeFromAccCurr",""),a.history.navigate("#/walletonetimepayinit")},gotoAddWalletBeneficiaryPage:function(e){e.stopImmediatePropagation(),o.set("isTransfer","true"),o.set("isWalletOneOffSuccess","false"),o.set("walletToAccNum",null),o.set("thisInputId",null),o.set("formDatasInEls",null),o.set("isWalletTransferSelectBenePage","true"),a.history.navigate("#/addwalletbene")},gotoWalletTransferInitiatePage:function(t){t.stopImmediatePropagation(),o.set("isManageBene","false");var n=e("input[name='walletBene']:checked"),r=e(n).val();o.set("selectedWalletTransferBeneId",r);var l=e(n).attr("id");o.set("selectedWalletTransferBeneInd",l);var i=e(n).attr("data");o.set("selectedWalletTransferbeneInstId",i),a.history.navigate("#/wallettobeneinit")},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return a.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return c});