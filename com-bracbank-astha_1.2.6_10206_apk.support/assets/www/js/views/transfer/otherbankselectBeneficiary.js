define(["jquery","underscore","Backbone","collections/manageBeneficiaries/getBeneficiaryListCollections","text!views/transfer/otherbankselectBeneficiary.tpl"],function(e,t,n,o,r){var a=new EncryptedLocalStorage("secret"),i=n.View.extend({el:"#container",events:{"click #nextBtn":"gotoOtherBankToBeneInitTransfer","click #addBene":"addviewUI","keyup #other_transfer_search_box":"filterOtherTransferList","click #other_transfer_edit_bene_btn":"gotoOtherBankEditBenePage"},initialize:function(){},update:function(){var t=this,r=function(o){hideSpinner(),e("body").removeClass("loginbg"),e("html").removeClass().addClass("app"),a.set("downtimeTransType","OTHERBANK");var r=a.get("downtimeNotification");a.set("isNPSBBothDown","N"),a.set("isBEFTBothNDown","N"),a.set("isRTGSBothDown","N"),!isNull(r)&&r.length>0?(e.each(r,function(e,t){if("NPSB"==t.code&&"BOTH"==t.subTransactionType){var n="Y",o=a.get("isBEFTBothNDown"),r=a.get("isRTGSBothDown");a.set("isNPSBBothDown",n),a.set("isBEFTBothNDown",o),a.set("isRTGSBothDown",r)}if("BEFTN"==t.code&&"BOTH"==t.subTransactionType){var n=a.get("isNPSBBothDown"),o="Y",r=a.get("isRTGSBothDown");a.set("isNPSBBothDown",n),a.set("isBEFTBothNDown",o),a.set("isRTGSBothDown",r)}if("RTGS"==t.code&&"BOTH"==t.subTransactionType){var n=a.get("isNPSBBothDown"),o=a.get("isBEFTBothNDown"),r="Y";a.set("isNPSBBothDown",n),a.set("isBEFTBothNDown",o),a.set("isRTGSBothDown",r)}}),"Y"==a.get("isNPSBBothDown")&&"Y"==a.get("isBEFTBothNDown")&&"Y"==a.get("isRTGSBothDown")?(hideSpinner(),n.history.navigate("#/downtimeboth")):(hideSpinner(),t.loadTemplate())):(hideSpinner(),t.loadTemplate())},i=function(e){t.errorresponse()};showSpinner(),t.collection=new o,t.collection.fetch({data:e.param({access_token:a.get("access_token"),trSubTypeId:"Other",benetype:"T",serviceCode:"OTHERBANK"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):i(e)},error:i})},addviewUI:function(e){a.set("isTransfer","true"),a.set("isOtherOneOffSuccess","false"),e.stopImmediatePropagation(),n.history.navigate("#/otherbankaddbene")},loadTemplate:function(){e("html").removeClass().addClass("app"),this.$el.html(t.template(r)),a.set("isNPSBOnlyDown","N");var n=e("#other_transfer_add_btn_div").find("span").attr("id");enableScroll(n);var o,i="";e('input[type="checkbox"]').change(function(t){var n=t.currentTarget.id;o=e(t.currentTarget).attr("id"),isNull(i)||i==n||(e("#"+i).prop("checked",!1),e("#other_transfer_btn_div_"+i).hide()),i=n;var r=e('input[type="checkbox"]:checked').length;0==r?(e("#other_transfer_btn_div_"+o).hide(),e("#other_transfer_add_btn_div").show()):(e("#other_transfer_btn_div_"+o).show(),e("#other_transfer_add_btn_div").show())})},filterOtherTransferList:function(t){t.stopImmediatePropagation();jQuery.expr[":"].contains=function(e,t,n){return jQuery(e).text().toUpperCase().indexOf(n[3].toUpperCase())>=0};var n=t.target.value;n.length>0?(e(".search_clear").is(":visible")||(e(".search_clear").show(),e(".search_clear").on("click",function(){e("#other_transfer_search_box").val(""),e(".otherTransferItems").show(),e("#other_transfer_search_box").focus(),e(".search_clear").hide(),e(".nodata").hide()})),e(".otherTransferItems").hide(),e('.otherTransferItems:contains("'+n+'")').length>0?(e(".nodata").hide(),e('.otherTransferItems:contains("'+n+'")').show()):e(".nodata").show()):(e(".search_clear").hide(),e(".nodata").hide(),e(".otherTransferItems").show())},gotoOtherBankEditBenePage:function(t){t.stopImmediatePropagation(),a.set("isTransferPageFlag","true");var o=e("input[name='other_to_bene']:checked").attr("id");a.set("selectedIndex",o);var r=e("input[name='other_to_bene']:checked").attr("dataId");a.set("selectedId",r);var i=e("input[name='other_to_bene']:checked").attr("shortName");a.set("deletedBene",i);var s=e("input[name='other_to_bene']:checked").val();a.set("deletebeneaccnum",s),n.history.navigate("#/otherbankeditbene")},gotoOtherBankToBeneInitTransfer:function(t){t.stopImmediatePropagation(),a.set("isManageBene","false");var o=e("input[name='other_to_bene']:checked"),r=a.get("localBeneficiaryBeneficiaryInstructionDTOList"),i=e(o).attr("beneChannel");if("NPSB"==i){var s=a.get("downtimeNotification");e.each(s,function(e,t){"NPSB"!=t.code||"REGISTERED"!=t.subTransactionType&&"BOTH"!=t.subTransactionType||a.set("isNPSBOnlyDown","Y")})}else a.set("isNPSBOnlyDown","N");if("Y"==a.get("isNPSBOnlyDown"))return void n.history.navigate("#/downtimeboth");var c=e(o).attr("value");a.set("selectedAccount",c);var h=e(o).attr("data");a.set("selectBeneId",h);var d=e(o).attr("id");a.set("selectedBeneInd",d);var l=r[d].imAccountType;a.set("paymentTypeTo",l),n.history.navigate("#/otherbanktobeneficiary")},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return n.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return i});