define(["jquery","underscore","Backbone","collections/transfer/getTransactionLimitCollections","collections/bills/cardSummaryCollections","collections/transfer/getAccountBalanceCollections","collections/transfer/getCCAccountBalanceCollections","collections/transfer/ownAccountTransferCollections","collections/transfer/currencyListsCollections","collections/transfer/getAuthModeCollections","collections/transfer/bKashValidationCollections","models/validation/transfer/ownAccountTransferrepeatValidationModel","text!views/transfer/transfertodetail.tpl"],function(t,e,a,n,r,o,c,s,i,l,m,u,p){isValidAccount=!1;var d=new EncryptedLocalStorage("secret"),h=a.View.extend({el:"#container",events:{"click #OwnCard_Init_TransferBtn":"submitPay","click #transactionbtn":"transactionbtn","click #OwnCard_Init_CancelBtn":"cancelTransfer","click #OwnCard_PayNow":"paynowshow","click #OwnCard_PayLater":"paylatershow","click #OwnCard_Init_BackBtn":"transferbackbtn","change #OwnCard_PaymentType":"gotopaymenttype","click #OwnCard_FromAccNum":"openFromAccDropdown","click .oc_acccardnumtype":"getFromAccountInfo","click #ownCardTandCPopup":"ownCardOpenTandCPopup"},initialize:function(){},update:function(){var e=this;showSpinner();var a=function(t){hideSpinner(),e.getCardSummary()};e.collection=new c;var n=function(t){e.errorresponse()};e.collection.fetch({data:t.param({access_token:d.get("access_token"),accountId:d.get("toAccountId"),accountType:"CC",beneficiaryInstructionId:null}),dataType:"json",type:"POST",cache:!1,success:function(t){a("0000"==ackStatus?t:t)},error:n})},getprepaidview:function(){var e=this;if("false"==d.get("isPrepaidCardData")){var a=function(t){hideSpinner(),d.set("isPrepaidCardData","true"),e.getpaymenttypeview()},n=function(t){e.errorresponse()};showSpinner(),e.collection=new prepaidcardCollections([],{});getDeviceId();e.collection.fetch({data:t.param({newversion:"Y",access_token:d.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?a(t):n(t)},error:n})}else hideSpinner(),e.getpaymenttypeview()},getCardSummary:function(){var e=this;if("false"==d.get("isWalletCCPCData")){var a=function(t){hideSpinner(),e.getpaymenttypeview(),d.set("isWalletCCPCData","true")},n=function(t){e.errorresponse()};showSpinner(),e.collection=new r([],{});getDeviceId();e.collection.fetch({data:t.param({newversion:"Y",paytype:"WALLET",ctrycode:"BD",currcode:"BDT",access_token:d.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?a(t):n(t)},error:n})}else hideSpinner(),e.getpaymenttypeview()},getpaymenttypeview:function(){var e=this,a=function(t){hideSpinner(),e.loadTemplate()},r=function(t){e.errorresponse()};showSpinner(),e.collection=new n,e.collection.fetch({data:t.param({access_token:d.get("access_token"),payeeType:"OA"}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?a(t):r(t)},error:r})},loadTemplate:function(){var a=this;d.set("alertType",null),t("html").removeClass().addClass("app"),this.$el.html(e.template(p)),d.set("fromAcntId",""),d.set("fromAccountIndex",""),d.set("fromAcctype",""),d.set("fromAccNumber",""),d.set("fromAccCurr",""),d.set("fromAccName",""),d.set("ccPayFromAcc",""),t("#ownCardShortNotesUIDiv").hide(),a.populateTransactionLimitPopup();var n=t.parseJSON(window.localStorage.getItem("shortNotesObj"));isNull(n.OWNCARD)||(t("#ownCardShortNotesUIDiv").show(),t("#ownCardShortNotesDiv").html(n.OWNCARD)),t("#availBalDiv").hide(),t("#payLater").hide(),t("#repeat").hide(),t("#paymentAmount").val(d.get("minAmountDue")),t("#paymentAmount").attr("disabled",!0),t("#othersDiv").hide();var r="",o=getAccountDTO(),c=getPrepaidCardDTO(),s="",i="";s=o.filter(function(t){return"Y"==t.cardpymtflag}),i=c.filter(function(t){return""!=t.merchantType&&"Y"==t.cardpymtflag}),r=s.concat(i);var l=r[0].id;d.set("fromAcntId",l);var m;m=isNull(s)?isNull(s)&&!isNull(i)?"PC":"bKash":"CASA",d.set("fromAcctype",m);var u=r[0].accountNumber;d.set("fromAccNumber",u);var h=r[0].currencyCode;d.set("fromAccCurr",h);var f;f=isNull(s)?isNull(s)&&!isNull(i)?r[0].cardHolderName:"bKash":r[0].productName,d.set("fromAccName",f),a.getAccountBalanceview();var v='<div class="qr_acc_outer">\n <ul class="list-unstyled m0">\n <li class="list-group-item">\n <div class="col-xs-2 first-col">\n<span class="menu_icon account"></span>\n</div>\n <div class="col-xs-10">\n<p class="acc_txt"> '+r[0].accountShortName+'</p>\n<p class="acc_cat"> <span class="selectAccNumber"> '+r[0].accountNumber+" </span></p>\n</div>\n </li>\n </ul>\n </div>";t("#seltpayval").html(v),t('li.oc_acccardnumtype[accide="'+l+'"]').find("input").attr("checked","checked"),a.populateBDT(event),isNull(d.get("minAmountDue"))||0==d.get("minAmountDue")||a.getOwnCardAuthMode()},gotopaymenttype:function(e){e.stopImmediatePropagation();var a=this;t("#transAmountError").html("");var n=t("#OwnCard_PaymentType option:selected").val();return""==n?void t("#paymentAmount").val(""):("miniamt"==n?(d.set("paymentType","miniamt"),t("#paymentAmount").val(d.get("minAmountDue")),t("#paymentAmount").attr("disabled",!0),d.set("paymentAmount",d.get("minAmountDue"))):"statmetbal"==n?(d.set("paymentType","statmetbal"),t("#paymentAmount").val(d.get("statementBalance")),t("#paymentAmount").attr("disabled",!0),d.set("paymentAmount",d.get("statementBalance"))):"curoutstanding"==n?(d.set("paymentType","curoutstanding"),t("#paymentAmount").val(d.get("totalOutstandingAmount")),t("#paymentAmount").attr("disabled",!0),d.set("paymentAmount",d.get("totalOutstandingAmount"))):"otheramt"==n&&(d.set("paymentType","otheramt"),t("#paymentAmount").val(""),t("#paymentAmount").attr("disabled",!1),d.set("paymentAmount",paymentAmount)),void("otheramt"==n?(t("#OC_AuthModeDiv").html(""),"bKash"!=d.get("ccPayFromAcc")&&a.invokeAuthMode(e)):"bKash"!=d.get("ccPayFromAcc")&&a.getOwnCardAuthMode(e)))},invokeAuthMode:function(e){e.stopImmediatePropagation();var a=this;t("#paymentAmount").blur(function(e){e.stopImmediatePropagation();var n=t("#paymentAmount").val().replace(/,/g,"");isNull(n)||0==n||a.getOwnCardAuthMode(e)})},getOwnCardAuthMode:function(e){var n=this;if("object"==typeof e&&e.stopImmediatePropagation(),t("#error_acc").html(""),"bKash"!=d.get("ccPayFromAcc")){var r=t("#paymentAmount").val().replace(/,/g,"");d.set("IsAuthMode","false"),d.set("authModeFlag","false"),this.model=new u({url:"json/"}),a.Validation.bind(this);var o=this.$("form").serializeObject();this.model.set(o,{validate:!0})?(this.model.clear(),a.Validation.unbind(this)):this.$(".has-error").fadeIn();var c=new RegExp("^[0-9.,]+$");t("#OC_AuthModeDiv").html(""),t("#transAmountError").html(""),t("#error_acc").html("");var s=d.get("fromAcntId");if(isNull(s))return void t("#error_acc").html("Please select a From Account/Wallet");if(d.set("transferType","OwnCard"),!isNull(r)&&0!=r){if(!isNull(r)&&!c.test(r))return void t("#transAmountError").html(t.i18n.t("validation.transfer.validamount"));var r=parseFloat(t("#paymentAmount").val().replace(/,/g,"")),i=parseFloat(d.get("minAmountPerTransaction")),m=parseFloat(d.get("maxAmountPerTransaction"));if(i>r)return void t("#transAmountError").html(t.i18n.t("validation.sadad.amtgreaterthanminamt"));if(r>m)return void t("#transAmountError").html(t.i18n.t("validation.sadad.amtlessthanmaxamt"));var p=function(t){hideSpinner();var a=d.get("securitySettingList");!isNull(a)&&a.length>0?d.set("IsAuthMode","true"):(d.set("alertType",null),d.set("IsAuthMode","false")),n.populateAuthMode(e),n.submitPay(e)},h=function(e){hideSpinner(),d.set("authModeFlag","true"),t("#paymentAmount").val(""),n.errorresponse()};showSpinner(),n.collection=new l,n.collection.fetch({data:t.param({access_token:d.get("access_token"),transactionAmount:r,tenantServiceCode:"O"}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?p(t):h(t)},error:h})}}},populateAuthMode:function(e){"object"==typeof e&&e.stopImmediatePropagation();var a="",n="",r=d.get("securitySettingList"),o="<label for='username'>"+t.i18n.t("app.transfer.managebeneficiary.selectauthorisationmode")+"</label>";o+="<div class='custRadio_pass'>",!isNull(r)&&r.length>0?(t("#OC_AuthModeDiv").html(""),t.each(r,function(e,r){"SMS"==r?(a="sms",n=t.i18n.t("app.transfer.managebeneficiary.sms")):"EMAIL"==r?(a="mail",n=t.i18n.t("app.transfer.managebeneficiary.mail")):"TOKEN"==r?(a="fScan",n=t.i18n.t("app.transfer.managebeneficiary.token")):"ESIGN"==r&&(a="esign",n=t.i18n.t("app.transfer.managebeneficiary.esign")),o+='<div class="box"><div class="radio"><label>',o+=0==e?'<input type="radio" name="ownCard_AuthMode" id="optionsRadios'+e+'" value="'+r+'" checked>':'<input type="radio" name="ownCard_AuthMode" id="optionsRadios'+e+'" value="'+r+'">',o+='<div class="row bg"><div class="col-xs-12 p0"><span class="menu_icon ico-xs '+a+'"></span><span class="small">'+n+"</span></div></div></label></div></div>"}),t("#OC_AuthModeDiv").html(o)):t("#OC_AuthModeDiv").html("")},populateTransactionLimitPopup:function(e){"object"==typeof e&&e.stopImmediatePropagation(),t("#transactionLimitPopup").html("");var a=d.get("minAmountPerTransaction"),n=d.get("dailyAvailableLimit"),r=(d.get("monthlyTransactionLimit"),d.get("maxAmountPerTransaction")),o=d.get("dailyAvailableCount"),c=(d.get("dailyTransactionCount"),d.get("monthlyAvailableLimit")),s=d.get("monthlyAvailableCount"),i="";i+='<div class="modal fade modernPOP" id="TransactionLimit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><form method="post"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">'+t.i18n.t("app.transferss.translimit")+'</h4></div><div class="modal-body"><p class="text-center"><span class="ico-badge center-block"><span class="menu_icon ico-3x translimit"></span></span></p><div class="row"><div class="col-xs-12"><div class="row"><div class="col-xs-6"><p><span class="small">'+t.i18n.t("app.transferss.minimumamount")+'</span><br><span class="amt small">'+checkAmount(t.formatNumber(a,{format:"#,###.00",locale:"us"}))+'<span class="cur">'+t.i18n.t("app.transferss.bdt")+'</span></span></p></div><div class="col-xs-6"><p><span class="small">'+t.i18n.t("app.transferss.dailylimit")+'</span><br><span class="amt small">'+checkAmount(t.formatNumber(n,{format:"#,###.00",locale:"us"}))+'<span class="cur">'+t.i18n.t("app.transferss.bdt")+'</span></span></p></div></div></div><div class="col-xs-12"><div class="row"><div class="col-xs-6"><p><span class="small">'+t.i18n.t("app.transferss.pertransactionlimit")+'</span><br><span class="amt small">'+checkAmount(t.formatNumber(r,{format:"#,###.00",locale:"us"}))+'<span class="cur">'+t.i18n.t("app.transferss.bdt")+'</span></span></p></div><div class="col-xs-6"><p><span class="small">'+t.i18n.t("app.transferss.availabletransfercount")+'</span><br><span class="amt small">'+o+'</span></p></div></div></div><div class="col-xs-12"><div class="row"><div class="col-xs-6"><p><span class="small">'+t.i18n.t("app.transferss.monthavalimit")+'</span><br><span class="amt small">'+checkAmount(t.formatNumber(c,{format:"#,###.00",locale:"us"}))+'<span class="cur">'+t.i18n.t("app.transferss.bdt")+'</span></span></p></div><div class="col-xs-6"><p><span class="small">'+t.i18n.t("app.transferss.monthavalcount")+'</span><br><span class="amt small">'+s+"</span></p></div></div></div></div></div></div></form></div></div>",t("#transactionLimitPopup").html(i)},getbKashPullMoneyLimits:function(e){"object"==typeof e&&e.stopImmediatePropagation();var a=this,r=function(t){hideSpinner(),a.populateTransactionLimitPopup(e)},o=function(t){a.errorresponse()};showSpinner(),a.collection=new n,a.collection.fetch({data:t.param({access_token:d.get("access_token"),payeeType:"WALLET_BKASH_PULL_MONEY"}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?r(t):o(t)},error:o})},getFromAccountInfo:function(e){"object"==typeof e&&(e.preventDefault(),e.stopImmediatePropagation()),d.set("isFromDropdownSelect","true");var a=this,n=t(e.target).closest("li.oc_acccardnumtype").attr("Accide");d.set("fromAcntId",n);var r=t(e.target).closest("li.oc_acccardnumtype").attr("id");d.set("fromAccountIndex",r);var o=t(e.target).closest("li.oc_acccardnumtype").attr("acctype");d.set("fromAcctype",o);var c=t(e.target).closest("li.oc_acccardnumtype").attr("accNum");d.set("fromAccNumber",c);var s=t(e.target).closest("li.oc_acccardnumtype").attr("data");d.set("fromAccCurr",s);var i=t(e.target).closest("li.oc_acccardnumtype").attr("frName");d.set("fromAccName",i),"bKash"==n?d.set("ccPayFromAcc","bKash"):d.set("ccPayFromAcc",""),a.getAccountBalanceview(e),t('li.oc_acccardnumtype[accide="'+n+'"]').find("input").attr("checked","checked");var l=t(e.target).closest("li.oc_acccardnumtype").find(".row").clone().html(),m='<div class="qr_acc_outer">\n <ul class="list-unstyled m0">\n <li class="list-group-item">\n'+l+"</li>\n </ul>\n </div>";t("#bkashseltpayval").html(m),t("#OC_card_account .close").trigger("click")},getAccountBalanceview:function(e){"object"==typeof e&&(e.preventDefault(),e.stopImmediatePropagation()),t("#error_acc").html("");var a=d.get("fromAcntId");if((""==a||"bKash"==a)&&(t("#availbal").html(""),t("#availBalDiv").hide()),"bKash"==a){var n=d.get("fromAcntId");t('li.oc_acccardnumtype[accide="'+n+'"]').find("input").attr("checked","checked");var r=t(e.target).closest("li.oc_acccardnumtype").find(".row").clone().html(),c='<div class="qr_acc_outer">\n <ul class="list-unstyled m0">\n <li class="list-group-item">\n'+r+"</li>\n </ul>\n </div>";return t("#seltpayval").html(c),void t("#OC_card_account .close").trigger("click")}var s=d.get("fromAcctype");"PC"==s?d.set("typeOfTransfer","PC"):"CASA"==s&&d.set("typeOfTransfer","CASA");var i=this,l=function(a){hideSpinner(),t("#error_acc").html(""),t("#availBalDiv").show(),isValidAccount=!1;var n,r,o=d.get("availableBalance"),c=parseFloat(o.slice(0,-2)),l=d.get("accountCurrency");"CASA"==s?(n=checkAmount(t.formatNumber(c,{format:"#,###.00",locale:"us"})),r=n+" "+l,d.set("fromAcntAvailBal",c)):"PC"==s&&(n=checkAmount(t.formatNumber(o,{format:"#,###.00",locale:"us"})),r=n+" "+l,d.set("fromAcntAvailBal",o)),t("#availbal").html(r);var m=d.get("fromAcntId");t('li.oc_acccardnumtype[accide="'+m+'"]').find("input").attr("checked","checked");var u=t(e.target).closest("li.oc_acccardnumtype").find(".row").clone().html(),p='<div class="qr_acc_outer">\n <ul class="list-unstyled m0">\n <li class="list-group-item">\n'+u+"</li>\n </ul>\n </div>";t("#seltpayval").html(p),t("#OC_card_account .close").trigger("click");var l=d.get("fromAccCurr");d.get("toCardCurr");"BDT"==l?(i.populateBDT(e),d.set("fromAccCurr","BDT")):(i.getCurrencyList(e),d.set("fromAccCurr",l))},m=function(t){isValidAccount=!0,i.errorresponse()};showSpinner(),i.collection=new o,d.set("fromAcntNumber",a),i.collection.fetch({data:t.param({access_token:d.get("access_token"),accountId:d.get("fromAcntNumber"),accountType:s,beneficiaryInstructionId:null}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?l(t):m(t)},error:m})},getCurrencyList:function(e){"object"==typeof e&&e.stopImmediatePropagation();var a=this,n=function(t){hideSpinner(),a.populateCurrencyDropDown(e)},r=function(t){a.errorresponse()};showSpinner(),a.collection=new i,a.collection.fetch({data:t.param({access_token:d.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?n(t):r(t)},error:r})},populateCurrencyDropDown:function(e){e.stopImmediatePropagation();var a=d.get("currencyLists");t("#currency").empty();var n="",r=d.get("fromAccCurr");d.get("toCardCurr");t.each(a,function(t,e){e.code==r&&(n+="<option value='"+e.code+"' selected>"+e.code+"</option>")}),t("#currency").append(n)},populateBDT:function(e){"object"==typeof e&&e.stopImmediatePropagation(),t("#currency").empty();var a="";a+="<option value='BDT' selected>BDT</option>",t("#currency").append(a)},submitPay:function(e){"object"==typeof e&&e.stopImmediatePropagation(),t("#tandcErr").html(""),t("#error_amount").html(""),t("#payDateError").html(""),t("#transAmountError").html(""),t("#otherRemaksNullError").html("");var n=new RegExp("^[0-9.,]+$"),r=t("#OC_OtherRemarks").val(),o=new RegExp("^[A-Za-z0-9 ]+$"),c=t("#paymentAmount").val().replace(/,/g,""),s=this;this.model=new u({url:"json/"}),a.Validation.bind(this);var i=this.$("form").serializeObject();if(this.model.set(i,{validate:!0})){this.model.clear(),a.Validation.unbind(this);var l=t("#currency option:selected").val(),m=t("#termsand").prop("checked");if(!m)return void t("#tandcErr").html("Please check the Terms and Conditions");if(!isNull(c)&&!n.test(c))return void t("#transAmountError").html(t.i18n.t("validation.transfer.validamount"));if("bKash"==d.get("ccPayFromAcc")){var p=d.get("totalOutstandingAmount");if(!isNull(c)&&c>p)return void t("#transAmountError").html("Transfer Amount should not be greater than Outstanding Amount")}if(!isNull(r)&&r.length>16)return void t("#otherRemaksNullError").html("The Remarks should contain maximum of 16 characters");if(!isNull(r)&&!o.test(r))return void t("#otherRemaksNullError").html(t.i18n.t("validation.managebene.remarksspecialchar"));if(d.get("fromAccCurr")==l){var h=parseFloat(t("#paymentAmount").val().replace(/,/g,"")),f=d.get("fromAcntAvailBal");if("bKash"!=d.get("ccPayFromAcc")&&h>f)return void t("#transAmountError").html(t.i18n.t("validation.transfer.nobal"))}if("BDT"==d.get("fromAccCurr")&&"BDT"==d.get("toCardCurr")){var h=parseFloat(t("#paymentAmount").val().replace(/,/g,"")),v=parseFloat(d.get("dailyAvailableLimit")),y=parseFloat(d.get("minAmountPerTransaction")),g=parseFloat(d.get("maxAmountPerTransaction")),A=d.get("dailyAvailableCount"),b=d.get("monthlyAvailableCount");if(y>h)return t("#transAmountError").html(t.i18n.t("validation.sadad.amtgreaterthanminamt")),!1;if(h>v)return void t("#transAmountError").html(t.i18n.t("validation.transfer.notra"));if(h>g)return t("#transAmountError").html(t.i18n.t("validation.sadad.amtlessthanmaxamt")),!1;if("0"==A)return void t("#transAmountError").html("You have exceeded your daily transaction count.");if("0"==b)return void t("#transAmountError").html("Transaction count exceeded Monthly Available Count.")}var C="paynow";"paynow"==C&&d.set("payType","PAYNOW");var w=new Date,P=w.getDate(),T=w.getMonth()+1,_=w.getFullYear(),S=new Date(_,T,P),k=("00"+P.toString()).slice(-2)+"/"+("00"+T.toString()).slice(-2)+"/"+("0000"+_.toString()).slice(-4);if(d.set("payDate",k),"paylater"==C){d.set("payType","LATER");var N=t("#payDate").val(),D=N.split("-"),I=D[2],O=D[1],E=D[0],F=new Date(I,O,E);if(""==N)return void t("#payDateError").html("Please enter the Payment Date");if(F.getTime()<S.getTime())return void t("#payDateError").html("Please select a date greater than the current date")}if(isValidAccount)return void t("#accountNoErr").html(t.i18n.t("app.transfer.managebeneficiary.withinaccounterror"));if("true"==d.get("authModeFlag"))return;s.beneconfrom(e)}else this.$(".has-error").fadeIn(),"object"==typeof e&&e.preventDefault()},gotobKashPullMoneyValidation:function(e){"object"==typeof e&&e.stopImmediatePropagation();var n=this;showSpinner();var n=this,r=d.get("toAcntInd"),o=d.get("creditCardAccountList"),c=o[r],s=c.accountNumber,i=s.split("-"),l=i[1].slice(0,2),u=i[0]+l+"******"+i[3];d.set("bKashSelectedCardNumber",u);var p=t("#paymentAmount").val().replace(/,/g,"");isNull(p)||0==p||d.set("bKashPullMoneytransferAmount",p);var h=function(t){hideSpinner(),d.set("beneSuccessFlag","true"),d.set("fromAccCurr","BDT"),a.history.navigate("#/transferconfrim")},f=function(t){hideSpinner(),n.errorresponse()};showSpinner(),n.collection=new m,n.collection.fetch({data:t.param({access_token:d.get("access_token"),creditAccountNumber:d.get("bKashSelectedCardNumber"),principalAmount:d.get("bKashPullMoneytransferAmount"),creditAccountId:d.get("toAccountId")}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?h(t):f(t)},error:f})},paynowshow:function(e){e.stopImmediatePropagation(),d.set("paynowtrans","Y"),d.set("payscheduletrans","N"),d.set("paylatertrans","N"),t("#payLater").hide(),t("#schPay").hide(),t("#payDateError").html(""),t("#pdate").val(""),t("#payDateError").html(""),t("#pdate").attr("disabled",!0),t("#payDateError").attr("disabled",!0),t("#error_amount").html(""),t("#payDateError").html(""),t("#transAmountError").html("")},paynow:function(t){t.stopImmediatePropagation();this.model=new withinAccountrepeatTransferValidationModel({url:"json/"}),a.Validation.bind(this);var e=this.$("form").serializeObject();this.model.set(e,{validate:!0})&&(this.model.clear(),a.Validation.unbind(this))},paylatershow:function(e){e.stopImmediatePropagation(),t("#payDate").val(""),d.set("paylatertrans","Y"),d.set("paynowtrans","N"),d.set("payscheduletrans","N");t("#payLater").show(),t("#schPay").hide(),t("#payLater").show(),t("#repeat").hide(),t("#pdate").attr("disabled",!1),t("#payDateError").attr("disabled",!1),t("#error_amount").html(""),t("#payDateError").html(""),t("#transAmountError").html("")},beneconfrom:function(e){e.stopImmediatePropagation();var a=(d.get("paynowtrans"),d.get("paylatertrans"),d.get("fromAccountIndex"));d.set("fromAccountIndex",a);var n=d.get("fromAcntId");d.set("fromAcntId",n);var r=d.get("fromAccName");d.set("fromAccName",r);var o=d.get("fromAccNumber");d.set("fromAccNumber",o);var c=d.get("fromAccCurr");d.set("fromAccCurr",c);var s=d.get("fromAcctype");d.set("fromAcctype",s),"CASA"==s?d.set("transferType","A2C"):"PC"==s&&d.set("transferType","P2C");var i=t("#paymentAmount").val().replace(/,/g,"");d.set("transferAmount",i);var l=t("#OC_OtherRemarks").val();d.set("purposetransfer",l);var m=t("input[name='ownCard_AuthMode']:checked").val();d.set("alertType",m);var u=t("#currency option:selected").val();d.set("transCurrency",u);var p=this;"bKash"==d.get("ccPayFromAcc")?p.gotobKashPullMoneyValidation(e):p.gotoVerifyPage(e)},gotoVerifyPage:function(e){e.stopImmediatePropagation(),t("#transAmountError").html("");var n=this,r=d.get("transferAmount"),o=r.replace(/\,/g,"");d.set("ReplacedNumber",o);var c=function(e){if("BDT"!==d.get("fromAccCurr")||"BDT"!==d.get("toCardCurr")){hideSpinner();var n=parseFloat(d.get("paymentAmount")),r=parseFloat(d.get("dailyAvailableLimit")),o=parseFloat(d.get("minAmountPerTransaction")),c=parseFloat(d.get("maxAmountPerTransaction"));if(o>n)return t("#transAmountError").html(t.i18n.t("validation.sadad.amtgreaterthanminamt")),!1;if(n>r)return void t("#transAmountError").html(t.i18n.t("validation.transfer.notra"));if(n>c)return t("#transAmountError").html(t.i18n.t("validation.sadad.amtlessthanmaxamt")),!1;d.set("beneSuccessFlag","true"),a.history.navigate("#/transferconfrim")}else hideSpinner(),d.set("beneSuccessFlag","true"),a.history.navigate("#/transferconfrim")},i=function(t){n.errorresponse()};showSpinner(),n.collection=new s,n.collection.fetch({data:t.param({access_token:d.get("access_token"),fromaccountId:d.get("fromAcntNumber"),paymentdate:d.get("payDate"),transtype:d.get("payType"),validtype:"Validation",beneAcctType:"CC",currSelection:"F",transcurrency:d.get("transCurrency"),toaccountId:d.get("toAccountId"),remarks:d.get("purposetransfer"),trnasfertype:d.get("transferType"),uniqueId:null,globalId:null,totalDebitAmount:o,transamount:o}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?c(t):i(t)},error:i})},transferbackbtn:function(t){t.stopImmediatePropagation(),a.history.navigate("#/transferbbicardviewdetail")},transactionbtn:function(){a.history.navigate("#/transactionhistory")},cancelTransfer:function(t){t.stopImmediatePropagation(),a.history.navigate("#/transferbbicardviewdetail")},errorresponse:function(){hideSpinner(),openErrorPopup()},ownCardOpenTandCPopup:function(t){t.stopImmediatePropagation(),"bKash"==d.get("ccPayFromAcc")?d.set("tandctype","bKashToCC"):d.set("tandctype","owncard"),openTermsAndConditionsPopup()},openFromAccDropdown:function(e){"object"==typeof e&&(e.preventDefault(),e.stopImmediatePropagation()),t("#OC_card_account").modal("show")},disposeView:function(t){return a.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=t,this.currentView.delegateEvents(),this.currentView}});return h});