define(["jquery","underscore","Backbone","collections/transfer/validateVIDCollections","text!views/transfer/binimoyNewRegistration.tpl"],function(e,i,t,n,o){var r=new EncryptedLocalStorage("secret"),a=t.View.extend({el:"#container",events:{"click #binimoyNewRegCancelBtn":"gotoBinimoyTagAccountPage","click #binimoyNewRegProceedBtn":"validateVID"},initialize:function(){},update:function(){r.set("isValidBinimoyVID","false"),e("html").removeClass().addClass("app"),e("div").removeClass("modal-backdrop fade in"),this.$el.html(i.template(o)),r.set("binimoyRegServiceFlag","")},gotoBinimoyTagAccountPage:function(e){e.stopImmediatePropagation(),t.history.navigate("#/binimoytagaccounts")},validateVID:function(i){i.stopImmediatePropagation(),e("#binimoyNewVIDError").html("");var t=e("#binimoyNewVID").val(),o=t.charAt(0),a=t.charAt(t.length-1);if(isNull(t))return void e("#binimoyNewVIDError").html("Please enter a new BINIMOY VID");if(!o.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return e("#binimoyNewVIDError").html(e.i18n.t("validation.newregistration.firstspaceind")),!1;if(!a.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return e("#binimoyNewVIDError").html(e.i18n.t("validation.newregistration.lastspaceind")),!1;t+=e("#basic-addon2").text(),showSpinner();var s=this,c=function(e){hideSpinner(),r.set("binimoyVID",t),r.set("isValidBinimoyVID","true"),r.set("isFromNewBinimoyRegPage","true"),s.gotoBinimoyRegistrationReviewPage(i)},l=function(e){hideSpinner(),r.set("binimoyVID",t),r.set("isValidBinimoyVID","false"),s.errorresponse()};showSpinner(),s.collection=new n,s.collection.fetch({data:e.param({access_token:r.get("access_token"),virtual_id:t,service_flag:"NB"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?c(e):l(e)},error:l})},gotoBinimoyRegistrationReviewPage:function(i){i.stopImmediatePropagation(),e("#binimoyNewVIDError").html("");var n=e("#binimoyNewVID").val(),o=n.charAt(0),a=n.charAt(n.length-1);return isNull(n)?void e("#binimoyNewVIDError").html("Please enter a new BINIMOY VID"):o.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i)?a.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i)?"false"==r.get("isValidBinimoyVID")?void e("#binimoyNewVIDError").html("Please enter a valid BINIMOY VID"):(r.set("isFromNewBinimoyRegPage","true"),r.set("binimoyRegServiceFlag","NB"),void t.history.navigate("#/binimoyregreview")):(e("#binimoyNewVIDError").html(e.i18n.t("validation.newregistration.lastspaceind")),!1):(e("#binimoyNewVIDError").html(e.i18n.t("validation.newregistration.firstspaceind")),!1)},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return t.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return a});