define(["jquery","underscore","Backbone","collections/transfer/getTransactionLimitCollections","collections/wealth/prepaidcardCollections","collections/transfer/getAccountBalanceCollections","collections/transfer/localTransferFTPCollections","collections/transfer/currencyListsCollections","collections/transfer/getAuthModeCollections","models/validation/transfer/withinAccountrepeatTransferValidationModel","text!views/transfer/otherbanktobeneficiary.tpl"],function(e,t,r,a,n,o,i,s,l,c,d){var h=!1,m=new EncryptedLocalStorage("secret"),v=r.View.extend({el:"#container",events:{"click .transType":"toggleDiv","click #confirmbtndiv":"submitPay","click #Other_paynowdiv":"paynowshow","click #Other_paylaterdiv":"paylatershow","click #Other_repeatpaydiv":"payschshow","click #cancelbtndiv":"cancelTransfer","blur #paymentAmountdiv":"getAuthMode","change #fromaccnumdiv":"getAccountBalanceview","change #purposetransferdiv":"showOthersDiv","click #tobene_trans_limit":"showToBeneTransLimitPopup","click #otherBankToBeneTandCPopup":"otherBankToBeneOpenTandCPopup"},initialize:function(){e("html").removeClass().addClass("app")},update:function(){var t=this;if("false"==m.get("isPrepaidCardData")){var r=function(e){hideSpinner(),h=!1;var r=m.get("localBeneficiaryBeneficiaryInstructionDTOList"),a=m.get("selectedBeneInd"),n=r[a],o=n.channelIndicator;"NPSB"==o?(m.set("transferChannel","NPSB"),m.set("tenantServiceCode","NPSB")):"NPSB/BEFTN/RTGS"==o&&("Y"==n.npsb_allowed_flag&&(m.set("transferChannel","NPSB"),m.set("tenantServiceCode","NPSB")),"Y"==n.beftn_allowed_flag&&"Y"!==n.npsb_allowed_flag&&(m.set("transferChannel","BEFTN"),m.set("tenantServiceCode","BEFTN")),"Y"==n.rtgs_allowed_flag&&"Y"!==n.npsb_allowed_flag&&"Y"!==n.beftn_allowed_flag&&(m.set("transferChannel","RTGS"),m.set("tenantServiceCode","RTGS"))),t.getpaymenttypeview(),m.set("isPrepaidCardData","true")},a=function(e){t.errorresponse()};showSpinner(),t.collection=new n([],{});getDeviceId();t.collection.fetch({data:e.param({newversion:"Y",access_token:m.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):a(e)},error:a})}else{hideSpinner(),h=!1;var o=m.get("localBeneficiaryBeneficiaryInstructionDTOList"),i=m.get("selectedBeneInd"),s=o[i],l=s.channelIndicator;"NPSB"==l?(m.set("transferChannel","NPSB"),m.set("tenantServiceCode","NPSB")):"NPSB/BEFTN/RTGS"==l&&("Y"==s.npsb_allowed_flag&&(m.set("transferChannel","NPSB"),m.set("tenantServiceCode","NPSB")),"Y"==s.beftn_allowed_flag&&"Y"!==s.npsb_allowed_flag&&(m.set("transferChannel","BEFTN"),m.set("tenantServiceCode","BEFTN")),"Y"==s.rtgs_allowed_flag&&"Y"!==s.npsb_allowed_flag&&"Y"!==s.beftn_allowed_flag&&(m.set("transferChannel","RTGS"),m.set("tenantServiceCode","RTGS"))),t.getpaymenttypeview()}},populateFromAccounts:function(){e("#fromaccnumdiv").html("");var t=getAccountDTO(),r=e("input[name='transfer']:checked").val(),a=m.get("prepaidCardAccountList"),n='<option value="" id=""  selected="selected">'+e.i18n.t("app.transferss.selaccnum")+"</option>";isNull(t)||("npsb"==r&&(m.set("tenantServiceCode","NPSB"),e.each(t,function(e,t){"Y"==t.npsbflag&&(n+='<option acctype="CASA" shName="'+t.productName+'" curCode="'+t.currencyCode+'" Accideothr="'+t.id+'" id="'+e+'">'+t.accountNumber+"</option>")})),"beftn"==r&&(m.set("tenantServiceCode","BEFTN"),e.each(t,function(e,t){"Y"==t.beftnflag&&(n+='<option acctype="CASA" shName="'+t.productName+'" curCode="'+t.currencyCode+'" Accideothr="'+t.id+'" id="'+e+'">'+t.accountNumber+"</option>")})),"rtgs"==r&&(m.set("tenantServiceCode","RTGS"),e.each(t,function(e,t){"Y"==t.rtgsflag&&(n+='<option acctype="CASA" shName="'+t.productName+'" curCode="'+t.currencyCode+'" Accideothr="'+t.id+'" id="'+e+'">'+t.accountNumber+"</option>")}))),isNull(a)||("npsb"==r&&(m.set("tenantServiceCode","NPSB"),e.each(a,function(e,t){"Y"==t.npsbflag&&(n+='<option acctype="PC" shName="'+t.cardHolderName+'" curCode="'+t.currencyCode+'" Accideothr="'+t.id+'" id="'+e+'">'+t.accountNumber+"</option>")})),"beftn"==r&&(m.set("tenantServiceCode","BEFTN"),e.each(a,function(e,t){"Y"==t.beftnflag&&(n+='<option acctype="PC" shName="'+t.cardHolderName+'" curCode="'+t.currencyCode+'" Accideothr="'+t.id+'" id="'+e+'">'+t.accountNumber+"</option>")})),"rtgs"==r&&(m.set("tenantServiceCode","RTGS"),e.each(a,function(e,t){"Y"==t.rtgsflag&&(n+='<option acctype="PC" shName="'+t.cardHolderName+'" curCode="'+t.currencyCode+'" Accideothr="'+t.id+'" id="'+e+'">'+t.accountNumber+"</option>")}))),e("#fromaccnumdiv").html(n)},getAuthMode:function(t){var a=this,n=new RegExp("^[0-9.,]+$");t.stopImmediatePropagation();var o=e("#paymentAmountdiv").val().replace(/,/g,"");m.set("IsAuthMode","false"),m.set("authModeFlag","false"),e("#transAmountErrordiv").html(""),e("#other_tobene_transferDiv").html(""),this.model=new c({url:"json/"}),r.Validation.bind(this);var i=this.$("form").serializeObject();if(this.model.set(i,{validate:!0})?(this.model.clear(),r.Validation.unbind(this)):this.$(".has-error").fadeIn(),m.set("transferType","otherToBene"),!isNull(o)){if(!isNull(o)&&!n.test(o))return void e("#transAmountErrordiv").html(e.i18n.t("validation.transfer.validamount"));var o=parseFloat(e("#paymentAmountdiv").val().replace(/,/g,"")),s=parseFloat(m.get("minAmountPerTransaction")),d=parseFloat(m.get("maxAmountPerTransaction"));if(s>o)return void e("#transAmountErrordiv").html(e.i18n.t("validation.sadad.amtgreaterthanminamt"));if(o>d)return void e("#transAmountErrordiv").html(e.i18n.t("validation.sadad.amtlessthanmaxamt"));var h=function(e){hideSpinner();var r=m.get("securitySettingList");!isNull(r)&&r.length>0?m.set("IsAuthMode","true"):(m.set("alertType",null),m.set("IsAuthMode","false")),a.populateAuthMode(t),a.submitPay(t)},v=function(t){hideSpinner(),m.set("authModeFlag","true"),e("#paymentAmountdiv").val(""),a.errorresponse()};showSpinner(),a.collection=new l,a.collection.fetch({data:e.param({access_token:m.get("access_token"),transactionAmount:o,tenantServiceCode:m.get("tenantServiceCode")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?h(e):v(e)},error:v})}},populateAuthMode:function(t){t.stopImmediatePropagation();var r="",a="",n=m.get("securitySettingList"),o="<label for='username'>"+e.i18n.t("app.transfer.managebeneficiary.selectauthorisationmode")+"</label>";o+="<div class='custRadio_pass'>",!isNull(n)&&n.length>0?(e("#other_tobene_transferDiv").html(""),e.each(n,function(t,n){"SMS"==n?(r="sms",a=e.i18n.t("app.transfer.managebeneficiary.sms")):"EMAIL"==n?(r="mail",a=e.i18n.t("app.transfer.managebeneficiary.mail")):"TOKEN"==n?(r="fScan",a=e.i18n.t("app.transfer.managebeneficiary.token")):"ESIGN"==n&&(r="esign",a=e.i18n.t("app.transfer.managebeneficiary.esign")),o+='<div class="box"><div class="radio"><label>',o+=0==t?'<input type="radio" name="other_tobene_transfer" id="optionsRadios'+t+'" value="'+n+'" checked>':'<input type="radio" name="other_tobene_transfer" id="optionsRadios'+t+'" value="'+n+'">',o+='<div class="row bg"><div class="col-xs-12 p0"><span class="menu_icon ico-xs '+r+'"></span><span class="small">'+a+"</span></div></div></label></div></div>"}),e("#other_tobene_transferDiv").html(o)):e("#other_tobene_transferDiv").html("")},cancelTransfer:function(e){e.stopImmediatePropagation(),r.history.navigate("#/otherbankselectbeneficiary")},showToBeneTransLimitPopup:function(){e("#toBeneMinAmount, #toBeneDailyLimit, #toBenePerTransLimit, #toBeneMonthlyLimit, #toBeneDailyAvailCount, #toBeneDailyTransCount, #toBeneMonthlyAvailLimit, #toBeneMonthlyAvailCount").html(""),e("#TransactionLimitdiv").modal("show");var t=m.get("minAmountPerTransaction"),r=m.get("dailyAvailableLimit"),a=m.get("monthlyTransactionLimit"),n=m.get("maxAmountPerTransaction"),o=m.get("dailyAvailableCount"),i=m.get("dailyTransactionCount"),s=m.get("monthlyAvailableLimit"),l=m.get("monthlyAvailableCount");e("#toBeneMinAmount").html(checkAmount(e.formatNumber(t,{format:"#,###.00",locale:"us"}))+" <span class='cur'>"+e.i18n.t("app.transferss.bdt")+"</span>"),e("#toBeneDailyLimit").html(checkAmount(e.formatNumber(r,{format:"#,###.00",locale:"us"}))+" <span class='cur'>"+e.i18n.t("app.transferss.bdt")+"</span>"),e("#toBenePerTransLimit").html(checkAmount(e.formatNumber(n,{format:"#,###.00",locale:"us"}))+" <span class='cur'>"+e.i18n.t("app.transferss.bdt")+"</span>"),e("#toBeneMonthlyLimit").html(checkAmount(e.formatNumber(a,{format:"#,###.00",locale:"us"}))+" <span class='cur'>"+e.i18n.t("app.transferss.bdt")+"</span>"),e("#toBeneMonthlyAvailLimit").html(checkAmount(e.formatNumber(s,{format:"#,###.00",locale:"us"}))+" <span class='cur'>"+e.i18n.t("app.transferss.bdt")+"</span>"),e("#toBeneDailyAvailCount").html(o),e("#toBeneDailyTransCount").html(i),e("#toBeneMonthlyAvailCount").html(l)},getpaymenttypeview:function(){var t=this,r=function(e){hideSpinner(),h||t.loadTemplate()},n=function(e){t.errorresponse()};showSpinner(),t.collection=new a,t.collection.fetch({data:e.param({access_token:m.get("access_token"),payeeType:"LOCAL_TRANSFER",transferChannel:m.get("transferChannel")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):n(e)},error:n})},loadTemplate:function(){function a(e){return"REGISTERED"==e.subTransactionType?e:void 0}var n=this,o=m.get("downtimeNotification");if(!isNull(o)&&o.length>0){var i=o.filter(a);3==i.length?(m.set("isBeneAllDown","Y"),m.set("isOneOffAllDown","N"),r.history.navigate("#/downtimeboth")):(m.set("isBeneAllDown","N"),m.set("isOneOffAllDown","N"),this.$el.html(t.template(d)))}else m.set("isBeneAllDown","N"),m.set("isOneOffAllDown","N"),this.$el.html(t.template(d));if(!isNull(o)&&o.length>0){var s=(o[0].downtimeNotificationDetail,"");e.each(o,function(e,t){if("REGISTERED"==t.subTransactionType||"BOTH"==t.subTransactionType){var r=t.downtimeNotificationDetail,a=r[e].messageMobile;isNull(a)||(s+="<p>"+a+"</p>")}}),e("#notificationMessage").html(e.parseHTML(s))}e("#brancknamdive").hide();var l=m.get("localBeneficiaryBeneficiaryInstructionDTOList"),c=m.get("selectedBeneInd"),h=l[c],v=h.channelIndicator,u=m.get("transferChannel");if("NPSB"==v){m.set("transferChannel","NPSB"),e("#otherToBeneRTGSShortNotesDiv").hide(),e("#otherBankOneTimeShortNotesDiv").hide(),e("#otherToBeneBEFTNShortNotesDiv").hide(),e("#brancknamdive").hide();var p=e.parseJSON(window.localStorage.getItem("shortNotesObj"));isNull(p.NPSBBENE)||(e("#otherToBeneNPSBShortNotesDiv").show(),e("#otherBankOneTimeShortNotesDiv").show(),e("#otherToBeneNPSBShortNotesDiv").html(p.NPSBBENE))}else if("NPSB/BEFTN/RTGS"==v)if("NPSB"==u){m.set("transferChannel","NPSB"),e("#otherToBeneRTGSShortNotesDiv").hide(),e("#otherBankOneTimeShortNotesDiv").hide(),e("#otherToBeneBEFTNShortNotesDiv").hide();var p=e.parseJSON(window.localStorage.getItem("shortNotesObj"));isNull(p.NPSBBENE)||(e("#otherToBeneNPSBShortNotesDiv").show(),e("#otherBankOneTimeShortNotesDiv").show(),e("#otherToBeneNPSBShortNotesDiv").html(p.NPSBBENE)),e("#brancknamdive").hide()}else if("BEFTN"==u){e("#otherToBeneRTGSShortNotesDiv").hide(),e("#otherToBeneNPSBShortNotesDiv").hide(),e("#otherBankOneTimeShortNotesDiv").hide();var p=e.parseJSON(window.localStorage.getItem("shortNotesObj"));isNull(p.BEFTNBENE)||(e("#otherToBeneBEFTNShortNotesDiv").show(),e("#otherBankOneTimeShortNotesDiv").show(),e("#otherToBeneBEFTNShortNotesDiv").html(p.BEFTNBENE)),e("#brancknamdive").show(),n.getotherBranchList()}else if("RTGS"==u){e("#otherToBeneNPSBShortNotesDiv").hide(),e("#otherToBeneBEFTNShortNotesDiv").hide(),e("#otherBankOneTimeShortNotesDiv").hide();var p=e.parseJSON(window.localStorage.getItem("shortNotesObj"));isNull(p.RTGSBENE)||(e("#otherToBeneRTGSShortNotesDiv").show(),e("#otherBankOneTimeShortNotesDiv").show(),e("#otherToBeneRTGSShortNotesDiv").html(p.RTGSBENE)),e("#brancknamdive").show(),n.getotherBranchList()}e("#availBalDiv").hide(),n.populateFromAccounts()},toggleDiv:function(t){t.stopImmediatePropagation();var r=this;h=!0;var a=e("input[name='transfer']:checked").val();if(e("#paymentAmountdiv").val(""),"npsb"==a){m.set("transferChannel","NPSB"),m.set("tenantServiceCode","NPSB"),e("#brancknamdive").hide(),e("#otherToBeneRTGSShortNotesDiv").hide(),e("#otherToBeneBEFTNShortNotesDiv").hide(),e("#otherBankOneTimeShortNotesDiv").hide();var n=e.parseJSON(window.localStorage.getItem("shortNotesObj"));isNull(n.NPSBBENE)||(e("#otherToBeneNPSBShortNotesDiv").show(),e("#otherBankOneTimeShortNotesDiv").show(),e("#otherToBeneNPSBShortNotesDiv").html(n.NPSBBENE)),e("#OBToBene_OtherRemarks").val(""),e("#otherRemaksNullError").html("")}else if("beftn"==a){m.set("transferChannel","BEFTN"),m.set("tenantServiceCode","BEFTN"),e("#brancknamdive").show(),e("#otherToBeneNPSBShortNotesDiv").hide(),e("#otherToBeneRTGSShortNotesDiv").hide(),e("#otherBankOneTimeShortNotesDiv").hide();var n=e.parseJSON(window.localStorage.getItem("shortNotesObj"));isNull(n.BEFTNBENE)||(e("#otherToBeneBEFTNShortNotesDiv").show(),e("#otherBankOneTimeShortNotesDiv").show(),e("#otherToBeneBEFTNShortNotesDiv").html(n.BEFTNBENE)),r.getotherBranchList(),e("#OBToBene_OtherRemarks").val(""),e("#otherRemaksNullError").html("")}else if("rtgs"==a){m.set("transferChannel","RTGS"),m.set("tenantServiceCode","RTGS"),e("#brancknamdive").show(),e("#otherToBeneNPSBShortNotesDiv").hide(),e("#otherToBeneBEFTNShortNotesDiv").hide(),e("#otherBankOneTimeShortNotesDiv").hide();var n=e.parseJSON(window.localStorage.getItem("shortNotesObj"));isNull(n.RTGSBENE)||(e("#otherToBeneRTGSShortNotesDiv").show(),e("#otherBankOneTimeShortNotesDiv").show(),e("#otherToBeneRTGSShortNotesDiv").html(n.RTGSBENE)),r.getotherBranchList(),e("#OBToBene_OtherRemarks").val(""),e("#otherRemaksNullError").html("")}r.populateFromAccounts(),r.getpaymenttypeview()},getotherBranchList:function(){var t=m.get("localBeneficiaryBeneficiaryInstructionDTOList"),r=m.get("selectedBeneInd"),a=t[r],n=a.branchName;m.set("branchName",n);var o=a.routingNo;m.set("routingNo",o);var i=a.district;m.set("district",i),e("#otherbenebranch").html(n),e("#otherroutingNum").html(o),e("#otherdist").html(i)},showOthersDiv:function(t){t.stopImmediatePropagation();var r=e("#purposetransferdiv option:selected").val();"others"==r?e("#othersDiv").show():e("#othersDiv").hide()},getAccountBalanceview:function(t){t.stopImmediatePropagation();var r=e("#fromaccnumdiv option:selected").attr("id");if(""==r)return e("#availbaldiv").html(""),void e("#availBalDiv").hide();var a=e("#fromaccnumdiv option:selected").attr("Accideothr");m.set("fromaccountNumber",a);var n=e("#fromaccnumdiv option:selected").attr("shName");m.set("otherfromname",n);var i=e("#fromaccnumdiv option:selected").attr("curCode");m.set("otherfromcurCode",i);var s=e("#fromaccnumdiv option:selected").attr("acctype");"PC"==s?m.set("typeOfTransfer","PC"):"CASA"==s&&m.set("typeOfTransfer","CASA");var l=this,c=function(t){hideSpinner(),e("#error_accdiv").html(""),e("#availBalDiv").show();var r,a,n=m.get("availableBalance"),o=parseFloat(n.slice(0,-2)),i=m.get("accountCurrency");"CASA"==s?(r=checkAmount(e.formatNumber(o,{format:"#,###.00",locale:"us"})),a=r+" "+i,m.set("fromAcntAvailBal",o)):"PC"==s&&(r=checkAmount(e.formatNumber(n,{format:"#,###.00",locale:"us"})),a=r+" "+i,m.set("fromAcntAvailBal",n)),e("#availbaldiv").html(a);var i=e("#fromaccnumdiv option:selected").attr("curCode");"BDT"==i?m.set("fromAccCurr","BDT"):m.set("fromAccCurr",i)},d=function(e){l.errorresponse()};showSpinner(),l.collection=new o,l.collection.fetch({data:e.param({access_token:m.get("access_token"),accountId:m.get("fromaccountNumber"),accountType:s,beneficiaryInstructionId:null}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?c(e):d(e)},error:d})},getCurrencyList:function(t){t.stopImmediatePropagation();var r=this,a=function(e){hideSpinner(),r.populateCurrencyDropDown(t)},n=function(e){r.errorresponse()};showSpinner(),r.collection=new s,r.collection.fetch({data:e.param({access_token:m.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):n(e)},error:n})},populateCurrencyDropDown:function(t){t.stopImmediatePropagation();var r=m.get("currencyLists");e("#currency").empty();var a="",n=m.get("fromAccCurr");e.each(r,function(e,t){t.code==n&&(a+="<option value='"+t.code+"' selected>"+t.code+"</option>")}),e("#currency").append(a)},populateBDT:function(t){t.stopImmediatePropagation(),e("#currency").empty();var r="";r+="<option value='BDT' selected>BDT</option>",e("#currency").append(r)},submitPay:function(t){t.stopImmediatePropagation(),e("#tandcErr").html(""),e("#error_amountdiv").html(""),e("#error_reasondiv").html(""),e("#error_greaterdatediv").html(""),e("#errorstartdatediv").html(""),e("#errorfrrequencydiv").html(""),e("#errornoftimesdiv").html(""),e("#transAmountErrordiv").html(""),e("#otherRemaksNullError").html("");var a=this,n=new RegExp("^[0-9.,]+$"),o=new RegExp("^[A-Za-z0-9 ]+$"),i=e("#OBToBene_OtherRemarks").val(),s=parseFloat(e("#paymentAmountdiv").val().replace(/,/g,"")),l=e("input[name='other_tobene_transfer']:checked").val();m.set("alertType",l),m.set("toAccCurr","BDT"),this.model=new c({url:"json/"}),r.Validation.bind(this);var d=this.$("form").serializeObject();if(this.model.set(d,{validate:!0})){this.model.clear(),r.Validation.unbind(this);var h=e("#currency option:selected").val(),v=e("#termsand").prop("checked");if(!v)return void e("#tandcErr").html("Please check the Terms and Conditions");if(m.get("fromAccCurr")==h){var u=m.get("fromAcntAvailBal"),p=parseFloat(e("#paymentAmountdiv").val().replace(/,/g,""));if(p>u)return void e("#transAmountErrordiv").html(e.i18n.t("validation.transfer.nobal"))}if(!isNull(s)&&!n.test(s))return void e("#transAmountErrordiv").html(e.i18n.t("validation.transfer.validamount"));if(!isNull(i)&&i.length>16)return void e("#otherRemaksNullError").html("The Remarks should contain maximum of 16 characters");if(!isNull(i)&&!o.test(i))return void e("#otherRemaksNullError").html(e.i18n.t("validation.managebene.remarksspecialchar"));if("BDT"==m.get("fromAccCurr")&&"BDT"==m.get("toAccCurr")){var f=parseFloat(m.get("minAmountPerTransaction")),g=parseFloat(m.get("maxAmountPerTransaction")),N=parseFloat(m.get("dailyAvailableLimit")),T=m.get("dailyAvailableCount"),B=m.get("monthlyAvailableCount"),p=parseFloat(e("#paymentAmountdiv").val().replace(/,/g,""));if(f>p)return e("#transAmountErrordiv").html(e.i18n.t("validation.sadad.amtgreaterthanminamt")),!1;if(p>N)return void e("#transAmountErrordiv").html(e.i18n.t("validation.transfer.notra"));if(p>g)return void e("#transAmountErrordiv").html(e.i18n.t("validation.sadad.amtlessthanmaxamt"));if("0"==T)return void e("#transAmountErrordiv").html("You have exceeded your daily transaction count.");if("0"==B)return void e("#transAmountErrordiv").html("Transaction count exceeded Monthly Available Count.")}if("BEFTN"==m.get("transferChannel")){var S=e("#OBToBene_OtherRemarks").val();if(!isNull(S)){var y=S.charAt(0);S.charAt(S.length-1);if(0==S)return void e("#otherRemaksNullError").html("Invalid Remarks");if(/\s\s+$/.test(S))return void e("#otherRemaksNullError").html("Invalid Remarks");if(!y.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return void e("#otherRemaksNullError").html("Invalid Remarks");if(S.match(/\s\s/g))return void e("#otherRemaksNullError").html("Invalid Remarks");for(var b=!1,A=0;A<S.length;A++)if(0==S[A]){for(var D=S.length,C=0,A=0;D>A;A++)0==S[A]&&C++;C==D&&(b=!0)}if(b)return isError=!0,void e("#otherRemaksNullError").html("Invalid Remarks")}}var w=e("input[name='paymenttype']:checked").val();"otherpaynow"==w&&m.set("payType","PAYNOW");var E=new Date,P=E.getDate(),k=E.getMonth()+1,O=E.getFullYear(),_=new Date(O,k,P),R=("00"+P.toString()).slice(-2)+"/"+("00"+k.toString()).slice(-2)+"/"+("0000"+O.toString()).slice(-4);if(m.set("payDate",R),"otherpaylater"==w){m.set("payType","LATER");var I=e("#payDatediv").val();if(""==I)return void e("#error_greaterdatediv").html("Please enter the Payment Date");var F=I.split("-"),L=F[2],Y=F[1],G=F[0],M=new Date(L,Y,G);if(M.getTime()<_.getTime())return void e("#error_greaterdatediv").html(e.i18n.t("validation.transfer.greaterdate"))}else if("otherrepeatPay"==w){m.set("payType","REPEAT");var x=e("#startDatediv").val(),j=e("#freqListdiv option:selected").val(),q=e("#nooftimesdiv option:selected").val();if(""==x)return void e("#errorstartdatediv").html(e.i18n.t("validation.transfer.startdate"));if(""==j)return void e("#errorfrrequencydiv").html(e.i18n.t("validation.transfer.freqList"));if(""==q)return void e("#errornoftimesdiv").html(e.i18n.t("validation.transfer.not"));if(""!==x){var V=x.split("-"),$=V[2],J=V[1],z=V[0],H=new Date($,J,z);if(H.getTime()<_.getTime())return void e("#errorstartdatediv").html(e.i18n.t("validation.transfer.greaterdate"))}}var S=e("#purposetransferdiv option:selected").val();if("true"==m.get("authModeFlag"))return;a.gotoOwnAccountTransferValidation(t)}else this.$(".has-error").fadeIn(),t.preventDefault()},gotoOwnAccountTransferValidation:function(t){t.stopImmediatePropagation(),e("#transAmountErrordiv").html("");var r=this,a=(m.get("paymentType"),m.get("selectid1"),m.get("transDate"),e("#currency option:selected").val());m.set("transCurr",a);var n=(m.get("transferAmount"),new Date),o=n.getDate(),s=n.getMonth()+1,l=n.getFullYear(),c=(new Date(l,s,o),("0000"+l.toString()).slice(-4)+"-"+("00"+s.toString()).slice(-2)+"-"+("00"+o.toString()).slice(-2));m.set("payDate",c);var d=parseFloat(e("#paymentAmountdiv").val().replace(/,/g,""));m.set("transferAmount",d);var h=(e("#purposetransferdiv option:selected").html(),e.trim(e("#OBToBene_OtherRemarks").val()));m.set("transferReason",h);var v=m.get("typeOfTransfer"),u=m.get("paymentTypeTo");"CASA"==v&&"account"==u?m.set("tYpeOfTrans","A2A"):"PC"==v&&"CREDITCARD"==u?m.set("tYpeOfTrans","P2C"):"PC"==v&&"account"==u?m.set("tYpeOfTrans","P2A"):"CASA"==v&&"CREDITCARD"==u&&m.set("tYpeOfTrans","A2C");var p=function(a){if("BDT"!==m.get("fromAccCurr")||"BDT"!==m.get("toAccCurr")){hideSpinner();var n=parseFloat(m.get("minAmountPerTransaction")),o=parseFloat(m.get("maxAmountPerTransaction")),i=parseFloat(m.get("dailyAvailableLimit")),s=parseFloat(m.get("paymentAmount"));if(n>s)return e("#transAmountErrordiv").html(e.i18n.t("validation.sadad.amtgreaterthanminamt")),!1;if(s>i)return void e("#transAmountErrordiv").html(e.i18n.t("validation.transfer.notra"));if(s>o)return void e("#transAmountErrordiv").html(e.i18n.t("validation.sadad.amtlessthanmaxamt"));r.beneconfrom(t)}else hideSpinner(),r.beneconfrom(t)},f=function(e){r.errorresponse()};showSpinner(),r.collection=new i,r.collection.fetch({data:e.param({access_token:m.get("access_token"),fromaccountId:m.get("fromaccountNumber"),paydate:m.get("payDate"),transtype:m.get("payType"),validtype:"Validation",beneAcctType:"CASA",currSelection:"F",transcurrency:m.get("transCurr"),toaccountId:m.get("selectBeneId"),remarks:m.get("transferReason"),trnasfertype:m.get("tYpeOfTrans"),transamount:m.get("transferAmount"),uniqueId:null,globalId:null,totalDebitAmount:m.get("transferAmount"),onetimepay:"FALSE",benetype:"DOMESTIC",paymenttype:m.get("transferChannel"),frmAcctName:m.get("otherfromname"),limitId:m.get("id")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?p(e):f(e)},error:f})},beneconfrom:function(t){t.stopImmediatePropagation();var a="PAYNOW";if("otherrepeatPay"==a){var n=e("#freqListdiv option:selected").val();m.set("freq",n);var o=e("#startDatediv").val();m.set("startdate",o)}if("otherpaylater"==a){var i=e("#payDatediv").val(),s=i.split("-");s[0],s[1],s[2];m.set("transDate",transDate)}else if("PAYNOW"==a){var l=getDatemonthToday();m.set("transDate",l)}var c=e("#fromaccnumdiv option:selected").attr("id");m.set("fromAccountIndex",c);var d=e("#fromaccnumdiv option:selected").val();m.set("fromAcntId",d);var h=e("#fromaccnumdiv").val();m.set("otherFromaccno",h);var v=parseFloat(e("#paymentAmountdiv").val().replace(/,/g,""));m.set("transferAmount",v);var u=e.trim(e("#OBToBene_OtherRemarks").val());m.set("transferReason",u),m.set("beneSuccessFlag","true"),r.history.navigate("#/otherbanktobeneficiaryverify")},paynowshow:function(t){t.stopImmediatePropagation(),e("#otherpayLater").hide(),e("#otherrepeatPay").hide(),e("#pdate").val(""),e("#error_greaterdatediv").html(""),e("#pdate").attr("disabled",!0),e("#error_greaterdatediv").attr("disabled",!0),e("#startDatediv").val(""),e("#freqListdiv").val(""),e("#nooftimesdiv").val(""),e("#errorstartdatediv").html(""),e("#errorfrrequencydiv").html(""),e("#errornoftimesdiv").html(""),e("#startDatediv").attr("disabled",!0),e("#errorstartdatediv").attr("disabled",!0),e("#freqListdiv").attr("disabled",!0),e("#errorfrrequencydiv").attr("disabled",!0),e("#nooftimesdiv").attr("disabled",!0),e("#errornoftimesdiv").attr("disabled",!0)},paylatershow:function(t){t.stopImmediatePropagation(),e("#otherpayLater").show(),e("#otherrepeatPay").hide(),e("#pdate").attr("disabled",!1),e("#error_greaterdatediv").attr("disabled",!1),e("#startDatediv").val(""),e("#freqListdiv").val(""),e("#nooftimesdiv").val(""),e("#errorstartdatediv").html(""),e("#errorfrrequencydiv").html(""),e("#errornoftimesdiv").html(""),e("#startDatediv").attr("disabled",!0),e("#errorstartdatediv").attr("disabled",!0),e("#freqListdiv").attr("disabled",!0),e("#errorfrrequencydiv").attr("disabled",!0),e("#nooftimesdiv").attr("disabled",!0),e("#errornoftimesdiv").attr("disabled",!0)},payschshow:function(t){t.stopImmediatePropagation(),e("#otherpayLater").hide(),e("#otherrepeatPay").show(),e("#pdate").val(""),e("#error_greaterdatediv").html(""),e("#pdate").attr("disabled",!0),e("#error_greaterdatediv").attr("disabled",!0),e("#startDatediv").attr("disabled",!1),e("#errorstartdatediv").attr("disabled",!1),e("#freqListdiv").attr("disabled",!1),e("#errorfrrequencydiv").attr("disabled",!1),e("#nooftimesdiv").attr("disabled",!1),e("#errornoftimesdiv").attr("disabled",!1)},cancel:function(){r.history.navigate("#/otherbankselectbeneficiary")},errorresponse:function(){hideSpinner(),openErrorPopup()},otherBankToBeneOpenTandCPopup:function(e){e.stopImmediatePropagation(),"NPSB"==m.get("transferChannel")?m.set("tandctype","npsbbene"):"BEFTN"==m.get("transferChannel")?m.set("tandctype","beftnbene"):"RTGS"==m.get("transferChannel")&&m.set("tandctype","rtgsbene"),openTermsAndConditionsPopup()},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return v});