define(["jquery","underscore","Backbone","collections/requests/debitcardusagecontrolCollections","models/validation/tedallal/tedallalValidationModel","text!views/requests/debitCardusagecontrolrequest.tpl"],function(e,t,a,i,r,c){var n=new EncryptedLocalStorage("secret"),o="",l=a.View.extend({el:"#mobcontent",events:{"change #localCheckLabel":"localCheckHandler","change #intCheckLabel":"intCheckHandler","change #ecommCheckLabel":"ecommCheckHandler","click #validatePoints":"validatePoints","change #serviceType":"convertedamount"},update:function(){n.set("managecreditcardsubmenu","");var t=this;timestamp=(new Date).getTime();var a=function(e){o=debitCardControlFetchDTO,n.set("debitCardControlFetchDTO",o),t.requestcompile()},r=function(e){t.errorresponse()};t.collection=new i([],{});n.get("custno");showSpinner(),timestamp=(new Date).getTime();t.collection.fetch({data:e.param({}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(n.get("calltimeout")),success:function(e){"0000"==ackStatus?a(e):r(e)},error:r})},localCheckHandler:function(t){var a=e(t.currentTarget).data("index");e('#localCheckLabel[data-index="'+a+'"]').find("input:checkbox:first").is(":checked")||e('#intCheckLabel[data-index="'+a+'"]').find("input:checkbox:first").is(":checked")||e('#ecommCheckLabel[data-index="'+a+'"]').find("input:checkbox:first").is(":checked")||e("#errorcheckLabel"+a).hide()},intCheckHandler:function(t){var a=e(t.currentTarget).data("index");e('#localCheckLabel[data-index="'+a+'"]').find("input:checkbox:first").is(":checked")||e('#intCheckLabel[data-index="'+a+'"]').find("input:checkbox:first").is(":checked")||e("#errorcheckLabel"+a).hide()},requestcompile:function(){hideSpinner(),this.$el.html(t.template(c,{})).i18n(),this.$el.trigger("create");var e=n.get("device.platform");return"Android"==e||"Ios"==e?this.datefunc():this.datefunc(),this},validatePoints:function(){var t=n.get("debitCardControlFetchDTO"),a=this;e("#errorcheckLabelEnd").hide(),t.forEach(function(t,a){e("#errorFromDate"+a).hide(),e("#errorToDate"+a).hide(),e("#errorcheckLabel"+a).hide(),e("#errorFromDate").hide(),e("#errorToDate").hide(),e("#errorFromDatePast"+a).hide(),e("#errorToDatePast"+a).hide(),e("#errorToDateGreater"+a).hide()});t.forEach(function(t,i){var r=e('#localCheckLabel[data-index="'+i+'"]').find("input:checkbox:first").is(":checked"),c=e('#intCheckLabel[data-index="'+i+'"]').find("input:checkbox:first").is(":checked");r&&c?t.controlFlag="B":r||1!=c?c||1!=r?r||c||(t.controlFlag="N"):t.controlFlag="L":t.controlFlag="I",a.verificationcompile()})},verificationcompile:function(){hideSpinner();var t=n.get("debitCardControlFetchDTO"),i=[];t.forEach(function(t,r){if(JSON.stringify(o[r])!=JSON.stringify(t)){var c=e('#localCheckLabel[data-index="'+r+'"]').find("input:checkbox:first").is(":checked"),l=e('#intCheckLabel[data-index="'+r+'"]').find("input:checkbox:first").is(":checked"),d={};d.CreditCardNumber=t.cardNumber,d.hidmaskcardnumber=t.debitCardnomasked,d.controlFlag=t.controlFlag,c&&l?(d.localflagval="Y",d.interflagval="Y"):c||1!=l?l||1!=c?c||l||(d.localflagval="N",d.interflagval="N"):(d.localflagval="Y",d.interflagval="N"):(d.localflagval="N",d.interflagval="Y");var h=getDeviceId(),s=t.cardNumber+""+h,u=CryptoJS.MD5(s);d.appCheckSum=u+"",i.push(d)}n.set("creditcardcontrols",i),a.history.navigate("#/debitCardusagecontrolconfirmrequest")})},datefunc:function(t){e(".nativedatepicker").focus(function(t){t.preventDefault();var a,i=e(this);if(""!==i.val()){var r=i.val(),c=/(\d+)\/(\d+)\/(\d+)/.exec(r),n=new Date(+c[3],+c[2]-1,+c[1]);a=Date.parse(n)}else t.preventDefault(),a=new Date;"number"==typeof a&&(a=new Date(a)),window.plugins.datePicker.show({date:a,mode:"date",allowOldDates:!0},function(e){if(e){var t=new Date(e),a=t.getDate(),r=t.getMonth()+1,c=t.getFullYear(),n=""+(9>=a?"0"+a:a)+"/"+(9>=r?"0"+r:r)+"/"+c;i.val(n)}i.blur()})})},errorresponse:function(){hideSpinner(),a.history.navigate("#/exception")}});return l});