define(["jquery","underscore","Backbone","models/validation/requestValidationModel","models/requests/requestMetaFormModel","backbonevalidation","collections/creditcard/creditCardSummaryCollections","collections/requests/blockDebitCardRequestCollections","collections/requests/blockDebitCardfetchRequestCollections","text!views/requests/stopcreditcardrequest.tpl"],function(e,t,r,i,n,o,c,s,a,l){var u=new EncryptedLocalStorage("secret"),d=r.View.extend({el:"#mobcontent",events:{"click #stopcreditcardrequest":"gotoconfirmrequest"},initialize:function(){},render:function(){u.set("currentPage","transferConfirm");var t=this,r="CC",i=r;i=null==i?"":i,checkSumEncrypt(i);var n=localStorage.getItem("FINALCHECKSUM"),t=this;timestamp=(new Date).getTime();var o=function(e){t.stopcardfetchdetails()},c=function(e){t.errorresponse()};t.collection=new a([],{}),showSpinner(),timestamp=(new Date).getTime();t.collection.fetch({data:e.param({appchecksum:n,access_token:u.get("access_token"),cardType:r}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(u.get("calltimeout")),success:function(e){"0000"==ackStatus?o(e):c(e)},error:c})},stopcardfetchdetails:function(){var t=this;timestamp=(new Date).getTime();var r=function(e){t.requestcompile()},i=function(e){t.errorresponse()};t.collection=new s([],{}),showSpinner(),timestamp=(new Date).getTime();var n="BLK_DEBITCARD",o=n;o=null==o?"":o,checkSumEncrypt(o);var c=localStorage.getItem("FINALCHECKSUM");t.collection.fetch({data:e.param({access_token:u.get("access_token"),code:n,appchecksum:c}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(u.get("calltimeout")),success:function(e){"0000"==ackStatus?r(e):i(e)},error:i})},requestcompile:function(){return hideSpinner(),e("#exp").val(""),this.$el.html(t.template(l,{})).i18n(),this.$el.trigger("create"),this},gotoconfirmrequest:function(t){e("#errorAct").hide(),e("#errorReason").hide(),e("#errorReplc").hide();var o="false",c="false",s="false";this.model=new i({url:"json/"}),this.$(".alert").hide(),r.Validation.bind(this);var a=this.$("form").serializeObject();if(this.model.set(a,{validate:!1})){this.model.clear(),r.Validation.unbind(this),t.preventDefault(),this.model=new n({url:"json/"});var l=e("input[name=accno]:checked").val(),d=e("#repreason option:selected").text(),p=e("#rplacecard option:selected").text(),h=(e("#repreason option:selected").text(),e("#rplacecard option:selected").text(),e("#repreason option:selected").val()),m=e("#rplacecard option:selected").val();if("undefined"==typeof l&&(o="true",e("#errorAct").show()),""==m&&(c="true",e("#errorReplc").show()),""==h&&(s="true",e("#errorReason").show()),"true"==o||"true"==c||"true"==s)return hideSpinner(),!1;var f=l.split("~"),v=f[0],w=f[1],g=f[2];u.set("stopCardNo",v),u.set("primaryAccount",w),u.set("repreason",d),u.set("rplacecard",p),u.set("cardtypeDesc",g),showSpinner(),this.verificationcompile()}else hideSpinner(),this.$(".alert-error").fadeIn(),t.preventDefault()},verificationcompile:function(e){this.undelegateEvents(),hideSpinner(),r.history.navigate("#/stopcreditcardconfirmrequest")},errorresponse:function(){hideSpinner(),r.history.navigate("#/exception")},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return d});