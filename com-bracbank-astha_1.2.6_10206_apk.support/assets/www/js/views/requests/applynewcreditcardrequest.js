define(["jquery","underscore","Backbone","models/requests/requestMetaFormModel","backbonevalidation","models/validation/requestValidationModel","routers/requestrouter","collections/requests/applyFinanceRequestPostingCollections","collections/requests/requestVerificationCollections","text!views/requests/applynewcreditcardconfirmrequest.tpl","text!views/requests/applynewcreditcardrequest.tpl","views/requests/applynewcreditcardrequestresult"],function(e,t,r,i,n,a,o,c,s,d,l,p){var u=new EncryptedLocalStorage("secret"),h=r.View.extend({el:"#mobcontent",events:{"click #applynewcreditcardrequest":"gotoconfirmrequest","click #applynewcreditcardrequestposting":"applynewcreditcardrequestposting","change #cardtype":"changeCardType"},initialize:function(){new o},update:function(t,r){u.set("currentPage","");var i=this;timestamp=(new Date).getTime();var n=function(e){i.requestcompile()},a=function(e){i.errorresponse()};i.collection=new c([],{}),timestamp=(new Date).getTime(),showSpinner();var o="",s=u.get("lang_id");"en-US"==s?o="EN":"en-AR"==s&&(o="AR"),i.collection.fetch({data:e.param({requestid:timestamp,service:"01",language:o,paramcode:"SRVNEWCC",status:"ACTIVE"}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(u.get("calltimeout")),success:function(e){"0000"==ackStatus?n(e):a(e)},error:a})},requestcompile:function(){return hideSpinner(),this.$el.html(t.template(l,{})).i18n(),this.$el.trigger("create"),this.changeCardType(),this},changeCardType:function(){var r=u.get("cardListApply"),i=e("#cardtype option:selected").val().split("~")[1];if(e("#cardname").empty(),e("#cardname").append('<option value="">'+e.i18n.t("app.requests.newcc.selectcardname")+"</option>"),t.each(r,function(t){"undefined"!=typeof t&&"QMASTERTITANIUM"!=t.cardCode&&"QMASTERTITANIUMLOW"!=t.cardCode&&"QMASTERWORLD"!=t.cardCode&&e("#cardname").append('<option value="'+t.cardDesc+'">'+t.cardDesc+"</option>")}),"ISLAMIC"==i){var n=0;t.each(r,function(t){("QMASTERTITANIUM"==t.cardCode||"QMASTERTITANIUMLOW"==t.cardCode||"QMASTERWORLD"==t.cardCode)&&(e("#cardname option:eq("+n+")").after("<option value='"+t.cardDesc+"'>"+t.cardDesc+"</option>"),n++)})}},applynewcreditcardrequestposting:function(){this.subview=this.disposeView(new p),this.subview.render(),this.undelegateEvents()},gotoconfirmrequest:function(t){e("#errorCheckBox").hide(),this.model=new a({url:"json/"}),this.$(".alert").hide(),r.Validation.bind(this);var n=this.$("form").serializeObject();if(this.model.set(n,{validate:!0})){this.model.clear(),r.Validation.unbind(this),t.preventDefault(),this.model=new i({url:"json/"});var o=e("#cardtype option:selected").val().split("~")[0],c="false";""==o&&(c="true",e("#errorCardType").show());var s=e("#cardname option:selected").val();if(""==s&&(c="true",e("#errorCardName").show()),!e("#iagreee").prop("checked"))return e("#errorCheckBox").show(),!1;var d=u.get("birthdateforcc"),l=u.get("userlogin"),p=u.get("mobileforcc"),h=e("input[name=frmacno]:checked").val();"undefined"==typeof h&&(c="true",e("#errorFromAct").show());var m=e("#selectcity").val(),v=e("#empname").val(),f=e("#los").val(),w=e("#sal").val(),g=h.split("~"),y=(g[0],g[1]);showSpinner(),this.verificationcompile(o,s,l,d,p,y,m,v,f,w)}},verificationcompile:function(e,t,i,n,a,o,c,s,d,l){var p=new Array;p[0]=e,p[1]=i,p[2]=n,p[3]=a,p[4]=o,p[5]=c,p[6]=s,p[7]=d,p[8]=l,p[9]=t,u.set("applynewcc",p),hideSpinner(),r.history.navigate("#/applynewcreditcardconfirmrequest")},errorresponse:function(){hideSpinner(),r.history.navigate("#/exception")},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return h});