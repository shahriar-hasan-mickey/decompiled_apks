define(["jquery","underscore","Backbone","models/validation/requestValidationModel","models/requests/requestMetaFormModel","backbonevalidation","collections/requests/blockDebitCardRequestCollections","collections/requests/requestVerificationCollections","views/requests/blockdebitcardconfirmrequest","text!views/requests/blockdebitcardrequest.tpl"],function(e,t,i,n,o,r,s,a,c,l){var u=new EncryptedLocalStorage("secret"),d=i.View.extend({el:"#mobcontent",events:{"click #managedebitcardrequest":"gotoconfirmrequest","change  #accno":"expiryDate"},update:function(){u.set("currentPage","transferConfirm");var t=this;timestamp=(new Date).getTime();var i=function(e){t.requestcompile()},n=function(e){t.errorresponse()};t.collection=new s([],{});var o=u.get("custno");showSpinner(),timestamp=(new Date).getTime();t.collection.fetch({data:e.param({status:"ACTIVE",requestid:timestamp,custno:o}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(u.get("calltimeout")),success:function(e){"0000"==ackStatus?i(e):n(e)},error:n})},requestcompile:function(){return hideSpinner(),e("#exp").val(""),this.$el.html(t.template(l,{})).i18n(),this.$el.trigger("create"),this},expiryDate:function(){var t=e("#accno option:selected").val();if("undefined"!=typeof t||""!=t){var i=t.split("~");expDate=i[1];var n=i[2];e("#exp").val(n)}u.set("blockExpDate",expDate)},gotoconfirmrequest:function(t){this.model=new n({url:"json/"}),this.$(".alert").hide(),i.Validation.bind(this);var r=this.$("form").serializeObject();if(this.model.set(r,{validate:!0})){this.model.clear(),i.Validation.unbind(this),t.preventDefault(),this.model=new o({url:"json/"});var s,a,c,l=e("#accno option:selected").val();if("undefined"!=typeof l||""!=l){var d=l.split("~");s=d[0],c=d[1],a=e("#accno option:selected").text()}var l=e("#accno option:selected").text();showSpinner(),u.set("blockCardNo",s),u.set("blockCardMaskNo",a),this.verificationcompile()}else hideSpinner(),this.$(".alert-error").fadeIn(),t.preventDefault()},verificationcompile:function(e){this.undelegateEvents(),hideSpinner(),i.history.navigate("#/blockdebitcardconfirmrequest")},errorresponse:function(){hideSpinner(),i.history.navigate("#/exception")},disposeView:function(e){return i.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return d});