define(["jquery","underscore","Backbone","models/validation/requestValidationModel","models/requests/requestMetaFormModel","backbonevalidation","collections/requests/blockDebitCardfetchRequestCollections","collections/requests/blockDebitCardRequestCollections","text!views/requests/stopatmcardrequest.tpl"],function(e,t,r,n,i,o,c,s,a){var l=new EncryptedLocalStorage("secret"),u=r.View.extend({el:"#mobcontent",events:{"click #stopatmcardrequest":"gotoconfirmrequest"},initialize:function(){},render:function(){l.set("currentPage","transferConfirm");var t="DC",r=t;r=null==r?"":r,checkSumEncrypt(r);var n=localStorage.getItem("FINALCHECKSUM"),i=this;timestamp=(new Date).getTime();var o=function(e){i.stopatmcardfetch()},s=function(e){i.errorresponse()};i.collection=new c([],{}),showSpinner(),timestamp=(new Date).getTime();i.collection.fetch({data:e.param({appchecksum:n,access_token:l.get("access_token"),cardType:t}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(l.get("calltimeout")),success:function(e){"0000"==ackStatus?o(e):s(e)},error:s})},stopatmcardfetch:function(){var t=this;timestamp=(new Date).getTime();var r=function(e){t.requestcompile()},n=function(e){t.errorresponse()};t.collection=new s([],{}),showSpinner(),timestamp=(new Date).getTime();var i="BLK_DEBITCARD",o=i;o=null==o?"":o,checkSumEncrypt(o);var c=localStorage.getItem("FINALCHECKSUM");t.collection.fetch({data:e.param({access_token:l.get("access_token"),code:i,servicecode:i,appchecksum:c}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(l.get("calltimeout")),success:function(e){"0000"==ackStatus?r(e):n(e)},error:n})},requestcompile:function(){return hideSpinner(),e("#exp").val(""),this.$el.html(t.template(a,{})).i18n(),this.$el.trigger("create"),this},gotoconfirmrequest:function(t){e("#errorReplc").hide(),e("#errorReason").hide(),e("#errorAct").hide();var o="false",c="false",s="false",a=e("#repreason").val(),u=e("#rplacecard").val();this.model=new n({url:"json/"}),this.$(".alert").hide(),r.Validation.bind(this);var p=this.$("form").serializeObject();if(this.model.set(p,{validate:!0})){this.model.clear(),r.Validation.unbind(this),t.preventDefault(),this.model=new i({url:"json/"});var d,h=e("input[name=accno]:checked").val(),m=e("#repreason option:selected").text(),f=e("#rplacecard option:selected").text();if(("undefined"==typeof h||""==h)&&(o="true",e("#errorAct").show()),"00"==u&&(c="true",e("#errorReplc").show()),"00"==a&&(s="true",e("#errorReason").show()),"true"==o||"true"==c||"true"==s)return hideSpinner(),!1;var v=h.split("~");d=v[0],primaryAccount=v[1],cardtypeDesc=v[2],showSpinner(),l.set("stopCardNo",d),l.set("stopCardMaskNo",d),l.set("repreason",m),l.set("rplacecard",f),l.set("primaryAccount",primaryAccount),l.set("cardtypeDesc",cardtypeDesc),this.verificationcompile()}else hideSpinner(),this.$(".alert-error").fadeIn(),t.preventDefault()},verificationcompile:function(e){this.undelegateEvents(),hideSpinner(),r.history.navigate("#/stopatmcardconfirmrequest")},errorresponse:function(){hideSpinner(),r.history.navigate("#/exception")},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return u});