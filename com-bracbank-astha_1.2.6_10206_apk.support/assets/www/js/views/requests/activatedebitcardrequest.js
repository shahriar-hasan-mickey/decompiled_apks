define(["jquery","underscore","Backbone","models/validation/requestValidationModel","models/requests/requestMetaFormModel","collections/requests/activateDebitCardRequestPostingCollections","collections/requests/requestVerificationCollections","views/requests/activatedebitcardconfirmrequest","text!views/requests/activatedebitcardrequest.tpl"],function(e,t,r,i,n,o,s,a,l){var c=new EncryptedLocalStorage("secret"),h=r.View.extend({el:"#mobcontent",events:{"click #managedebitcardrequest":"gotoconfirmrequest"},update:function(){c.set("currentPage",""),showSpinner(),this.requestcompile()},requestcompile:function(){return hideSpinner(),this.$el.html(t.template(l,{})).i18n(),this.$el.trigger("create"),this},gotoconfirmrequest:function(t){e("#errorMonth").hide(),e("#errorYear").hide(),e("#errorFromAct").hide(),this.model=new i({url:"json/"}),this.$(".alert").hide(),r.Validation.bind(this);var o=this.$("form").serializeObject();if(this.model.set(o,{validate:!0})){this.model.clear(),r.Validation.unbind(this),t.preventDefault(),this.model=new n({url:"json/"});var s=e("#cardno").val();c.set("acctno",s);var a=e("#mm").val(),l=e("#yy").val(),h=l+a;c.set("expiryform",h);var u=a+-l,d=l+-a,m="XXXXXXXX"+s.substring(s.length-4);c.set("DebitCardNo",m),c.set("frmacno",s),c.set("mmyy",u),c.set("mmyyArabic",d),frmdatearr=u.split("-"),monthVal=frmdatearr[0],yearVal=frmdatearr[1];var p=new Date,f=p.getYear()+1900+"",v=parseInt(f.substring(2)),V=!1;if(parseInt(yearVal)==v){var w=p.getMonth()+1;parseInt(monthVal)<w&&(V=!0,e("#errorMonth").show())}if((parseInt(monthVal)<0||parseInt(monthVal)>13)&&(V=!0,e("#errorMonth").show()),parseInt(yearVal)>=v?parseInt(monthVal)>0&&parseInt(monthVal)<13||(V=!0,e("#errorMonth").show()):(V=!0,e("#errorYear").show()),1==V)return!1;showSpinner(),this.verificationcompile()}else this.$(".alert-error").fadeIn(),t.preventDefault()},verificationcompile:function(){r.history.navigate("#/activatedebitcardconfirmrequest")},errorresponse:function(){hideSpinner(),r.history.navigate("#/exception")},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return h});