define(["jquery","underscore","Backbone","models/requests/requestAcountOpeningModel","collections/requests/applyAdditionalAccountCollections","text!views/requests/addaccopeningrequest.tpl"],function(e,a,t,c,s,n){var r=new EncryptedLocalStorage("secret"),l=t.View.extend({el:"#mobcontent",events:{"click #addAccount":"gotoAddAccount","click #addaccopeningurl":"addaccopeningurl","change #accountType":"changeAccount","change #currencyType":"changeCurrency","change input[type=radio][name=debitCardNeed]":"changeDebitCard","change input[type=radio][name=modeOfDelivery]":"changeModeOfDelivery"},initialize:function(){},update:function(a,t){r.set("currentPage",""),r.set("accDebitCardUsed","NO");var c=this;timestamp=(new Date).getTime();var n=r.get("branchcode");null!=n&&""!=n&&(n=n.substring(0,3));var l=function(e){c.requestcompile()},o=function(e){c.errorresponse()};c.collection=new s([],{}),timestamp=(new Date).getTime(),showSpinner(),c.collection.fetch({data:e.param({branchcode:n}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(r.get("calltimeout")),success:function(e){"0000"==ackStatus?l(e):o(e)},error:o})},gotoAddAccount:function(){this.model=new c({url:"json/"}),t.Validation.bind(this);var a=this.$("form").serializeObject();e("#errorDelivery").hide(),e("#errorNameOnCard").hide(),e("#errorCheckBox").hide();var s=!1;if(e("#checkConfirm").prop("checked")||(e("#errorCheckBox").show(),s=!0),e("#labelYes").hasClass("btn-success")&&(e("#selectModeOfDelivery label").hasClass("btn-success")||(e("#errorDelivery").show(),s=!0),e("#labelPost").hasClass("btn-success")&&""==e("#debitcardname").val()&&(e("#errorNameOnCard").show(),s=!0)),this.model.set(a,{validate:!0})){if(this.model.clear(),t.Validation.unbind(this),hideSpinner(),s)return!1;var n=e("#accountType").val().split("~"),l=e("#purposeofAccount").val().split("~");r.set("aacaccountTypeVal",n[0]),r.set("aacaccountTypeDesc",n[1]),r.set("aaccurrencyType",e("#currencyType").val()),r.set("aacpurposeofAccountVal",l[0]),r.set("aacpurposeofAccountDesc",l[1]);var o=e("input[type=radio][name=debitCardNeed]:checked");if(o.length>0)selectedVal=o.val(),"yes"==selectedVal?(r.set("accNameOnCard",e("#debitcardname").val()),r.set("aacdebitCardNeed",e.i18n.t("app.requests.additionalAccount.yes"))):(r.set("accNameOnCard",""),r.set("aacdebitCardNeed",e.i18n.t("app.requests.additionalAccount.no")));else{var d=r.get("accDebitCardUsed");"YES"==d?(r.set("aacdebitCardNeed",e.i18n.t("app.requests.additionalAccount.yes")),r.set("accNameOnCard",e("#debitcardname").val())):(r.set("aacdebitCardNeed",e.i18n.t("app.requests.additionalAccount.no")),r.set("accNameOnCard",""))}var o=e("input[type=radio][name=modeOfDelivery]:checked");if(o.length>0)if(selectedVal=o.val(),"branch"==selectedVal)r.set("aacdeliveryType","branch"),r.set("aacmodeOfDelivery",e.i18n.t("app.requests.additionalAccount.deliveryBranch"));else{var d=r.get("accDebitCardUsed");"YES"==d?(r.set("aacdeliveryType","post"),r.set("aacmodeOfDelivery",e.i18n.t("app.requests.additionalAccount.deliveryPost"))):(r.set("aacdeliveryType",""),r.set("aacmodeOfDelivery",""))}else{var d=r.get("accDebitCardUsed");"YES"==d?(r.set("aacdeliveryType","branch"),r.set("aacmodeOfDelivery",e.i18n.t("app.requests.additionalAccount.deliveryBranch"))):(r.set("aacdeliveryType",""),r.set("aacmodeOfDelivery",""))}r.set("aacaddress",e("#address").val()),this.gotoAddAccountcompile()}else this.$(".alert-error").fadeIn(),hideSpinner()},gotoAddAccountcompile:function(){r.set("fromAddAccOpening",!1),t.history.navigate("#/addaccopeningconfirmrequest")},changeCurrency:function(){var a=e("#currencyType").val();"KWD"==a?(r.set("showDebit",!0),e("#debitCardDiv").show()):(r.set("showDebit",!1),e("#debitCardDiv").hide()),e("#debitNo").attr("checked","checked"),e("#debitYes").removeAttr("checked"),r.set("accDebitCardUsed","NO"),e("#labelYes").removeClass("active"),e("#labelYes").removeClass("btn-success"),e("#labelYes").addClass("btn-default"),e("#labelNo").addClass("active"),e("#labelNo").removeClass("btn-default"),e("#labelNo").addClass("btn-success"),e("#Branch").attr("checked","checked"),e("#Post").removeAttr("checked"),e("#labelPost").removeClass("active"),e("#labelPost").removeClass("btn-success"),e("#labelPost").addClass("btn-default"),e("#labelBranch").addClass("active"),e("#labelBranch").removeClass("btn-default"),e("#labelBranch").addClass("btn-success"),e("#selectModeOfDelivery").hide(),e("#modifyAddress").hide()},changeAccount:function(){var t=e("#accountType").val().split("~")[0];e("#currencyType").empty(),i=0;var c=r.get("currencyList"),s=e.i18n.lng();e("#currencyType").append('<option id="accType'+i+'"value="">'+e.i18n.t("app.requests.additionalAccount.currency")+"</option>"),"1001"==t?a.each(c,function(a){"en-US"==s?e("#currencyType").append('<option value="'+a.currencyEngDesc+'">'+a.currencyEngDesc+"</option>"):e("#currencyType").append('<option value="'+a.currencyEngDesc+'">'+a.currencyArbDesc+"</option>")}):a.each(c,function(a){return"KWD"==a.currencyEngDesc?("en-US"==s?e("#currencyType").append('<option selected value="'+a.currencyEngDesc+'">'+a.currencyEngDesc+"</option>"):e("#currencyType").append('<option selected value="'+a.currencyEngDesc+'">'+a.currencyArbDesc+"</option>"),!1):void 0}),this.changeCurrency()},changeDebitCard:function(){var a=e("input[type=radio][name=debitCardNeed]:checked");a.length>0&&(selectedVal=a.val(),"yes"==selectedVal?(r.set("accDebitCardUsed","YES"),e("#labelYes").addClass("active"),e("#labelYes").addClass("btn-success"),e("#labelYes").removeClass("btn-default"),e("#labelNo").removeClass("active"),e("#labelNo").addClass("btn-default"),e("#labelNo").removeClass("btn-success"),e("#selectModeOfDelivery").show(),e("#branchinfoo").show()):(r.set("accDebitCardUsed","NO"),e("#labelYes").removeClass("active"),e("#labelYes").removeClass("btn-success"),e("#labelYes").addClass("btn-default"),e("#labelNo").addClass("active"),e("#labelNo").removeClass("btn-default"),e("#labelNo").addClass("btn-success"),e("#selectModeOfDelivery").hide(),e("#branchinfoo").hide())),e("#modifyAddress").hide()},changeModeOfDelivery:function(){var a=e("input[type=radio][name=modeOfDelivery]:checked");a.length>0&&(selectedVal=a.val(),"branch"==selectedVal?(e("#labelBranch").addClass("active"),e("#labelBranch").addClass("btn-success"),e("#labelBranch").removeClass("btn-default"),e("#labelPost").removeClass("active"),e("#labelPost").addClass("btn-default"),e("#labelPost").removeClass("btn-success"),e("#modifyAddress").hide(),e("#branchinfoo").show()):(e("#labelBranch").removeClass("active"),e("#labelBranch").removeClass("btn-success"),e("#labelBranch").addClass("btn-default"),e("#labelPost").addClass("active"),e("#labelPost").removeClass("btn-default"),e("#labelPost").addClass("btn-success"),e("#modifyAddress").show(),e("#branchinfoo").hide()))},requestcompile:function(){hideSpinner(),r.set("accountTypeList",accountTypeList),r.set("currencyList",currencyList),r.set("purposeList",purposeList),r.set("smeNotAllowed",!1),r.set("primaryAccountInnactive",!1),r.set("maximumLimitReached",!1),r.set("allowedForAccount",!0);var e=r.get("segmentvalue"),t=r.get("myaccounts"),c=r.get("myaccountslength");return c>=5&&(r.set("maximumLimitReached",!0),r.set("allowedForAccount",!1)),a.each(t,function(e){return"ACTIVE"!=e.acctStatus?(r.set("primaryAccountInnactive",!0),r.set("allowedForAccount",!1),!1):void 0}),a.each(segmentCodeList,function(a){return a.segmentCode==e?(r.set("smeNotAllowed",!0),r.set("allowedForAccount",!1),!1):void 0}),this.$el.html(a.template(n,{})).i18n(),this.$el.trigger("create"),this},updateUserSelection:function(){this.$el.html(a.template(n,{accountTypeList:r.get("accountTypeList"),currencyList:r.get("currencyList"),purposeList:r.get("purposeList")})).i18n();var t=r.get("accUserSelection");return e("#accountType").prop("selectedIndex",t[2].accountType),this.changeAccount(),e("#currencyType").prop("selectedIndex",t[3].currencyType),this.changeCurrency(),e("#debitYes").attr("checked","checked"),e("#debitNo").removeAttr("checked"),e("#Post").attr("checked","checked"),e("#Branch").removeAttr("checked"),e("#purposeofAccount").prop("selectedIndex",t[4].purposeofAccount),e("#debitcardname").val(t[5].nameOnCard),r.set("accDebitCardUsed","YES"),r.set("accNameOnCard",e("#debitcardname").val()),r.set("aacdebitCardNeed",e.i18n.t("app.requests.additionalAccount.yes")),e("#labelYes").addClass("active"),e("#labelYes").addClass("btn-success"),e("#labelYes").removeClass("btn-default"),e("#labelNo").removeClass("active"),e("#labelNo").addClass("btn-default"),e("#labelNo").removeClass("btn-success"),e("#selectModeOfDelivery").show(),e("#modifyAddress").show(),e("#labelBranch").removeClass("active"),e("#labelBranch").removeClass("btn-success"),e("#labelBranch").addClass("btn-default"),e("#labelPost").addClass("active"),e("#labelPost").removeClass("btn-default"),e("#labelPost").addClass("btn-success"),this.$el.trigger("create"),this},addaccopeningurl:function(){var a=(r.get("lang_id"),[{checkBox:e("#checkConfirm").prop("checked")},{labelYes:e("#labelYes").hasClass("btn-success")},{accountType:e("#accountType").prop("selectedIndex")},{currencyType:e("#currencyType").prop("selectedIndex")},{purposeofAccount:e("#purposeofAccount").prop("selectedIndex")},{nameOnCard:e("#debitcardname").val()}]);r.set("accUserSelection",a),r.set("fromAddAccOpening",!0),t.history.navigate("#/profileUpdation")},errorresponse:function(){hideSpinner(),t.history.navigate("#/exception")},disposeView:function(e){return t.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return l});