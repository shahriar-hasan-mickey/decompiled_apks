define(["jquery","underscore","Backbone","collections/qrcode/qrCodeCollections","text!views/qrScan/qrScanner.tpl"],function(e,n,t,o,r){var i=new EncryptedLocalStorage("secret"),c=t.View.extend({el:"#container",events:{"click #scanQRCode":"openQRScanner"},render:function(){this.$el.trigger("create"),e("html").removeClass().addClass("app fntzoom"),this.$el.html(n.template(r))},openQRScanner:function(){var e=this,n=/Android|iPad|iPhone|iPod/.test(navigator.userAgent);if(n)cordova.plugins.barcodeScanner.scan(function(n){if(!n.cancelled&&"QR_CODE"==n.format){var t=n.text;window.localStorage.setItem("qrContent",t),e.sendQRContent()}},function(e){},{showTorchButton:!0,prompt:"",disableSuccessBeep:!0,resultDisplayDuration:0});else{var t="0002010102120216432149001234567852044321530335654031505502025602105802IN5904TEST6008CHENNAI 6106637404627101045432021093854142160305TESLA0404TEST050467780605NHHCN07036780804TEST64220002BD0105HUIOP0203DH56304D08E";window.localStorage.setItem("qrContent",t),e.sendQRContent()}},sendQRContent:function(){var n=this,r=function(e){hideSpinner(),t.history.navigate("#/qrscaninitiate")},c=function(e){hideSpinner(),n.errorresponse()};showSpinner(),n.collection=new o,n.collection.fetch({data:e.param({access_token:i.get("access_token"),qrcode:window.localStorage.getItem("qrContent")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):c(e)},error:c})},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return t.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return c});