define(["jquery","underscore","Backbone","collections/qrcode/qrCodeCollections","collections/transfer/getAuthModeCollections","collections/bills/cardSummaryCollections","collections/wealth/otpPostLoginGenerationCollections","collections/wealth/otpPostLoginVerificationCollections","collections/transfer/getTransactionLimitCollections","collections/transfer/getAccountBalanceCollections","collections/transfer/currencyListsCollections","collections/qrcode/qrPaymentValidationCollections","collections/qrcode/bKashQRPaymentValidationCollections","collections/qrcode/qrCodeCardPinCollections","collections/qrcode/qrCodeFetchBkashFeeCollections","text!views/qrScan/bKashQRScanInitiate.tpl"],function(e,t,a,r,n,o,l,i,s,c,u,m,p,d,h,g){var _=null,f=new EncryptedLocalStorage("secret"),y=a.View.extend({el:"#container",events:{"click .bkash_acccardnumtype":"qrPayFromSelect","blur #bkash_qrtips_amount":"qrPayTotalAMT","click #qr_close_btn":"revokeQROTPSpinner","click #qr_cancel_btn":"revokeQROTPSpinner","click #bkash_qrscan_cancel":"navigateToQRScanner","click #qr_verifyOTP":"qrVerifyOTP","click #qrscan_payverify":"openAuthModePopup","click #bksh_qrscan_confirm":"qrScanPayVerifyPopup","click #bkash_crdaccid li.list-group-item":"qrPaymentModel","keyup #bkashqrscan_amount":"validateAmountOnKeyUp","click #bKashQRTandCPopup":"bKashQROpenTandCPopup"},render:function(){_=null;var t=this;e("#qravailBalDiv").hide(),f.set("cardaccuntid",""),f.set("isError","false"),f.set("conPercentageFee",""),f.set("isbKashFee","false"),f.set("paymentAmount",""),t.getCreditPrepaidCardsList()},getCreditPrepaidCardsList:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var a=this,r=function(r){f.set("cardaccuntid",""),f.set("selectCardType",""),f.set("selectCurrencyType",""),f.set("singlecrdval",""),e("#seltpayval").html(""),e("#qravailBalDiv").hide();var n=f.get("ccListDTO"),o=f.get("pcListDTO"),l=f.get("dcListDTO"),i=getAccountDTO(),s=[];if(!isNull(n)&&isNull(o)&&isNull(i)&&isNull(l)&&isNull(s)&&(s=n.filter(function(e){return""!=e.merchantType&&"Y"==e.bkashQRFlag}),1==s.length&&(s[0].cardType="CC")),!isNull(o)&&isNull(n)&&isNull(i)&&isNull(l)&&isNull(s)&&(s=o.filter(function(e){return""!=e.merchantType&&"Y"==e.bkashQRFlag}),1==s.length&&(s[0].cardType="PC")),!isNull(l)&&isNull(n)&&isNull(o)&&isNull(i)&&isNull(s)&&(s=l.filter(function(e){return""!=e.merchantType&&"Y"==e.bkashQRFlag}),1==s.length&&(s[0].cardType="DC")),1==s.length){(isNull(f.get("qrmerchantCategory"))||isNull(f.get("qrmerchantCategory1"))||f.get("qrmerchantCategory")!=s[0].merchantType&&f.get("qrmerchantCategory1")!=s[0].merchantType)&&(isNull(f.get("qrmerchantCategory"))||f.get("qrmerchantCategory")!=s[0].merchantType)&&(isNull(f.get("qrmerchantCategory1"))||f.get("qrmerchantCategory1")!=s[0].merchantType)?(f.set("cardaccuntid",s[0].id),f.set("selectCardType",s[0].cardType),f.set("selectCurrencyType",s[0].currencyCode),a.getAccountBalance(t)):(f.set("cardaccuntid",s[0].id),f.set("selectCardType",s[0].cardType),f.set("selectCurrencyType",s[0].currencyCode),a.getAccountBalance(t));var c='<div class="qr_acc_outer">\n <ul class="list-unstyled m0">\n <li class="list-group-item">\n <div class="col-xs-2 first-col">\n';c+="CASA"==s[0].cardType?'<span class="menu_icon account"></span>':"VISA"==s[0].merchantType?'<span class="menu_icon visa"></span>':'<span class="menu_icon mastercard"></span>',"CASA"==s[0].cardType?(c+='\n</div>\n <div class="col-xs-10">\n<p class="acc_txt"> '+s[0].accountShortName+'</p>\n<p class="acc_cat"><span class="selectAccNumber"> '+s[0].accountNumber+" </span></p>\n</div>\n </li>\n </ul>\n </div>",f.set("singlecrdval",c)):(c+='\n</div>\n <div class="col-xs-10">\n<p class="acc_txt"> '+s[0].productName+'</p>\n<p class="acc_cat"> '+s[0].merchantType+' | <span class="selectAccNumber"> '+s[0].accountNumber+" </span></p>\n</div>\n </li>\n </ul>\n </div>",f.set("singlecrdval",c))}a.getTransLimitView()},n=function(e){a.getTransLimitView()};showSpinner(),a.collection=new o([],{}),a.collection.fetch({data:e.param({newversion:"Y",paytype:"BKASH_QR_PAYMENT",ctrycode:f.get("merCountry"),currcode:f.get("txnCurrency"),access_token:f.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):n(e)},error:n})},getTransLimitView:function(a){"object"==typeof a&&(a.preventDefault(),a.stopImmediatePropagation());var r=this,n=function(n){if(hideSpinner(),e("html").removeClass().addClass("app fntzoom"),e("div").removeClass("modal-backdrop fade in"),r.$el.html(t.template(g)),f.set("isAmtblur","false"),f.set("isAmountError","false"),r.$el.trigger("create"),e("#qravailBalDiv").hide(),e("#bankFeeDiv").hide(),e("#bkashqrscan_amount").blur(function(){f.set("isAmtblur","true"),f.set("paymentAmount",""),"BDT"!=f.get("txnCurrency")?(r.getQRConvertedAmount(a),r.qrPayTotalAMT(a)):(r.qrPayTotalAMT(a),r.getbKashQRFeeAmount(a))}),isNull(f.get("txnAmt"))||(r.getbKashQRFeeAmount(a),r.getQRScanAuthMode()),isNull(f.get("singlecrdval")))e("#seltpayval").html(e.i18n.t("app.qrcode.selctcard"));else{e("#seltpayval").html(f.get("singlecrdval"));var o=f.get("cardaccuntid");e('li.bkash_acccardnumtype[accide="'+o+'"]').find("input").attr("checked","checked")}r.qrPayTipsModel(),r.qrPayTotalAMT()},o=function(a){e("html").removeClass().addClass("app fntzoom"),r.$el.html(t.template(g)),f.set("isAmtblur","false"),f.set("isAmountError","false"),e("#bankFeeDiv").hide(),r.$el.trigger("create"),e("#qravailBalDiv").hide(),isNull(f.get("txnAmt"))?hideSpinner():r.getQRScanAuthMode(),r.qrPayTipsModel(),r.qrPayTotalAMT()};r.collection=new s,r.collection.fetch({data:e.param({access_token:f.get("access_token"),payeeType:"BKASH_QR_PAYMENT"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?n(e):o(e)},error:o})},getbKashQRFeeAmount:function(t){if("object"==typeof t&&t.stopImmediatePropagation(),!isNull(f.get("cardaccuntid"))&&"true"!=f.get("isAmountError")){var a=e("#bkashqrscan_amount").val().replace(/,/g,""),r=checkAmount(e.formatNumber(a,{format:"#,###.00",locale:"us"})),n=r.replace(/,/g,"");if(!isNull(n)){var o=this,l=function(a){hideSpinner(),f.set("isbKashFee","true");var r=parseFloat(f.get("totalfee"));"0"!=r||0!=r?(e("#bankFeeDiv").show(),e("#bkashQRFee").html(checkAmount(e.formatNumber(f.get("totalfee"),{format:"#,###.00",locale:"us"})))):(e("#bankFeeDiv").hide(),e("#bkashQRFee").html("")),o.qrPayTotalAMT(),o.getQRScanAuthMode(t)},i=function(t){hideSpinner(),f.set("isbKashFee","false"),e("#bankFeeDiv").hide(),e("#bkashQRFee").html(""),o.errorresponse()};showSpinner(),o.collection=new h,o.collection.fetch({data:e.param({access_token:f.get("access_token"),accountid:f.get("cardaccuntid"),amount:n,currency:f.get("selectCurrencyType"),walletNo:f.get("bKashQRWalletNumber"),merchantName:f.get("merName"),mcc:f.get("mcc"),counter:f.get("coutnerNo"),qrid:f.get("bKashQRId")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?l(e):i(e)},error:i})}}},getQRConvertedAmount:function(t){if(!isNull(f.get("cardaccuntid"))){var a=f.get("paymentAmount");if(!isNull(a)&&!isNull(f.get("cardaccuntid"))&&!isNull(a)){var r=(f.get("limitId"),f.get("bKashQRId"),f.get("accountTitle"),e(".qrAddInfo:first").val(),e(".qrAddInfo:last").val(),f.get("tipIndicator"),e("#bkash_qrtips_amount").val()),n=(isNull(r)?"":parseFloat(r.replace(/,/g,"")),isNull(r)?"":parseFloat(r.replace(/,/g,"")),this),o=function(e){hideSpinner(),n.getbKashQRFeeAmount(t),n.getQRScanAuthMode(t)},l=function(e){hideSpinner(),n.errorresponse()};showSpinner(),n.collection=new p,n.collection.fetch({data:e.param({access_token:f.get("access_token"),accountid:f.get("cardaccuntid"),amount:a,currency:f.get("txnCurrency"),validtype:"Validation",limitId:f.get("limitId"),totalFee:f.get("totalfee"),totalDebitAmount:"",globalTranValidationId:"",billUniqueId:"",remarks:"",walletNo:f.get("bKashQRWalletNumber"),counter:f.get("coutnerNo"),merchantName:f.get("merName"),mcc:f.get("mcc"),qrid:f.get("bKashQRId"),sendername:f.get("accountTitle")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?o(e):l(e)},error:l})}}},getQRScanAuthMode:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var a=this;f.set("IsAuthMode","false"),e("#qrCardPinDiv").html(""),e("#qrscan_auth_mode").html(""),e("#bakshQR_transAmountError").html("");var r;if("BDT"!=f.get("txnCurrency"))r=f.get("totalDebitAmount");else{var o=e("#bkashqrscan_amount").val().replace(/,/g,""),l=checkAmount(e.formatNumber(o,{format:"#,###.00",locale:"us"}));r=l.replace(/,/g,"")}if(f.set("transferType","bKashQR"),isNull(r)||0==r)return void f.set("isError","false");if("BDT"!=f.get("txnCurrency"))r=f.get("totalDebitAmount");else{var o=f.get("bkashPaymentAmt").replace(/,/g,""),l=checkAmount(e.formatNumber(o,{format:"#,###.00",locale:"us"}));r=l.replace(/,/g,"")}var i=(parseFloat(f.get("minAmountPerTransaction")),parseFloat(f.get("maxAmountPerTransaction")),function(e){hideSpinner(),f.set("isError","false");var t=f.get("securitySettingList");!isNull(t)&&t.length>0?f.set("IsAuthMode","true"):(f.set("alertType",null),f.set("IsAuthMode","false")),a.populateAuthMode()}),s=function(t){hideSpinner(),a.populateAuthMode(),f.set("isError","true"),f.set("authModeError",f.get("errordesc")),e("#bakshQR_transAmountError").html(f.get("errordesc")),e("#bkashqrscan_amount").val("")};showSpinner(),a.collection=new n,a.collection.fetch({data:e.param({access_token:f.get("access_token"),transactionAmount:r,tenantServiceCode:"BKASH_QR_PAYMENT",percent:f.get("conPercentage"),qrMode:"2FA"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):s(e)},error:s})},populateAuthMode:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var a="",r="";e("#qrCardPinDiv").html("");var n=f.get("securitySettingList"),o="<label for='username'>"+e.i18n.t("app.transfer.managebeneficiary.selectauthorisationmode")+"</label>";o+="<div class='custRadio_pass'>",!isNull(n)&&n.length>0?(e("#qrscan_auth_mode").html(""),e.each(n,function(t,n){"SMS"==n?(a="sms",r=e.i18n.t("app.transfer.managebeneficiary.sms")):"EMAIL"==n?(a="mail",r=e.i18n.t("app.transfer.managebeneficiary.mail")):"TOKEN"==n?(a="fScan",r=e.i18n.t("app.transfer.managebeneficiary.token")):"ESIGN"==n?(a="esign",r=e.i18n.t("app.transfer.managebeneficiary.esign")):"PIN"==n&&(a="credit",r="Card PIN"),o+='<div class="box"><div class="radio"><label>',o+=0==t?'<input type="radio" name="bkash_qr_payment_authmode" id="optionsRadios'+t+'" value="'+n+'" checked>':'<input type="radio" name="bkash_qr_payment_authmode" id="optionsRadios'+t+'" value="'+n+'">',o+='<div class="row bg"><div class="col-xs-12 p0"><span class="menu_icon ico-xs '+a+'"></span><span class="small">'+r+"</span></div></div></label></div></div>"}),e("#qrscan_auth_mode").html(o)):e("#qrscan_auth_mode").html("")},validateQRCard:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var a=this;if("false"==f.get("IsAuthMode"))return void a.qrPaymentPosting();var r=e("input[name='bkash_qr_payment_authmode']:checked").val();f.set("authmode",r),"SMS"==r||"EMAIL"==r||"ESIGN"==r?a.qrValidateCardPin("N"):"TOKEN"==r?(hideSpinner(),f.set("otpCode",""),f.set("alertType",r),e("#qr_verify").modal("show"),setTimeout(function(){e("#qr_otp1").focus()},500),e("#authModeOTPDiv").show(),e("#cardPinOTPDiv").hide(),e("#qr_otp1, #qr_otp2, #qr_otp3, #qr_otp4, #qr_otp5, #qr_otp6").removeAttr("data"),"TOKEN"==f.get("alertType")&&(e("#qr_titleAuth").html(e.i18n.t("app.registration.opthelptokentext")),e("#qr_myModalLabel").html(e.i18n.t("app.registration.otptokenheadertext")),e("#qr_challengeText").html(""),e("#OTPcontainer1").hide(),e("#qr_resend_btn").hide()),e("#qr_otpNullError").html(""),e("#qr_otpNullErrorDiv").hide(),e(".inputs").on("input",function(t){t.stopImmediatePropagation();var a=t.currentTarget.id,r=e("#"+a).val();e("#"+a).attr("data",r),e("#"+a).val(r.replace(/[^\*]/,"."))}),e("#qr_otp1, #qr_otp2, #qr_otp3, #qr_otp4, #qr_otp5, #qr_otp6").val("")):"PIN"==r&&(hideSpinner(),f.set("otpCode",""),f.set("alertType",r),e("#qr_verify").modal("show"),setTimeout(function(){e("#qr_pin1").focus()},500),e("#qr_titleAuth").html("Enter Card PIN"),e("#qr_myModalLabel").html(e.i18n.t("app.transferss.verfici")),e("#authModeOTPDiv").hide(),e("#cardPinOTPDiv").show(),e("#qr_challengeText").html(""),e("#OTPcontainer1").hide(),e("#qr_resend_btn").hide(),e("#qr_otpNullError").html(""),e("#qr_otpNullErrorDiv").hide(),e(".inputs").on("input",function(t){t.stopImmediatePropagation();var a=t.currentTarget.id,r=e("#"+a).val();e("#"+a).attr("data",r),e("#"+a).val(r.replace(/[^\*]/,"."))}),e("#qr_pin1, #qr_pin2, #qr_pin3, #qr_pin4").val(""))},qrValidateCardPin:function(t){e(".otp_msg_txt").html("");var a=e("input[name='bkash_qr_payment_authmode']:checked").val();f.set("alertType",a);var r=this,n=function(a){hideSpinner(),"PIN"!=f.get("alertType")&&("Y"==t&&(e("#OTPcontainer1").slideDown("slow"),_.set(1),_.animate(0,function(){e("#OTPcontainer1").slideUp("slow")})),e("#qr_verify").modal("show"),e("#authModeOTPDiv").show(),e("#cardPinOTPDiv").hide(),e("#qr_otp1, #qr_otp2, #qr_otp3, #qr_otp4, #qr_otp5, #qr_otp6").removeAttr("data"),"SMS"==f.get("alertType")?(e("#qr_titleAuth").html(e.i18n.t("app.registration.opthelptext")+" "+maskMobile(f.get("contactNumber"))),e("#qr_myModalLabel").html(e.i18n.t("app.transferss.verfici")),e("#qr_challengeText").html(""),e("#OTPcontainer1").show(),e("#qr_resend_btn").show()):"EMAIL"==f.get("alertType")?(e("#qr_titleAuth").html(e.i18n.t("app.registration.opthelptext")+" "+maskEmailID(f.get("emailId"))),e("#qr_myModalLabel").html(e.i18n.t("app.transferss.verfici")),e("#qr_challengeText").html(""),e("#OTPcontainer1").show(),e("#qr_resend_btn").show()):"ESIGN"==f.get("alertType")&&(e("#qr_titleAuth").html(e.i18n.t("app.registration.otphelpesigntext")),e("#qr_myModalLabel").html(e.i18n.t("app.transferss.verfici")),e("#qr_challengeText").html(e.i18n.t("app.transferss.genratedTocn")+" "+f.get("otpCode")),e("#OTPcontainer1").hide(),e("#qr_resend_btn").hide()),setTimeout(function(){e("#qr_otp1").focus()},500),e("#qr_otpNullError").html(""),e("#qr_otpNullErrorDiv").hide(),e(".inputs").on("input",function(t){t.stopImmediatePropagation();var a=t.currentTarget.id,r=e("#"+a).val();e("#"+a).attr("data",r),e("#"+a).val(r.replace(/[^\*]/,"."))}),e("#qr_otp1, #qr_otp2, #qr_otp3, #qr_otp4, #qr_otp5, #qr_otp6").val(""),("SMS"==f.get("alertType")||"EMAIL"==f.get("alertType"))&&r.invokeOTPSpinner())},o=function(e){r.errorresponse()};showSpinner(),r.collection=new l;getDeviceId(),(new Date).getTime();r.collection.fetch({data:e.param({access_token:f.get("access_token"),transactionType:"BKASH_QR_PAYMENT",resendflag:t,authMode:f.get("alertType")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?n(e):o(e)},error:o})},invokeOTPSpinner:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var a=this;return e("#qr_resend_btn").hide(),e("#OTPcontainer1").show(),e("#qr_otp1, #qr_otp2, #qr_otp3, #qr_otp4, #qr_otp5, #qr_otp6").val(""),null!=_?(_.set(1),void _.animate(0,function(){e("#OTPcontainer1").slideUp("slow")})):(_=new ProgressBar.Circle(OTPcontainer1,{color:"#333",strokeWidth:8,trailWidth:8,easing:"linear",duration:6e4*parseInt(f.get("otpExpiryPeriod")),text:{autoStyleContainer:!1},from:{color:"#ec5f59",width:8},to:{color:"#ec5f59",width:8},step:function(t,a){a.path.setAttribute("stroke",t.color),a.path.setAttribute("stroke-width",t.width);var r=Math.round(a.value()*(60*f.get("otpExpiryPeriod")));"0"==r?(a.setText(""),e("#qr_resend_btn").show()):(e("#qr_resend_btn").hide(),a.setText(r+"s"))}}),_.text.style.fontFamily='"Raleway", Helvetica, sans-serif',_.text.style.fontSize="12px",_.text.style.fontWeight="bold",_.set(1),_.animate(0,function(){e("#OTPcontainer1").slideUp("slow")}),void e("#qr_resend_btn").click(function(){a.qrValidateCardPin("Y")}))},revokeQROTPSpinner:function(){null!=_&&_.stop()},qrVerifyOTP:function(e){"object"==typeof e&&e.stopImmediatePropagation();var t=this;"PIN"==f.get("authmode")?t.qrCardPinValidation():t.qrVerifySuccessPopUp(e)},qrVerifySuccessPopUp:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var a="",r="";e("#qr_otpNullError").html(""),e("#qr_otpNullErrorDiv").hide();var n=e("#qr_otp1").attr("data"),o=e("#qr_otp2").attr("data"),l=e("#qr_otp3").attr("data"),s=e("#qr_otp4").attr("data"),c=e("#qr_otp5").attr("data"),u=e("#qr_otp6").attr("data");if(isNull(n)||isNull(o)||isNull(l)||isNull(s)||isNull(c)||isNull(u))return e("#qr_otpNullErrorDiv").show(),void e("#qr_otpNullError").html(e.i18n.t("validation.newregistration.otpnotnull"));var m=n+o+l+s+c+u,p=e("input[name='bkash_qr_payment_authmode']:checked").val();"SMS"==p?(r=f.get("mobileNo"),a=null):"EMAIL"==p&&(r=null,a=f.get("emailId"));var d=this,h=function(t){hideSpinner(),d.revokeQROTPSpinner(),e("#qr_verify").modal("hide"),d.qrPaymentValidation()},g=function(t){hideSpinner(),isNull(f.get("errordesc"))||(e("#qr_otpNullErrorDiv").show(),e("#qr_otpNullError").html(f.get("errordesc")))};showSpinner(),d.collection=new i,d.collection.fetch({data:e.param({access_token:f.get("access_token"),transactionType:"BKASH_QR_PAYMENT",activationno:m,uniqueId:f.get("otpCode"),twoFAType:f.get("alertType")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?h(e):g(e)},error:g})},validateAmountOnKeyUp:function(){e("#bakshQR_transAmountError").html("");var t=parseFloat(e("#bkashqrscan_amount").val().replace(/,/g,""));(isNaN(t)||0==t)&&(isError=!0,e("#bakshQR_transAmountError").html("Please enter amount to proceed further"))},bKashQROpenTandCPopup:function(e){e.stopImmediatePropagation(),f.set("tandctype","bkashQR"),openTermsAndConditionsPopup()},qrScanPayVerifyPopup:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var a=this,r=!1;e("#fromAcntNumErr").html(""),e("#qrCardPinError").html(""),e("#qr_loyality_err").html(""),e("#qr_reference_err").html(""),e("#bakshQR_transAmountError").html(""),e("#qr_bill_number_err").html(""),e("#qr_store_label_err").html(""),e("#qr_mobile_number_err").html(""),e("#qr_customer_label_err").html(""),e("#qr_terminal_number_err").html(""),e("#qr_purpose_transfer_err").html("");var n=f.get("securitySettingList"),o=e("#qrCardPin").val(),l=parseFloat(e("#bkash_qrtips_amount").val().replace(/,/g,"")),i=e("#qr_loyality").val(),s=e("#qr_reference").val(),c=e("#qr_store_label").val(),u=(e("#qr_bill_number").val(),e(".qrAddInfo:first").val()),m=e(".qrAddInfo:last").val(),p=e("#qr_mobile_number").val(),d=e("#qr_customer_label").val(),h=e("#qr_terminal_number").val(),g=e("#qr_purpose_transfer").val(),_=parseFloat(e("#bkashqrscan_amount").val().replace(/,/g,"")),y=parseFloat(e(".qramt").text().replace(/,/g,"")),v=parseFloat(f.get("qrfromAcntAvailBal")),b=parseFloat(f.get("dailyAvailableLimit")),q=parseFloat(f.get("minAmountPerTransaction")),T=parseFloat(f.get("maxAmountPerTransaction")),N=f.get("dailyAvailableCount"),A=f.get("monthlyAvailableCount"),b=parseFloat(f.get("dailyAvailableLimit")),k=parseFloat(f.get("monthlyAvailableLimit")),P=f.get("accountCurrency"),C=f.get("txnCurrency");if((isNaN(_)||0==_)&&(r=!0,e("#bakshQR_transAmountError").html("Please enter amount to proceed further")),"true"==f.get("isError")&&(r=!0,e("#bakshQR_transAmountError").html(f.get("authModeError"))),isNull(l)&&0==l&&"01"==f.get("tipIndicator")&&(r=!0,e("#bkashQR_tipsAmountError").html("Please enter valid tips amount")),isNull(f.get("cardaccuntid"))?(r=!0,e("#fromAcntNumErr").html("Please select a card to proceed for payment")):!isNull(f.get("cardaccuntid"))||"VISA"!=f.get("qrmerchantCategory")&&"VISA"!=f.get("qrmerchantCategory1")||"MASTER"!=f.get("selectMerchantType")?!isNull(f.get("cardaccuntid"))||"MASTER"!=f.get("qrmerchantCategory")&&"MASTER"!=f.get("qrmerchantCategory1")||"VISA"!=f.get("selectMerchantType")||(r=!0,e("#fromAcntNumErr").html("Please select a master card")):(r=!0,e("#fromAcntNumErr").html("Please select a visa card")),isNull(n)||"PIN"==n[0]&&isNull(o)&&!isNull(e("#qrCardPinDiv").html())&&(e("#qrCardPinError").html("Please enter the PIN"),r=!0),isNull(p)&&"E"==f.get("addMobNoFlg")?(r=!0,e("#qr_mobile_number_err").html("Please enter mobile number")):!isNull(p)&&p.length>25&&"E"==f.get("addMobNoFlg")&&(r=!0,e("#qr_mobile_number_err").html("The mobile number should contain maximum of 25 characters")),isNull(c)&&"E"==f.get("addStoreLabelFlg")?(r=!0,e("#qr_store_label_err").html("Please enter store label")):!isNull(c)&&c.length>25&&"E"==f.get("addStoreLabelFlg")&&(r=!0,e("#qr_store_label_err").html("The store label should contain maximum of 25 characters")),isNull(i)&&"E"==f.get("addLoyalNoFlg")?(r=!0,e("#qr_loyality_err").html("Please enter loyalty number")):!isNull(i)&&i.length>25&&"E"==f.get("addLoyalNoFlg")&&(r=!0,e("#qr_loyality_err").html("The loyalty number should contain maximum of 25 characters")),isNull(s)&&"E"==f.get("addRefNoFlg")?(r=!0,e("#qr_reference_err").html("Please enter reference label")):!isNull(s)&&s.length>25&&"E"==f.get("addRefNoFlg")&&(r=!0,e("#qr_reference_err").html("The reference number should contain maximum of 25 characters")),isNull(d)&&"E"==f.get("addCustomerLabelFlg")?(r=!0,e("#qr_customer_label_err").html("Please enter customer label")):!isNull(d)&&d.length>25&&"E"==f.get("addCustomerLabelFlg")&&(r=!0,e("#qr_customer_label_err").html("The customer label should contain maximum of 25 characters")),isNull(h)&&"E"==f.get("terminalLabelFlg")?(r=!0,e("#qr_terminal_number_err").html("Please enter terminal number")):!isNull(h)&&h.length>25&&"E"==f.get("terminalLabelFlg")&&(r=!0,e("#qr_terminal_number_err").html("The terminal number should contain maximum of 25 characters")),isNull(g)&&"E"==f.get("purposeOfTransactionaFlg"))r=!0,e("#qr_purpose_transfer_err").html("Please enter purpose of transaction");else if(!isNull(g)&&g.length>25&&"E"==f.get("purposeOfTransactionaFlg"))r=!0,e("#qr_purpose_transfer_err").html("The purpose of transfer should contain maximum of 25 characters");else if("BDT"==P&&"BDT"==C){if(!isNull(y)&&!isNaN(_)&&0!=_&&parseFloat(y)<q)return void e("#bakshQR_transAmountError").html(e.i18n.t("validation.sadad.amtgreaterthanminamt")+" "+q+" BDT");if(!isNull(y)&&!isNaN(_)&&0!=_&&parseFloat(y)>v)return void e("#bakshQR_transAmountError").html(e.i18n.t("validation.transfer.nobal"));if(!isNull(y)&&!isNaN(_)&&0!=_&&parseFloat(y)>b)return void e("#bakshQR_transAmountError").html("Limit has been exhausted. Please try again later or contact the bank");if(!isNull(y)&&!isNaN(_)&&0!=_&&parseFloat(y)>k)return void e("#bakshQR_transAmountError").html("Limit has been exhausted. Please try again later or contact the bank");if(!isNull(y)&&!isNaN(_)&&0!=_&&parseFloat(y)>T)return void e("#bakshQR_transAmountError").html(e.i18n.t("validation.sadad.amtlessthanmaxamt")+" "+T+" BDT");if(!isNull(y)&&!isNaN(_)&&0!=_&&"0"==N)return void e("#bakshQR_transAmountError").html("You have exceeded your daily transaction count.");if(!isNull(y)&&!isNaN(_)&&0!=_&&"0"==A)return void e("#bakshQR_transAmountError").html("Transaction count exceeded Monthly Available Count.")}r||(f.set("purchaseId",u),f.set("secondaryId",m),f.set("qrscanamount",y),showSpinner(),"false"==f.get("IsAuthMode")?a.qrPaymentValidation():a.validateQRCard(t))},qrCardPinValidation:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var a=this,r=function(t){hideSpinner(),e("#qr_verify").modal("hide"),a.qrPaymentValidation()},n=function(t){hideSpinner(),e("#qr_verify").modal("hide"),a.errorresponse()};e("#qr_otpNullError").html(""),e("#qr_otpNullErrorDiv").hide();var o=e("#qr_pin1").attr("data"),l=e("#qr_pin2").attr("data"),i=e("#qr_pin3").attr("data"),s=e("#qr_pin4").attr("data");if(isNull(o)||isNull(l)||isNull(i)||isNull(s))return e("#qr_otpNullErrorDiv").show(),void e("#qr_otpNullError").html("Please enter Card PIN");showSpinner();var c=o+l+i+s,u=(new Date).getTime(),m=c,p=EncryptWithDynamicSalt(m,u);a.collection=new d,a.collection.fetch({data:e.param({salt:u,ccpinno:p,acctid:f.get("cardaccuntid"),cardtype:f.get("selectCardType"),access_token:f.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):n(e)},error:n})},qrPaymentValidation:function(t){e("#bkash_qrtips_amount").val();"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var a=e("#bkashqrscan_amount").val().replace(/,/g,""),r=checkAmount(e.formatNumber(a,{format:"#,###.00",locale:"us"})),n=r.replace(/,/g,""),o=this,l=function(e){hideSpinner(),o.qrPaymentPosting()},i=function(e){hideSpinner(),o.errorresponse()};showSpinner(),o.collection=new p,o.collection.fetch({data:e.param({access_token:f.get("access_token"),accountid:f.get("cardaccuntid"),amount:n,currency:f.get("txnCurrency"),validtype:"Validation",limitId:f.get("limitId"),totalFee:f.get("totalfee"),totalDebitAmount:"",globalTranValidationId:"",billUniqueId:"",remarks:"",walletNumber:f.get("bKashQRWalletNumber"),counter:f.get("coutnerNo"),merchantName:f.get("merName"),mcc:f.get("mcc"),qrid:f.get("bKashQRId"),sendername:f.get("accountTitle")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?l(e):i(e)},error:i})},qrPaymentPosting:function(t){e("#bkash_qrtips_amount").val();"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var r=this,n=e("#bkashqrscan_amount").val().replace(/,/g,""),o=checkAmount(e.formatNumber(n,{format:"#,###.00",locale:"us"})),l=o.replace(/,/g,""),i=function(e){hideSpinner(),a.history.navigate("#/qrscantransferring")},s=function(e){hideSpinner(),r.errorresponse()};showSpinner(),r.collection=new p,r.collection.fetch({data:e.param({access_token:f.get("access_token"),accountid:f.get("cardaccuntid"),amount:l,currency:f.get("txnCurrency"),validtype:"Posting",limitId:f.get("limitId"),totalFee:f.get("totalfee"),totalDebitAmount:f.get("totalDebitAmount"),globalTranValidationId:f.get("globalTranValidationId"),billUniqueId:f.get("billUniqueId"),remarks:"",walletNumber:f.get("bKashQRWalletNumber"),counter:f.get("coutnerNo"),merchantName:f.get("merName"),mcc:f.get("mcc"),qrid:f.get("bKashQRId"),sendername:f.get("accountTitle")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):s(e)},error:s})},navigateToQRScanner:function(e){"object"==typeof e&&(e.preventDefault(),e.stopImmediatePropagation()),a.history.navigate("#/wealth")},qrPayTipsModel:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var a=e("#bkashqrscan_amount").val().replace(/,/g,"");if(isNull(f.get("tipIndicator")))e("#qr_tips").hide(),e("#bkash_qrtips_amount").val(0);else if("01"==f.get("tipIndicator"))e("#bkash_qrtips_amount").val(""),e("#qrtips_txt").html("Tips");else{if(isNull(f.get("convFixed"))){if(e("#bkash_qrtips_amount").val(checkAmount(e.formatNumber(f.get("conPercentage"),{format:"#,###.00",locale:"us"}))),isNull(a)&&"03"==f.get("tipIndicator")){var r=e("#qrtips_amount").val()+" %";e("#bkash_qrtips_amount").val(r)}}else e("#bkash_qrtips_amount").val(checkAmount(e.formatNumber(f.get("convFixed"),{format:"#,###.00",locale:"us"})));e("#bkash_qrtips_amount").attr("disabled","disabled"),e("#qrtips_txt").html("Convenience fee")}},qrPayTotalAMT:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation()),e("#bakshQR_transAmountError").html("");var a=0;e("#bkash_qrtotamt").html(""),e("#bkashQR_tipsAmountError").html(""),e("#paymentAmtDiv").hide();var r=parseFloat(e("#bkashqrscan_amount").val().replace(/,/g,"")),n=parseFloat(e("#bkash_qrtips_amount").val().replace(/,/g,""));if(isNaN(r)&&(r=0),isNaN(n)&&(n=0),0!=n&&n>r&&"01"==f.get("tipIndicator"))e("#bkashQR_tipsAmountError").html("Amount must be less than the Pay Amount"),a=r,e("#qrconPercentage").html("");else if(0!=n&&"03"==f.get("tipIndicator")){var o=e("#bkashqrscan_amount").val().replace(/,/g,"");isNull(o)?(isNull(o)&&(n=0),a=r+n):a=f.get("conPercentageFee")}else e("#qrconPercentage").html(""),a=r+n;a="true"==f.get("isbKashFee")?isNull(f.get("paymentAmount"))?checkAmount(e.formatNumber(a,{format:"#,###.00",locale:"us"})):checkAmount(e.formatNumber(f.get("paymentAmount"),{format:"#,###.00",locale:"us"})):checkAmount(e.formatNumber(a,{format:"#,###.00",locale:"us"}));var l='<span class="cur">'+f.get("txnCurrency")+'</span> <span class="qramt">'+a+"</span>";e("#bkash_qrtotamt").html(l),e("#paymentAmtDiv").show();var i=parseFloat(f.get("minAmountPerTransaction")),s=parseFloat(f.get("maxAmountPerTransaction")),c=f.get("dailyAvailableCount"),u=f.get("monthlyAvailableCount"),m=parseFloat(f.get("dailyAvailableLimit")),p=parseFloat(f.get("monthlyAvailableLimit")),d=parseFloat(a.replace(/,/g,""));if("true"==f.get("isAmtblur")){if(i>d)return e("#bakshQR_transAmountError").html(e.i18n.t("validation.sadad.amtgreaterthanminamt")+" "+i+" BDT"),void f.set("isAmountError","true");if(d>s)return e("#bakshQR_transAmountError").html(e.i18n.t("validation.sadad.amtlessthanmaxamt")+" "+s+" BDT"),void f.set("isAmountError","true");if(0!=d&&"0"==c)return void e("#bakshQR_transAmountError").html("You have exceeded your daily transaction count.");if(0!=d&&"0"==u)return void e("#bakshQR_transAmountError").html("Transaction count exceeded Monthly Available Count.");if(d>m)return void e("#bakshQR_transAmountError").html("Limit has been exhausted. Please try again later or contact the bank.");if(d>p)return void e("#bakshQR_transAmountError").html("Limit has been exhausted. Please try again later or contact the bank.");f.set("isAmountError","false")}f.set("bkashPaymentAmt",a)},qrPayFromSelect:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var a=this;f.set("cardaccuntid",""),f.set("selectCardType",""),f.set("selectCurrencyType",""),e("#seltpayval").html(""),e("#qravailBalDiv").hide();var r=e(t.target).closest("li.bkash_acccardnumtype").attr("merchantType"),n=e(t.target).closest("li.bkash_acccardnumtype").attr("Accide"),o=e(t.target).closest("li.bkash_acccardnumtype").attr("acctype"),l=e(t.target).closest("li.bkash_acccardnumtype").attr("data");f.set("selectMerchantType",r),(isNull(f.get("qrmerchantCategory"))||isNull(f.get("qrmerchantCategory1"))||f.get("qrmerchantCategory")!=r&&f.get("qrmerchantCategory1")!=r)&&(isNull(f.get("qrmerchantCategory"))||f.get("qrmerchantCategory")!=r)&&(isNull(f.get("qrmerchantCategory1"))||f.get("qrmerchantCategory1")!=r)?(f.set("cardaccuntid",n),f.set("selectCardType",o),f.set("selectCurrencyType",l),a.getAccountBalance(t)):(f.set("cardaccuntid",n),f.set("selectCardType",o),f.set("selectCurrencyType",l),a.getAccountBalance(t)),e('li.bkash_acccardnumtype[accide="'+n+'"]').find("input").attr("checked","checked");var i=e(t.target).closest("li.bkash_acccardnumtype").find(".row").clone().html(),s='<div class="qr_acc_outer">\n <ul class="list-unstyled m0">\n <li class="list-group-item">\n'+i+"</li>\n </ul>\n </div>";e("#seltpayval").html(s),e("#bkash_card_account .close").trigger("click")},getAccountBalance:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation()),e("#fromAcntNumErr").html("");var a=f.get("cardaccuntid");if(""==a)return e("#qravailbalance").html(""),void e("#qravailBalDiv").hide();var r=f.get("selectCardType");"PC"==r?f.set("typeOfTransfer","PC"):"DC"==r?f.set("typeOfTransfer","DC"):"CC"==r?f.set("typeOfTransfer","CC"):"CASA"==r&&f.set("typeOfTransfer","CASA");var n=this,o=function(a){hideSpinner(),e("#qrerror_acc").html(""),e("#qravailBalDiv").show(),isValidAccount=!1;var o,l,i=f.get("availableBalance"),s=parseFloat(i.slice(0,-2)),c=f.get("accountCurrency");"DC"==r?(o=checkAmount(e.formatNumber(s,{format:"#,###.00",locale:"us"})),l=c+" "+o,f.set("qrfromAcntAvailBal",s)):"CASA"==r?(o=checkAmount(e.formatNumber(s,{format:"#,###.00",locale:"us"})),l=c+" "+o,f.set("qrfromAcntAvailBal",s)):"PC"==r?(o=checkAmount(e.formatNumber(i,{format:"#,###.00",locale:"us"})),l=c+" "+o,f.set("qrfromAcntAvailBal",i)):"CC"==r&&(o=checkAmount(e.formatNumber(i,{format:"#,###.00",
locale:"us"})),l=c+" "+o,f.set("qrfromAcntAvailBal",i)),e("#qravailbalance").html(l),"BDT"!=f.get("txnCurrency")&&n.getQRConvertedAmount(t);var u=e("#bkashqrscan_amount").val().replace(/,/g,""),m=checkAmount(e.formatNumber(u,{format:"#,###.00",locale:"us"})),p=m.replace(/,/g,"");isNull(p)||n.getbKashQRFeeAmount(t)},l=function(e){n.errorresponse()};showSpinner(),n.collection=new c,n.collection.fetch({data:e.param({access_token:f.get("access_token"),accountId:f.get("cardaccuntid"),accountType:f.get("selectCardType"),beneficiaryInstructionId:null}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?o(e):l(e)},error:l})},qrPaymentModel:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation()),e("#bkash_card_account").modal("show")},openAuthModePopup:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation()),e("#verify .close").trigger("click"),a.history.navigate("#/qrscantransferring")},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return a.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return y});