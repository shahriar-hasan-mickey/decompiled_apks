define(["jquery","underscore","Backbone","collections/qrcode/qrCodeCollections","collections/transfer/getAuthModeCollections","collections/bills/cardSummaryCollections","collections/wealth/otpPostLoginGenerationCollections","collections/wealth/otpPostLoginVerificationCollections","collections/transfer/getTransactionLimitCollections","collections/transfer/getAccountBalanceCollections","collections/transfer/currencyListsCollections","collections/qrcode/qrPaymentValidationCollections","collections/qrcode/qrCodeCardPinCollections","text!views/qrScan/qrScanInitiate.tpl"],function(e,t,r,a,n,o,l,i,s,c,u,p,d,m){var h=null,g=new EncryptedLocalStorage("secret");g.set("isAllThreeDTONull","false");var f=r.View.extend({el:"#container",events:{"click .acctypenum":"qrPayFromSelect","blur #qrtips_amount":"getTotalAmtWithTips","click #qr_close_btn":"revokeQROTPSpinner","click #qr_cancel_btn":"revokeQROTPSpinner","click #qrscan_cancel":"navigateToQRScanner","click #qr_verifyOTP":"qrVerifyOTP","click #qrscan_payverify":"openAuthModePopup","click #qrscan_confirm":"qrScanPayVerifyPopup","click #crdaccid li.list-group-item":"qrPaymentModel"},render:function(){h=null;var t=this;e("#qravailBalDiv").hide(),g.set("cardaccuntid",""),g.set("isError","false"),g.set("conPercentageFee",""),g.set("isTipsError","false"),t.getCreditPrepaidCardsList()},getCreditPrepaidCardsList:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var r=this,a=function(a){g.set("cardaccuntid",""),g.set("selectCardType",""),g.set("selectCurrencyType",""),g.set("singlecrdval",""),e("#seltpayval").html(""),e("#qravailBalDiv").hide();var n=g.get("ccListDTO"),o=g.get("pcListDTO"),l=g.get("dcListDTO"),i=[];if(!isNull(n)&&isNull(o)&&isNull(l)&&isNull(i)&&(i=n.filter(function(e){return""!=e.merchantType&&"Y"==e.qrflag}),1==i.length&&(i[0].cardType="CC")),!isNull(o)&&isNull(n)&&isNull(l)&&isNull(i)&&(i=o.filter(function(e){return""!=e.merchantType&&"Y"==e.qrflag}),1==i.length&&(i[0].cardType="PC")),!isNull(l)&&isNull(n)&&isNull(o)&&isNull(i)&&(i=l.filter(function(e){return""!=e.merchantType&&"Y"==e.qrflag}),1==i.length&&(i[0].cardType="DC")),1==i.length){g.set("cardaccuntid",i[0].id),g.set("selectCardType",i[0].cardType),g.set("selectCurrencyType",i[0].currencyCode),r.getAccountBalance(t);var s='<div class="qr_acc_outer">\n <ul class="list-unstyled m0">\n <li class="list-group-item">\n <div class="col-xs-2 first-col">\n';s+="VISA"==i[0].merchantType?'<span class="menu_icon visa"></span>':'<span class="menu_icon mastercard"></span>',s+='\n</div>\n <div class="col-xs-10">\n<p class="acc_txt"> '+i[0].merchantType+'</p>\n<p class="acc_cat"> '+i[0].merchantType+' | <span class="selectAccNumber"> '+i[0].accountNumber+" </span></p>\n</div>\n </li>\n </ul>\n </div>",g.set("singlecrdval",s)}r.getTransLimitView()},n=function(e){r.getTransLimitView()};showSpinner(),r.collection=new o([],{}),r.collection.fetch({data:e.param({newversion:"Y",paytype:"QR",ctrycode:g.get("merCountry"),currcode:g.get("txnCurrency"),access_token:g.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):n(e)},error:n})},getTotalAmtWithTips:function(e){e.stopImmediatePropagation();var t=this;t.qrPayTotalAMT(),t.getQRScanAuthMode(e)},getTransLimitView:function(r){"object"==typeof r&&(r.preventDefault(),r.stopImmediatePropagation()),e("#qrerror_acc").html("");var a=this,n=function(n){if(hideSpinner(),e("html").removeClass().addClass("app fntzoom"),e("div").removeClass("modal-backdrop fade in"),h=null,a.$el.html(t.template(m)),a.$el.trigger("create"),e("#qravailBalDiv").hide(),e("#qrscan_amount").blur(function(){a.qrPayTotalAMT(),"BDT"!=g.get("txnCurrency")?a.getQRConvertedAmount(r):a.getQRScanAuthMode()}),isNull(g.get("txnAmt"))||(a.qrPayTotalAMT(),a.getQRScanAuthMode()),isNull(g.get("singlecrdval")))e("#seltpayval").html(e.i18n.t("app.qrcode.selctcard"));else{e("#seltpayval").html(g.get("singlecrdval"));var o=g.get("cardaccuntid");e('li.acctypenum[accide="'+o+'"]').find("input").attr("checked","checked")}return a.qrPayTipsModel(),a.qrPayTotalAMT(),"true"==g.get("isAllThreeDTONull")?void e("#qrerror_acc").html("No active card linked to you, so QR Payment is restricted. Please contact the bank."):void 0},o=function(r){e("html").removeClass().addClass("app fntzoom"),a.$el.html(t.template(m)),a.$el.trigger("create"),e("#qravailBalDiv").hide(),isNull(g.get("txnAmt"))?hideSpinner():(a.qrPayTotalAMT(),a.getQRScanAuthMode()),a.qrPayTipsModel(),a.qrPayTotalAMT()};a.collection=new s,a.collection.fetch({data:e.param({access_token:g.get("access_token"),payeeType:"QR_PAYMENT"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?n(e):o(e)},error:o})},getQRConvertedAmount:function(t){if(!isNull(g.get("cardaccuntid"))){var r=e("#qrscan_amount").val().replace(/,/g,"");if(!isNull(r)&&!isNull(g.get("cardaccuntid"))&&!isNull(r)){var a=g.get("limitId"),n=g.get("qrId"),o=g.get("accountTitle"),l=e(".qrAddInfo:first").val(),i=e(".qrAddInfo:last").val(),s=g.get("tipIndicator"),c=e("#qrtips_amount").val(),u=isNull(c)?"":parseFloat(c.replace(/,/g,"")),d=isNull(c)?"":parseFloat(c.replace(/,/g,"")),m=this,h=function(e){hideSpinner(),m.qrPayTotalAMT(),m.getQRScanAuthMode(t)},f=function(t){hideSpinner(),e("#qrscan_amount").val(""),e("#qrtips_amount").val(""),g.set("qrtotpamt","0"),m.qrPayTotalAMT(),m.errorresponse()};showSpinner(),m.collection=new p,m.collection.fetch({data:e.param({access_token:g.get("access_token"),accountid:g.get("cardaccuntid"),amount:r,validtype:"Validation",limitId:a,qrid:n,sendername:o,purchaseId:l,secondaryId:i,tips:u,convfee:d,convIndicator:s}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?h(e):f(e)},error:f})}}},getQRScanAuthMode:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var r=this;g.set("IsAuthMode","false"),e("#qrCardPinDiv").html(""),e("#qrscan_auth_mode").html(""),e("#transAmountError").html("");var a;if(a="BDT"!=g.get("txnCurrency")?g.get("totalDebitAmount"):parseFloat(g.get("qrtotpamt").replace(/,/g,"")),g.set("transferType","qrScan"),isNull(a)||0==a)return void g.set("isError","false");if("true"!=g.get("isTipsError")){a="BDT"!=g.get("txnCurrency")?g.get("totalDebitAmount"):parseFloat(g.get("qrtotpamt").replace(/,/g,""));var o=(parseFloat(g.get("minAmountPerTransaction")),parseFloat(g.get("maxAmountPerTransaction")),function(e){hideSpinner(),g.set("isError","false");var t=g.get("securitySettingList");!isNull(t)&&t.length>0?g.set("IsAuthMode","true"):(g.set("alertType",null),g.set("IsAuthMode","false")),r.populateAuthMode()}),l=function(t){hideSpinner(),r.populateAuthMode(),g.set("isError","true"),g.set("authModeError",g.get("errordesc")),e("#transAmountError").html(g.get("errordesc")),e("#qrscan_amount").val(""),e("#qrtips_amount").val(""),g.set("qrtotpamt","0"),r.qrPayTotalAMT()};showSpinner(),r.collection=new n,r.collection.fetch({data:e.param({access_token:g.get("access_token"),transactionAmount:a,tenantServiceCode:"QR_PAYMENT",percent:g.get("conPercentage"),qrMode:"2FA"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?o(e):l(e)},error:l})}},populateAuthMode:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var r="",a="";e("#qrCardPinDiv").html("");var n=g.get("securitySettingList"),o="<label for='username'>"+e.i18n.t("app.transfer.managebeneficiary.selectauthorisationmode")+"</label>";o+="<div class='custRadio_pass'>",!isNull(n)&&n.length>0?(e("#qrscan_auth_mode").html(""),e.each(n,function(t,n){"SMS"==n?(r="sms",a=e.i18n.t("app.transfer.managebeneficiary.sms")):"EMAIL"==n?(r="mail",a=e.i18n.t("app.transfer.managebeneficiary.mail")):"TOKEN"==n?(r="fScan",a=e.i18n.t("app.transfer.managebeneficiary.token")):"ESIGN"==n?(r="esign",a=e.i18n.t("app.transfer.managebeneficiary.esign")):"PIN"==n&&(r="credit",a="Card PIN"),o+='<div class="box"><div class="radio"><label>',o+=0==t?'<input type="radio" name="qr_payment_authmode" id="optionsRadios'+t+'" value="'+n+'" checked>':'<input type="radio" name="qr_payment_authmode" id="optionsRadios'+t+'" value="'+n+'">',o+='<div class="row bg"><div class="col-xs-12 p0"><span class="menu_icon ico-xs '+r+'"></span><span class="small">'+a+"</span></div></div></label></div></div>"}),e("#qrscan_auth_mode").html(o)):e("#qrscan_auth_mode").html("")},validateQRCard:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var r=this;if("false"==g.get("IsAuthMode"))return void r.qrPaymentPosting();var a=e("input[name='qr_payment_authmode']:checked").val();g.set("authmode",a),"SMS"==a||"EMAIL"==a||"ESIGN"==a?r.qrValidateCardPin("N"):"TOKEN"==a?(hideSpinner(),g.set("otpCode",""),g.set("alertType",a),e("#qr_verify").modal("show"),setTimeout(function(){e("#qr_otp1").focus()},500),e("#authModeOTPDiv").show(),e("#cardPinOTPDiv").hide(),e("#qr_otp1, #qr_otp2, #qr_otp3, #qr_otp4, #qr_otp5, #qr_otp6").removeAttr("data"),"TOKEN"==g.get("alertType")&&(e("#qr_titleAuth").html(e.i18n.t("app.registration.opthelptokentext")),e("#qr_myModalLabel").html(e.i18n.t("app.registration.otptokenheadertext")),e("#qr_challengeText").html(""),e("#OTPcontainer1").hide(),e("#qr_resend_btn").hide()),e("#qr_otpNullError").html(""),e("#qr_otpNullErrorDiv").hide(),e(".inputs").on("input",function(t){t.stopImmediatePropagation();var r=t.currentTarget.id,a=e("#"+r).val();e("#"+r).attr("data",a),e("#"+r).val(a.replace(/[^\*]/,"."))}),e("#qr_otp1, #qr_otp2, #qr_otp3, #qr_otp4, #qr_otp5, #qr_otp6").val("")):"PIN"==a&&(hideSpinner(),g.set("otpCode",""),g.set("alertType",a),e("#qr_verify").modal("show"),setTimeout(function(){e("#qr_pin1").focus()},500),e("#qr_titleAuth").html("Enter Card PIN"),e("#qr_myModalLabel").html(e.i18n.t("app.transferss.verfici")),e("#authModeOTPDiv").hide(),e("#cardPinOTPDiv").show(),e("#qr_challengeText").html(""),e("#OTPcontainer1").hide(),e("#qr_resend_btn").hide(),e("#qr_otpNullError").html(""),e("#qr_otpNullErrorDiv").hide(),e(".inputs").on("input",function(t){t.stopImmediatePropagation();var r=t.currentTarget.id,a=e("#"+r).val();e("#"+r).attr("data",a),e("#"+r).val(a.replace(/[^\*]/,"."))}),e("#qr_pin1, #qr_pin2, #qr_pin3, #qr_pin4").val(""))},qrValidateCardPin:function(t){e(".otp_msg_txt").html("");var r=e("input[name='qr_payment_authmode']:checked").val();g.set("alertType",r);var a=this,n=function(r){hideSpinner(),"PIN"!=g.get("alertType")&&("Y"==t&&(e("#OTPcontainer1").slideDown("slow"),h.set(1),h.animate(0,function(){e("#OTPcontainer1").slideUp("slow")})),e("#qr_verify").modal("show"),e("#authModeOTPDiv").show(),e("#cardPinOTPDiv").hide(),e("#qr_otp1, #qr_otp2, #qr_otp3, #qr_otp4, #qr_otp5, #qr_otp6").removeAttr("data"),"SMS"==g.get("alertType")?(e("#qr_titleAuth").html(e.i18n.t("app.registration.opthelptext")+" "+maskMobile(g.get("contactNumber"))),e("#qr_myModalLabel").html(e.i18n.t("app.transferss.verfici")),e("#qr_challengeText").html(""),e("#OTPcontainer1").show(),e("#qr_resend_btn").show()):"EMAIL"==g.get("alertType")?(e("#qr_titleAuth").html(e.i18n.t("app.registration.opthelptext")+" "+maskEmailID(g.get("emailId"))),e("#qr_myModalLabel").html(e.i18n.t("app.transferss.verfici")),e("#qr_challengeText").html(""),e("#OTPcontainer1").show(),e("#qr_resend_btn").show()):"ESIGN"==g.get("alertType")&&(e("#qr_titleAuth").html(e.i18n.t("app.registration.otphelpesigntext")),e("#qr_myModalLabel").html(e.i18n.t("app.transferss.verfici")),e("#qr_challengeText").html(e.i18n.t("app.transferss.genratedTocn")+" "+g.get("otpCode")),e("#OTPcontainer1").hide(),e("#qr_resend_btn").hide()),setTimeout(function(){e("#qr_otp1").focus()},500),e("#qr_otpNullError").html(""),e("#qr_otpNullErrorDiv").hide(),e(".inputs").on("input",function(t){t.stopImmediatePropagation();var r=t.currentTarget.id,a=e("#"+r).val();e("#"+r).attr("data",a),e("#"+r).val(a.replace(/[^\*]/,"."))}),e("#qr_otp1, #qr_otp2, #qr_otp3, #qr_otp4, #qr_otp5, #qr_otp6").val(""),("SMS"==g.get("alertType")||"EMAIL"==g.get("alertType"))&&a.invokeOTPSpinner())},o=function(e){a.errorresponse()};showSpinner(),a.collection=new l;getDeviceId(),(new Date).getTime();a.collection.fetch({data:e.param({access_token:g.get("access_token"),transactionType:"QR_PAYMENT",resendflag:t,authMode:g.get("alertType")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?n(e):o(e)},error:o})},invokeOTPSpinner:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var r=this;return e("#qr_resend_btn").hide(),e("#OTPcontainer1").show(),e("#qr_otp1, #qr_otp2, #qr_otp3, #qr_otp4, #qr_otp5, #qr_otp6").val(""),null!=h?(h.set(1),void h.animate(0,function(){e("#OTPcontainer1").slideUp("slow")})):(h=new ProgressBar.Circle(OTPcontainer1,{color:"#333",strokeWidth:8,trailWidth:8,easing:"linear",duration:6e4*parseInt(g.get("otpExpiryPeriod")),text:{autoStyleContainer:!1},from:{color:"#ec5f59",width:8},to:{color:"#ec5f59",width:8},step:function(t,r){r.path.setAttribute("stroke",t.color),r.path.setAttribute("stroke-width",t.width);var a=Math.round(r.value()*(60*g.get("otpExpiryPeriod")));"0"==a?(r.setText(""),e("#qr_resend_btn").show()):(e("#qr_resend_btn").hide(),r.setText(a+"s"))}}),h.text.style.fontFamily='"Raleway", Helvetica, sans-serif',h.text.style.fontSize="12px",h.text.style.fontWeight="bold",h.set(1),h.animate(0,function(){e("#OTPcontainer1").slideUp("slow")}),void e("#qr_resend_btn").click(function(){r.qrValidateCardPin("Y")}))},revokeQROTPSpinner:function(){null!=h&&h.stop()},qrVerifyOTP:function(e){"object"==typeof e&&e.stopImmediatePropagation();var t=this;"PIN"==g.get("authmode")?t.qrCardPinValidation():t.qrVerifySuccessPopUp(e)},qrVerifySuccessPopUp:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var r="",a="";e("#qr_otpNullError").html(""),e("#qr_otpNullErrorDiv").hide();var n=e("#qr_otp1").attr("data"),o=e("#qr_otp2").attr("data"),l=e("#qr_otp3").attr("data"),s=e("#qr_otp4").attr("data"),c=e("#qr_otp5").attr("data"),u=e("#qr_otp6").attr("data");if(isNull(n)||isNull(o)||isNull(l)||isNull(s)||isNull(c)||isNull(u))return e("#qr_otpNullErrorDiv").show(),void e("#qr_otpNullError").html(e.i18n.t("validation.newregistration.otpnotnull"));var p=n+o+l+s+c+u,d=e("input[name='qr_payment_authmode']:checked").val();"SMS"==d?(a=g.get("mobileNo"),r=null):"EMAIL"==d&&(a=null,r=g.get("emailId"));var m=this,h=function(t){hideSpinner(),m.revokeQROTPSpinner(),e("#qr_verify").modal("hide"),m.qrPaymentValidation()},f=function(t){hideSpinner(),isNull(g.get("errordesc"))||(e("#qr_otpNullErrorDiv").show(),e("#qr_otpNullError").html(g.get("errordesc")))};showSpinner(),m.collection=new i,m.collection.fetch({data:e.param({access_token:g.get("access_token"),transactionType:"QR_PAYMENT",activationno:p,uniqueId:g.get("otpCode"),twoFAType:g.get("alertType")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?h(e):f(e)},error:f})},qrScanPayVerifyPopup:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var r=this,a=!1;e("#fromAcntNumErr").html(""),e("#qrCardPinError").html(""),e("#qr_loyality_err").html(""),e("#qr_reference_err").html(""),e("#transAmountError").html(""),e("#qr_bill_number_err").html(""),e("#qr_store_label_err").html(""),e("#qr_mobile_number_err").html(""),e("#qr_customer_label_err").html(""),e("#qr_terminal_number_err").html(""),e("#qr_purpose_transfer_err").html("");var n=g.get("securitySettingList"),o=e("#qrCardPin").val(),l=parseFloat(e("#qrtips_amount").val().replace(/,/g,"")),i=e("#qr_loyality").val(),s=e("#qr_reference").val(),c=e("#qr_store_label").val(),u=e("#qr_bill_number").val(),p=e(".qrAddInfo:first").val(),d=e(".qrAddInfo:last").val(),m=e("#qr_mobile_number").val(),h=e("#qr_customer_label").val(),f=e("#qr_terminal_number").val(),q=e("#qr_purpose_transfer").val(),_=parseFloat(e("#qrscan_amount").val().replace(/,/g,"")),v=parseFloat(e(".qramt").text().replace(/,/g,"")),y=parseFloat(g.get("qrfromAcntAvailBal")),T=parseFloat(g.get("dailyAvailableLimit")),P=parseFloat(g.get("minAmountPerTransaction")),N=parseFloat(g.get("maxAmountPerTransaction")),b=g.get("dailyAvailableCount"),A=g.get("monthlyAvailableCount"),S=g.get("accountCurrency"),C=g.get("txnCurrency");if("true"!=g.get("isTipsError")){if((isNull(v)||isNaN(_)||0==_)&&(a=!0,e("#transAmountError").html("Please enter amount to proceed further")),"true"==g.get("isError")&&(a=!0,e("#transAmountError").html(g.get("authModeError"))),isNull(l)&&0==l&&"01"==g.get("tipIndicator")&&(a=!0,e("#tipsAmountError").html("Please enter valid tips amount")),isNull(g.get("cardaccuntid"))&&(a=!0,e("#fromAcntNumErr").html("Please select a card")),(isNull(g.get("qrmerchantCategory"))||isNull(g.get("qrmerchantCategory1"))||g.get("qrmerchantCategory")==g.get("qrmerchantCategory1"))&&(isNull(g.get("cardaccuntid"))||"VISA"!=g.get("qrmerchantCategory")&&"VISA"!=g.get("qrmerchantCategory1")||"MASTER"!=g.get("selectMerchantType")?isNull(g.get("cardaccuntid"))||"MASTER"!=g.get("qrmerchantCategory")&&"MASTER"!=g.get("qrmerchantCategory1")||"VISA"!=g.get("selectMerchantType")||(a=!0,e("#fromAcntNumErr").html("Please select a master card")):(a=!0,e("#fromAcntNumErr").html("Please select a visa card"))),isNull(n)||"PIN"==n[0]&&isNull(o)&&!isNull(e("#qrCardPinDiv").html())&&(e("#qrCardPinError").html("Please enter the PIN"),a=!0),isNull(u)&&"E"==g.get("addBillNumberFlg")?(a=!0,e("#qr_bill_number_err").html("Please enter bill number")):!isNull(u)&&u.length>25&&"E"==g.get("addBillNumberFlg")&&(a=!0,e("#qr_bill_number_err").html("The bill number should contain maximum of 25 characters")),isNull(m)&&"E"==g.get("addMobNoFlg")?(a=!0,e("#qr_mobile_number_err").html("Please enter mobile number")):!isNull(m)&&m.length>25&&"E"==g.get("addMobNoFlg")&&(a=!0,e("#qr_mobile_number_err").html("The mobile number should contain maximum of 25 characters")),isNull(c)&&"E"==g.get("addStoreLabelFlg")?(a=!0,e("#qr_store_label_err").html("Please enter store label")):!isNull(c)&&c.length>25&&"E"==g.get("addStoreLabelFlg")&&(a=!0,e("#qr_store_label_err").html("The store label should contain maximum of 25 characters")),isNull(i)&&"E"==g.get("addLoyalNoFlg")?(a=!0,e("#qr_loyality_err").html("Please enter loyalty number")):!isNull(i)&&i.length>25&&"E"==g.get("addLoyalNoFlg")&&(a=!0,e("#qr_loyality_err").html("The loyalty number should contain maximum of 25 characters")),isNull(s)&&"E"==g.get("addRefNoFlg")?(a=!0,e("#qr_reference_err").html("Please enter reference label")):!isNull(s)&&s.length>25&&"E"==g.get("addRefNoFlg")&&(a=!0,e("#qr_reference_err").html("The reference number should contain maximum of 25 characters")),isNull(h)&&"E"==g.get("addCustomerLabelFlg")?(a=!0,e("#qr_customer_label_err").html("Please enter customer label")):!isNull(h)&&h.length>25&&"E"==g.get("addCustomerLabelFlg")&&(a=!0,e("#qr_customer_label_err").html("The customer label should contain maximum of 25 characters")),isNull(f)&&"E"==g.get("terminalLabelFlg")?(a=!0,e("#qr_terminal_number_err").html("Please enter terminal number")):!isNull(f)&&f.length>25&&"E"==g.get("terminalLabelFlg")&&(a=!0,e("#qr_terminal_number_err").html("The terminal number should contain maximum of 25 characters")),isNull(q)&&"E"==g.get("purposeOfTransactionaFlg"))a=!0,e("#qr_purpose_transfer_err").html("Please enter purpose of transaction");else if(!isNull(q)&&q.length>25&&"E"==g.get("purposeOfTransactionaFlg"))a=!0,e("#qr_purpose_transfer_err").html("The purpose of transfer should contain maximum of 25 characters");else if("BDT"==S&&"BDT"==C){if(!isNull(v)&&!isNaN(_)&&0!=_&&parseFloat(v)<P)return void e("#transAmountError").html(e.i18n.t("validation.sadad.amtgreaterthanminamt")+" "+P+" BDT");if(!isNull(v)&&!isNaN(_)&&0!=_&&parseFloat(v)>y)return void e("#transAmountError").html(e.i18n.t("validation.transfer.nobal"));if(!isNull(v)&&!isNaN(_)&&0!=_&&parseFloat(v)>T)return void e("#transAmountError").html("Limit has been exhausted. Please try again later or contact the bank");if(!isNull(v)&&!isNaN(_)&&0!=_&&parseFloat(v)>N)return void e("#transAmountError").html(e.i18n.t("validation.sadad.amtlessthanmaxamt")+" "+N+" BDT");if(!isNull(v)&&!isNaN(_)&&0!=_&&"0"==b)return void e("#transAmountError").html("You have exceeded your daily transaction count.");if(!isNull(v)&&!isNaN(_)&&0!=_&&"0"==A)return void e("#transAmountError").html("Transaction count exceeded Monthly Available Count.")}g.get("availableBalance");g.get("qrtotpamt"),a||(g.set("purchaseId",p),g.set("secondaryId",d),g.set("qrscanamount",v),showSpinner(),"false"==g.get("IsAuthMode")?r.qrPaymentValidation():r.validateQRCard(t))}},qrCardPinValidation:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var r=this,a=function(t){hideSpinner(),e("#qr_verify").modal("hide"),r.qrPaymentValidation()},n=function(t){hideSpinner(),e("#qr_verify").modal("hide"),e("#qrscan_amount").val(""),e("#qrtips_amount").val(""),g.set("qrtotpamt","0"),r.qrPayTotalAMT(),r.errorresponse()};e("#qr_otpNullError").html(""),e("#qr_otpNullErrorDiv").hide();var o=e("#qr_pin1").attr("data"),l=e("#qr_pin2").attr("data"),i=e("#qr_pin3").attr("data"),s=e("#qr_pin4").attr("data");if(isNull(o)||isNull(l)||isNull(i)||isNull(s))return e("#qr_otpNullErrorDiv").show(),void e("#qr_otpNullError").html("Please enter Card PIN");showSpinner();var c=o+l+i+s,u=(new Date).getTime(),p=c,m=EncryptWithDynamicSalt(p,u);r.collection=new d,r.collection.fetch({data:e.param({salt:u,ccpinno:m,acctid:g.get("cardaccuntid"),cardtype:g.get("selectCardType"),access_token:g.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):n(e)},error:n})},qrPaymentValidation:function(t){var r=e("#qrtips_amount").val();"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var a=this,n=function(e){hideSpinner(),a.qrPaymentPosting()},o=function(t){hideSpinner(),e("#qrscan_amount").val(""),e("#qrtips_amount").val(""),g.set("qrtotpamt","0"),a.qrPayTotalAMT(),a.errorresponse()};showSpinner(),a.collection=new p,a.collection.fetch({data:e.param({access_token:g.get("access_token"),accountid:g.get("cardaccuntid"),amount:e("#qrscan_amount").val().replace(/,/g,""),validtype:"Validation",limitId:g.get("limitId"),qrid:g.get("qrId"),sendername:g.get("accountTitle"),purchaseId:g.get("purchaseId"),secondaryId:g.get("secondaryId"),tips:isNull(r)?"":parseFloat(r.replace(/,/g,"")),convfee:isNull(r)?"":parseFloat(r.replace(/,/g,"")),convIndicator:g.get("tipIndicator"),qrPaymentMode:g.get("qrPaymentMode")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?n(e):o(e)},error:o})},qrPaymentPosting:function(t){var a=e("#qrtips_amount").val();"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var n=this,o=function(e){hideSpinner(),r.history.navigate("#/qrscantransferring")},l=function(t){hideSpinner(),e("#qrscan_amount").val(""),e("#qrtips_amount").val(""),g.set("qrtotpamt","0"),n.qrPayTotalAMT(),n.errorresponse()},i=JSON.stringify(g.get("qrrespMap"));showSpinner(),n.collection=new p,n.collection.fetch({data:e.param({access_token:g.get("access_token"),accountid:g.get("cardaccuntid"),amount:e("#qrscan_amount").val().replace(/,/g,""),validtype:"Posting",limitId:g.get("limitId"),qrid:g.get("qrId"),sendername:g.get("accountTitle"),purchaseId:g.get("purchaseId"),secondaryId:g.get("secondaryId"),tips:isNull(a)?"":parseFloat(a.replace(/,/g,"")),convfee:isNull(a)?"":parseFloat(a.replace(/,/g,"")),convIndicator:g.get("tipIndicator"),totalDebitAmount:g.get("totalDebitAmount"),totalFee:g.get("totalfee"),globalTranValidationId:g.get("globalTranValidationId"),billUniqueId:g.get("billUniqueId"),qrPaymentMode:g.get("qrPaymentMode"),respMap:i}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?o(e):l(e)},error:l})},navigateToQRScanner:function(e){"object"==typeof e&&(e.preventDefault(),e.stopImmediatePropagation()),r.history.navigate("#/wealth")},qrPayTipsModel:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var r=e("#qrscan_amount").val().replace(/,/g,"");if(isNull(g.get("tipIndicator")))e("#qr_tips").hide(),e("#qrtips_amount").val(0);else if("01"==g.get("tipIndicator"))e("#qrtips_amount").val(""),e("#qrtips_txt").html("Tips");else{if(isNull(g.get("convFixed"))){if(e("#qrtips_amount").val(checkAmount(e.formatNumber(g.get("conPercentage"),{format:"#,###.00",locale:"us"}))),isNull(r)&&"03"==g.get("tipIndicator")){var a=e("#qrtips_amount").val()+" %";e("#qrtips_amount").val(a)}}else e("#qrtips_amount").val(checkAmount(e.formatNumber(g.get("convFixed"),{format:"#,###.00",locale:"us"})));e("#qrtips_amount").attr("disabled","disabled"),e("#qrtips_txt").html("Convenience fee")}},qrPayTotalAMT:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation()),g.set("isTipsError","false");var r=0;e("#qrtotamt").html(""),e("#tipsAmountError").html("");var a=parseFloat(e("#qrscan_amount").val().replace(/,/g,"")),n=parseFloat(e("#qrtips_amount").val().replace(/,/g,""));if(isNaN(a)&&(a=0),isNaN(n)&&(n=0),0!=n&&n>a&&"01"==g.get("tipIndicator"))e("#tipsAmountError").html("Amount must be less than the Pay Amount"),r=a,g.set("isTipsError","true"),e("#qrconPercentage").html("");else if(0!=n&&"03"==g.get("tipIndicator")){var o,l=e("#qrscan_amount").val().replace(/,/g,"");isNull(g.get("conPercentage"))||(o=parseFloat(g.get("conPercentage").replace(/,/g,""))),isNull(l)?(isNull(l)&&(n=0),r=a+n):r=a+o}else e("#qrconPercentage").html(""),r=a+n;r=checkAmount(e.formatNumber(r,{format:"#,###.00",locale:"us"})),g.set("qrtotpamt",r);var i='<span class="cur">'+g.get("txnCurrency")+'</span> <span class="qramt">'+r+"</span>";e("#qrtotamt").html(i)},qrPayFromSelect:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation());var r=this;g.set("cardaccuntid",""),g.set("selectCardType",""),g.set("selectCurrencyType",""),e("#seltpayval").html(""),e("#qravailBalDiv").hide();var a=e(t.target).closest("li.acctypenum").attr("merchantType"),n=e(t.target).closest("li.acctypenum").attr("Accide"),o=e(t.target).closest("li.acctypenum").attr("acctype"),l=e(t.target).closest("li.acctypenum").attr("data");g.set("selectMerchantType",a),g.set("cardaccuntid",n),g.set("selectCardType",o),g.set("selectCurrencyType",l),r.getAccountBalance(t),e('li.acctypenum[accide="'+n+'"]').find("input").attr("checked","checked");var i=e(t.target).closest("li.acctypenum").find(".row").clone().html(),s='<div class="qr_acc_outer">\n <ul class="list-unstyled m0">\n <li class="list-group-item">\n'+i+"</li>\n </ul>\n </div>";e("#seltpayval").html(s),e("#card_account .close").trigger("click")},getAccountBalance:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation()),e("#fromAcntNumErr").html("");var r=g.get("cardaccuntid");if(""==r)return e("#qravailbalance").html(""),void e("#qravailBalDiv").hide();var a=g.get("selectCardType");"PC"==a?g.set("typeOfTransfer","PC"):"DC"==a?g.set("typeOfTransfer","DC"):"CC"==a?g.set("typeOfTransfer","CC"):"CASA"==a&&g.set("typeOfTransfer","CASA");var n=this,o=function(r){hideSpinner(),e("#qrerror_acc").html(""),e("#qravailBalDiv").show(),isValidAccount=!1;var o,l,i=g.get("availableBalance"),s=parseFloat(i.slice(0,-2)),c=g.get("accountCurrency");"DC"==a?(o=checkAmount(e.formatNumber(s,{format:"#,###.00",locale:"us"})),l=c+" "+o,g.set("qrfromAcntAvailBal",s)):"CASA"==a?(o=checkAmount(e.formatNumber(s,{format:"#,###.00",locale:"us"})),l=c+" "+o,g.set("qrfromAcntAvailBal",s)):"PC"==a?(o=checkAmount(e.formatNumber(i,{format:"#,###.00",locale:"us"})),l=c+" "+o,g.set("qrfromAcntAvailBal",i)):"CC"==a&&(o=checkAmount(e.formatNumber(i,{format:"#,###.00",locale:"us"})),l=c+" "+o,g.set("qrfromAcntAvailBal",i)),e("#qravailbalance").html(l),"BDT"!=g.get("txnCurrency")&&n.getQRConvertedAmount(t)},l=function(e){n.errorresponse()};showSpinner(),n.collection=new c,n.collection.fetch({data:e.param({access_token:g.get("access_token"),accountId:g.get("cardaccuntid"),accountType:g.get("selectCardType"),beneficiaryInstructionId:null}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?o(e):l(e)},error:l})},qrPaymentModel:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation()),e("#card_account").modal("show")},openAuthModePopup:function(t){"object"==typeof t&&(t.preventDefault(),t.stopImmediatePropagation()),e("#verify .close").trigger("click"),r.history.navigate("#/qrscantransferring")},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return f});