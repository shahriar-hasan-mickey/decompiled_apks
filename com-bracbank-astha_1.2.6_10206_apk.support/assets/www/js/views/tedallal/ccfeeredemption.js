define(["jquery","underscore","Backbone","collections/tedallal/rewardSummaryCollections","collections/creditcard/creditCardSummaryCollections","models/validation/tedallal/tedallalValidationModel","text!views/tedallal/ccfeeredemption.tpl"],function(e,t,c,r,n,a,o){var i=new EncryptedLocalStorage("secret"),s=c.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #submit":"submit","click #cancel":"cancel","change #fromactno":"redeempoints","click #fromactno":"redeempoints"},render:function(){var t=this;showSpinner();var c=i.get("lmsreqid");t.collection=new r([],{});var n=function(e){t.ccfeeredemption()},a=function(e){t.errorresponse()};t.collection.fetch({data:e.param({channelcode:"MOBILE",requestdatetime:"",requestusername:c}),dataType:"json",type:"POST",timeout:parseInt(i.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?n(e):a(e)},error:a})},ccfeeredemption:function(){e("#pointOveralert").hide(),showSpinner();var t=this,c=function(e){t.update()},r=function(e){t.errorresponse()};t.collection=new n([],{});var a=(new Date).getTime();t.collection.fetch({data:e.param({status:"ACTIVE",requestid:a}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(i.get("calltimeout")),success:function(e){var t=i.get("errorcode");"0000"==ackStatus?(c(e),hideSpinner()):null!=t&&"MTC-RT-0003"!=t?c(e):r(e)},error:r})},redeempoints:function(){e("#pointOveralert").hide();var t=e("input[name=fromactno]:checked").val(),c=t.split("~"),r=c[2];i.set("cctype",r),e.each(creditCardCodeDescDTO,function(t,c){var n=c.cccode;if(r==n){var a=c.ccdescription;i.set("creditcardtype",a);var o=checkAmount(e.formatNumber(c.ccdescription,{format:"#,###",locale:"us"}));return e("#cccode").html("<span>"+o+"</span>"),i.set("creditcardtype1",o),e(".crcode").show(),!1}var o=checkAmount(e.formatNumber(0,{format:"#,###",locale:"us"}));e("#cccode").html("<span>"+o+"</span>"),i.set("creditcardtype1","")})},submit:function(){e("#pointOveralert").hide();var t=e("input[name=fromactno]:checked").val(),r=t.split("~"),n=r[1],a=r[0];i.set("frmact",a),i.set("ccnum",n);var o=i.get("totalCurrentPoints"),s=i.get("creditcardtype1");return s=s.replace(/,/g,""),s>o?(e("#pointOveralert").show(),!1):void c.history.navigate("#/ccfeeverify")},update:function(){hideSpinner(),this.$("#mobcontent").html(t.template(o)),this.redeempoints()},errorresponse:function(){hideSpinner(),c.history.navigate("#/exception")}});return s});