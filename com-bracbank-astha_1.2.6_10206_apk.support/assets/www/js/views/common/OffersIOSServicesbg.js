define(["jquery","underscore","Backbone"],function(e,t,n){var a=new EncryptedLocalStorage("secret"),o=n.View.extend({render:function(){e(".spinner").show();var o=new Date,r=o.getDate(),i=o.getMonth()+1,c=o.getYear()+1900;a.set("todaydate",r+""+i+c);var s=a.get("resultsearchlist_JSON"),l=(a.get("bg_job_interval"),15e3),g=new Map,u="TOT_RECS",d="TRUE",h=window.localStorage.getItem("FLAG_STATUS");"DONE"!=h&&(a.set("pushedcount","1"),e.each(s,function(e){}));var v=0;setInterval(function(){function r(e){"TRUE"==d&&(cationEnableCheck="FALSE",onGeoLocationError(e))}function i(e){a.set("locationPage","");var t,n,o=(e.coords,a.get("app.context.path"));-1!=o.indexOf("dev")||-1!=o.indexOf(".json")?(t="24.669170",n="46.70533"):(t=e.coords.latitude,n=e.coords.longitude),a.set("ltd",t),a.set("lgt",n)}function c(e){var t=new Date,n=t.getDate()+"";n.length<=1&&(n="0"+n);var a=t.getMonth()+1+"";a.length<=1&&(a="0"+a);var o=t.getYear()+1900+"";return n+e+a+e+o}function s(e,t){var n=0,a=e.split("/"),o=new Date(a[2],a[1]-1,a[0]),r=t.split("/"),i=new Date(r[2],r[1]-1,r[0]),c=o-i,n=0;return n=c>0?1:0>c?-1:0}function h(e,t){var n=a.get("ltd"),o=a.get("lgt"),r=f(n),i=f(o),c=f(e),s=f(t),l=6371,g=Math.acos(Math.sin(r)*Math.sin(c)+Math.cos(r)*Math.cos(c)*Math.cos(i-s))*l;return g}function f(e){var t=e*Math.PI/180;return t}v++,window.localStorage.setItem("JOB_STATUS","RUN");navigator.geolocation&&navigator.geolocation.getCurrentPosition(i,r,{enableHighAccuracy:!0,timeout:1e4,maximumAge:1e4});window.localStorage.setItem("FileStorage","DONE");var p=a.get("resultsearchlist_JSON"),_=p.length;a.set("jsonObject",_);var m=(Object.keys(_),a.get("radious_proximity"));m=parseFloat(m);var w=(/iPad|iPhone|iPod/.test(navigator.userAgent),parseInt(a.get("records_Per_Day"))),y=(new Date,o.getDate(),o.getMonth()+1,o.getYear()+1900,a.get("todaydate"),[]),M=[],S=[],D=[],I=[],P=[],b=[],O=[],A=[],E=[],x=[],T=[],j=[],k=[];e.each(p,function(t){e(".spinner").hide();var n=p[t];y[t]=n.merchant_id,M[t]=n.latitute,S[t]=n.longitude,D[t]=n.merchant_name_ar,I[t]=n.merchant_name_en,P[t]=n.offer_text_ar,b[t]=n.offer_text_en,O[t]=n.validaty_frm,A[t]=n.validaty_to,E[t]=n.merchant_id+"-"+n.merchant_outlet,T[t]=h(M[t],S[t]),e(".spinner").show()});var F=[],N=[],R=0;e.each(y,function(n){e(".spinner").hide(),t.contains(F,y[n])||(e(".spinner").hide(),F[R]=y[n],N[R]=n+"",R++),e(".spinner").show()}),x=N;try{g=a.get("pushed_records");var U=c("");k=g[u],j=g[U]}catch(L){k=[],j=[],g=new Map}var C=[],J=[];null!=j&&e.each(j,function(e){C[e]=j[e]}),null!=k&&e.each(k,function(e){J[e]=k[e]}),e.each(x,function(a){e(".spinner").hide();var o=0;try{o=C.length}catch(r){}var i=parseInt(x[a]);if(!t.contains(k,E[a])){var l=parseFloat(T[i]);if(l>=m&&parseInt(w)>o){var g=c("/"),u=!1,d=s(g,O[i]),h=s(g,A[i]);if(d>0&&0>h?u=!0:0==d&&0==h&&(u=!0),u){var v=/iPad|iPhone|iPod/.test(navigator.userAgent);if(v){var f,p,_=e.i18n.lng();"en-AR"==_?(f=D[i],p=P[i]):(f=I[i],p=b[i]),cordova.plugins.backgroundMode.onactivate=function(){cordova.plugins.notification.local.hasPermission(function(e){})},cordova.plugins.notification.local.schedule({id:a,title:f,message:p,icon:"res://icon",smallIcon:"res://notify"}),cordova.plugins.notification.local.on("click",function(e){n.history.navigate("#/landinglayout/offersresume")})}o>0&&(o+=1),C[o]=E[a],J[o]=E[a]}}}}),null!=C&&C.length>0&&(t.contains(g,u)?(g["delete"](u),g["delete"](U),g[u]=J,g[U]=C):(g[u]=J,g[U]=C)),a.set("pushed_records",g),l=parseInt(a.set("bg_job_interval"))},parseInt(l))},localstorefile:function(){}});return o});