define(["jquery","underscore","Backbone"],function(e,t,n){var o=new EncryptedLocalStorage("secret"),i=n.View.extend({render:function(){function t(e){var t=e.root;t.getFile("proximitylist.json",{create:!0,exclusive:!1},function(e){e.createWriter(function(e){e.write(d)},function(e){}),e.file(function(e){var t=new FileReader;t.onloadend=function(e){var t=this.result;o.set("readobj",t)},t.readAsText(e)},function(e){})},function(e){}),t.getFile("proximitylist.json",{create:!0,exclusive:!1},function(e){},function(e){});t.createReader()}function i(e){}var a={customSpinner:!1,position:"middle",bgColor:"#000",opacity:.5,color:"#000 "};window.wizSpinner.show(a);var r=new Date,c=r.getDate(),s=r.getMonth()+1,l=r.getYear()+1900;o.set("todaydate",c+""+s+l);var d=o.get("resultsearchlist_JSON"),u=(o.get("bg_job_interval"),15e3),g={},f="TRUE",h=window.localStorage.getItem("FLAG_STATUS");"DONE"!=h&&(o.set("pushedcount","1"),e.each(d,function(e){var t=d[e];g[t.merchant_id+""+e]="N"}));var v=(/BlackBerry | IEMobile| Windows Phone | Win32NT | Android | iPad|iPhone|iPod/.test(navigator.userAgent),/BlackBerry | IEMobile| Windows Phone | Win32NT | Android | iPad|iPhone|iPod/.test(navigator.userAgent));v&&requestFileSystem(LocalFileSystem.PERSISTENT,0,t,i),setInterval(function(){function t(e){"TRUE"==f&&(f="FALSE",onGeoLocationError(e))}function i(e){o.set("locationPage","");var t,n,i=(e.coords,o.get("app.context.path"));-1!=i.indexOf("dev")||-1!=i.indexOf(".json")?(t="24.669170",n="46.70533"):(t=e.coords.latitude,n=e.coords.longitude),o.set("ltd",t),o.set("lgt",n)}window.localStorage.setItem("JOB_STATUS","RUN");navigator.geolocation&&navigator.geolocation.getCurrentPosition(i,t,{enableHighAccuracy:!0,timeout:1e4,maximumAge:1e4}),setTimeout(function(){window.localStorage.setItem("FileStorage","DONE");var t,i=o.get("readobj");obj=JSON.parse(i);var a=obj,c=a.length;o.set("jsonObject",c);var s=(Object.keys(c),o.get("radious_proximity"));s=parseFloat(s);var l=/BlackBerry | IEMobile| Windows Phone | Win32NT | Android | iPad|iPhone|iPod/.test(navigator.userAgent),d=parseInt(o.get("records_Per_Day")),f=(new Date,r.getDate()),h=r.getMonth()+1,v=r.getYear()+1900,p=f+""+h+v,m=o.get("todaydate");e.each(a,function(i){function r(e,t){var n=o.get("ltd"),i=o.get("lgt"),a=v.latitute,r=v.longitude,s=c(n),l=c(i),d=c(a),u=c(r),g=6371,f=Math.acos(Math.sin(s)*Math.sin(d)+Math.cos(s)*Math.cos(d)*Math.cos(l-u))*g;return f}function c(e){var t=e*Math.PI/180;return t}window.wizSpinner.hide();var f,h,v=a[i],w=e.i18n.lng();"en-AR"==w?(f=v.offer_text_ar,h=v.merchant_name_ar):(f=v.offer_text_en,h=v.merchant_name_en);var S=(a[i].id,v.merchant_id,v.latitute,v.longitude),_=r(t,I),y=parseFloat(_),P=parseInt(o.get("pushedcount"));if(s>=y&&d>=P){if(m==p){var b=o.get("pushedcount");(void 0==b||"undefined"==b||null==b||"null"==b||""==b)&&(b="1"),b=parseInt(o.get("pushedcount")),b+=1,o.set("pushedcount",b)}else o.set("pushedcount","1"),o.set("todaydate",p);if("Y"!=g[v.merchant_id+""+i]){window.localStorage.setItem("FLAG_STATUS","DONE");var A={lat:v.latitute,lon:v.longitude,offer:f,distance:_},I=JSON.stringify(A);l&&(g[v.merchant_id+""+i]="Y",cordova.plugins.notification.local.hasPermission(function(e){}),cordova.plugins.notification.local.schedule({id:i,title:h,message:f,at:S,icon:"res://icon",smallIcon:"res://notify"}),cordova.plugins.notification.local.on("click",function(e){n.history.navigate("#/landinglayout/offersresume")}))}}u=parseInt(o.set("bg_job_interval"))})},3e3)},parseInt(u))},localstorefile:function(){}});return i});