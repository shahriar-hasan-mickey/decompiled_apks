define(["jquery","underscore","Backbone","collections/common/offersSearchResultCollections"],function(e,t,n,i){var o=new EncryptedLocalStorage("secret"),r=n.View.extend({render:function(){function t(e){alert("code: "+e.code+"\nmessage: "+e.message+"\n"),onGeoLocationError(e)}function n(t){var n=this;timestamp=(new Date).getTime();var r=getDeviceId(),a=e.i18n.lng(),c=function(e){};n.collection=new i,e(".spinner").show();var s=1e3;n.collection.fetch({data:e.param({login_type:"prelogin",reqtype:"PROXIMITYPUSH",device_id:r,language:a,type:"1",city:"",requestid:timestamp}),dataType:"json",type:"POST",cache:!1,success:function(n){function i(t){function n(e){e.getFile("shbproximitylist.json",{create:!0,exclusive:!1},function(e){e.createWriter(function(e){e.write(a)},function(e){})},function(e){})}t.root.getDirectory(".shb",{create:!0,exclusive:!1},n);var i=window.localStorage.getItem("JobStatus");if("RUN"!=i){s=3e3,window.localStorage.setItem("JobStatus","RUN");var o=/iPad|iPhone|iPod/.test(navigator.userAgent);o||navigator.notification.alert("runJob",function(){},"","")}e(".spinner").hide()}function r(t){e(".spinner").hide()}if("0000"==ackStatus&&(alert("success"),t=/BlackBerry | IEMobile| Windows Phone | Win32NT | Android | iPad|iPhone|iPod/.test(navigator.userAgent))){var a=o.get("pushListDTO");window.requestFileSystem(LocalFileSystem.PERSISTENT,0,i,r)}},error:c})}navigator.geolocation?navigator.geolocation.getCurrentPosition(n,t):alert("Please Enable your GPS and try again")},disposeView:function(e){return n.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return r});