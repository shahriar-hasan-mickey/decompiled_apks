define(["jquery","underscore","Backbone","models/login/loginModel","text!views/touchid/touchreg.tpl","text!views/touchid/touchreg_tmp.tpl","text!views/touchid/touchreg_securityimg.tpl","text!views/touchid/touchTermsandCond.tpl","collections/login/loginAuthCollections","collections/login/MPINLoginCollections","text!views/common/noconnection.tpl","collections/login/preLoginAuthCollections","collections/login/secureloginCollections","models/validation/login/loginValidationModel","models/validation/loginuserValidationModel","text!views/login/mpin.tpl","text!views/touchid/touchregException.tpl","collections/login/secureloginCollections","collections/login/secureaccessvalidateCollections","collections/login/securelogintokenCollections"],function(e,t,n,i,o,r,a,s,c,l,p,g,d,u,m,h,v,d,f,y){var w=new EncryptedLocalStorage("secret"),I=n.View.extend({el:"#container",events:{"click #regAgree":"touchRegAgree","click #userlogintmp":"secureaccessvalidate","click #userTouchReg":"preloginverification","click #secureques":"showlogin_resetsecureaccessTemplate","click #userTouchRegconfirm":"securesystimeencuser","click #goatm":"goatm","click #changelanguage":"gotochangelanguage","click #capturephoto":"addMedia","click #mpinTouch":"mpin","click #logTouch":"userlogin","click #newReg":"newRegistration","click .numberButtonTouch":"securesystimeenMPIN","change #iagreeeMpin":"mpinLoginAgree","click #termandconditionMpin":"termandcondition","click #termandconditionUser":"termandcondition","click #tAndCPopup":"touchRegOpenTandCPopup"},render:function(e){w.set("customernumber",""),w.set("custno",""),w.set("custnoenc",""),w.set("timeStampharse",""),w.set("deccust",""),w.set("emailid",""),w.set("NOTIFY_STATUS",""),w.set("notifistopflag",""),w.set("duebillcountflag",""),w.set("currentPage",""),changeStatusBarColor("initial");var i=w.get("internetAccessFlag"),o=w.get("allowOnConfirmAppAccessFlag"),a=w.get("allowAppAccessFlag"),s=w.get("allowAppAccessFlag1");"true"==i&&"true"==a&&"false"==o?this.$el.html(t.template(r)):"known"==s?n.history.navigate("#/ServerConnectionexception"):"unknown"==s?n.history.navigate("#/InternetException"):n.history.navigate("#/InternetException")},touchRegAgree:function(){this.$el.html(t.template(r))},exception:function(){this.$el.html(t.template(v))},termandcondition:function(){w.get("lang_id"),w.get("BiometricType")},forceUpdateNewVersion:function(){function t(e){if(null!=i.url&&void 0!=i.url&&""!=i.url){var t=/iPad|iPhone|iPod/.test(navigator.userAgent);t?window.location.href=i.url:window.open(i.url,"_system","location=no")}}function t(e){if(1==e&&null!=i.url&&void 0!=i.url&&""!=i.url){var t=/iPad|iPhone|iPod/.test(navigator.userAgent);t?window.location.href=i.url:window.open(i.url,"_system","location=no")}}var i=w.get("appInfoDTO");if(!isNull(i)){var o=i.isUpdate,r=i.msg_eng;w.set("allowAppAccessFlag","false"),w.set("allowOnConfirmAppAccessFlag","true"),"M"==o||""==o?(n.history.navigate("#/InternetException"),w.get("promptFired")||(navigator.notification.confirm(r,t,"",[e.i18n.t("app.login.okButton")]),w.set("promptFired",!0))):"O"==o&&(w.get("promptFired")||(navigator.notification.confirm(r,t,"",[e.i18n.t("app.mpin.yes"),e.i18n.t("app.mpin.no")]),w.set("promptFired",!0)))}},preloginverification:function(t){var i=this;new Array,getDeviceId();e("#errortermscondUser").hide();var o=e.trim(e("#username").val());o.charAt(0),o.charAt(o.length-1);this.model=new u({url:"json/"}),this.$(".alert").hide(),n.Validation.bind(this);var r=this.$("form").serializeObject(),a=/iPhone|iPod|iPad|Android/.test(navigator.userAgent);if(this.model.set(r,{validate:!0})){t.preventDefault();var s=e("#termsand").prop("checked");if(!s)return void e("#tandcErr").html("Please check the Terms and Conditions");if(void 0==navigator.network&&a)w.set("errorcode","9999"),w.set("errordesc",e.i18n.t("app.login.nointernet2")),openErrorPopup();else{var c=navigator.connection.type,l={};l[Connection.UNKNOWN]="Unknown connection",l[Connection.ETHERNET]="Ethernet connection",l[Connection.WIFI]="WiFi connection",l[Connection.CELL_2G]="Cell 2G connection",l[Connection.CELL_3G]="Cell 3G connection",l[Connection.CELL_4G]="Cell 4G connection",l[Connection.NONE]="No network connection",c!=Connection.UNKNOWN&&c!=Connection.NONE||!a?(showSpinner(),i.validateTIDReg()):(w.set("errorcode","9999"),w.set("errordesc",e.i18n.t("app.login.nointernet2")),openErrorPopup())}}else this.$(".alert-error").fadeIn(),hideSpinner(),n.Validation.unbind(t)},validateTIDReg:function(){var t=this,n="",i="";if(n=window.localStorage.getItem("loginuserid"),null!=n){var o=n.split("~");i=o[0],n=o[1]}else n=e.trim(e("#username").val());var r=function(e){var n=w.get("appInfoDTO");isNull(n)||"M"!=n.isUpdate&&"O"!=n.isUpdate?t.securesystimeencuserLogin():t.forceUpdateNewVersion()},a=function(n){var i=/iPhone|iPod|iPad|Android/.test(navigator.userAgent);i?e.ajax({url:"https://www.google.com/",type:"GET",timeout:9e4,datatype:"json",success:function(e){hideSpinner(),t.errorresponse()},error:function(t){hideSpinner(),w.set("errorcode","9999"),w.set("errordesc",e.i18n.t("app.login.nointernet2")),openErrorPopup()}}):t.errorresponse()};t.collection=new g([],{});for(var s=e.trim(e("#username").val()),c=(new Date).getTime(),l=EncryptWithDynamicSalt(s,c),p="",d=e.trim(e("#username").val()),u=0;u<d.length;u++)p+=u<d.length-3?"X":d[u];var n="",i="";try{n=window.localStorage.getItem("loginuserid");var o=n.split("~");i=o[0],n=o[1]}catch(m){n=""}var h=!1,v=!1;d==i&&(h=!0),d==n&&(v=!0),(h||v)&&(d=n);w.set("loginuser_id",d),w.set("TID_loginuser_id",d);var f=(e.trim(e("#password").val()),p+"~"+d);e("#rememberuser").prop("checked")?window.localStorage.setItem("loginuserid",f):(window.localStorage.setItem("loginuserid",""),window.localStorage.removeItem("loginuserid"));var y=w.get("device.platform");s="Android"==y?d:d,w.set("touchIDRegUsername",s);var I=null==s?"":s;checkSumEncrypt(I);var S,D=localStorage.getItem("FINALCHECKSUM"),k=getDeviceId(),A=/iPad|iPhone|iPod/.test(navigator.userAgent);S=A?"IOSMOBILE":"ANDROIDMOBILE",t.collection.fetch({data:e.param({mpinflag:w.get("BiometricType")+"R",userId:l,appchecksum:D,platform:S,biometriclogintype:w.get("BiometricType"),appVersion:w.get("app.versionCode"),deviceid:k,userflag:"Y",salt:c}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(w.get("calltimeout")),success:function(e){"0000"==ackStatus?r(e):a(e)},error:a})},securesystimeencuserLogin:function(){var t=this,n=(getDeviceId(),getDeviceId()),i=function(e){t.securesystimeencuser()},o=function(e){t.errorresponse()};t.collection=new y,t.collection.fetch({data:e.param({device_id:n,ulpId:w.get("ulpID")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):o(e)},error:o})},securesystimeencuser:function(){this.model=new u({url:"json/"}),this.$(".alert").hide(),n.Validation.bind(this);var t=this.$("form").serializeObject();if(this.model.set(t,{validate:!0})){var i=this,o=getDeviceId(),r=e("#password").val(),a=r.charAt(r.length-1);" "===a&&(r=r.trim()),w.set("oldpasswrd",r);var s=w.get("loginuser_id"),c=(new Date).getTime(),l=EncryptWithDynamicSalt(s,c);rand=Math.floor(9e4*Math.random())+1e5,c=rand+"";var p=w.get("ulpID");r.length>0&&(plainText=p+r,checkSumEncryptlogin(plainText),finalHash=localStorage.getItem("LOGINCHECKSUM"));var g=w.get("dynamicToken"),m=w.get("timepassphrase"),h=DEcryptWithDynamicSalt(g,m),v="BRAC"+o+s+finalHash+"~"+h,f=CryptoJS.SHA512(v)+"";showSpinner();var y=function(e){i.authlogin()},I=function(e){i.errorresponse()},S=w.get("ulpID");w.set("ulpIDreg",S);var D,k=(e.param({deviceid:o,lang_id:w.get("language"),ulpId:w.get("ulpID"),client_id:w.get("ulpID"),allowedIp:"true",j_username:l,j_password:finalHash,username:w.get("ulpID"),password:finalHash,scope:"read,write",grant_type:"password",response_type:"token",userflag:"Y",salt:c}),/iPad|iPhone|iPod/.test(navigator.userAgent));D=k?"IOSMOBILE":"ANDROIDMOBILE";var A=w.get("networkproviderip"),c=(new Date).getTime();A=EncryptWithDynamicSalt(A,c),i.collection=new d,i.collection.fetch({data:e.param({cliIp:A,salt:c,mtc_token:f,deviceid:o,lang_id:w.get("language"),ulpId:w.get("ulpID"),client_id:w.get("ulpID"),allowedIp:"true",j_username:"xxxxxxxx",j_password:finalHash,username:w.get("ulpID"),password:finalHash,scope:"read,write",grant_type:"password",response_type:"token",osversion:w.get("device.version"),paltform:D,appversion:w.get("app.versionCode"),model:w.get("device.model"),userflag:"Y"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?y(e):I(e)},error:I})}else this.$(".alert-error").fadeIn(),n.Validation.unbind(event)},authlogin:function(e){hideSpinner(),n.history.fragment=null,n.history.navigate("#/touchidotp",{trigger:!0,replace:!0})},loginaskverify:function(){hideSpinner();var e=w.get("forceflag"),t="NO";try{t=window.localStorage.getItem("FirstTimeLoginChk")}catch(i){t="NO"}var o=w.get("mpincheck_server"),r="";try{r=w.get("mpincheck_local")}catch(i){r="NO"}w.get("mpinStatus");"DONE"!=t?n.history.navigate("#/loginask",{trigger:!0,replace:!0}):"Y"==e?n.history.navigate("#/forgotPasswordMsg",{trigger:!0,replace:!0}):"I"==w.get("intermediateFlag")?n.history.navigate("#/fullrightsnotification",{trigger:!0,replace:!0}):n.history.navigate("#/landinglayout",{trigger:!0,replace:!0});var a="N";"mpinch"==r&&(a="Y");var s="N";"mpinch"==o&&(s="Y")},securesystimeenMPIN:function(t){e(this.el).undelegate("#logoutapp","click"),showSpinner();var n=this,i=function(e){n.mpinLogin(t)},o=function(e){n.errorresponse()};n.collection=new d([],{});(new Date).getTime();w.set("mpinval",mpinval);var r,a,s,c,l;l=getDeviceId();var p=w.get("BiometricType");w.set("device_id",l),w.set("lang_id",e.i18n.lng()),a=Math.floor(9e4*Math.random())+1e5,r=a+"",w.set("saltvaluee",r);var g=l+p,u=CryptoJS.MD5(g)+"";s=CryptoJS.MD5(u+r)+"";var m=CryptoJS.SHA512(g)+"";c=CryptoJS.SHA512(m+r)+"";var h,v=((new Date).getTime(),/iPad|iPhone|iPod/.test(navigator.userAgent));h=v?"IOSMOBILE":"ANDROIDMOBILE";var f=getDeviceId(),y=w.get("networkproviderip"),r=(new Date).getTime();y=EncryptWithDynamicSalt(y,r),n.collection.fetch({data:e.param({cliIp:y,salt:r,deviceid:f,osversion:w.get("device.version"),paltform:h,appversion:w.get("app.versionCode"),model:w.get("device.model")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):o(e)},error:o});n.undelegateEvents()},loginverification:function(t,i){this.model=new loginValidation({url:"json/"}),this.$(".alert").hide(),n.Validation.bind(this);var o=this.$("form").serializeObject();if(this.model.set(o,{validate:!0})){var i,r,a,s,l,p,g,d=this,u=(new Date).getTime(),m=w.get("customernumber");i=m;var h=w.get("timeStampharse"),v=DEcryptuser(i,h);w.set("deccust",v),r=e("#password").val(),w.set("loginid",i);var f=Encryptuser(v,u),y=f,I=Encryptuser(v,u);if(s=Math.floor(9e4*Math.random())+1e5,a=s+"",p=w.get("shaMigrateFlag"),r.length>0)if(l=v+r,"N"==p||""==p||null==p||void 0==p){var S=CryptoJS.MD5(l)+"";g=CryptoJS.MD5(S+a)+""}else{var D=CryptoJS.SHA512(l)+"";g=CryptoJS.SHA512(D+a)+""}e("#password").val(r);var k,A,C,T,M,E;isCordovaApp()?(C=w.get("deviceno"),E=w.get("deviceno"),T=device.platform,A=C,A=C,M=device.version,k=getDeviceId(),w.set("predevid",k),w.set("device_id",k),w.set("lang_id",e.i18n.lng())):(C=w.get("deviceno"),E=w.get("deviceno"),T=device.platform,A=C,A=C,M=device.version,k=getDeviceId(),w.set("predevid",k),w.set("device_id",k),w.set("lang_id",e.i18n.lng()));var P=function(e,n){d.authlogin(t,i),w.set("sumryInterfaceReq","N")},O=function(e){d.errorresponse()};d.collection=new c([],{}),showSpinner();var N,_=/iPad|iPhone|iPod/.test(navigator.userAgent);N=_?"IOSMOBILE":"ANDROIDMOBILE";var L=getDeviceId(),R=w.get("dynamicToken"),j=DEcryptusertime(R);sstenc="BURGAN"+L+v+g+"~"+j;var V=CryptoJS.SHA512(sstenc)+"";d.collection.fetch({data:e.param({mtc_token:V,deviceId:k,mobileId:E,userName:y,custencflag:"Y",timeenv:I,timephrase:u,password:g,migrAppRequiredFlag:"Y",shaMigFlag:p,loginsalt:a,platform:N,modelNumber:w.get("device.model"),osVersion:w.get("device.version"),networkMode:w.get("connection"),appVersion:w.get("app.versionCode"),screenResolution:w.get("deviceDimension"),timeZone:w.get("timeZone"),networkOperator:w.get("networkProvider")}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(w.get("calltimeout")),success:function(e){"0000"==ackStatus?P(e):O(e)},error:function(){}})}else this.$(".alert-error").fadeIn(),n.Validation.unbind(t)},showDeviceList:function(){hideSpinner(),n.history.navigate("#/showdevicelist",{trigger:!0,replace:!0})},otpVerification:function(){hideSpinner(),n.history.fragment=null;var e=w.get("mpincheck_server");try{var t=w.get("mpincheck_local")}catch(i){var t="NO"}"mpinch"==t||"mpinch"==e?n.history.navigate("#/mpinloginotp",{trigger:!0,replace:!0}):n.history.navigate("#/touchidotp",{trigger:!0,replace:!0})},preLoginVerficationMPIN:function(t){t.preventDefault();var n=this,i=function(e){n.authlogin()},o=function(e){n.errorresponse()};n.collection=new g([],{});var r=w.get("custno");showSpinner(),n.collection.fetch({data:e.param({userid:r,custencflag:"Y"}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(w.get("calltimeout")),success:function(e){if("0000"==ackStatus){var t=w.get("userstatus");"A"==t?i(e):o(e)}else o(e)},error:o})},authlogin:function(e){hideSpinner(),n.history.fragment=null,n.history.navigate("#/touchidotp",{trigger:!0,replace:!0})},authotplogin:function(e){hideSpinner(),n.history.fragment=null,n.history.navigate("#/mpinloginotp",{trigger:!0,replace:!0})},newRegistration:function(e){showSpinner(),e.preventDefault(),n.history.fragment=null,n.history.navigate("#/landinglayout/registration",{trigger:!0,replace:!0})},mpin:function(t){t.preventDefault(),e("#mpinTouch").addClass("active"),e("#logTouch").removeClass("active"),e("#mpinLogin").show(),e("#userLogin").hide()},userlogin:function(t){t.preventDefault(),e("#logTouch").addClass("active"),e("#mpinTouch").removeClass("active"),e("#mpinLogin").hide(),e("#userLogin").show()},mpinLoginAgree:function(t){var n=this;e("#iagreeeMpin").prop("checked")&&(e("#errortermscondMpin").hide(),n.mpinLogin(t))},mpinLogin:function(t){var n,i=e("#mpin1").val(),o=e("#mpin2").val(),r=e("#mpin3").val(),a=e("#mpin4").val(),s=e("#mpin5").val();t.preventDefault(),e("#errortermscondMpin").hide();e("#iagreeeMpin").val();if(i.length>=1&&o.length>=1&&r.length>=1&&a.length>=1&&s.length>=1){if(n=i+""+o+r+a+s,w.set("sumryInterfaceReq","N"),!e("#iagreeeMpin").prop("checked"))return e("#errortermscondMpin").show(),!1;var c=0,p=n;if(""!=p&&"undefined"!=p){for(var g=0;g<p.length-1;g++){var d=parseInt(p[g])+1;p[g+1]==d&&p[g]!=p[g+1]&&c++}if(4==c)return e("#commonMpinError").show(),!1}var c=0,p=n;if(""!=p&&"undefined"!=p){for(var g=0;g<p.length-1;g++)p[g+1]==p[g]&&c++;if(4==c)return e("#commonMpinError").show(),!1}showSpinner();var u=this,m=function(e){u.authlogin(t)},h=function(e){u.errorresponse()};u.collection=new l([],{});var v=(new Date).getTime();w.set("mpinval",n);var f,y,I,S,D,k;D=getDeviceId(),w.set("device_id",D),w.set("lang_id",e.i18n.lng()),y=Math.floor(9e4*Math.random())+1e5,f=y+"",w.set("saltvaluee",f);var A=D+n,C=CryptoJS.MD5(A)+"";I=CryptoJS.MD5(C+f)+"";var T=CryptoJS.SHA512(A)+"";S=CryptoJS.SHA512(T+f)+"";var M,v=(new Date).getTime(),E="",P=/iPad|iPhone|iPod/.test(navigator.userAgent);M=P?"IOSMOBILE":"ANDROIDMOBILE";var O=(w.get("BiometricType")+"~Y",getDeviceId()),N=w.get("dynamicToken"),_=DEcryptusertime(N);sstenc="BURGAN"+O+n+"~"+deccusttimeSST1+_;var L=CryptoJS.SHA512(sstenc)+"",R=w.get("networkproviderip"),f=(new Date).getTime();R=EncryptWithDynamicSalt(R,f),u.collection.fetch({data:e.param({cliIp:R,salt:f,mtc_token:L,userName:E,custencflag:"Y",mobileId:k,deviceId:D,password:I,shapassword:S,shaMpinMigFlag:"",migrAppRequiredFlag:"Y",loginsalt:f,requestid:v,platform:M,modelNumber:w.get("device.model"),osVersion:w.get("device.version"),networkMode:w.get("connection"),appVersion:w.get("app.versionCode"),screenResolution:w.get("deviceDimension"),timeZone:w.get("timeZone"),networkOperator:w.get("networkProvider")}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(w.get("calltimeout")),success:function(e){"0000"==ackStatus?m(e):h(e)},error:h});u.undelegateEvents()}},touchRegOpenTandCPopup:function(e){e.stopImmediatePropagation(),w.set("tandctype","touchidreg"),openTermsAndConditionsPopup()},errorresponse:function(e){hideSpinner(),openErrorPopup()},addMedia:function(e){navigator.camera.getPicture(this.successAddMedia,this.errorAddMedia,{quality:50,destinationType:Camera.DestinationType.FILE_URI})},successAddMedia:function(e){},errorAddMedia:function(e){},disposeView:function(e){return n.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView},gotochangelanguage:function(t){t.preventDefault(),showSpinner(),"en-US"==e.i18n.lng()?(e.i18n.init({lng:"en-AR"}),jQuery("#rtl.jquery.mobile-1.3.2").remove(),jQuery("#rtl.main").remove(),e("head").append('<link href="css/ltr.jquery.mobile-1.3.2.css" rel="stylesheet"/>'),e("head").append('<link href="css/ltr.main.css" rel="stylesheet"/>')):"en-AR"==e.i18n.lng()&&(e.i18n.init({lng:"en-US"}),jQuery("#ltr.jquery.mobile-1.3.2").remove(),jQuery("#ltr.main").remove(),e("head").append('<link href="css/rtl.jquery.mobile-1.3.2.css" rel="stylesheet"/>'),e("head").append('<link href="css/rtl.main.css" rel="stylesheet"/>')),w.set("userName",e("#userName").val()),e.mobile.jqmNavigator.pushView(new login),e("#spinner").hide()}});return I});