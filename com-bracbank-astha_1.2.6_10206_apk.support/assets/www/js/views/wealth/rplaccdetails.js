define(["jquery","underscore","Backbone","models/validation/wealthValidationModel","collections/wealth/rplAccDetailsCollections","collections/wealth/accStatementCollections","collections/wealth/accDetailStatementCollections","collections/wealth/accDetailStatementPaginationCollections","collections/wealth/accNicknameCollections","collections/wealth/acctDownloadCollections","collections/common/emailAdviceCollections","text!views/wealth/rplaccdetails.tpl","views/wealth/getstatement","views/errors/exception","libs/security/crypto-js/md5"],function(e,t,i,n,a,o,c,l,s,d,r,h,u,m,p){var v=new EncryptedLocalStorage("secret"),w=i.View.extend({el:"#mobcontent",events:{"click #detailstatement":"getdetailStatement","submit #searchby":"gotodate","click #getstatement":"getstatement","click #editname":"savenickname","click #pdfdownload":"PDFDownload","click #xlsdownload":"XLSdownload","click #emailadvice":"EmailAdvice","click #buttonclick":"clickpagination"},update:function(e){showSpinner();var t=this,i=function(e){t.statementcompile()},n=function(e){t.errorresponse()};t.collection=new a([],{id:e}),timestamp=(new Date).getTime(),v.set("accid",e),v.set("rplAccountNumber",e),v.set("accoutDetailType","account"),t.collection.fetch({dataType:"json",type:"POST",cache:!1,timeout:parseInt(v.get("calltimeout")),success:function(e){"0000"==ackStatus?i(e):n(e)},error:n})},statementcompile:function(i){this.$el.html(t.template(h,{collection:this.collection.models,accid:i})).i18n(),this.$el.trigger("create"),e(".amtformatter").formatamount(),hideSpinner();var n=v.get("device.platform");return"Android"==n||"Ios"==n?this.datefunc():this.datefunc(),this},MonthList:function(){hideSpinner(),v.set("SelectedMonthCode","");var t=e("#monthlist option:selected").val(),n=t.split("~");monthcode=n[0],fromdate=n[1],todate=n[2],v.set("SelectedMonthCode",monthcode),v.set("rplmonthlastday",todate),v.set("rplmonthfirstday",fromdate);timestamp=(new Date).getTime();v.get("accid");i.history.navigate("#/rplpagination")},emailadvicecompile:function(){return v.set("backReqFromEmail","10"),this.$el.empty(),i.history.navigate("#/emailAdviceSuccessPage"),hideSpinner(),this},getdetailStatement:function(t){this.model=new n({url:"json/"}),i.Validation.bind(this);var a=this.$("form").serializeObject();if(this.model.set(a,{validate:!0})){this.model.clear(),i.Validation.unbind(this),t.preventDefault(),showSpinner();var o=e("#monthlist option:selected").val(),c=o.split("~");monthcode=c[0],fromdate=c[1],todate=c[2],v.set("SelectedMonthCode",monthcode),v.set("rplmonthlastday",todate),v.set("rplmonthfirstday",fromdate),i.history.navigate("#/rpldetailstatement"),this.undelegateEvents()}else this.$(".alert-error").fadeIn(),t.preventDefault(),hideSpinner()},PDFDownload:function(t){var i="",n=v.get("app.context.path");i=n+"account/ministatement/download.pdf";var a=v.get("appSessionId"),o=v.get("device_id"),c=v.get("lang_id"),l=e("#accountno").val(),s=getDeviceId(),d=l+""+s,r=CryptoJS.MD5(d);d=r+"";var h="device_id="+o+"&appchecksum="+d+"&lang_id="+c+"&accountNumber="+l+"&download=PDF&cardoract=RPL",u=encodeURI(h);fileDownLoadAndViewer(i,u,1,a)},pdfdownloadcompile:function(){hideSpinner()},XLSdownload:function(t){var i="",n=v.get("app.context.path");i=n+"account/ministatement/download.xls";var a=v.get("appSessionId"),o=v.get("device_id"),c=v.get("lang_id"),l=e("#accountno").val(),s=getDeviceId(),d=l+""+s,r=CryptoJS.MD5(d);d=r+"";var h="device_id="+o+"&appchecksum="+d+"&lang_id="+c+"&accountNumber="+l+"&download=XLS&cardoract=RPL",u=encodeURI(h);fileDownLoadAndViewer(i,u,2,a)},xlsdownloadcompile:function(){hideSpinner()},datefunc:function(t){e(".nativedatepicker").focus(function(t){t.preventDefault();var i,n=e(this);if(""!==n.val()){var a=n.val(),o=/(\d+)\/(\d+)\/(\d+)/.exec(a),c=new Date(+o[3],+o[2]-1,+o[1]);i=Date.parse(c)}else t.preventDefault(),i=new Date;"number"==typeof i&&(i=new Date(i)),window.plugins.datePicker.show({date:i,mode:"date",allowOldDates:!0},function(e){if(e){var t=new Date(e),i=t.getDate(),a=t.getMonth()+1,o=t.getFullYear(),c=""+(9>=i?"0"+i:i)+"/"+(9>=a?"0"+a:a)+"/"+o;n.val(c)}n.blur()})})},errorresponse:function(){hideSpinner(),i.history.navigate("#/exception")},showDatePicker:function(){e(".nativedatepicker").focus(function(t){t.preventDefault(),e(this).blur();var i,n=e(this);if(""!==n.val()){var a=n.val(),o=/(\d+)-(\d+)-(\d+)/.exec(a),c=new Date(+o[3],+o[2]-1,+o[1]);i=Date.parse(c)}else t.preventDefault(),i=new Date;"number"==typeof i&&(i=new Date(i));try{var l=cordova.require("cordova/plugin/datepicker"),s={date:i,mode:"date",allowOldDates:!0};s.onChange=this.onDatePickerChange,s.visibility="visible",s.onDismiss=this.onDatePickerDismiss,l.show(s)}catch(d){}})},onDatePickerChange:function(t){var i=new Date(t),n=i.getDate(),a=i.getMonth()+1,o=i.getFullYear(),c=""+(9>=n?"0"+n:n)+"/"+(9>=a?"0"+a:a)+"/"+o;e(this).val(c),e(this).blur()},onDatePickerDismiss:function(t){var i=new Date(t),n=i.getDate(),a=i.getMonth()+1,o=i.getFullYear(),c=""+(9>=n?"0"+n:n)+"-"+(9>=a?"0"+a:a)+"-"+o;e(this).val(c),e(this).blur()},disposeView:function(e){return i.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return w});