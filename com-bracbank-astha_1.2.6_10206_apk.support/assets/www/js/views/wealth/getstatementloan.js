define(["jquery","underscore","Backbone","collections/wealth/loanDetailStatementCollections","collections/wealth/loanDetailStatementPaginationCollections","collections/common/emailAdviceCollections","collections/wealth/acctDownloadCollections","routers/wealthrouter","text!views/wealth/getstatementloan.tpl","text!views/wealth/loandetailstatementpagination.tpl","text!views/common/emailAdviceSuccessPage.tpl","views/errors/exception"],function(e,t,a,n,o,c,r,s,l,d,m,u){var g=new EncryptedLocalStorage("secret"),p=a.View.extend({el:"#mobcontent",e1:"#acctdetcnt",events:{"click #buttonclick":"clickpagination","click #emailadvice":"EmailAdvice","click #pdfdownload":"PDFDownload","click #xlsdownload":"XLSdownload","click #csvdownload":"CSVdownload","click #ftrefnum":"fttransaccnum"},initialize:function(){},update:function(e,t,a,n,o){g.set("currentPage","");var c=new Array;return g.set("pageno","1"),g.set("tranback","0"),c[0]=e,c[1]=t,c[2]=a,c[3]=n,c[4]=o,g.set("AcctSummaryArray",c),this.showFirstRecord(e,t,a,n,o),this},render:function(e,t,a,n,o){var c=new Array;return c[0]=e,c[1]=t,c[2]=a,c[3]=n,c[4]=o,g.set("AcctSummaryArray",c),this.showFirstRecordDetail(e,t,a,n,o),this},clickpagination:function(){var t=e("#currentpageno").val();a.history.navigate("#/showotherloanpages/"+t)},showFirstRecord:function(t,a,o,c,r){showSpinner();var s=this,l=g.get("loanid"),d=g.get("myloans"),m=g.get("cdbflag"),u=(d[l].id,g.get("filterloanid")),p=function(e){s.showdetailstmttemplate(t)};g.set("accountNumber",t),g.set("frmamount",c),g.set("toamount",r),g.set("fromdateacc",a),g.set("todateacc",o);var f=function(e){s.errorresponse()};s.collection=new n([],{});var h=getDeviceId(),v=t+""+h,w=CryptoJS.MD5(v);v=w+"";var y=u+a+o;y=null==y?"":y,checkSumEncrypt(y);var S=localStorage.getItem("FINALCHECKSUM"),A=g.get("frmamtprod"),D=g.get("toamtprod");A=""!=A?A:"",D=""!=D?D:"",s.collection.fetch({data:e.param({access_token:g.get("access_token"),appchecksum:S,accountId:u,fromDate:a,toDate:o,debitCreditFlag:m,lastnTxn:g.get("lastntrans"),fromAmount:A,toAmount:D}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(g.get("calltimeout")),success:function(e){if("0000"==ackStatus){var t=g.get("spendingAnalysierList");if(null!=t&&""!=t){var a=new Array,n=new Array;for(i=0;i<t.length;i++)category=t[i].category,spendingAmount=t[i].spendingAmount,a[i]=category,n[i]=spendingAmount;g.set("graphKey_det_stmt",a),g.set("graphVal_det_stmt",n),p(e)}else p(e)}else f(e)},error:f})},showFirstRecordDetail:function(t,a,o,c,r){showSpinner();var s=this,l=g.get("loanid"),d=g.get("myaccounts"),m=d[l].id,u=g.get("filterloanid"),p=function(e){s.showdetailtemplate(t)};g.set("accountNumber",t),g.set("frmamount",c),g.set("toamount",r);var f=function(e){s.errorresponse()};s.collection=new n([],{});var h=getDeviceId(),v=t+""+h,w=CryptoJS.MD5(v);v=w+"";var y=m+a+o;y=null==y?"":y,checkSumEncrypt(y);var S=localStorage.getItem("FINALCHECKSUM");s.collection.fetch({data:e.param({access_token:g.get("access_token"),appchecksum:S,accountId:u,fromDate:a,toDate:o}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(g.get("calltimeout")),success:function(e){if("0000"==ackStatus){var t=g.get("spendingAnalysierList");if(null!=t&&""!=t){var a=new Array,n=new Array;for(i=0;i<t.length;i++)category=t[i].category,spendingAmount=t[i].spendingAmount,a[i]=category,n[i]=spendingAmount;g.set("graphKey_det_stmt",a),g.set("graphVal_det_stmt",n),p(e)}else p(e)}else f(e)},error:f})},showdetailstmttemplate:function(n){hideSpinner(),this.$el.html(t.template(l,{accountNumber:n})),this.$el.trigger("create"),e(".amtformatter").formatamount(),a.history.navigate("#/showpaginationloan")},showdetailtemplate:function(n){hideSpinner(),this.$el.html(t.template(l,{accountNumber:n})),this.$el.trigger("create");var o=g.get("pageno");page_no=parseInt(o)-1,e(".page_link[longdesc="+page_no+"]").addClass("active_page").siblings(".active_page").removeClass("active_page"),e(".amtformatter").formatamount();var o=g.get("pageno");a.history.navigate("#/showotherloanpages/"+o)},EmailAdvice:function(){showSpinner();var t=this,a=g.get("ftreff"),n=function(e){t.emailadvicecompile(a)},o=function(e){t.errorresponse()};t.collection=new c([],{});var i,r=(new Date).getTime(),s=g.get("accountNumber"),l=g.get("ttype");"ACCOUNT"==l?i="ACCOUNT":"CARD"==l?i="CARD":"TRANSFER"==l&&(i="TRANSFER");var d=g.get("emailid"),m=(g.get("loginid"),g.get("custno")),u=(g.get("lang_id"),getDeviceId()),p=(g.get("accountNumber"),s+""+u),f=CryptoJS.MD5(p);p=f+"",t.collection.fetch({data:e.param({appchecksum:p,ftrefno:a,transfertype:i,accountNumber:s,custmailid:d,custuserid:m,requestid:r}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(g.get("calltimeout")),success:function(e){"0000"==ackStatus?n(e):o(e)},error:o})},emailadvicecompile:function(){return g.set("backReqFromEmail","3"),this.$el.html(t.template(m)).i18n(),this.$el.trigger("create"),hideSpinner(),this},PDFDownload:function(t){var a="",n=g.get("app.context.path");a=n+"account/ministatement/download.pdf";var o=g.get("access_token"),c=(g.get("device_id"),g.get("lang_id"),e("#accountno").val(),g.get("loanid")),i=g.get("myloans"),r=i[c].id,s=(g.get("cdbflag"),g.get("frmamtprod")),l=g.get("toamtprod"),d=g.get("lastntrans"),m=g.get("fromdateacc"),u=g.get("todateacc"),p="";s=""!=s?s:"",l=""!=l?l:"";var f=(getDeviceId(),""),h="accountID="+r+"&fromDate="+m+"&toDate="+u+"&fromAmount="+s+"&toAmount="+l+"&lastnTxn="+d+"&emailRequired="+p+"&appchecksum="+f+"&access_token="+o+"&download=PDF&type=LOAN",v=encodeURI(h);fileDownLoadAndViewer(a,v,1,o)},pdfdownloadcompile:function(){hideSpinner()},XLSdownload:function(t){var a="",n=g.get("app.context.path");a=n+"account/ministatement/download.xls";var o=g.get("access_token"),c=(g.get("device_id"),g.get("lang_id"),e("#accountno").val(),g.get("loanid")),i=g.get("myloans"),r=i[c].id,s=(g.get("cdbflag"),g.get("frmamtprod")),l=g.get("toamtprod"),d=g.get("lastntrans"),m=g.get("fromdateacc"),u=g.get("todateacc"),p="";s=""!=s?s:"",l=""!=l?l:"";var f=(getDeviceId(),""),h="accountID="+r+"&fromDate="+m+"&toDate="+u+"&fromAmount="+s+"&toAmount="+l+"&lastnTxn="+d+"&emailRequired="+p+"&appchecksum="+f+"&access_token="+o+"&download=XLS&type=LOAN",v=encodeURI(h);fileDownLoadAndViewer(a,v,2,o)},xlsdownloadcompile:function(){hideSpinner()},CSVdownload:function(t){var a=this,n=function(e){a.csvdownloadcompile()},o=function(e){a.errorresponse()};a.collection=new r([],{});var c=getDeviceId(),i=accountNumber+""+c,s=CryptoJS.MD5(i);i=s+"";var l=e("#accountno").val();timestamp=(new Date).getTime(),a.collection.fetch({data:e.param({appchecksum:i,accountnumber:l,requestid:timestamp}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(g.get("calltimeout")),success:function(e){"0000"==ackStatus?n(e):o(e)},error:o})},csvdownloadcompile:function(){hideSpinner()},errorresponse:function(){hideSpinner(),openErrorPopup()}});return p});