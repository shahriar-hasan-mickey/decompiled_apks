define(["jquery","underscore","Backbone","collections/wealth/accDetailStatementCollections","collections/common/emailAdviceCollections","text!views/common/emailAdviceSuccessPage.tpl","text!views/wealth/rplaccdetailstatement.tpl","views/common/exception"],function(e,t,n,o,a,c,i,r){var l=new EncryptedLocalStorage("secret"),d=n.View.extend({el:"#mobcontent",events:{"click #buttonclick":"clickpagination","click #emailadvice":"EmailAdvice","click #pdfdownload":"PDFDownload","click #xlsdownload":"XLSdownload"},update:function(){var e=this;e.details1("0")},details1:function(t){hideSpinner();var n=this;if(l.set("SelectedMonthCode",""),"0"!=t){monthlistVal=l.get("monthlistVal"),monthSelectedIdx=l.get("monthSelectedIdx"),l.get("MonthListArray");var a=l.get("montharr");monthcode=a[0],r=a[1],d=a[2]}else{monthSelectedIdx="0",monthcode="00";var c=l.get("rplmonthfirstday"),i=l.get("rplmonthlastday")}l.set("SelectedMonthCode",monthcode);var r=c,d=i;timestamp=(new Date).getTime();var s=l.get("accid");showSpinner();var m=function(e){n.detailstatementcompile(monthSelectedIdx)},p=function(e){n.errorresponse()};n.collection=new o([],{});var h=getDeviceId(),u=s+""+h,g=CryptoJS.MD5(u);u=g+"",n.collection.fetch({data:e.param({appchecksum:u,accountNumber:s,fromDate:r,toDate:d,frmtxnfromamount:"",frmtxntoamount:""}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(l.get("calltimeout")),success:function(e){var t=(l.get("errordesc"),l.get("errorcode"));"0000"==ackStatus?"0000"==t?m(e):n.statementcompile("0"):null!=t&&"MTC-RT-0003"!=t?m(e):p(e)},error:p})},MonthList:function(){hideSpinner(),l.set("SelectedMonthCode","");var t=this;monthlistVal=l.get("monthlistVal"),monthSelectedIdx=l.get("monthSelectedIdx");l.get("montharr");monthcode=l.get("SelectedMonthCode");var n=l.get("rplmonthfirstday"),a=l.get("rplmonthlastday");timestamp=(new Date).getTime();var c=l.get("rplano");showSpinner();var i=function(e){t.statementcompile(monthSelectedIdx)},r=function(e){t.errorresponse()};t.collection=new o([],{});var d=getDeviceId(),s=c+""+d,m=CryptoJS.MD5(s);s=m+"",t.collection.fetch({data:e.param({appchecksum:s,accountNumber:c,fromDate:n,toDate:a,frmtxnfromamount:"",frmtxntoamount:""}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(l.get("calltimeout")),success:function(e){var n=(l.get("errordesc"),l.get("errorcode"));"0000"==ackStatus?"0000"==n?i(e):t.listcompile("0"):null!=n&&"MTC-RT-0003"!=n?i(e):r(e)},error:r})},statementcompile:function(n){return this.$el.html(t.template(i,{collection:this.collection.models,accid:n})).i18n(),this.$el.trigger("create"),e(".amtformatter").formatamount(),hideSpinner(),this},detailstatementcompile:function(){return this.$el.html(t.template(i,{collection:this.collection.models})).i18n(),this.$el.trigger("create"),hideSpinner(),this.undelegateEvents(),this},PDFDownload:function(e){var t="",n=l.get("app.context.path");t=n+"account/ministatement/download.pdf";var o=l.get("appSessionId"),a=l.get("device_id"),c=l.get("lang_id"),i=l.get("rplano"),r=getDeviceId(),d=i+""+r,s=CryptoJS.MD5(d);d=s+"";var m="device_id="+a+"&appchecksum="+d+"&lang_id="+c+"&accountNumber="+i+"&download=PDF&cardoract=RPL",p=encodeURI(m);fileDownLoadAndViewer(t,p,1,o)},pdfdownloadcompile:function(){hideSpinner()},XLSdownload:function(e){var t="",n=l.get("app.context.path");t=n+"account/ministatement/download.xls";var o=l.get("appSessionId"),a=l.get("device_id"),c=l.get("lang_id"),i=l.get("rplano"),r=getDeviceId(),d=i+""+r,s=CryptoJS.MD5(d);d=s+"";var m="device_id="+a+"&appchecksum="+d+"&lang_id="+c+"&accountNumber="+i+"&download=XLS&cardoract=RPL",p=encodeURI(m);fileDownLoadAndViewer(t,p,2,o)},clickpagination:function(){var t=e("#currentpageno").val();n.history.navigate("#/rplshowotherpages/"+t)},EmailAdvice:function(){showSpinner();var t=this,n=function(e){t.emailadvicecompile()},o=function(e){t.errorresponse()};t.collection=new a([],{});var c,i=(new Date).getTime(),r=l.get("ttype");"ACCOUNT"==r?c="ACCOUNT":"CARD"==r?c="CARD":"TRANSFER"==r&&(c="TRANSFER");var d=l.get("emailid"),s=(l.get("loginid"),l.get("custno")),m=(l.get("lang_id"),getDeviceId()),p=l.get("rplano"),h=p+""+m,u=CryptoJS.MD5(h);h=u+"",t.collection.fetch({data:e.param({appchecksum:h,transfertype:c,accountNumber:p,custmailid:d,custuserid:s,requestid:i}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(l.get("calltimeout")),success:function(e){"0000"==ackStatus?n(e):o(e)},error:o})},emailadvicecompile:function(){return l.set("backReqFromEmail","10"),this.$el.html(t.template(c)).i18n(),this.$el.trigger("create"),hideSpinner(),this},errorresponse:function(){hideSpinner(),n.history.navigate("#/exception")}});return d});