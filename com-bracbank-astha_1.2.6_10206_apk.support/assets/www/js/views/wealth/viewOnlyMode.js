define(["jquery","underscore","Backbone","text!views/wealth/viewOnlyMode.tpl"],function(e,t,s,a){var i=new EncryptedLocalStorage("secret"),o=s.View.extend({el:"#container",events:{"click #okButton":"gotoDashBoard","click #slide_out_savings":"savingUI","click #slide_out_deposits":"depositsUI","click #slide_out_creditcard":"creditUI","click #slide_out_prepaidcard":"prepaidUI","click #slide_out_loan":"loansUI","click #slide_out_statementCertificate":"gotoStatementAndCertificate","click #slide_out_transfers":"transfer","click #slide_out_positivePay":"gotopositivePay","click #slide_out_billpay":"billpay","click #slide_out_managebene":"loadmanagebeneUi","click #slide_out_transactions":"gotoTransferHistory","click #slide_out_transferlimit":"gotoTransferLimit","click #slide_out_services":"servicesUI","click #slide_out_user_settings":"gotoUserSettings","click #slideout_more":"gotoMore","click #slideout_contact":"gotoPostLoginContactUs","click #logout":"gotoFeedbackPopup"},initialize:function(){},render:function(){this.$el.html(t.template(a)),e("html").removeClass().addClass("app")},gotoDashBoard:function(e){e.stopImmediatePropagation(),s.history.navigate("#/wealth")},savingUI:function(){s.history.navigate("#/accounttypelist")},depositsUI:function(){i.set("depositType","FDR"),i.set("isFromFooterMenu","false"),s.history.navigate("#/deposittype")},creditUI:function(){s.history.navigate("#/creditcardtype")},prepaidUI:function(){s.history.navigate("#/prepaidcardlist")},loansUI:function(){s.history.navigate("#/loantype")},gotoStatementAndCertificate:function(e){e.stopImmediatePropagation(),i.set("isFromFooterMenu","true"),s.history.navigate("#/statementcertificate")},transfer:function(){"N"==i.get("fullRightsFlag")?(i.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(i.set("isFromFooterMenu","false"),s.history.navigate("#/transfer")),e(".pagewrapper").toggleClass("mnuactive")},gotopositivePay:function(t){t.stopImmediatePropagation(),"N"==i.get("fullRightsFlag")?(i.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(i.set("isFromFooterMenu","true"),s.history.navigate("#/positivepayinit")),e(".pagewrapper").toggleClass("mnuactive")},billpay:function(){"N"==i.get("fullRightsFlag")?(i.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(i.set("isFromFooterMenu","false"),s.history.navigate("#/billpay")),e(".pagewrapper").toggleClass("mnuactive")},loadmanagebeneUi:function(){"N"==i.get("fullRightsFlag")?(i.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):s.history.navigate("#/managebene"),e(".pagewrapper").toggleClass("mnuactive")},gotoTransferHistory:function(t){t.stopImmediatePropagation(),"N"==i.get("fullRightsFlag")?(i.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(i.set("isFromFooterMenu","false"),s.history.navigate("#/transhistory")),e(".pagewrapper").toggleClass("mnuactive")},gotoTransferLimit:function(t){t.stopImmediatePropagation(),"N"==i.get("fullRightsFlag")?(i.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(i.set("isFromFooterMenu","true"),s.history.navigate("#/transferlimits")),e(".pagewrapper").toggleClass("mnuactive")},servicesUI:function(){i.set("isFromFooterMenu","false"),s.history.navigate("#/servicerequest")},gotoUserSettings:function(){s.history.navigate("#/usersettings")},gotoMore:function(){s.history.navigate("#/more")},gotoPostLoginContactUs:function(e){e.stopImmediatePropagation(),s.history.navigate("#/contact")},gotoFeedbackPopup:function(t){t.stopImmediatePropagation(),showSpinner(),i.set("surveyStatus",null),i.set("surveyMesage",null),i.set("surveyQuestionIds",null),i.set("surveyQuestionRatings",null);var s=this,a=function(e){hideSpinner(),"Y"==i.get("disppop")?s.gotoPopulateFeedbackPopup(t):"N"==i.get("disppop")&&s.logout(t)},o=function(e){s.errorresponse()};s.collection=new feedbackSurveyCollections([],{});(new Date).getTime();s.collection.fetch({data:e.param({access_token:i.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):o(e)},error:o})},gotoPopulateFeedbackPopup:function(t){t.stopImmediatePropagation();var s=i.get("surveyList");e("#feedbackPopup").html("");var a=this,o=/iPad|iPhone|iPod/.test(navigator.userAgent),r='<div class="modal fade feedbackPop" id="feedback" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><form> <div class="modal-content"><div class="modal-header"> <button type="button" class="close" aria-label="Close" id="surveySkipButton"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">Rate Your Experience</h4></div><div class="modal-body"><div class="survey-ques"><div class="row"><div class="col-sm-12 col-md-6">';e.each(s,function(e,t){r+='<div class="ques"><span class="ques-cout">'+(e+1)+'</span><div class="rat-cnt" ques="'+t.surveyQuestion+'"><p>'+t.surveyQuestion+'</p></div><div class="rate-area rateAreaClass" id="'+t.surveyQuestionId+'_rating_value"><input type="radio" id="'+t.surveyQuestionId+'_rat1" name="rating'+(e+1)+'" value="10" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat1" title="Excellent">10 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat2" name="rating'+(e+1)+'" value="9" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat2" title="Excellent">9 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat3" name="rating'+(e+1)+'" value="8" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat3" title="Good">8 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat4" name="rating'+(e+1)+'" value="7" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat4" title="Good">7 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat5" name="rating'+(e+1)+'" value="6" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat5" title="Average">6 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat6" name="rating'+(e+1)+'" value="5" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat6" title="Average">5 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat7" name="rating'+(e+1)+'" value="4" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat7" title="Not Good">4 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat8" name="rating'+(e+1)+'" value="3" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat8" title="Not Good">3 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat9" name="rating'+(e+1)+'" value="2" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat9" title="Poor">2 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat10" name="rating'+(e+1)+'" value="1" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat10" title="Poor">1 star</label></div></div>',r+='<div class="form-group has-error"><p class="help-block error-message" style="color:#a94442" id="surveyQuesErr'+(e+1)+'"></p></div>'}),r+='</div></div><div class="form-group"><textarea class="form-control inputlengthcontrol" id="feedbackComment" placeholder="Leave a comment ( Max 500 character)" maxlength="500"></textarea><p class="text-muted small">Special characters (Space, Dot, Comma, Brackets) are allowed only.</p></div><div class="alert alert-info" role="alert">',r+=o?'<small><a href="javascript:void(0);" id="gotoStoreBtn" class="btn btn-primary btn-sm" target="_blank"><i class="fa fa-external-link"></i> Click Here</a> &nbsp;to rate us on Apple Store <img src="images/common/ios-app-store.svg" width="32" /></small>':'<small><a href="javascript:void(0);" id="gotoStoreBtn" class="btn btn-primary btn-sm" target="_blank"><i class="fa fa-external-link"></i> Click Here</a> &nbsp;to rate us on Play Store <img src="images/common/google-play.svg" width="32" /></small>',r+='</div></div></div><div class="modal-footer"><div class="row"><div class="col-xs-6 pr5"><a href="javascript:void(0);" class="btn btn-default btn-block" id="surveyLaterButton">Later</a></div><div class="col-xs-6 pl5"><a href="javascript:void(0);" class="btn btn-primary btn-block" id="surveySubmitButton">Submit</a></div></div></div></div></form></div></div>',e("#feedbackPopup").html(r),e(".inputlengthcontrol").inputalphanumericlength(),e("#feedback").modal("show"),e("#surveySkipButton").on("click",function(){i.set("surveyStatus","SKIPPED"),i.set("surveyMesage",null),i.set("surveyQuestionIds",null),i.set("surveyQuestionRatings",null),e("#feedback").modal("hide"),a.logout(t)}),e("#surveyLaterButton").on("click",function(){i.set("surveyStatus","MARKED_LATER"),i.set("surveyMesage",null),i.set("surveyQuestionIds",null),i.set("surveyQuestionRatings",null),e("#feedback").modal("hide"),a.logout(t)}),e("#surveySubmitButton").on("click",function(){i.set("surveyStatus","COMPLETED"),a.gotoGetSurveyDetails(t)}),e("#gotoStoreBtn").on("click",function(){a.gotoRateUsFunction(t)})},gotoGetSurveyDetails:function(t){t.stopImmediatePropagation();var s=!1,a=[],o=[];if(e(".rateAreaClass").each(function(t,i){e("#surveyQuesErr"+(t+1)).html("");var r=e(this).attr("id"),n=e("#"+r+" input[type='radio']:checked").attr("quesId"),l=e("#"+r+" input[type='radio']:checked").val();isNull(l)&&(s=!0,e("#surveyQuesErr"+(t+1)).html("Kindly share the valuable feedback rating")),s||(a.push(n),o.push(l))}),!s){e("#feedback").modal("hide"),i.set("surveyQuestionIds",a),i.set("surveyQuestionRatings",o);var r=e.trim(e("#feedbackComment").val());i.set("surveyMesage",r);var n=this;n.logout(t)}},gotoRateUsFunction:function(e){e.stopImmediatePropagation();var t=i.get("appInfoDTO");if(null!=t.url&&void 0!=t.url&&""!=t.url){var s=/iPad|iPhone|iPod/.test(navigator.userAgent);s?window.location.href=t.url:window.open(t.url,"_system","location=no")}},logout:function(t){t.stopImmediatePropagation(),showSpinner();var a=i.get("surveyQuestionIds");if(!isNull(a))var o=a.join("~"),r=i.get("surveyQuestionRatings"),n=r.join("~");var l=this,u=function(e){hideSpinner(),i.set("isLogin",!1),i.set("defaultSessionTimeOut",0),i.set("timeoutFlagsessioncount",""),this.model=new accSummaryModel;var t=i.get("touchIdReg");"A"==t?s.history.navigate("#/landing"):s.history.navigate("#/applogin")},c=function(e){l.errorresponse()};l.collection=new logoutCollections([],{});(new Date).getTime();l.collection.fetch({data:e.param({usersession:i.get("access_token"),access_token:i.get("access_token"),status:i.get("surveyStatus"),message:i.get("surveyMesage"),questionIds:o,questionRatings:n}),dataType:"json",type:"POST",cache:!1,success:function(e){if("0000"==ackStatus){i.get("errorcode");u("0000"==ackStatus?e:e)}else c(e)},error:c})},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return s.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return o});