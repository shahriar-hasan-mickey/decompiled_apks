define(["jquery","underscore","Backbone","collections/wealth/PersonalfinanceSummaryCollections","text!views/wealth/personalfinancesummary.tpl","models/validation/OTPValidationModel","models/validation/wealthValidationModel","collections/common/otpGenerateCollections","views/errors/exception"],function(e,n,t,a,i,o,r,s,c){var l=new EncryptedLocalStorage("secret"),p=t.View.extend({el:"#mobcontent",events:{"click #personalfinancesubmitotp":"personalfinancesubmitotp","click #personalfinanceresentotp":"ResendOtpRequest","click #termandcondition":"applytermsandconurl"},update:function(){showSpinner(),l.set("currentPage","");var n=this,t=function(e){n.personalfinancesummarycompile()},i=function(e){n.errorresponse()};n.collection=new a([],{}),timestamp=(new Date).getTime();var o=(l.get("custno"),l.get("loanAccountNumber"));n.collection.fetch({data:e.param({hidapplicationid:o,requestid:timestamp}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?t(e):i(e)},error:i})},personalfinancesummarycompile:function(){this.$el.html(n.template(i,{})).i18n(),this.$el.trigger("create"),hideSpinner()},applytermsandconurl:function(){l.get("lang_id")},ResendOtpRequest:function(){e("#secError").hide(),e("#otp").val(""),e("#personalfinancesubmitotp").removeAttr("disabled");var n=this,t=function(e){n.errorresponse()};n.collection=new s([],{});var a=(new Date).getTime();"en-US"==e.i18n.lng()?language="EN":"en-AR"==e.i18n.lng()&&(language="AR");var i=l.get("custno"),o="9004",r="";showSpinner(),n.collection.fetch({data:e.param({servicetype:o,language:language,custno:i,ipaddress:r,requestid:a}),dataType:"json",type:"POST",timeout:parseInt(l.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?hideSpinner():t(e)},error:t})},personalfinancesubmitotp:function(n){e("#errortermscond").hide();var a=!1;e("#iagreee").prop("checked")&&e("#acceptFinCheck").prop("checked")||(e("#errortermscond").show(),a=!0),this.model=new r({url:"json/"}),t.Validation.bind(this);var i=this.$("form").serializeObject();if(this.model.set(i,{validate:!0})){this.model.clear(),t.Validation.unbind(this);(new Date).getTime(),l.get("custno");if(a)return!1;this.personalfinanceotpCompile()}else this.$(".alert-error").fadeIn()},personalfinanceotpCompile:function(){var n=e("#finamtval").val(),a=e("#purposeoffinval").val(),i=e("#fincontractperiodval").val(),o=e("#finstatus").val();l.set("finamtval",n),l.set("purposeoffinval",a),l.set("fincontractperiodval",i),l.set("finstatus",o);var r=e("#purposetype option:selected").text();l.set("purposetype",r),hideSpinner(),t.history.navigate("#/personalfinanceOtp")},errorresponse:function(){hideSpinner(),t.history.navigate("#/exception")}});return p});