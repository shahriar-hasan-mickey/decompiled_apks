define(["jquery","underscore","Backbone","collections/wealth/cardDetailStatementCollections","collections/wealth/cardDetailStatementPaginationCollections","collections/common/emailAdviceCollections","collections/wealth/acctDownloadCollections","routers/wealthrouter","text!views/wealth/getstatementcard.tpl","text!views/wealth/carddetailstatementpagination.tpl","text!views/common/emailAdviceSuccessPage.tpl","views/errors/exception"],function(e,t,a,n,c,o,r,s,l,d,m,u){var p=new EncryptedLocalStorage("secret"),g=a.View.extend({el:"#mobcontent",e1:"#acctdetcnt",events:{"click #buttonclick":"clickpagination","click #emailadvice":"EmailAdvice","click #pdfdownload":"PDFDownload","click #xlsdownload":"XLSdownload","click #csvdownload":"CSVdownload","click #ftrefnum":"fttransaccnum"},initialize:function(){},update:function(e,t,a,n,c){p.set("currentPage","");var o=new Array;return p.set("pageno","1"),p.set("tranback","0"),o[0]=e,o[1]=t,o[2]=a,o[3]=n,o[4]=c,p.set("AcctSummaryArray",o),this.showFirstRecord(e,t,a,n,c),this},render:function(e,t,a,n,c){var o=new Array;return o[0]=e,o[1]=t,o[2]=a,o[3]=n,o[4]=c,p.set("AcctSummaryArray",o),this.showFirstRecordDetail(e,t,a,n,c),this},clickpagination:function(){var t=e("#currentpageno").val();a.history.navigate("#/showotherpagescard/"+t)},showFirstRecord:function(t,a,c,o,r){showSpinner();var s=this,l=p.get("cccard"),d=p.get("mycreditcards"),m=d[l].id,u=p.get("cdbflag"),g=function(e){s.showdetailstmttemplate(t)};p.set("accountNumber",t),p.set("frmamount",o),p.set("toamount",r),p.set("fromdateacc",a),p.set("todateacc",c);var f=function(e){s.errorresponse()};s.collection=new n([],{});var h=getDeviceId(),v=t+""+h,w=CryptoJS.MD5(v);v=w+"";var y=p.get("frmamtcc"),S=p.get("toamtcc");y=""!=y?y:"",S=""!=S?S:"",s.collection.fetch({data:e.param({access_token:p.get("access_token"),appchecksum:"",accountId:m,fromDate:a,toDate:c,flag:"CC",type:p.get("transaction"),debitCreditFlag:u,lastnTxn:p.get("lastntrans"),fromAmount:y,toAmount:S}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(p.get("calltimeout")),success:function(e){if("0000"==ackStatus){var t=p.get("spendingAnalysierList");if(null!=t&&""!=t){var a=new Array,n=new Array;for(i=0;i<t.length;i++)category=t[i].category,spendingAmount=t[i].spendingAmount,a[i]=category,n[i]=spendingAmount;p.set("graphKey_det_stmt",a),p.set("graphVal_det_stmt",n),g(e)}else g(e)}else f(e)},error:f})},showFirstRecordDetail:function(t,a,c,o,r){showSpinner();var s=this,l=p.get("acccid"),d=p.get("mycreditcards"),m=d[l].id,u=function(e){s.showdetailtemplate(t)};p.set("accountNumber",t),p.set("frmamount",o),p.set("toamount",r);var g=function(e){s.errorresponse()};s.collection=new n([],{});var f=getDeviceId(),h=t+""+f,v=CryptoJS.MD5(h);h=v+"",s.collection.fetch({data:e.param({access_token:p.get("access_token"),appchecksum:"",accountID:m,fromDate:a,toDate:c}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(p.get("calltimeout")),success:function(e){if("0000"==ackStatus){var t=p.get("spendingAnalysierList");if(null!=t&&""!=t){var a=new Array,n=new Array;for(i=0;i<t.length;i++)category=t[i].category,spendingAmount=t[i].spendingAmount,a[i]=category,n[i]=spendingAmount;p.set("graphKey_det_stmt",a),p.set("graphVal_det_stmt",n),u(e)}else u(e)}else g(e)},error:g})},showdetailstmttemplate:function(n){hideSpinner(),this.$el.html(t.template(l,{accountNumber:n})),this.$el.trigger("create"),e(".amtformatter").formatamount(),a.history.navigate("#/showpaginationcard")},showdetailtemplate:function(n){hideSpinner(),this.$el.html(t.template(l,{accountNumber:n})),this.$el.trigger("create");var c=p.get("pageno");page_no=parseInt(c)-1,e(".page_link[longdesc="+page_no+"]").addClass("active_page").siblings(".active_page").removeClass("active_page"),e(".amtformatter").formatamount();var c=p.get("pageno");a.history.navigate("#/showotherpagescard/"+c)},EmailAdvice:function(){showSpinner();var t=this,a=p.get("ftreff"),n=function(e){t.emailadvicecompile(a)},c=function(e){t.errorresponse()};t.collection=new o([],{});var i,r=(new Date).getTime(),s=p.get("accountNumber"),l=p.get("ttype");"ACCOUNT"==l?i="ACCOUNT":"CARD"==l?i="CARD":"TRANSFER"==l&&(i="TRANSFER");var d=p.get("emailid"),m=(p.get("loginid"),p.get("custno")),u=(p.get("lang_id"),getDeviceId()),g=(p.get("accountNumber"),s+""+u),f=CryptoJS.MD5(g);g=f+"",t.collection.fetch({data:e.param({appchecksum:g,ftrefno:a,transfertype:i,accountNumber:s,custmailid:d,custuserid:m,requestid:r}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(p.get("calltimeout")),success:function(e){"0000"==ackStatus?n(e):c(e)},error:c})},emailadvicecompile:function(){return p.set("backReqFromEmail","3"),this.$el.html(t.template(m)).i18n(),this.$el.trigger("create"),hideSpinner(),this},PDFDownload:function(t){var a="",n=p.get("app.context.path");a=n+"creditcard/ministatement/download.pdf";var c=p.get("access_token"),o=(p.get("device_id"),p.get("lang_id"),e("#accountno").val(),p.get("cccard")),i=p.get("mycreditcards"),r=i[o].id,s=(p.get("cdbflag"),p.get("fromdateacc")),l=p.get("todateacc"),d=p.get("frmamtprod"),m=(p.get("cdbflag"),p.get("toamtprod")),u=p.get("lastntrans"),g=p.get("transaction"),f="";d=""!=d?d:"",m=""!=m?m:"";var h=(getDeviceId(),""),v="accountID="+r+"&fromDate="+s+"&toDate="+l+"&fromAmount="+d+"&toAmount="+m+"&lastnTxn="+u+"&emailRequired="+f+"&appchecksum="+h+"&access_token="+c+"&type="+g+"&download=PDF&flag=CC",w=encodeURI(v);fileDownLoadAndViewer(a,w,1,c)},pdfdownloadcompile:function(){hideSpinner()},XLSdownload:function(t){var a="",n=p.get("app.context.path");a=n+"account/ministatement/download.xls";var c=p.get("appSessionId"),o=p.get("device_id"),i=p.get("lang_id"),r=e("#accountno").val(),s=getDeviceId(),l=r+""+s,d=CryptoJS.MD5(l);l=d+"";var m="device_id="+o+"&appchecksum="+l+"&lang_id="+i+"&accountNumber="+r+"&download=XLS&cardoract=CARD",u=encodeURI(m);fileDownLoadAndViewer(a,u,2,c)},xlsdownloadcompile:function(){hideSpinner()},CSVdownload:function(t){var a=this,n=function(e){a.csvdownloadcompile()},c=function(e){a.errorresponse()};a.collection=new r([],{});var o=getDeviceId(),i=accountNumber+""+o,s=CryptoJS.MD5(i);i=s+"";var l=e("#accountno").val();timestamp=(new Date).getTime(),a.collection.fetch({data:e.param({appchecksum:i,accountnumber:l,requestid:timestamp}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(p.get("calltimeout")),success:function(e){"0000"==ackStatus?n(e):c(e)},error:c})},csvdownloadcompile:function(){hideSpinner()},errorresponse:function(){hideSpinner(),openErrorPopup()}});return g});