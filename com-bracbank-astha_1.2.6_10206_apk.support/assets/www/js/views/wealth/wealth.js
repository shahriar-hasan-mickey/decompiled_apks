define(["jquery","underscore","Backbone","collections/wealth/accSummaryCollections","collections/logout/logoutCollections","collections/login/getFAPCollections","collections/logout/feedbackSurveyCollections","collections/transfer/loadWalletInfoCollection","collections/bills/fetchBillerCollections","models/wealth/accSummaryModel","routers/wealthrouter","routers/morerouter","routers/datelinerouter","routers/accountsrouter","routers/transferrouter","routers/servicerouter","routers/billerrouter","text!views/wealth/wealth.tpl","text!views/wealth/casaLoad.tpl","text!views/dateline/dateline.tpl","collections/accounts/termDeposit/applyCasaProductInputCollections","views/errors/exception"],function(e,t,s,a,i,o,n,r,l,c,u,d,g,p,v,m,f,y,h,b,w,_){var I=new EncryptedLocalStorage("secret"),k=s.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",e3:"#ccloaddata",events:{"click #creditcard_tab":"creditcard","click #prepaidcard_tab":"prepaidcreditcard","click #loan_tab":"loan","click #termdeposit_tab":"termdeposits","click #slide_out_dashboard":"wealth","click #slide_out_upcomingpayments":"loaddatelineUI","click #slide_out_savings":"savingUI","click #slide_out_creditcard":"creditUI","click #slide_out_prepaidcard":"prepaidUI","click #slide_out_loan":"loansUI","click #slide_out_deposits":"depositsUI","click #slide_out_open_deposits":"openDepositsUI","click #slide_out_transfers":"transfer","click #slide_out_billpay":"billpay","click #manage_biller":"managebillerUI","click #slide_out_managebene":"loadmanagebeneUi","click #slide_out_services":"servicesUI","click #logout":"gotoFeedbackPopup","click #slideout_more":"gotoMore","click #slide_out_user_settings":"gotoUserSettings","click #slide_out_transactions":"gotoTransferHistory","click #slide_out_statementCertificate":"gotoStatementAndCertificate","click #slide_out_positivePay":"gotopositivePay","click #slide_out_transferlimit":"gotoTransferLimit","click #slideout_contact":"gotoPostLoginContactUs","click #pushNotifications":"pushNotificationsUI","click #footerMenu_bKash":"gotobKashWalletPayment","click #footerMenu_MobileTopup":"gotoMobileTopup","click #footerMenu_billPay":"gotoBillPayPage","click #footerMenu_ccPay":"gotoCreditCardPayment","click #footerMenu_transfer":"gotoTransfer","click #footerMenu_ApplyDeposit":"gotoApplyDepositFooterMenu","click #footerMenu_Transactions":"gotoTransactionHistory","click #footerMenu_CardManagement":"gotoCardManagement","click #footerMenu_PositivePay":"gotopositivePay","click #footerMenu_BBLApps":"gotoBBLApps","click #footerMenu_getCertificate":"gotoStatementAndCertificate","click #activateCard":"gotoCardManagementPage"},initialize:function(){new u,new d,new g,new p,new v,new m,new f;e("html").removeClass().addClass("primarybg hasBoth dashWrap fntzoom")},render:function(){I.set("pageid","wealth");var t=this;I.set("isLanding","false"),I.set("isTransferAccountDetails","false"),I.set("trsBackFlg",""),I.set("transFromDate",""),I.set("transToDate",""),I.set("fromaccidTH",""),I.set("channel",""),I.set("beneficiaryType",""),I.set("beneIdValueTH",""),I.set("isTransHisPagination","false"),this.model=new c,t.whealthcompile(),"false"==I.get("isFABData")?t.getFapServices():t.getCasaAccountList();var s=e("#deposits_add_btn_div").find("span").attr("id");enableScroll(s),setTimeout(function(){var e="Y";I.set("autologoutPopup","150"),I.set("autologout",e),I.set("sessionTimeOut",(new Date).getTime())},1500)},showPasswordExpirePopUp:function(){if("false"==I.get("isExpiryPopup")&&"Y"==I.get("popupflag")){var e=1==I.get("noOfDays")?I.get("noOfDays")+" day":I.get("noOfDays")+" days",t="Your password will expire in "+e;navigator.notification.alert(t,function(){},"Password Expiry Reminder","Close"),I.set("isExpiryPopup","true")}},invokeTouchTimer:function(){e(document).on("touchend",function(t){e(".logout-notification").is(":visible")||setTimeout(function(){if(!isNull(I.get("defaultSessionTimeOut"))&&"Y"==I.get("autologout")){var e=new Date,t=(e.getTime()-parseInt(I.get("sessionTimeOut")))/6e4;if(parseInt(t)>=parseInt(I.get("defaultSessionTimeOut"))&&0!=I.get("sessionTimeOut"))I.set("sessionTimeOut",0),gotoLogoutsession();else{var s="",a=I.get("app.context.path");s=-1!=a.indexOf("240")||-1!=a.indexOf("202")?2:1,I.set("sessionTimeOut",e.getTime())}}},1e3)})},getFapServices:function(){var t=this;showSpinner();var s=function(e){I.set("isFABData","true"),t.showPasswordExpirePopUp(),t.getCasaAccountList()},a=function(e){I.set("isFABData","true"),t.showPasswordExpirePopUp(),t.errorresponse()};t.collection=new o,t.collection.fetch({data:e.param({access_token:I.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?s(e):a(e)},error:a})},getCasaAccountList:function(){var s=this;showSpinner();var i=function(a){hideSpinner(),this.$("#casaDetails").html(t.template(h)),"N"==I.get("fullRightsFlag")&&(s.populateViewOnlyModeDiv(),s.populateActivateCardDiv()),e("#push_count").html(""),e(".badge").hide();var i=I.get("profileName"),o=I.get("lastSuccessfulLogin"),n=I.get("lastFailureLogin");e(".profilename").html(i),e("#lastlogin").html(o),e("#lastfaillogin").html(n),isNull(o)&&e(".fail").hide(),isNull(I.get("unreadMsgCount"))||"0"==I.get("unreadMsgCount")||(e("#push_count").show(),e(".badge").show(),e("#push_count").html(I.get("unreadMsgCount")))},o=function(e){s.errorresponse()};s.collection=new a,s.collection.fetch({data:e.param({access_token:I.get("access_token"),userflag:"Y"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):o(e)},error:o})},populateViewOnlyModeDiv:function(){e("#viewOnlyModeDiv").html("");var t="";t+='<p><span class="label label-warning view_only">View Only</span></p>',e("#viewOnlyModeDiv").html(t)},populateActivateCardDiv:function(){e("#activateNewCardDiv").html("");var t="";t+='<a href="javascript:void(0);" id="activateCard" alt="Add Beneficiary" class="click_active"><small class="scrollviewbtn">Click to Activate Card</small></a>',e("#activateNewCardDiv").html(t)},whealthcompile:function(){this.$el.html(t.template(y)),e("#viewOnlyModeDiv").html(""),e("#activateNewCardDiv").html(""),this.$el.trigger("create")},logout:function(t){t.stopImmediatePropagation(),showSpinner();var a=I.get("surveyQuestionIds");if(!isNull(a))var o=a.join("~"),n=I.get("surveyQuestionRatings"),r=n.join("~");var l=this,u=function(e){hideSpinner(),I.set("isLogin",!1),I.set("defaultSessionTimeOut",0),I.set("timeoutFlagsessioncount",""),this.model=new c;var t=I.get("touchIdReg");"A"==t?s.history.navigate("#/landing"):s.history.navigate("#/applogin")},d=function(e){l.errorresponse()};l.collection=new i([],{});(new Date).getTime();l.collection.fetch({data:e.param({usersession:I.get("access_token"),access_token:I.get("access_token"),status:I.get("surveyStatus"),message:I.get("surveyMesage"),questionIds:o,questionRatings:r}),dataType:"json",type:"POST",cache:!1,success:function(e){if("0000"==ackStatus){I.get("errorcode");u("0000"==ackStatus?e:e)}else d(e)},error:d})},accounts:function(){var e=this;e.whealthcompile()},creditcard:function(){s.history.navigate("#/creditcardsummary")},termdeposits:function(){s.history.navigate("#/termdepositsummary")},prepaidcreditcard:function(){s.history.navigate("#/prepaidcardsummary")},loan:function(){s.history.navigate("#/loansummary")},wealth:function(){},transfer:function(){"N"==I.get("fullRightsFlag")?(I.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(I.set("isFromFooterMenu","false"),s.history.navigate("#/transfer"))},billpay:function(){"N"==I.get("fullRightsFlag")?(I.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(I.set("isFromFooterMenu","false"),s.history.navigate("#/billpay"))},managebillerUI:function(){s.history.navigate("#/managebillertype")},loadmanagebeneUi:function(){"N"==I.get("fullRightsFlag")?(I.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):s.history.navigate("#/managebene")},loaddatelineUI:function(){},subNav:function(){e("#accounts").toggle()},savingUI:function(){s.history.navigate("#/accounttypelist")},creditUI:function(){s.history.navigate("#/creditcardtype")},prepaidUI:function(){s.history.navigate("#/prepaidcardlist")},loansUI:function(){s.history.navigate("#/loantype")},depositsUI:function(){I.set("depositType","FDR"),I.set("isFromFooterMenu","false"),s.history.navigate("#/deposittype")},servicesUI:function(){I.set("isFromFooterMenu","false"),s.history.navigate("#/servicerequest")},gotoMore:function(){s.history.navigate("#/more")},gotoUserSettings:function(){s.history.navigate("#/usersettings")},gotoTransferHistory:function(e){e.stopImmediatePropagation(),"N"==I.get("fullRightsFlag")?(I.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(I.set("isFromFooterMenu","false"),s.history.navigate("#/transhistory"))},pushNotificationsUI:function(){s.history.navigate("#/pushNotifications")},gotobKashWalletPayment:function(t){if(t.stopImmediatePropagation(),I.set("isFromFooterMenu","true"),"N"==I.get("fullRightsFlag"))return I.set("isServiceReqMenu","false"),void s.history.navigate("#/viewonlymode");var a=this,i=function(t){hideSpinner();var a=I.get("walletList");e.each(a,function(e,t){if("bKash"==t.description){var a=t.id,i=t.description;I.set("walletId",a),I.set("walletType",i),s.history.navigate("#/wallettransfertobeneselect")}})},o=function(e){a.errorresponse()};showSpinner(),a.collection=new r,a.collection.fetch({data:e.param({access_token:I.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):o(e)},error:o})},gotoMobileTopup:function(t){if(t.stopImmediatePropagation(),I.set("isFromFooterMenu","true"),"N"==I.get("fullRightsFlag"))return I.set("isServiceReqMenu","false"),void s.history.navigate("#/viewonlymode");var a=this;showSpinner();var i=function(t){hideSpinner();var a=I.get("menuList");e.each(a,function(e,t){if("Mobile / Telephone"==t.description){var a=t.id,i=t.dataLabel,o=t.description;I.set("selectedBillerTypeId",a),I.set("selectedBillerTypeName",o),I.set("selectedBillerDateLabel",i),s.history.navigate("#/viewbillpaylists")}})},o=function(e){a.errorresponse()};a.collection=new l,a.collection.fetch({data:e.param({access_token:I.get("access_token"),type:"MENU",billId:null,newversion:"Y"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):o(e)},error:o})},gotoBillPayPage:function(e){e.stopImmediatePropagation(),"N"==I.get("fullRightsFlag")?(I.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(I.set("isFromFooterMenu","true"),s.history.navigate("#/billpay"))},gotoCreditCardPayment:function(e){e.stopImmediatePropagation(),"N"==I.get("fullRightsFlag")?(I.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(I.set("isFromFooterMenu","true"),s.history.navigate("#/transferbbicardviewdetail"))},gotoTransfer:function(e){e.stopImmediatePropagation(),"N"==I.get("fullRightsFlag")?(I.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(I.set("isFromFooterMenu","true"),s.history.navigate("#/transfer"))},gotoApplyDepositFooterMenu:function(e){e.stopImmediatePropagation(),"N"==I.get("fullRightsFlag")?(I.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(I.set("isFromFooterMenu","true"),s.history.navigate("#/applyForDeposit"))},gotoTransactionHistory:function(e){e.stopImmediatePropagation(),I.set("isFromFooterMenu","true"),s.history.navigate("#/transhistory")},gotoCardManagement:function(e){e.stopImmediatePropagation(),I.set("isFromFooterMenu","true"),s.history.navigate("#/cardmanage")},gotopositivePay:function(e){e.stopImmediatePropagation(),"N"==I.get("fullRightsFlag")?(I.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(I.set("isFromFooterMenu","true"),s.history.navigate("#/positivepayinit"))},gotoTransferLimit:function(e){e.stopImmediatePropagation(),"N"==I.get("fullRightsFlag")?(I.set("isServiceReqMenu","false"),s.history.navigate("#/viewonlymode")):(I.set("isFromFooterMenu","true"),s.history.navigate("#/transferlimits"))},gotoPostLoginContactUs:function(e){e.stopImmediatePropagation(),s.history.navigate("#/contact")},gotoBBLApps:function(e){e.stopImmediatePropagation(),I.set("isFromFooterMenu","true"),s.history.navigate("#/bblpartnerapps")},gotoStatementAndCertificate:function(e){e.stopImmediatePropagation(),I.set("isFromFooterMenu","true"),s.history.navigate("#/statementcertificate")},gotoCardManagementPage:function(e){e.stopImmediatePropagation(),"N"==I.get("fullRightsFlag")&&(I.set("isFromViewOnlyMode","true"),I.set("isFromWealthActiavteCard","true")),s.history.navigate("#/cardmanage")},gotoFeedbackPopup:function(t){t.stopImmediatePropagation(),showSpinner(),I.set("surveyStatus",null),I.set("surveyMesage",null),I.set("surveyQuestionIds",null),I.set("surveyQuestionRatings",null);var s=this,a=function(e){hideSpinner(),"Y"==I.get("disppop")?s.gotoPopulateFeedbackPopup(t):"N"==I.get("disppop")&&s.logout(t)},i=function(e){s.errorresponse()};s.collection=new n([],{});(new Date).getTime();s.collection.fetch({data:e.param({access_token:I.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):i(e)},error:i})},gotoPopulateFeedbackPopup:function(t){t.stopImmediatePropagation();var s=I.get("surveyList");e("#feedbackPopup").html("");var a=this,i=/iPad|iPhone|iPod/.test(navigator.userAgent),o='<div class="modal fade feedbackPop" id="feedback" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><form> <div class="modal-content"><div class="modal-header"> <button type="button" class="close" aria-label="Close" id="surveySkipButton"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">Rate Your Experience</h4></div><div class="modal-body"><div class="survey-ques"><div class="row"><div class="col-sm-12 col-md-6">';e.each(s,function(e,t){o+='<div class="ques"><span class="ques-cout">'+(e+1)+'</span><div class="rat-cnt" ques="'+t.surveyQuestion+'"><p>'+t.surveyQuestion+'</p></div><div class="rate-area rateAreaClass" id="'+t.surveyQuestionId+'_rating_value"><input type="radio" id="'+t.surveyQuestionId+'_rat1" name="rating'+(e+1)+'" value="10" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat1" title="Excellent">10 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat2" name="rating'+(e+1)+'" value="9" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat2" title="Excellent">9 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat3" name="rating'+(e+1)+'" value="8" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat3" title="Good">8 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat4" name="rating'+(e+1)+'" value="7" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat4" title="Good">7 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat5" name="rating'+(e+1)+'" value="6" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat5" title="Average">6 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat6" name="rating'+(e+1)+'" value="5" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat6" title="Average">5 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat7" name="rating'+(e+1)+'" value="4" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat7" title="Not Good">4 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat8" name="rating'+(e+1)+'" value="3" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat8" title="Not Good">3 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat9" name="rating'+(e+1)+'" value="2" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat9" title="Poor">2 stars</label><input type="radio" id="'+t.surveyQuestionId+'_rat10" name="rating'+(e+1)+'" value="1" class="user-success ratingClass" quesId="'+t.surveyQuestionId+'"><label for="'+t.surveyQuestionId+'_rat10" title="Poor">1 star</label></div></div>',o+='<div class="form-group has-error"><p class="help-block error-message" style="color:#a94442" id="surveyQuesErr'+(e+1)+'"></p></div>'}),o+='</div></div><div class="form-group"><textarea class="form-control inputlengthcontrol" id="feedbackComment" placeholder="Leave a comment ( Max 500 character)" maxlength="500"></textarea><p class="text-muted small">Special characters (Space, Dot, Comma, Brackets) are allowed only.</p></div><div class="alert alert-info" role="alert">',o+=i?'<small><a href="javascript:void(0);" id="gotoStoreBtn" class="btn btn-primary btn-sm" target="_blank"><i class="fa fa-external-link"></i> Click Here</a> &nbsp;to rate us on Apple Store <img src="images/common/ios-app-store.svg" width="32" /></small>':'<small><a href="javascript:void(0);" id="gotoStoreBtn" class="btn btn-primary btn-sm" target="_blank"><i class="fa fa-external-link"></i> Click Here</a> &nbsp;to rate us on Play Store <img src="images/common/google-play.svg" width="32" /></small>',o+='</div></div></div><div class="modal-footer"><div class="row"><div class="col-xs-6 pr5"><a href="javascript:void(0);" class="btn btn-default btn-block" id="surveyLaterButton">Later</a></div><div class="col-xs-6 pl5"><a href="javascript:void(0);" class="btn btn-primary btn-block" id="surveySubmitButton">Submit</a></div></div></div></div></form></div></div>',e("#feedbackPopup").html(o),e(".inputlengthcontrol").inputalphanumericlength(),e("#feedback").modal("show"),e("#surveySkipButton").on("click",function(){I.set("surveyStatus","SKIPPED"),I.set("surveyMesage",null),I.set("surveyQuestionIds",null),I.set("surveyQuestionRatings",null),e("#feedback").modal("hide"),a.logout(t)}),e("#surveyLaterButton").on("click",function(){I.set("surveyStatus","MARKED_LATER"),I.set("surveyMesage",null),I.set("surveyQuestionIds",null),I.set("surveyQuestionRatings",null),e("#feedback").modal("hide"),a.logout(t)}),e("#surveySubmitButton").on("click",function(){I.set("surveyStatus","COMPLETED"),a.gotoGetSurveyDetails(t)}),e("#gotoStoreBtn").on("click",function(){a.gotoRateUsFunction(t)})},gotoGetSurveyDetails:function(t){t.stopImmediatePropagation();var s=!1,a=[],i=[];if(e(".rateAreaClass").each(function(t,o){e("#surveyQuesErr"+(t+1)).html("");var n=e(this).attr("id"),r=e("#"+n+" input[type='radio']:checked").attr("quesId"),l=e("#"+n+" input[type='radio']:checked").val();isNull(l)&&(s=!0,e("#surveyQuesErr"+(t+1)).html("Kindly share the valuable feedback rating")),s||(a.push(r),i.push(l))}),!s){e("#feedback").modal("hide"),I.set("surveyQuestionIds",a),I.set("surveyQuestionRatings",i);var o=e.trim(e("#feedbackComment").val());I.set("surveyMesage",o);var n=this;n.logout(t)}},gotoRateUsFunction:function(e){e.stopImmediatePropagation();var t=I.get("appInfoDTO");if(null!=t.url&&void 0!=t.url&&""!=t.url){var s=/iPad|iPhone|iPod/.test(navigator.userAgent);s?window.location.href=t.url:window.open(t.url,"_system","location=no")}},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return s.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return k});