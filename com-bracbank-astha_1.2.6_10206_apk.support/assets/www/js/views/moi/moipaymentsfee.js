define(["jquery","underscore","Backbone","text!views/moi/moipaymentsfee.tpl","collections/moi/moiPaymentsCollections","collections/moi/moiPaymentsfeeCollections","collections/moi/moiPaymentsfeeValidationCollections","collections/moi/moiPaymentsTrafficCollections","models/validation/moi/moiValidationModel","views/moi/moipaymentsconfirm","views/moi/moipayments","collections/moi/moisubmitpaymentCollections","collections/common/otpGenerateCollections"],function(e,t,a,i,o,r,n,s,c,d,l,m,u){var p=new EncryptedLocalStorage("secret"),h=a.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #submitotp":"onconfirm","change #frmacnt":"selectTypeAsAcct","change #frmcardcnt":"selectTypeAsCard","click #back":"back"},initialize:function(){},render:function(){var t=this,a=p.get("segmentvalue");p.set("defaultSelectionListDetails",""),p.set("paymentMethoddefaultselection","");var i=function(e){t.moipaymentsfee()},o=function(e){t.errorresponse()};t.collection=new r([],{}),showSpinner(),t.collection.fetch({data:e.param({trans_type:"MOIPAYMENT",status:"ACTIVE",segment:a,flag:"M",serviceid:"ALL",requestid:timestamp}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):o(e)},error:o})},onconfirm:function(t){e("#Common_chkboxid").text(e.i18n.t("app.sadad.duebillpay.billisnotselect")),e("#Common_chkboxid").hide(),e("#Error_FrmAcctNo").hide(),e("#Error_CreditCardNo").hide();var i="";i=e("#labelAccount").hasClass("btn-success")?"Account":e("#labelCard").hasClass("btn-success")?"Card":e("#ModeOfPayment").val();var o=p.get("selectedsubBillerId"),r="false",s=new Array,c=new Array,d=new Array,l=new Array,m=new Array,u=new Array,h=new Array,v=(p.get("moiBillerFeeDTO_Trafic"),e("input[name=moibillcheck]").is(":checked"));if(0==v)return e("#Common_chkboxid").show(),!1;if("040"==o){var f=0,C=0,b=e("#loctest").val(),y=b.split("~").length-1;e('input[name="moibillcheck"]:checked').each(function(){for(C=1;y>=C;C++){var t=b.split("~"),a=(t[C],e(this).val()),i=a.split("~");s[f]=i[0],c[f]=i[1],d[f]=i[2],l[f]=i[3],m[f]=i[4],u[f]=i[5],h[f]=i[6]}f++}),p.set("TV_hidservicecode",s),p.set("TV_violationsviolationid",c),p.set("TV_violationsgrouppmtid",d),p.set("TV_violationsfeeamount",l),p.set("TV_violationspmtid",m),p.set("TV_violationspmtidtype",u),p.set("TV_violationsfeetype",h)}for(var g=0;g<c.length;g++)(""==c[g]||null==c[g]||void 0==c[g])&&(r="true");for(var g=0;g<m.length;g++)(""==m[g]||null==m[g]||void 0==m[g])&&(r="true");for(var g=0;g<d.length;g++)(""==d[g]||null==d[g]||void 0==d[g])&&(r="true");var A=p.get("selectedBillerid"),_=p.get("selectedsubBillerId"),N=e("input[name=frmacno]:checked").val(),w=e("input[name=frmcard]:checked").val(),T="false";e("#labelCard").hasClass("btn-success")?e("#Error_FrmAcctNo").hide():"Account"==i&&("undefined"==typeof N||""==N)&&(e("#Error_FrmAcctNo").text(e.i18n.t("app.transfer.ownaccount.fromaccmsg")),e("#Error_FrmAcctNo").show(),T="true"),e("#labelAccount").hasClass("btn-success")?e("#Error_CreditCardNo").hide():"Card"==i&&("undefined"==typeof w||""==w)&&(e("#Error_CreditCardNo").text(e.i18n.t("app.transfer.ownaccount.fromaccmsg")),e("#Error_CreditCardNo").show(),T="true");var E=e("#totalAmount").val();if(("undefined"==typeof E||""==E)&&(e("#Common_chkboxid").show(),T="true"),"true"==r&&(T="true",e("#Common_chkboxid").text("FAILURE"),e("#Common_chkboxid").show()),parseFloat(E)<=0&&(e("#Common_chkboxid").text(e.i18n.t("validation.sadad.negamountvaldate")),e("#Common_chkboxid").show(),T="true"),"true"==T)return!1;var k,x,V,S,F;if("Account"==i)k=N,void 0!=k&&(x=k.split("~"),k=x[0],S=x[1],V=x[2],F=k,p.set("fromAccountNUmber",k),p.set("nickName",S)),p.set("paymentmode","ACCOUNT"),p.set("paymentmethod","ACTDEB");else{if(k=w,void 0!=k){x=k.split("~"),k=x[0],S=x[1],V=x[2];var O=x[3],D=x[4];F=O,p.set("fromCreditcardNumber",k),p.set("fromCreditcardEncNo",D),p.set("nickName",S)}p.set("paymentmode","CREDITCARD"),p.set("paymentmethod","CCARD")}p.set("dispaccno",F),p.set("ccmaskno",O);var I=Number(E).toFixed(2),M=V;-1!=V.indexOf(",")&&(M=V.replace(/,/g,"")),V=M;var P=e("#hidddailylimit").val(),R=e("#hiddavaillimit").val();if(p.set("moitotamt",I),parseFloat(I)>parseFloat(V))if(e("#labelCard").hasClass("btn-success")&&e("#Error_FrmAcctNo").hide(),e("#labelAccount").hasClass("btn-success"))e("#Error_CreditCardNo").hide();else if("Card"==i)return e("#Error_CreditCardNo").text(e.i18n.t("validation.sadad.amountcheck")),e("#Error_CreditCardNo").show(),!1;if(parseFloat(I)>parseFloat(R))return e("#labelCard").hasClass("btn-success")?e("#Error_FrmAcctNo").hide():"Account"==i&&(e("#Error_FrmAcctNo").text(e.i18n.t("validation.sadad.availablelimit")),e("#Error_FrmAcctNo").show()),e("#labelAccount").hasClass("btn-success")?e("#Error_CreditCardNo").hide():"Card"==i&&(e("#Error_CreditCardNo").text(e.i18n.t("validation.sadad.availablelimit")),e("#Error_CreditCardNo").show()),!1;if(parseFloat(I)>parseFloat(P))return e("#labelCard").hasClass("btn-success")?e("#Error_FrmAcctNo").hide():"Account"==i&&(e("#Error_FrmAcctNo").text(e.i18n.t("validation.sadad.dailylimit")),e("#Error_FrmAcctNo").show()),e("#labelAccount").hasClass("btn-success")?e("#Error_CreditCardNo").hide():"Card"==i&&(e("#Error_CreditCardNo").text(e.i18n.t("validation.sadad.dailylimit")),e("#Error_CreditCardNo").show()),!1;hideSpinner();var j=p.get("paymentmode"),B=p.get("paymentmethod"),U=p.get("grouppaymentid"),q=p.get("pmtid"),J=p.get("pmtidtype"),L=p.get("moitotamt"),Q=(p.get("currentamount"),p.get("transfees")),z="1",G=p.get("fromAccountNUmber"),Y=p.get("fromCreditcardNumber"),$="",H=p.get("moiPayment_Details");$=p.get("fromCreditcardEncNo"),("undefined"==G||void 0==G||null==G||"null"==G)&&(G=""),("undefined"==Y||void 0==Y||null==Y||"null"==Y)&&(Y=""),("undefined"==$||void 0==$||null==$||"null"==$)&&($=""),("undefined"==H[7]||void 0==H[7]||null==H[7]||"null"==H[7])&&(H[7]=""),("undefined"==H[4]||void 0==H[4]||null==H[4]||"null"==H[4])&&(H[4]=""),("undefined"==H[15]||void 0==H[15]||null==H[15]||"null"==H[15])&&(H[15]=""),("undefined"==H[16]||void 0==H[16]||null==H[16]||"null"==H[16])&&(H[16]="");var K=getDeviceId(),W=A+""+q+J+B+j+z+L+Q+_+G+Y+$+H[7]+H[15]+H[4]+H[16]+K,X=CryptoJS.MD5(W);if(W=X+"","040"!=_){var Z=this,ee=function(e){hideSpinner(),a.history.navigate("#/moipaymentsconfirm")},te=function(e){Z.errorresponse()};Z.collection=new n([],{}),showSpinner(),Z.collection.fetch({dataType:"json",data:e.param({otpModule:"moi_payments",appchecksum:W,refno:"",billerid:A,transdate:"",iqamano:H[2],pmtid:q,pmtidtype:J,paymentmethod:B,paymentmode:j,grouppmtid:U,services:"MOI",payfees:L,transfees:Q,customerid:"",hidsubservicecode:_,customerno:"",sponsorid:H[7],hidduration:H[9],hidjobcat:H[8],depcount:H[10],tuxvisacnt:H[11],hidvisatype:H[12],visanum:H[11],citid:H[3],hirjidate:H[14],hidlicensetype:H[19],hidbodytype:H[6],vehicleno:H[15],hidpasstype:H[18],txtviolationid:H[4],txtvcustomcardno:H[5],hidregtype:H[17],txtownid:H[16],beneficiaryidtype:"",pmtstatuscode:"",grouppmtid:U,shbaccountnumber:G,creditcardnumber:Y,creditcardacctnumber:$,shbaccounttype:z,customeridtype:"",hidbentype:"IQA",requestid:timestamp}),type:"POST",cache:!1,success:function(e){"0000"==ackStatus?ee(e):te(e)},error:te})}else{var Z=this,s=p.get("TV_hidservicecode"),c=p.get("TV_violationsviolationid"),d=p.get("TV_violationsgrouppmtid"),l=p.get("TV_violationsfeeamount"),m=p.get("TV_violationspmtid"),u=p.get("TV_violationspmtidtype"),h=p.get("TV_violationsfeetype"),o=p.get("selectedsubBillerId"),ae=JSON.stringify(c),ie=JSON.stringify(d),oe=JSON.stringify(l),re=JSON.stringify(m),ne=JSON.stringify(u),se=ae.replace(/"/g,""),ce=ie.replace(/"/g,""),de=oe.replace(/"/g,""),le=re.replace(/"/g,""),me=ne.replace(/"/g,""),ue=s[0],ee=function(e){hideSpinner(),a.history.navigate("#/moipaymentsconfirm")},te=function(e){Z.errorresponse()};Z.collection=new n([],{}),showSpinner(),Z.collection.fetch({dataType:"json",data:e.param({otpModule:"moi_payments",appchecksum:W,refno:"",billerid:A,transdate:"",iqamano:H[2],pmtid:q,pmtidtype:J,paymentmethod:B,paymentmode:j,grouppmtid:U,services:"MOI",payfees:L,transfees:Q,customerid:"",hidsubservicecode:_,customerno:"",sponsorid:H[7],hidduration:H[9],hidjobcat:H[8],depcount:H[10],tuxvisacnt:H[11],hidvisatype:H[12],visanum:H[11],citid:H[3],hirjidate:H[14],hidlicensetype:H[19],hidbodytype:H[6],vehicleno:H[15],hidpasstype:H[18],txtviolationid:H[4],txtvcustomcardno:H[5],hidregtype:H[17],txtownid:H[16],beneficiaryidtype:"",pmtstatuscode:"",grouppmtid:U,shbaccountnumber:G,creditcardnumber:Y,creditcardacctnumber:$,shbaccounttype:z,customeridtype:"",hidbentype:"IQA",customertype:"NAT",hidservicecode:ue,violationsviolationid:se,violationsgrouppmtid:ce,violationsfeeamount:de,violationspmtid:le,violationspmtidtype:me,requestid:timestamp}),type:"POST",cache:!1,success:function(e){"0000"==ackStatus?ee(e):te(e)},error:te})}},selectTypeAsAcct:function(){e("#labelAccount").addClass("active"),e("#labelAccount").addClass("btn-success"),e("#labelAccount").removeClass("btn-default"),e("#labelCard").removeClass("active"),e("#labelCard").addClass("btn-default"),e("#labelCard").removeClass("btn-success")},selectTypeAsCard:function(){e("#labelAccount").removeClass("active"),e("#labelAccount").removeClass("btn-success"),e("#labelAccount").addClass("btn-default"),e("#labelCard").addClass("active"),e("#labelCard").removeClass("btn-default"),e("#labelCard").addClass("btn-success")},moipaymentsfee:function(){hideSpinner(),this.$("#mobcontent").html(t.template(i)).i18n(),e(".amtformatter").formatamount();var a=p.get("defaultSelectionListDetails");if(""!=a&&null!=a){var o,r=p.get("paymentMethoddefaultselection");"ACCOUNT"==r?o=p.get("fromaccDTO"):"CREDITCARD"==r&&(o=p.get("creditcards"));var n=p.get("fromAccdefaultselection"),s=0,c="",d=new Array;t.each(o,function(e,t){"ACCOUNT"==r?d[s]=e.accountNumber:"CREDITCARD"==r&&(d[s]=e.creditCardNoMasked.replace(/\-/g,"")),n==d[s]&&(c=parseInt(t)),s++}),"ACCOUNT"==r?(e("input:radio[name=frmacno]")[c].checked=!0,e(".creditCard").hide(),e(".fromAcc").show(),e("#labelAccount").addClass("active"),e("#labelAccount").addClass("btn-success"),e("#labelAccount").removeClass("btn-default"),e("#labelCard").removeClass("active"),e("#labelCard").addClass("btn-default"),e("#labelCard").removeClass("btn-success")):"CREDITCARD"==r&&(e("input:radio[name=frmcard]")[c].checked=!0,e(".creditCard").show(),e(".fromAcc").hide(),e("#labelAccount").removeClass("active"),e("#labelAccount").removeClass("btn-success"),e("#labelAccount").addClass("btn-default"),e("#labelCard").addClass("active"),e("#labelCard").removeClass("btn-default"),e("#labelCard").addClass("btn-success")),(""!=n||null!=n||void 0!=n)&&e(".dropselect").dropselect()}},back:function(){a.history.navigate("#/moipayments")},errorresponse:function(){hideSpinner(),a.history.navigate("#/exception")},disposeView:function(e){return a.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return h});