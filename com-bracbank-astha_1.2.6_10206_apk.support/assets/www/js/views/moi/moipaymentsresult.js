define(["jquery","underscore","Backbone","text!views/moi/moipaymentsresult.tpl","collections/moi/moisubmitpaymentCollections","collections/moi/moiPaymentsTrafficCollections","collections/common/otpValidateCollections","models/validation/OTPValidationModel","views/moi/moipaymentsresult","views/moi/moipaymentsconfirm","collections/common/emailAdviceCollections","text!views/common/emailAdviceSuccessPage.tpl","libs/security/crypto-js/md5"],function(e,t,i,n,o,s,c,r,a,d,u,m,l){var p=new EncryptedLocalStorage("secret"),a=i.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #back":"back","click #sendemail":"EmailAdvice"},initialize:function(){},render:function(){var t=p.get("selectedBillerid"),i=p.get("selectedsubBillerId"),n=p.get("paymentmode"),c=p.get("paymentmethod"),r=p.get("grouppaymentid"),a=p.get("pmtid"),d=p.get("pmtidtype"),u=p.get("moitotamt"),m=(p.get("currentamount"),p.get("transfees")),l="1",v=p.get("fromAccountNUmber"),g=p.get("fromCreditcardNumber"),h="",y=p.get("moiPayment_Details");h=p.get("fromCreditcardEncNo"),("undefined"==v||void 0==v||null==v||"null"==v)&&(v=""),("undefined"==g||void 0==g||null==g||"null"==g)&&(g=""),("undefined"==h||void 0==h||null==h||"null"==h)&&(h=""),("undefined"==y[7]||void 0==y[7]||null==y[7]||"null"==y[7])&&(y[7]=""),("undefined"==y[4]||void 0==y[4]||null==y[4]||"null"==y[4])&&(y[4]=""),("undefined"==y[15]||void 0==y[15]||null==y[15]||"null"==y[15])&&(y[15]=""),("undefined"==y[16]||void 0==y[16]||null==y[16]||"null"==y[16])&&(y[16]="");var f=p.get("otpModule");p.set("otpModule","");var b=getDeviceId(),w=t+""+a+d+c+n+l+u+m+i+v+g+h+y[7]+y[15]+y[4]+y[16]+b,S=CryptoJS.MD5(w);w=S+"";var T=p.get("cardflagno"),V=p.get("passportDurationValue"),x=p.get("issuereasonvalue"),N=e("#cardNumber").val(),O=p.get("visaDurationValue"),k=p.get("visaNumber"),A=p.get("moiserviceType"),C=p.get("moiappType");if("040"!=i){showSpinner();var j=this,E=function(e){j.moisubmitpayment()},I=function(e){j.errorresponse()};j.collection=new o([],{}),j.collection.fetch({dataType:"json",data:e.param({appchecksum:w,refno:"",billerid:t,moiservice:A,moisubservice:C,transdate:"",iqamano:y[2],pmtid:a,pmtidtype:d,paymentmethod:c,paymentmode:n,grouppmtid:r,services:"MOI",payfees:u,transfees:m,customerid:"",hidsubservicecode:i,customerno:"",sponsorid:y[7],hidduration:y[9],hidjobcat:y[8],depcount:y[10],tuxvisacnt:y[11],hidvisatype:y[12],visanum:k,citid:y[3],hirjidate:y[14],hidlicensetype:y[19],hidbodytype:y[6],vehicleno:y[15],hidpasstype:y[18],txtviolationid:y[4],txtvcustomcardno:y[5],hidregtype:y[17],txtownid:y[16],beneficiaryidtype:"",pmtstatuscode:"",grouppmtid:r,shbaccountnumber:v,creditcardnumber:g,creditcardacctnumber:h,shbaccounttype:l,customeridtype:"",hidbentype:"IQA",requestid:timestamp,isOtpUsed:p.get("isOtpUsed"),opttype:f,hidvalidityduration:V,hidissuancereason:x,hidcardversionnumber:N,hidvisaduration:O,hidverdictnumber:"",cardversionflag:T}),type:"POST",cache:!1,success:function(e){"0000"==ackStatus?E(e):I(e)},error:I})}else{showSpinner();var j=this,_=p.get("TV_hidservicecode"),D=p.get("TV_violationsviolationid"),P=p.get("TV_violationsgrouppmtid"),q=p.get("TV_violationsfeeamount"),J=p.get("TV_violationspmtid"),M=p.get("TV_violationspmtidtype"),U=(p.get("TV_violationsfeetype"),p.get("selectedsubBillerId"),JSON.stringify(D)),B=JSON.stringify(P),R=JSON.stringify(q),$=JSON.stringify(J),F=JSON.stringify(M),Q=U.replace(/"/g,""),z=B.replace(/"/g,""),L=R.replace(/"/g,""),G=$.replace(/"/g,""),H=F.replace(/"/g,""),K=_[0],E=function(e){j.moisubmitpayment()},I=function(e){j.errorresponse()};j.collection=new s([],{}),j.collection.fetch({dataType:"json",data:e.param({appchecksum:w,refno:"",billerid:t,moiservice:A,moisubservice:C,transdate:"",iqamano:y[2],pmtid:a,pmtidtype:d,paymentmethod:c,paymentmode:n,grouppmtid:r,services:"MOI",payfees:u,transfees:m,customerid:"",hidsubservicecode:i,customerno:"",sponsorid:y[7],hidduration:y[9],hidjobcat:y[8],depcount:y[10],tuxvisacnt:y[11],hidvisatype:y[12],visanum:y[11],citid:y[3],hirjidate:y[14],hidlicensetype:y[19],hidbodytype:y[6],vehicleno:y[15],hidpasstype:y[18],txtviolationid:y[4],txtvcustomcardno:y[5],hidregtype:y[17],txtownid:y[16],beneficiaryidtype:"",pmtstatuscode:"",grouppmtid:r,shbaccountnumber:v,creditcardnumber:g,creditcardacctnumber:h,shbaccounttype:l,customeridtype:"",hidbentype:"IQA",customertype:"NAT",hidservicecode:K,violationsviolationid:Q,violationsgrouppmtid:z,violationsfeeamount:L,violationspmtid:G,violationspmtidtype:H,requestid:timestamp,isOtpUsed:p.get("isOtpUsed"),opttype:f}),type:"POST",cache:!1,success:function(e){"0000"==ackStatus?E(e):I(e)},error:I})}},resultpage:function(){hideSpinner(),this.subview=this.disposeView(new a),this.subview.render(),this.undelegateEvents()},moisubmitpayment:function(){hideSpinner(),this.$("#mobcontent").html(t.template(n,{})).i18n()},EmailAdvice:function(){p.set("currentPage",""),showSpinner();var t=this,i=p.get("ftno"),n=function(e){t.emailadvicecompile(i)},o=function(e){t.errorresponse()};t.collection=new u([],{});var s=(new Date).getTime(),c="TRANSFER",r=p.get("paymentmode");"ACCOUNT"==r?custaccountno=p.get("fromAccountNUmber"):custaccountno=p.get("fromCreditcardNumber");var a=p.get("emailid"),d=(p.get("loginid"),p.get("custno")),m=(p.get("lang_id"),getDeviceId()),l=custaccountno+""+m,v=CryptoJS.MD5(l);l=v+"",t.collection.fetch({data:e.param({appchecksum:l,ftrefno:i,transfertype:c,accountNumber:custaccountno,custmailid:a,custuserid:d,requestid:s}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(p.get("calltimeout")),success:function(e){"0000"==ackStatus?n(e):o(e)},error:o})},emailadvicecompile:function(e){return p.set("backReqFromEmail","7"),this.$("#mobcontent").html(t.template(m)).i18n(),this.$("#mobcontent").trigger("create"),hideSpinner(),this},back:function(){var t=(e("#paymode").text(),e("#no").text()),i=e("#name").text(),n=e("#txnfee").text(),o=e("#totamt").text();this.subview=this.disposeView(new d),this.subview.render(paymentmode,t,i,n,o),e.mobile.loading("hide")},errorresponse:function(){hideSpinner(),i.history.navigate("#/exception")},disposeView:function(e){return i.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return a});