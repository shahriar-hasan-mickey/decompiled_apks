define(["jquery","underscore","Backbone","models/validation/login/loginValidationModel","collections/login/preLoginAuthCollections","collections/login/forgotPasswordCollections","collections/login/forgotPassactiveCollections","text!views/login/forgotpassword.tpl"],function(e,t,r,i,o,n,a,l){var s=new EncryptedLocalStorage("secret"),c=r.View.extend({el:"#container",events:{"click #home_btn":"backToLogin","click #proced_btn":"preloginverification"},initialize:function(){},update:function(){var r=this;r.$el.html(t.template(l)),(null!==s.get("preloginUsername")||""!==s.get("preloginUsername"))&&e("#username").val(s.get("preloginUsername"))},preloginverification:function(t){var n=(new Array,getDeviceId()),a=e.trim(e("#username").val());a.charAt(0),a.charAt(a.length-1);this.model=new i({url:"json/"}),this.$(".alert").hide(),r.Validation.bind(this);var l=this.$("form").serializeObject();if(this.model.set(l,{validate:!0})){t.preventDefault();var c="",d="";if(c=window.localStorage.getItem("loginuserid"),null!=c){var u=c.split("~");d=u[0],c=u[1]}else c=e.trim(e("#username").val());var g=this,p=function(e){g.loadforgotPasswordConfirmUI(),s.set("userID",h)},v=function(e){g.errorresponse()};g.collection=new o([],{});for(var m=e.trim(e("#username").val()),h=e("#username").val(),f="",w=e.trim(e("#username").val()),I=0;I<w.length;I++)f+=I<w.length-3?"X":w[I];var c="",d="";try{c=window.localStorage.getItem("loginuserid");var u=c.split("~");d=u[0],c=u[1]}catch(S){c=""}var y=!1,k=!1;w==d&&(y=!0),w==c&&(k=!0),(y||k)&&(w=c);s.set("loginuser_id",w);var V=(e.trim(e("#password").val()),f+"~"+w);e("#rememberuser").prop("checked")?window.localStorage.setItem("loginuserid",V):(window.localStorage.setItem("loginuserid",""),window.localStorage.removeItem("loginuserid"));var b=s.get("device.platform");m="Android"==b?w:w;var T=(new Date).getTime(),D=EncryptWithDynamicSalt(m,T);s.set("preloginUsername",a);var C=null==m?"":m;checkSumEncrypt(C);var E=localStorage.getItem("FINALCHECKSUM"),n=getDeviceId();showSpinner(),g.collection.fetch({data:e.param({userId:D,appchecksum:E,deviceid:n,resetOption:"Y",userflag:"Y",salt:T}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(s.get("calltimeout")),success:function(e){"0000"==ackStatus?p(e):v(e)},error:v})}else this.$(".alert-error").fadeIn(),hideSpinner(),r.Validation.unbind(t)},backToLogin:function(){r.history.navigate("#/login")},loadforgotPasswordConfirmUI:function(){var t=e('input[name="cardType"]:checked').val();s.set("cardType",t);var r=this,i=(getDeviceId(),getDeviceId(),function(e){hideSpinner(),r.forgotpass()}),o=function(e){r.errorresponse()};r.collection=new a,r.collection.fetch({data:e.param({cardType:t,ulpId:s.get("ulpID")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):o(e)},error:o})},forgotpass:function(){r.history.navigate("#/forgotpasswordconfirm")},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return c});