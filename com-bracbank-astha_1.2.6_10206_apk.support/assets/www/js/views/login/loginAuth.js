define(["jquery","underscore","Backbone","models/validation/loginValidationModel","collections/login/loginAuthCollections","collections/dateline/dateLineCollections","text!views/login/loginAuth.tpl","views/layout/layout","views/errors/exception"],function(e,t,n,r,o,a,s,c,l){var u=new EncryptedLocalStorage("secret"),d=n.View.extend({el:"#container",events:{"submit #loginauth":"loginauthentication","click #cancelauth":"cancelAuth_clickHandler"},initialize:function(){},render:function(e){return this.$el.html(t.template(s)).trigger("create"),this},loginauthentication:function(t){showSpinner(),e("#secureMessage").is(":checked")?e("#secureMessage").val("YES"):(e("#secureMessage").val("NO"),e("#secureMessage").prop("checked",!0)),this.model=new r({url:"json/"}),this.$(".alert").hide(),n.Validation.bind(this);var a=this.$("form").serializeObject();if(this.model.set(a,{validate:!0})){e("#spinner").show(),t.preventDefault();var s,c,l,d,p,g,h=this;if(s=e("#userName").val(),c=e("#password").val(),l=u.get("tenantApplicationId"),d=u.get("groupId"),p=u.get("applicationId"),g="${salt}",c.length>0){var f=s+c+l+d,m=CryptoJS.SHA512(f);for(i=1;i<1024;i++)m=CryptoJS.SHA512(m);localStorage.setItem("password",m),localStorage.setItem("clientSecret",m)}var w=u.get("userLoginProfileId"),c=localStorage.getItem("password"),v=u.get("clientId"),S=localStorage.getItem("clientSecret"),y=e("#secureImg").val(),I=function(e,i){h.authlogin(t,s)},V=function(e){h.errorresponse()};h.collection=new o([],{}),timestamp=(new Date).getTime(),h.collection.fetch({data:e.param({requestid:timestamp,custencflag:"Y",client_id:v,client_secret:S,grant_type:"password",scope:"read+write",username:w,password:c,secureImg:y}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(u.get("calltimeout")),success:function(e){"00000"==ackStatus?I(e):V(e)},error:V})}else e("#spinner").hide(),this.$(".alert-error").fadeIn(),t.preventDefault(),n.Validation.unbind(t)},authlogin:function(){var t=this,i=function(e){t.landingcompile()},n=function(e){t.errorresponse()},r=e("form").serialize();t.collection=new a([],{}),t.collection.fetch({data:e.param({requestid:timestamp})+r,dataType:"json",type:"POST",cache:!1,success:function(e){"00000"==ackStatus?i(e):n(e)},error:n})},landingcompile:function(){e("#spinner").hide(),n.history.navigate("#/landing"),hideSpinner()},cancelAuth_clickHandler:function(e){},errorresponse:function(e){hideSpinner(),openErrorPopup()},disposeView:function(e){return n.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return d});