define(["jquery","underscore","Backbone","backbonevalidation","text!views/login/resetsecureaccessuser.tpl","collections/login/forgotUserNameCollections","models/validation/forgotUserNameValidationModel"],function(e,t,r,i,n,a,s){var o=new EncryptedLocalStorage("secret"),c=r.View.extend({el:"#container",events:{"click #atm":"setRequestTypeAtm","click #card":"setRequestTypeCard","click #validateCardPin":"validateATMCardandPin"},initialize:function(){this.on("error",function(e,t){alert(t)})},update:function(){o.set("custno",""),o.set("timeStampharse",""),o.set("atmcardd",""),o.set("atmpinnenc","");var e=this;e.showForgetUser()},setRequestTypeAtm:function(){e("#hidSetReqType").val("A"),e("#atm").addClass("active"),e("#card").removeClass("active")},setRequestTypeCard:function(){e("#hidSetReqType").val("C"),e("#card").addClass("active"),e("#atm").removeClass("active")},validateCardandPin:function(){var t=getDeviceId();o.set("device_id",t),e("#secError").hide(),e("#showError").text("");var r=e("#hidSetReqType").val();"A"==r?this.validateATMCardandPin():"C"==r&&this.validateCreditCardandPin()},validateATMCardandPin:function(){e("#secError").hide(),e("#showError").text(""),this.model=new s({url:"json/"}),this.$(".alert").hide(),r.Validation.bind(this);var t=this.$("form").serializeObject();if(this.model.set(t,{validate:!0})){this.model.clear(),r.Validation.unbind(this);var i=e("#atmCardNumber").val(),n=e("#atmPinNumber").val(),a=i.substring(0,4),c=i.substring(12,16);if(mask=i.substring(4,12).replace(/\d/g,"X"),maskval=a+""+mask+c,o.set("atmcardmaskval",maskval),i.length<16)return e("#showError").text(e.i18n.t("validation.forgotusername.invaidcardnumber")),e("#secError").show(),!1;if(i.length>16)return e("#showError").text(e.i18n.t("validation.forgotusername.invaidcardnumber")),e("#secError").show(),!1;if(n.length<4)return e("#showError").text(e.i18n.t("validation.forgotusername.invaidpin")),e("#secError").show(),!1;if(n.length>4)return e("#showError").text(e.i18n.t("validation.forgotusername.invaidpin")),e("#secError").show(),!1;showSpinner();var d=this;d.success()}},success:function(){r.history.navigate("#/wealth")},validateCreditCardandPin:function(){e("#secError").hide(),e("#showError").text(""),this.model=new s({url:"json/"}),this.$(".alert").hide(),r.Validation.bind(this);var t=this.$("form").serializeObject();if(this.model.set(t,{validate:!0})){this.model.clear(),r.Validation.unbind(this);var i=e("#atmCardNumber").val(),n=e("#atmPinNumber").val();if(i.length<16)return e("#showError").text(e.i18n.t("validation.forgotusername.invaidcardnumber")),e("#secError").show(),!1;if(i.length>16)return e("#showError").text(e.i18n.t("validation.forgotusername.invaidcardnumber")),e("#secError").show(),!1;if(n.length<4)return e("#showError").text(e.i18n.t("validation.forgotusername.invaidpin")),e("#secError").show(),!1;if(n.length>4)return e("#showError").text(e.i18n.t("validation.forgotusername.invaidpin")),e("#secError").show(),!1;showSpinner();var c="C",d=this,l=function(e){d.showOTP()},h=function(e){d.errorresponse()};d.collection=new a([],{}),timestamp=(new Date).getTime();var u=Encrypt(n),v=timestamp.toString();getDeviceId();v=Encrypt(v);var m=Encryptusertime(u,v),p=Encrypt(i);o.set("atmcardd",p),o.set("atmpinnenc",m),d.collection.fetch({data:e.param({accno:"",custencflag:"Y",cardtype:c,atmcard:p,enctimephrase:v,atmpin:m}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(o.get("calltimeout")),success:function(t){if("0000"==ackStatus)l(t);else{var r=o.get("errordesc");e("#showError").text(r),e("#secError").show(),hideSpinner()}},error:h})}else this.$(".alert-error").fadeIn()},showForgetUser:function(r){return hideSpinner(),e(this.el).html(t.template(n)).i18n(),e(this.el).trigger("create"),this},showOTP:function(){hideSpinner(),r.history.navigate("#/resetsecureaccessques")},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return c});