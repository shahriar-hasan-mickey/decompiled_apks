define(["jquery","underscore","Backbone","text!views/login/setSecureQues.tpl","collections/login/getSecureQuestionCollections","collections/login/setSecureQuestionCollections","models/validation/login/setSecureQuesValidationModel"],function(e,n,t,r,o,i,a){var s=new EncryptedLocalStorage("secret"),c=t.View.extend({el:"#container",events:{"click #continue":"gotoRequestAccess","click #cancel":"gotoLoginPage","click #secureQuesTandCPopup":"secureQuesOpenTandCPopup"},initialize:function(){},render:function(n){showSpinner();var t=this,r=function(e){hideSpinner(),t.viewSecureQuestionUI()},i=function(e){t.errorresponse()};t.collection=new o([],{}),t.collection.fetch({data:e.param({access_token:s.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):i(e)},error:i})},viewSecureQuestionUI:function(){this.$el.html(n.template(r)),e("html").addClass("preLog").removeClass("loginbg")},gotoRequestAccess:function(r){var o=!1;e("#secQuesError").html(""),e("#tandcErr").html(""),e("#errorcon1, #errorcon2").hide(),e("#errorconseq1, #errorconseq2").hide(),e("#commonerror1, #commonerror2").html("");var c=e("input[name=ques1]:checked").val(),l=e("input[name=ques2]:checked").val(),u=e("#ans1").val(),h=e("#ans2").val(),d=(e("input[type='checkbox']").prop("checked"),u.charAt(0)),m=u.charAt(u.length-1),p=h.charAt(0),v=h.charAt(h.length-1);if((null==c||void 0==c)&&(o=!0,e("#commonerror1").html(e.i18n.t("validation.login.secquesnotnull"))),(null==l||void 0==l)&&(o=!0,e("#commonerror2").html(e.i18n.t("validation.login.secquesnotnull"))),!o){var g=this;this.model=new a({url:"json/"}),t.Validation.bind(this);var f=this.$("form").serializeObject();if(this.model.set(f,{validate:!0})){if(this.model.clear(),t.Validation.unbind(this),null!=c&&null!=l&&c==l)return void e("#secQuesError").html(e.i18n.t("validation.login.secquessameerr"));if(!d.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return void e("#commonerror1").html(e.i18n.t("validation.newregistration.firstspaceind"));if(!m.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return void e("#commonerror1").html(e.i18n.t("validation.newregistration.lastspaceind"));if(u.length>20)return void e("#commonerror1").html(e.i18n.t("validation.login.answermaxlength"));if(!p.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return void e("#commonerror2").html(e.i18n.t("validation.newregistration.firstspaceind"));if(!v.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return void e("#commonerror2").html(e.i18n.t("validation.newregistration.lastspaceind"));if(h.length>20)return void e("#commonerror2").html(e.i18n.t("validation.login.answermaxlength"));if(null!=u&&null!=h&&u==h)return void e("#secQuesError").html(e.i18n.t("validation.login.answernotsame"));var w=e("#termsand").prop("checked");if(!w)return void e("#tandcErr").html("Please check the Terms and Conditions");var S=(new Date).getTime(),k=[],q=[],Q=[],y="",A="",P=s.get("questionBasketList");0!=n.size(P)&&n.each(P,function(n,t){var r=e("input[name=ques"+(t+1)+"]:checked").val(),o=r.split("~"),i=o[0],a=o[1];k.push(i),y=JSON.stringify(k),q.push(a);var s=(JSON.stringify(a),e("#ans"+(t+1)).val().trim());Q.push(s),A=JSON.stringify(Q)});var C=(y.replace(/"/g,""),A.replace(/"/g,""),[]);k.forEach(function(e,n){C.push(e+":"+Q[n])});var T=JSON.stringify(C);T=T.replace(/"/g,""),s.set("getQuesAns",T);var I=!1,O=[];if(0!=n.size(P)){var z=1;n.each(P,function(n,t){O.push(e("#ans"+z).val().toLowerCase()),z++})}if(n.each(O,function(n,t){for(var r=0;r<n.length;r++){var o=n[r],i=n[r+1];if(o===i&&o===n[r+2])return e("#errorcon"+(t+1)).show(),void(I=!0)}if(n.match(/([a-zA-Z0-9])\1\1+|(abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz|ABC|BCD|CDE|DEF|EFG|FGH|GHI|HIJ|IJK|JKL|KLM|LMN|MNO|NOP|OPQ|PQR|QRS|RST|STU|TUV|UVW|VWX|WXY|XYZ|012|123|234|345|456|567|678|789)+/g))return e("#errorconseq"+(t+1)).show(),void(I=!0);for(var a=0,r=0;r<n.length-1;r++){var s=parseInt(n[r])+1;n[r+1]==s&&n[r]!=n[r+1]&&a++}return 4==a?(e("#errorconseq"+(t+1)).show(),void(I=!0)):void 0}),I)this.$(".has-error").fadeIn(),r.preventDefault();else{showSpinner();var g=this,E=function(e){hideSpinner(),t.history.navigate("#/authorize")},F=function(e){g.errorresponse()};g.collection=new i([],{}),g.collection.fetch({data:e.param({access_token:s.get("access_token"),qnsans:s.get("getQuesAns"),salt:S,userId:s.get("ulpID"),ulpId:s.get("ulpID")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?E(e):F(e)},error:F})}}}},gotoLoginPage:function(){t.history.navigate("#/login")},secureQuesOpenTandCPopup:function(e){e.stopImmediatePropagation(),s.set("tandctype","secureques"),openTermsAndConditionsPopup()},errorresponse:function(e){hideSpinner(),openErrorPopup()}});return c});