define(["jquery","underscore","Backbone","text!views/login/forgotusernameconfirm.tpl","collections/login/forgotUsernameConfirmCollections"],function(t,e,n,o,r){var i=null,a=new EncryptedLocalStorage("secret"),l=n.View.extend({el:"#container",events:{"click #next_btn":"cardValidation","click #otp_verify_btn":"OTPValidation","click #otp_success_btn":"loadLoginUI","click #cancel_btn":"backToLogin"},initialize:function(){},render:function(){i=null,this.$el.html(e.template(o))},backToLogin:function(){n.history.navigate("#/login")},cardValidation:function(){t("#error_pin").hide(),t("#error_pin1").hide(),t("#error_card").hide();var e=t("#card_number").val(),n=/[0-9]/g;if(""==e)return t("#error_card").show(),void t("#error_card").html(t.i18n.t("validation.forgotusername.cardnumber"));if(e.length<4)return t("#error_card").show(),void t("#error_card").html(t.i18n.t("validation.forgotusername.cardnumber1"));if(!e.match(n))return t("#error_card").show(),void t("#error_card").html(t.i18n.t("validation.newregistration.cardnumberonly"));var o=this,r=t(".otpval1").val(),i=t(".otpval2").val(),a=t(".otpval3").val(),l=t(".otpval4").val(),c=r.concat(i).concat(a).concat(l);if(""==c)return void t("#error_pin").html(t.i18n.t("validation.forgotusername.cardpin"));if(c.length<4)return void t("#error_pin").html(t.i18n.t("validation.forgotusername.validpin"));if(!c.match(n))return void t("#error_pin").html(t.i18n.t("validation.newregistration.pinnumberonly"));var s=t(".otpval_1").val(),d=t(".otpval_2").val(),u=t(".otpval_3").val(),v=t(".otpval_4").val(),p=s.concat(d).concat(u).concat(v);return""==p?void t("#error_pin1").html(t.i18n.t("validation.forgotusername.cardexpiry")):p.length<4?void t("#error_pin1").html(t.i18n.t("validation.forgotusername.errorvalid")):p.match(n)?(t("#next_btn").attr("data-target","#verify"),void o.getUsename()):void t("#error_pin").html(t.i18n.t("validation.newregistration.pinnumberonly"))},OTPValidation:function(){var e=t(".otpvalpin1").val(),n=t(".otpvalpin2").val(),o=t(".otpvalpin3").val(),r=t(".otpvalpin4").val(),i=t(".otpvalpin5").val(),a=t(".otpvalpin6").val(),l=e.concat(n).concat(o).concat(r).concat(i).concat(a);if(""==l)return void t("#error_otp").html(t.i18n.t("validation.forgotusername.enterotp"));if(l.length<"6")return void t("#error_otp").html(t.i18n.t("validation.forgotusername.validotp"));t("#error_otp").hide();var c=this;c.getUsename()},getUsename:function(){var e=this,n=function(t){e.gotoSuccessPopup()},o=function(t){e.errorresponse()};showSpinner(),e.collection=new r;var i=(getDeviceId(),(new Date).getTime());e.collection.fetch({data:t.param({salt:i,cifNo:a.get("customerIDs")}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?n(t):o(t)},error:o})},gotoSuccessPopup:function(){hideSpinner(),t("#verify").modal("hide"),t("#success").modal("show")},invokeOTPSpinner:function(){return t(".resend_button").hide(),t("#OTPcontainer1").show(),null!=i?(i.set(1),void i.animate(0,function(){t("#OTPcontainer1").slideUp("slow")})):(i=new ProgressBar.Circle(OTPcontainer1,{color:"#333",strokeWidth:8,trailWidth:8,easing:"linear",duration:18e4,text:{autoStyleContainer:!1},from:{color:"#ec5f59",width:8},to:{color:"#ec5f59",width:8},step:function(e,n){n.path.setAttribute("stroke",e.color),n.path.setAttribute("stroke-width",e.width);var o=Math.round(180*n.value());0===o?(n.setText(""),t(".resend_button").show()):(t(".resend_button").hide(),n.setText(o+"s"))}}),i.text.style.fontFamily='"Raleway", Helvetica, sans-serif',i.text.style.fontSize="12px",i.text.style.fontWeight="bold",i.set(1),i.animate(0,function(){t("#OTPcontainer1").slideUp("slow")}),void t(".resend_button").click(function(){t("#OTPcontainer1").slideDown("slow"),i.set(1),i.animate(0,function(){t("#OTPcontainer1").slideUp("slow")})}))},loadLoginUI:function(){n.history.navigate("#/login")},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(t){return n.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=t,this.currentView.delegateEvents(),this.currentView}});return l});