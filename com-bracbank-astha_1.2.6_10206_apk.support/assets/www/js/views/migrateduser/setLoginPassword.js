define(["jquery","underscore","Backbone","text!views/migrateduser/setLoginPassword.tpl"],function(r,e,t,a){var i=new EncryptedLocalStorage("secret"),n=t.View.extend({el:"#container",events:{"click #migrated_login_cancelbtn":"backToLogin","click #migrated_login_gotoPwdSuccess":"gotoPwdSuccessPopUp","keyup #migrated_login_password":"registerPasswordChange","keyup #migrated_login_confpassword":"registerConfirmPasswordChange","keyup #migrated_username":"registerUsernameChange"},update:function(){r("div").removeClass("modal-backdrop fade in"),r("html").removeClass().addClass("loginbg"),this.$el.html(e.template(a,{})),this.$el.trigger("create"),(null!==i.get("preloginUsername")||""!==i.get("preloginUsername"))&&r("#migrated_username").val(i.get("preloginUsername"))},backToLogin:function(){t.history.navigate("#/login")},registerConfirmPasswordChange:function(){r("#migratedconfirmPasswordError").html("");var e=r("#migrated_login_confpassword").val();return""==e||null==e?(r("#migratedconfirmPasswordError").html(r.i18n.t("validation.newregistration.confpwdnotnull")),!1):void 0},registerUsernameChange:function(e){r("#usernameError").html("");var t=r("#migrated_username").val(),a=r.trim(r("#migrated_username").val()),i=/^[A-Za-z]/,n=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/,o=t.charAt(0),s=t.charAt(t.length-1);return""==a||null==a?(r("#migratedusernameError").html(r.i18n.t("validation.newregistration.usernamenotnull")),!1):i.test(a)?n.test(a)?(r("#migratedusernameError").html(r.i18n.t("validation.newregistration.usernamenospecchar")),!1):a.length<8?(r("#migratedusernameError").html(r.i18n.t("validation.newregistration.usernameminlengtherror")),!1):a.length>20?(r("#migratedusernameError").html(r.i18n.t("validation.newregistration.usernamemaxlengtherror")),!1):o.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i)?s.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i)?void 0:(r("#migratedusernameError").html(r.i18n.t("validation.newregistration.lastspaceind")),!1):(r("#migratedusernameError").html(r.i18n.t("validation.newregistration.firstspaceind")),!1):(r("#migratedusernameError").html(r.i18n.t("validation.newregistration.usrnamealphaerr")),!1)},registerPasswordChange:function(){r("#migratedpasswordError").html(""),r("#migratedconfirmPasswordError").html("");var e=/[0-9]/g,t=r("#migrated_login_password").val(),a=r("#migrated_login_confpassword").val(),n=i.get("pwdpolicy"),o=/[a-z\u0600-\u06FF]/g,s=/[A-Z\u0600-\u06FF]/g,l=/^[A-Z]/,d=/^[a-z]/,m=/^[0-9]/,g=/^[!@#$%^&*()-_+~.]/,p=/^[a-zA-Z]/;if(""==t||null==t)return r("#migratedpasswordError").html(r.i18n.t("validation.newregistration.pwdnotnull")),!1;if("U"===n.firstCharacterValue){if(!l.test(t))return r("#migratedpasswordError").html(r.i18n.t("app.login.errUP")),!1}else if("L"===n.firstCharacterValue){if(d.test(t))return r("#migratedpasswordError").html(r.i18n.t("app.login.errLOW")),!1}else if("N"===n.firstCharacterValue){if(m.test(t))return r("#migratedpasswordError").html(r.i18n.t("app.login.errNUM")),!1}else if("S"===n.firstCharacterValue){if(g.test(t))return r("#migratedpasswordError").html(r.i18n.t("app.login.errSpecl")),!1}else if("A"===n.firstCharacterValue&&!p.test(t))return r("#migratedpasswordError").html(r.i18n.t("First Character should be an alphabet")),!1;if(t.length<n.minimumLength)return r("#migratedpasswordError").html(r.i18n.t("app.login.pwderrlength1")+" "+n.minimumLength+" "+r.i18n.t("app.login.pwderrlength2")+" "+n.maximumLength+" "+r.i18n.t("app.login.pwderrlength3")),!1;if(t.length>n.maximumLength)return r("#migratedpasswordError").html(r.i18n.t("app.login.pwderrmaxlen")+" "+n.maximumLength+" "+r.i18n.t("app.login.pwderrlength3")),!1;var u=t.search(e);if("Y"===n.numeralsMandatory&&"-1"==u)return r("#migratedpasswordError").html(r.i18n.t("app.login.errnumber")),!1;var h=t.search(o);if("Y"===n.lowercaseMandatory&&"-1"==h)return r("#migratedpasswordError").html(r.i18n.t("app.login.errlwr")),!1;var w=t.search(s);if("Y"===n.uppercaseMandatory)if("U"===n.firstCharacterValue){if(-1==w||0!==w)return r("#passwordError").html(r.i18n.t("app.login.errupr")),!1}else if(-1==w)return r("#passwordError").html(r.i18n.t("app.login.errupr")),!1;if("Y"===n.specialCharactersMandatory)if(isNull(n.disallowedCharacters)){var c=!1,f=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/;if(f.test(t)||(c=!0),c)return isError=!0,void r("#passwordError").html(r.i18n.t("app.login.errspc"))}else{for(var v=n.disallowedCharacters,E=!1,C=0;C<t.length;C++){var P=t[C];-1!=v.indexOf(P)&&(E=!0)}if(E)return isError=!0,void r("#passwordError").html("Entered password does not match with password policy "+n.disallowedCharacters+" are not allowed");var c=!1,f=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/;if(f.test(t)||(c=!0),c)return isError=!0,void r("#passwordError").html(r.i18n.t("app.login.errspc"))}var _=t.toLowerCase();if("N"===n.repeatingValueAllowedInPwd)for(var C=0;C<_.length;C++){var P=_[C],V=_[C+1];if(P===V&&P===_[C+2])return r("#migratedpasswordError").html(r.i18n.t("app.login.errcon")),!1}if("N"===n.seqValueAllowedInPwd){if(_.match(/([a-zA-Z0-9])\1\1+|(abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz|ABC|BCD|CDE|DEF|EFG|FGH|GHI|HIJ|IJK|JKL|KLM|LMN|MNO|NOP|OPQ|PQR|QRS|RST|STU|TUV|UVW|VWX|WXY|XYZ|012|123|234|345|456|567|678|789)+/g))return r("#migratedpasswordError").html(r.i18n.t("app.login.errconseq")),!1;for(var A=0,C=0;C<_.length-1;C++){var L=parseInt(_[C])+1;_[C+1]==L&&_[C]!=_[C+1]&&A++}if(4==A)return r("#migratedpasswordError").html(r.i18n.t("app.login.errconseq")),!1}return(""!=t||null!=t)&&""==a||null==a?(r("#migratedconfirmPasswordError").html(r.i18n.t("validation.newregistration.confpwdnotnull")),!1):""!=t&&""!=a&&t!=a?(r("#migratedconfirmPasswordError").html(r.i18n.t("validation.newregistration.pwdmismatch")),!1):void 0},gotoPwdSuccessPopUp:function(){r("#migratedusernameError").html(""),r("#migratedpasswordError").html(""),r("#migratedconfirmPasswordError").html("");var e=!1,a=/[0-9]/g,n=/^[A-Za-z]/,o=r("#migrated_login_password").val(),s=r("#migrated_login_confpassword").val(),l=i.get("pwdpolicy"),d=r("#migrated_username").val(),m=r.trim(r("#migrated_username").val()),g=/[a-z\u0600-\u06FF]/g,p=/[A-Z\u0600-\u06FF]/g,u=/^[A-Z]/,h=/^[a-z]/,w=/^[0-9]/,c=/^[!@#$%^&*()-_+~.]/,f=/^[a-zA-Z]/,v=d.charAt(0),E=d.charAt(d.length-1),C=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/;if(""==m||null==m)e=!0,r("#migratedusernameError").html(r.i18n.t("validation.newregistration.usernamenotnull"));else{if(!n.test(m))return e=!0,void r("#migratedusernameError").html(r.i18n.t("validation.newregistration.usrnamealphaerr"));if(C.test(m))return e=!0,void r("#migratedusernameError").html(r.i18n.t("validation.newregistration.usernamenospecchar"));if(m.length>20)return e=!0,void r("#migratedusernameError").html(r.i18n.t("validation.newregistration.usernamemaxlengtherror"));if(!v.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return e=!0,void r("#migratedusernameError").html(r.i18n.t("validation.newregistration.firstspaceind"));if(!E.match(/^[a-zA-Z0-9\u0600-\u06FF]+$/i))return e=!0,void r("#migratedusernameError").html(r.i18n.t("validation.newregistration.lastspaceind"))}if((""==o||null==o)&&(e=!0,r("#migratedpasswordError").html(r.i18n.t("validation.newregistration.pwdnotnull"))),(""==s||null==s)&&(e=!0,r("#migratedconfirmPasswordError").html(r.i18n.t("validation.newregistration.confpwdnotnull"))),""==o||null==o)return e=!0,void r("#migratedpasswordError").html(r.i18n.t("validation.newregistration.pwdnotnull"));if("U"===l.firstCharacterValue){if(!u.test(o))return e=!0,void r("#migratedpasswordError").html(r.i18n.t("app.login.errUP"))}else if("L"===l.firstCharacterValue){if(h.test(o))return e=!0,void r("#migratedpasswordError").html(r.i18n.t("app.login.errLOW"))}else if("N"===l.firstCharacterValue){if(w.test(o))return e=!0,void r("#migratedpasswordError").html(r.i18n.t("app.login.errNUM"))}else if("S"===l.firstCharacterValue){if(c.test(o))return e=!0,void r("#migratedpasswordError").html(r.i18n.t("app.login.errSpecl"))}else if("A"===l.firstCharacterValue&&!f.test(o))return r("#migratedpasswordError").html(r.i18n.t("First Character should be an alphabet")),!1;if(o.length<l.minimumLength)return e=!0,void r("#migratedpasswordError").html(r.i18n.t("app.login.pwderrlength1")+" "+l.minimumLength+" "+r.i18n.t("app.login.pwderrlength2")+" "+l.maximumLength+" "+r.i18n.t("app.login.pwderrlength3"));if(o.length>l.maximumLength)return e=!0,void r("#migratedpasswordError").html(r.i18n.t("app.login.pwderrmaxlen")+" "+l.maximumLength+" "+r.i18n.t("app.login.pwderrlength3"));var P=o.search(a);if("Y"===l.numeralsMandatory&&"-1"==P)return e=!0,void r("#migratedpasswordError").html(r.i18n.t("app.login.errnumber"));var _=o.search(g);if("Y"===l.lowercaseMandatory&&"-1"==_)return e=!0,void r("#migratedpasswordError").html(r.i18n.t("app.login.errlwr"));var V=o.search(p);if("Y"===l.uppercaseMandatory)if("U"===l.firstCharacterValue){if(-1==V||0!==V)return r("#passwordError").html(r.i18n.t("app.login.errupr")),!1}else if(-1==V)return r("#passwordError").html(r.i18n.t("app.login.errupr")),!1;if("Y"===l.specialCharactersMandatory)if(isNull(l.disallowedCharacters)){var A=!1,L=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/;if(L.test(o)||(A=!0),A)return e=!0,void r("#passwordError").html(r.i18n.t("app.login.errspc"))}else{for(var F=l.disallowedCharacters,y=!1,U=0;U<o.length;U++){var x=o[U];-1!=F.indexOf(x)&&(y=!0)}if(y)return e=!0,void r("#passwordError").html("Entered password does not match with password policy "+l.disallowedCharacters+" are not allowed");var A=!1,L=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/;if(L.test(o)||(A=!0),A)return e=!0,void r("#passwordError").html(r.i18n.t("app.login.errspc"))}var b=o.toLowerCase();if("N"===l.repeatingValueAllowedInPwd)for(var U=0;U<b.length;U++){var x=b[U],M=b[U+1];if(x===M&&x===b[U+2])return e=!0,void r("#migratedpasswordError").html(r.i18n.t("app.login.errcon"))}if("N"===l.seqValueAllowedInPwd){if(b.match(/([a-zA-Z0-9])\1\1+|(abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz|ABC|BCD|CDE|DEF|EFG|FGH|GHI|HIJ|IJK|JKL|KLM|LMN|MNO|NOP|OPQ|PQR|QRS|RST|STU|TUV|UVW|VWX|WXY|XYZ|012|123|234|345|456|567|678|789)+/g))return e=!0,void r("#migratedpasswordError").html(r.i18n.t("app.login.errconseq"));for(var z=0,U=0;U<b.length-1;U++){var N=parseInt(b[U])+1;b[U+1]==N&&b[U]!=b[U+1]&&z++}if(4==z)return e=!0,void r("#migratedpasswordError").html(r.i18n.t("app.login.errconseq"))}return(""!=o||null!=o)&&""==s||null==s?(e=!0,void r("#migratedconfirmPasswordError").html(r.i18n.t("validation.newregistration.confpwdnotnull"))):""!=o&&""!=s&&o!=s?(e=!0,void r("#migratedconfirmPasswordError").html(r.i18n.t("validation.newregistration.pwdmismatch"))):void(e||(i.set("migratedPassword",o),i.set("isMigUserForgotpassword","false"),t.history.navigate("#/migratedauthmode")))},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(r){return t.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=r,this.currentView.delegateEvents(),this.currentView}});return n});