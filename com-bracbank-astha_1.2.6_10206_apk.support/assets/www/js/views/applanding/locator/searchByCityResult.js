define(["jquery","underscore","Backbone","collections/locator/locatorSearchResultCollections","text!views/applanding/locator/searchByCityResult.tpl"],function(e,t,i,a,s){var l=new EncryptedLocalStorage("secret"),n=i.View.extend({el:"#container",events:{"click #mapViewCity":"locatorsearchmap","click #direction":"directionUI"},render:function(){function t(e){var t=/iPad|iPhone|iPod/.test(navigator.userAgent);t||i.history.navigate("#/locator"),onGeoLocationError(e)}function s(t){hideSpinner();var i,a,s="";t.coords,l.get("app.context.path");i=t.coords.latitude,a=t.coords.longitude;getDeviceId(),l.get("atmbrn"),l.get("distkm"),l.get("srselecity");timestamp=(new Date).getTime(),showSpinner(),"en-US"==e.i18n.lng()?language="EN":"en-AR"==e.i18n.lng()&&(language="AR");var r=l.get("distkm");isNull(r)||(r=r.replace(/ +/g,"")),n.collection.fetch({data:e.param({usrLat:i,usrLon:a,paramcode:l.get("atmbrnch"),radius:"0",city:l.get("srselecityname"),searchByCity:"Y"}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(l.get("calltimeout")),success:function(t){if("0000"==ackStatus)if(""!=atmBranchDetailDTO&&null!=atmBranchDetailDTO){e("#atmresult").show(),e("#errorResult").hide(),e("#atmresult").empty();var n=[];e.each(atmBranchDetailDTO,function(t){function s(i,a){if(a!=google.maps.DistanceMatrixStatus.OK)n.pop();else{var s,r=i.rows[0].elements,o=r[0].distance.text,c=r[0].distance.value/1e3;s="Y"==l.accept_cash_deposit?e.i18n.t("app.mpin.yes"):e.i18n.t("app.mpin.no"),n[t].accepttype=s,n[t].disMeter=c,n[t].dis=o}}var l=atmBranchDetailDTO[t];n.push(l);var r=new google.maps.LatLng(i,a),o=new google.maps.LatLng(l.latitude,l.longitude),c=new google.maps.DistanceMatrixService;c.getDistanceMatrix({origins:[r],destinations:[o],travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC,avoidHighways:!1,avoidTolls:!1},s)}),setTimeout(function(){e(".boxborderd").empty(),e("#atmresult").empty(),e.each(n,function(e){if(void 0!=n[e]){var t=n[e].disMeter;void 0==t&&n.splice(e,1)}}),n.sort(function(e,t){return e=e.disMeter,t=t.disMeter,e-t});var t=n;e.each(t,function(i){var a=t[i],n=t[i].accepttype,r=t[i].dis;t[i].disMeter,l.get("distkm");(void 0==r||null==r)&&(r=""),(void 0==n||null==n)&&(n="");var o=atmBranchDetailDTO[i].workingHours;(void 0==o||null==o)&&(o=""),"A"==a.type1?(s='<div class="panel panel-default"><div class="panel-body"><p><strong>'+a.branchATMName+"</strong></p>",isNull(a.branchATMAddressEnglish)&&isNull(a.area)&&isNull(a.city)||(s+='<div class="media"><div class="media-left"><i class="fa fa-map-marker" aria-hidden="true"></i></div><div class="media-body small">'+a.branchATMAddressEnglish+"&nbsp;"+a.area+"&nbsp;"+a.city+"</div></div><br/>"),isNull(r)||(s+='<div class="row"><div class="col-xs-6"><p class="small text-muted">'+e.i18n.t("app.locator.distance")+'</p></div><div class="col-xs-6"><p class="small text-right"><b>'+r+"</b></p></div></div>"),isNull(a.atmType)||(s+='<div class="row"><div class="col-xs-8"><p class="small text-muted">'+e.i18n.t("app.locator.atmType")+'</p></div><div class="col-xs-4"><p class="small text-right"><b>'+a.atmType+"</b></p></div></div>"),isNull(a.acceptCashDeposit)||(s+='<div class="row"><div class="col-xs-10"><p class="small text-muted">'+e.i18n.t("app.locator.acceptsCashDeposits")+'</p></div><div class="col-xs-2"><p class="small text-right"><b>'+a.acceptCashDeposit+"</b></p></div></div>"),isNull(a.latitude)||isNull(a.longitude)||(s+='<br/> <div class="button" role="group" ><a href="#/direction/'+a.latitude+"/"+a.longitude+'" <button type="button" class="btn btn-primary btn-block">'+e.i18n.t("app.locator.direction")+"</a></div>"),s+="</div></div></div>",e("#atmresult").append(s)):(s='<div class="panel panel-default"><div class="panel-body"><p><strong>'+a.branchATMName+"</strong></p>",isNull(a.branchATMAddressEnglish)||(s+='<div class="media"><div class="media-left"><i class="fa fa-map-marker" aria-hidden="true"></i></div><div class="media-body small">'+a.branchATMAddressEnglish+"</div></div>"),isNull(r)||(s+='<div class="row"><div class="col-xs-6"><p class="small text-muted">'+e.i18n.t("app.locator.distance")+'</p></div><div class="col-xs-6"><p class="small text-right"><b>'+r+"</b></p></div></div>"),isNull(a.branchATMPhoneNo)||(s+='<div class="media"><div class="media-left"><i class="fa fa-phone" aria-hidden="true"></i></div><div class="media-body small">'+a.branchATMPhoneNo+"</div></div>"),isNull(o)||(s+='<div class="media"><div class="media-left"><i class="fa fa-clock-o" aria-hidden="true"></i></div><div class="media-body small">'+o+"</div></div>"),isNull(a.latitude)||isNull(a.longitude)||(s+='<br/><div class="row"><div class="col-xs-12"><div class="button" role="group" ><a href="#/direction/'+a.latitude+"/"+a.longitude+'" <button type="button" class="btn btn-primary btn-block">'+e.i18n.t("app.locator.direction")+"</a></div></div></div>"),s+="</div></div></div>",e("#atmresult").append(s))}),hideSpinner()},3e3)}else e("#atmresult").hide(),e("#atmresult").empty(),e("#errorResult").show(),hideSpinner();else e("#atmresult").hide(),e("#atmresult").empty(),e("#errorResult").show(),hideSpinner()}})}var n=this;n.locatorcompile();n.collection=new a,navigator.geolocation&&(showSpinner(),navigator.geolocation.getCurrentPosition(s,t,{enableHighAccuracy:!0,timeout:1e4,maximumAge:1e4}))},locatorcompile:function(){return hideSpinner(),this.$el.html(t.template(s,{})).i18n(),this.$el.trigger("create"),e("html").removeClass().addClass("preLog"),this},locatorsearchmap:function(e){e.preventDefault(),i.history.fragment=null,i.history.navigate("#/searchcitymap")},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return i.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return n});