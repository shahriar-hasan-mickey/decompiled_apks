define(["jquery","underscore","Backbone","text!views/applanding/Registration/creditCardRegistration.tpl","collections/applanding/Registration/cardPinValidationCollections"],function(t,e,n,i,r){var o=null,a=new EncryptedLocalStorage("secret"),l=n.View.extend({el:"#container",events:{"click #validate":"gotoOTPPopUp","click #cancelbtn":"backToLogin","click #verifyOTP":"gotoVerifySuccessPopUp","click #gotoSetPassword":"gotoSetPassword"},render:function(){o=null,hideSpinner(),this.$el.html(e.template(i,{})),this.$el.trigger("create"),t("html").addClass("loginbg").removeClass("preloginbg")},backToLogin:function(){n.history.navigate("#/applogin")},gotoOTPPopUp:function(){var e=this;t("#otpNullError").html(""),t("#otpNullErrorDiv").hide(),t("#cardNumNullError").html(""),t(".pincode-input-error").html("");var n=t("#first").val(),i=t("#second").val(),o=t("#third").val(),l=t("#fourth").val(),c=t("#mpininput").val(),s=/[0-9]/g;if(""==n||""==i||""==o||""==l)return void t("#cardNumNullError").html(t.i18n.t("validation.newregistration.cardnumnotnull"));if(n.length<t("#first").attr("maxlength")||i.length<t("#second").attr("maxlength")||o.length<t("#third").attr("maxlength")||l.length<t("#fourth").attr("maxlength"))return void t("#cardNumNullError").html(t.i18n.t("validation.newregistration.validnumerrmsg"));if(!(n.match(s)&&i.match(s)&&o.match(s)&&l.match(s)))return void t("#cardNumNullError").html(t.i18n.t("validation.newregistration.cardnumberonly"));if(c.length<4)return void t(".pincode-input-error").html(t.i18n.t("validation.newregistration.pinnotnull"));if(!c.match(s))return void t(".pincode-input-error").html(t.i18n.t("validation.newregistration.pinnumberonly"));var d=n+i+o+l,u=(new Date).getTime();a.set("saltreg",u),a.set("registerCardNumber",d),ccnum=EncryptWithDynamicSalt(d,u),ccpinnum=EncryptWithDynamicSalt(c,u);var p=function(t){hideSpinner(),e.validateCardPin()},h=function(t){e.errorresponse()};showSpinner(),e.collection=new r;getDeviceId(),(new Date).getTime();e.collection.fetch({data:t.param({ccno:ccnum,ccpinno:ccpinnum,salt:u,cardtype:"CC",flag:"R"}),dataType:"json",type:"POST",cache:!1,success:function(t){"0000"==ackStatus?p(t):h(t)},error:h})},validateCardPin:function(){var t=this;t.gotoVerifySuccessPopUp()},gotoVerifySuccessPopUp:function(){t("#verifysuccess").modal("show"),t(".otp_mobile_number").html(maskMobile(a.get("mobileNo")))},gotoSetPassword:function(){a.set("cardType","creditcard"),n.history.navigate("#/setpassword"),t("div").removeClass("modal-backdrop fade in")},invokeOTPSpinner:function(){return t(".resend_button").hide(),t("#OTPcontainer1").show(),null!=o?(o.set(1),void o.animate(0,function(){t("#OTPcontainer1").slideUp("slow")})):(o=new ProgressBar.Circle(OTPcontainer1,{color:"#333",strokeWidth:8,trailWidth:8,easing:"linear",duration:6e4*parseInt(a.get("otpExpiryPeriod")),text:{autoStyleContainer:!1},from:{color:"#ec5f59",width:8},to:{color:"#ec5f59",width:8},step:function(e,n){n.path.setAttribute("stroke",e.color),n.path.setAttribute("stroke-width",e.width);var i=Math.round(n.value()*(60*a.get("otpExpiryPeriod")));0===i?(n.setText(""),t(".resend_button").show()):(t(".resend_button").hide(),n.setText(i+"s"))}}),o.text.style.fontFamily='"Raleway", Helvetica, sans-serif',o.text.style.fontSize="12px",o.text.style.fontWeight="bold",o.set(1),o.animate(0,function(){t("#OTPcontainer1").slideUp("slow")}),void t(".resend_button").click(function(){t("#OTPcontainer1").slideDown("slow"),o.set(1),o.animate(0,function(){t("#OTPcontainer1").slideUp("slow")})}))},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(t){return n.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=t,this.currentView.delegateEvents(),this.currentView}});return l});