define(["jquery","underscore","Backbone","models/validation/tools/currencyConverterValidationModel","models/tools/toolMetaFormModel","collections/tools/currencyConverterListCollections","text!views/applanding/tools/curConverter.tpl","collections/tools/currencyConverterCollections"],function(e,t,r,n,o,i,a,c){var s=new EncryptedLocalStorage("secret"),l=r.View.extend({el:"#preloginmobcontent",events:{"click #currencyconvert":"currencyconvert","click #tools":"tools","click #tocurr":"changeToCurr","click #transAmt":"openNumPad"},openNumPad:function(){id="transAmt";var t=/iPad|iPhone|iPod/.test(navigator.userAgent),r=s.get("isKeyPadNeed");t&&r&&navigator.notification.keypadOpen(e("#"+id).val(),9,function(t){e("#"+id).val(convertNumbers2English(t))},function(t){e("#"+id).val(convertNumbers2English(t))})},changeToCurr:function(){var t=e("input[name=tocurr]:checked").val(),r=t.split("~"),n=r[1],o=r[2];e("#nme"+o).text(n)},render:function(){var e=this;e.showRegTemplate(),showSpinner()},showRegTemplate:function(e){return hideSpinner(),this.$el.html(t.template(a,{})).i18n(),this.$el.trigger("create"),this},currencyconvert:function(t){e("#examt").empty(),e("#exrate").empty(),e("#errorsar").hide(),e("#errorsame").hide(),e("#errorFromAct").hide(),e("#errorToAct").hide(),this.model=new n({url:"json/"}),r.Validation.bind(this);var i=this.$("form").serializeObject();if(this.model.set(i,{validate:!0})){var a=e("input[name=fromcurr]:checked").val(),l=e("input[name=tocurr]:checked").val(),u=l.split("~"),d=u[0],h=d,m=!1;("KWD"==a||"KWD"==h)&&(m=!0);var p="false",v="false";if("undefined"==typeof a)return p="true",e("#errorFromAct").show(),!1;if("undefined"==typeof h)return v="true",e("#errorToAct").show(),!1;if(a==h)return e("#errorsame").show(),!1;if("true"==p||"true"==v)return!1;var f=a.split("~"),g=f[0],w=h.split("~"),y=w[0],x=e("#transAmt").val(),S=0,V=e.i18n.t("app.tools.general.exrate");this.model.clear(),r.Validation.unbind(this),t.preventDefault(),accid=e("#accid").val();e("#transferAmount").val();this.model=new o({url:"json/"}),showSpinner();var k=this,A=function(e){k.errorresponse()};if(1!=m)return e("#errorsar").show(),hideSpinner(),!1;k.collection=new c([],{id:accid});e("form").serialize();timestamp=(new Date).getTime(),showSpinner(),k.collection.fetch({data:e.param({requestid:timestamp,frmcurr:g,tocurr:y,amount:x}),dataType:"json",type:"POST",cache:!1,success:function(t){if("0000"==ackStatus){var r=s.get("convertedAmt"),n=s.get("exchangerate");if(r!=S||n!=S){var o=s.get("lang_id");"en-US"==o?e("#examt").html(x+" "+g+" = "+r+" "+y):e("#examt").html(x+" "+y+" "+r+" = "+g),e("#examt").show(),e("#exrate").html(V+" = "+Math.round(1e4*n)/1e4),e("#exrate").show()}hideSpinner()}else A(t)},error:A})}else this.$(".alert-error").fadeIn(),t.preventDefault(),hideSpinner()},tools:function(e){e.preventDefault(),r.history.fragment=null,r.history.navigate("#/tools",{trigger:!0,replace:!0})},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return l});