define(["jquery","underscore","Backbone","collections/more/currncyDropCollections","collections/more/savAccountRatesCollections","collections/wealth/accStatementCollections","routers/morerouter","text!views/more/saccountrate/saccountrate.tpl","text!views/more/saccountrate/savaccRatesDetails.tpl"],function(e,c,r,n,t,o,i,a,s){var u=new EncryptedLocalStorage("secret"),l=0,p=r.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #fromcurr":"currncyChange","click #fromacc":"changeCurrencyCategory"},initialize:function(){l=0},update:function(){e("#Details_View").hide(),l=0;var c=this;showSpinner();var r=function(e){c.details()},t=function(e){c.errorresponse()};c.collection=new n,c.collection.fetch({data:e.param({access_token:u.get("access_token"),accountType:"CASA"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):t(e)},error:t}),u.set("currentPage","")},details:function(){e("#Details_View").hide(),hideSpinner(),this.$("#mobcontent").html(c.template(a)).i18n()},changeCurrencyCategory:function(){e("#Details_View").hide(),l=0,e("#dynamiccurrencycompany").hide();var r=e("input[name=fromacc]:checked").val(),n=r.split("~"),t=n[0];u.set("fromaccID",t);var o=n[1];u.set("fromacccode",o);var i=n[2],a=u.get("intlaccountDetails");if(""!=i&&null!=i&&void 0!=i&&"undefined"!=i){e("#dynamiccurrencycompany").show();var s=a[i].currencyDetails,p=s[0].currencyCode;u.set("currencycodee",p);var m=s[0].currencyDescription;if(u.set("currencydescc",m),e("#dynamiccurrencycompany").html('<div class="dropselectbiller" data-title="'+e.i18n.t("app.tools.currencyconverter.fromcurrency")+'" id="currencycompany" style="display:none;"></div>'),0!=c.size(s)){var d=0,y="";c.each(s,function(e,c){y+='<label class="list-group-item" id="fromcurr">',y+='<input type="radio" id="fromcurr" name="fromcurr" value="'+e.currencyCode+"~"+e.currencyDescription+"~"+c+'" />',y+='<p><span class="exicon" style="background: url(images/common/currency/"'+e.currencyCode+'".png)"> &nbsp;<span id="currencydesc" class="nme" id="nme'+c+'" >'+e.currencyDescription+"</span></p> </label>",d++}),e("#currencycompany").html(y),e("#currencycompany").show(),e(".dropselectbiller").dropselectbiller();e("#fromcurr").val()}}else e("#dynamiccurrencycompany").hide(),e("#currencycompany").hide(),e("#currencycompany").empty(),e("#serviceProviderType").val("");var h=e("input[name=fromcurr]:checked").val(),f=h.split("~"),v=f[0];u.set("nmeText",v);var g=f[1];u.set("nmeidx",g),(""!=e("#fromcurr").val()||null!=e("#fromcurr").val()||void 0!=e("#fromcurr").val())&&this.currncyChangecomp()},currncyChange:function(){var c=e("input[name=fromcurr]:checked").val(),r=c.split("~"),n=r[0];u.set("nmeText",n);var t=r[1];u.set("nmeidx",t),this.currncyChangecomp()},currncyChangecomp:function(){if(l>0)return!1;l=1,hideSpinner();var c=this,r=function(e){c.statementcompile()},n=function(e){c.errorresponse()};c.collection=new t([],{});var o,i;o=u.get("nmeidx"),i=u.get("nmeText"),showSpinner(),c.collection.fetch({data:e.param({access_token:u.get("access_token"),currency:i,casaType:u.get("fromaccID")}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(u.get("calltimeout")),success:function(c){u.get("errorcode");"0000"==ackStatus?(l=0,e("#Details_View").show(),u.set("currencycodee",""),u.set("currencydescc",""),r(c),hideSpinner()):n(c)},error:n})},statementcompile:function(){this.$("#Details_View").html(c.template(s)).i18n()},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return p});