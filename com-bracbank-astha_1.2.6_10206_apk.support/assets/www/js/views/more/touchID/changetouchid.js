define(["jquery","underscore","Backbone","routers/morerouter","collections/touchid/touchIDDeviceDetailCollections","collections/touchid/touchIDswitchCollection","text!views/more/touchID/changetouchid.tpl","text!views/more/touchID/changetouchidSuccess.tpl"],function(e,t,c,i,n,a,o,s){var r=new EncryptedLocalStorage("secret"),l=c.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #deviceListSubmit":"submitTouchEnabled","change input[type=radio]":"changeEnableDisable"},render:function(){r.set("currentPage",""),showSpinner();var t=this,c=function(e){t.changeTouchIDTemplate()},i=function(e){t.errorresponse()};t.collection=new n([],{});(new Date).getTime();t.collection.fetch({data:e.param({appchecksum:"",access_token:r.get("access_token"),biometriclogintype:r.get("BiometricType")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?c(e):i(e)},error:i})},changeTouchIDTemplate:function(){hideSpinner(),this.$("#mobcontent").html(t.template(o)).i18n()},changeEnableDisable:function(){var t=e("input[type=radio]:checked");t.length>0&&e.each(t,function(c){t[c].checked&&t[c].id=="deviceYes"+c?(e("#labelYes"+c).addClass("active"),e("#labelYes"+c).addClass("btn-success"),e("#labelYes"+c).removeClass("btn-default"),e("#labelNo"+c).removeClass("active"),e("#labelNo"+c).addClass("btn-default"),e("#labelNo"+c).removeClass("btn-success")):(e("#labelYes"+c).removeClass("active"),e("#labelYes"+c).removeClass("btn-success"),e("#labelYes"+c).addClass("btn-default"),e("#labelNo"+c).addClass("active"),e("#labelNo"+c).removeClass("btn-default"),e("#labelNo"+c).addClass("btn-success"));var i=(r.get("bioMetricDetailsDTO"),new Array),n=new Array,a=new Array,o=new Array,s=new Array,l=e("input[type=radio]:checked");l.length>0&&e.each(l,function(e){var t=l[e].value.split("~")[0];l[e].checked&&l[e].id=="deviceYes"+e?(i.push(t),n.push("E")):(i.push(t),n.push("D"))});a=i,o=n,e.each(a,function(t,c){var i=o[t],n="",a="";return n="E"==i?e.i18n.t("app.touchid.notiTouchEnable")+" "+a:e.i18n.t("app.touchid.notiTouchDisable")+" "+a,s.push(n),!1}),s.length>0?e("#deviceListSubmit").removeAttr("disabled"):e("#deviceListSubmit").attr("disabled","disabled")})},submitTouchEnabled:function(t){var c=(r.get("bioMetricDetailsDTO"),new Array),i=new Array,n=new Array,o=new Array,s=new Array,l=new Array,u="";t.preventDefault();var h=e("input[type=radio]:checked");h.length>0&&e.each(h,function(e){var t=h[e].value.split("~")[0],a=h[e].value.split("~")[1];h[e].checked&&h[e].id=="deviceYes"+e?(c.push(t),i.push("E"),u=u+t+"E",n.push(a),getDeviceId()==t&&r.set("touchAllowedForUser","E")):(c.push(t),i.push("D"),u=u+t+"D",n.push(a),getDeviceId()==t&&r.set("touchAllowedForUser","D"))}),o=c,s=i,e.each(o,function(t,c){var i=s[t],a="",o="",r=n[t];return a="E"==i?"FID"==r?e.i18n.t("app.faceid.notifaceEnable")+" "+o:e.i18n.t("app.touchid.notiTouchEnable")+" "+o:"FID"==r?e.i18n.t("app.faceid.notifaceDisable")+" "+o:e.i18n.t("app.touchid.notiTouchDisable")+" "+o,l.push(a),!1}),c=JSON.stringify(c).replace(/"/g,""),i=JSON.stringify(i).replace(/"/g,"");var d=this,p=function(e){d.updateTouchFlag()},b=function(e){d.errorresponse()};d.collection=new a([],{});var v,f=((new Date).getTime(),r.get("emailid"));v=""!=f&&"null"!=f&&null!=f&&void 0!=f?f:"",u=u+r.get("BiometricType")+"Enable";var g=CryptoJS.MD5(u);u=g+"",showSpinner(),d.collection.fetch({data:e.param({access_token:r.get("access_token"),appchecksum:"",multiple_deviceid:c,multiple_deviceidflag:i,touchIdFlag:"Y",biometriclogintype:r.get("BiometricType")}),dataType:"json",type:"POST",cache:!1,success:function(t){if("0000"==ackStatus){var c=getDeviceId();e.each(o,function(e,t){var i=s[e];"D"==i&&(c==t?r.set("touchAllowedForUser","D"):r.set("touchAllowedForUser",""))}),e.each(l,function(e,t){pushLocalNotification(t)}),p(t)}else b(t)},error:b})},updateTouchFlag:function(){hideSpinner(),this.$("#mobcontent").html(t.template(s)).i18n()},errorresponse:function(){hideSpinner(),c.history.navigate("#/exception")},disposeView:function(e){return c.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return l});