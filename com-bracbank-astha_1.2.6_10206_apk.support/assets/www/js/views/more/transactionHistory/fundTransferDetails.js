define(["jquery","underscore","Backbone","routers/morerouter","routers/estatementrouter","collections/more/getTransferHistoryDetailsCollections","text!views/more/transactionHistory/fundTransferDetails.tpl"],function(e,t,a,n,r,s,i){var l=new EncryptedLocalStorage("secret"),o=a.View.extend({el:"#container",events:{"click #transDetailsBackBtn":"gotoTransHistoryPage","click #transHistDetailDownload":"transHistoryDetailsPDFDownload"},initialize:function(){new n,new r},render:function(t){var a=l.get("selectedTransHistoryDetailDTO"),n=a.paymentType;l.set("transHistSelectedBillerPaymentType",n),showSpinner();var r=this,i=function(e){r.loadDetailsPageUI(t)},o=function(e){r.errorresponse()};r.collection=new s,r.collection.fetch({data:e.param({access_token:l.get("access_token"),fromName:a.customerName,fromactno:a.fromAccountNo,toName:a.beneficaryName,toActNo:a.toAccountNo,currency:a.txnCurrency,amount:a.txnAmt,billmonth:null,payDate:a.txnDate,payTime:a.txnTime,refNo:a.txnRefNo,accountType:a.paymentType,studentId:a.studentId,purpose:a.purpose,bankname:a.bankName,branchname:a.bankCity,billername:a.beneType,paydetId:a.id,postingId:a.globalTransIdPosting,dpdcorderid:a.dpdcOrderID,bankfee:a.bankFees,rocketfee:a.rocketFees}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):o(e)},error:o})},loadDetailsPageUI:function(a){hideSpinner(),l.set("transIndex",a),l.set("isTranDetailPage","true"),this.$el.html(t.template(i)),e("html").removeClass().addClass("primarybg hasFooter")},gotoTransHistoryPage:function(e){e.stopImmediatePropagation(),window.history.back()},transHistoryDetailsPDFDownload:function(e){if(e.stopImmediatePropagation(),"QR_PAYMENT"==l.get("transHistSelectedBillerPaymentType")||"Scan to pay"==l.get("transHistSelectedBillerPaymentType")||"BKASH QR"==l.get("transHistSelectedBillerPaymentType")||"BKASH_QR"==l.get("transHistSelectedBillerPaymentType")||"Bkash QR"==l.get("transHistSelectedBillerPaymentType")||"bKash QR"==l.get("transHistSelectedBillerPaymentType")||"Bkash_QR"==l.get("transHistSelectedBillerPaymentType")||"bKash_QR"==l.get("transHistSelectedBillerPaymentType"))var t=l.get("transQrDispFromData");else var t=l.get("transDetailsDTO");var a,n=Object.values(t);a="WALLET_BKASH_PULL_MONEY"==l.get("transHistSelectedBillerPaymentType")?l.get("profileName"):n[0].split("\n")[0];var r="",s=l.get("app.context.path");if("QR_PAYMENT"==l.get("transHistSelectedBillerPaymentType")||"Scan to pay"==l.get("transHistSelectedBillerPaymentType")||"BKASH QR"==l.get("transHistSelectedBillerPaymentType")||"BKASH_QR"==l.get("transHistSelectedBillerPaymentType")||"Bkash QR"==l.get("transHistSelectedBillerPaymentType")||"bKash QR"==l.get("transHistSelectedBillerPaymentType")||"Bkash_QR"==l.get("transHistSelectedBillerPaymentType")||"bKash_QR"==l.get("transHistSelectedBillerPaymentType")){r=s+"payment/qrtransfers/download.pdf";var i;"QR_PAYMENT"==l.get("transHistSelectedBillerPaymentType")||"Scan to pay"==l.get("transHistSelectedBillerPaymentType")?i="QR_PAYMENT":("BKASH QR"==l.get("transHistSelectedBillerPaymentType")||"BKASH_QR"==l.get("transHistSelectedBillerPaymentType")||"Bkash QR"==l.get("transHistSelectedBillerPaymentType")||"bKash QR"==l.get("transHistSelectedBillerPaymentType")||"Bkash_QR"==l.get("transHistSelectedBillerPaymentType")||"bKash_QR"==l.get("transHistSelectedBillerPaymentType"))&&(i="BKASH_QR_PAYMENT");var o="access_token="+l.get("access_token")+"&statementheaderid="+l.get("transDetailsDownloadID")+"&fromActName="+a+"&accountType="+l.get("transHistSelectedBillerPaymentType")+"&transtype=TRANSFER&paytype="+i}else{r=s+"payment/transfersdownload";var o="access_token="+l.get("access_token")+"&statementheaderid="+l.get("transDetailsDownloadID")+"&fromActName="+a+"&accountType="+l.get("transHistSelectedBillerPaymentType")+"&transtype=TRANSFER"}var c=encodeURI(o);fileDownLoadAndViewer(r,c,1,l.get("access_token"))},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return a.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return o});