define(["jquery","underscore","Backbone","routers/morerouter","routers/estatementrouter","models/validation/more/transferHistoryValidaionModel","collections/more/getTransferHistoryCollection","collections/more/getAllBeneficiariesCollection","collections/more/getAllBillerCollections","collections/bills/cardSummaryCollections","collections/wealth/ccsummeryCollections","text!views/more/transactionHistory/transHistory.tpl","text!views/more/transactionHistory/transactionHistoryNew.tpl","text!views/more/transactionHistory/fundTransferHistory.tpl"],function(e,t,a,n,i,r,s,o,c,l,d,p,u,h){var v=new EncryptedLocalStorage("secret");v.set("isTranDetailPage","false");var m=a.View.extend({el:"#container",events:{"click #backBtn":"gotoBackPage","change #transType":"setBeneficiaryTypeDropDown","change input[name=transType]":"setBeneficiaryTypeDropDown","change input[name=duration]":"getPeriodRange","click #view_trans_btn":"gotoViewTransactionList","click #cancel_trans_btn":"gotoBackPage","change #chennal_Id":"errormsgclear","change #beneficiaryType_Id":"setBeneficiaryDropDown","click #trigerModaddisClik":"modalShownMethod","click .search_clear":"clearSearch","keyup #trans_search_box":"filterContactList","click #transHistory_filterBtn":"openTranshistoryFilterPopup"},initialize:function(){new n,new i},clearSearch:function(){e("#trans_search_box").val(""),e(".search_clear").hide(),e(".nocontacts").hide(),e("#page_navigation").show(),e("#trans_history").html(t.template(h))},openTranshistoryFilterPopup:function(t){t.stopImmediatePropagation();var a=this;"Y"==v.get("isFiltered")?("A"==v.get("transHistFilterTranType")?e("#A").attr("checked",!0):"F"==v.get("transHistFilterTranType")?e("#F").attr("checked",!0):"B"==v.get("transHistFilterTranType")&&e("#B").attr("checked",!0),"ALL"==v.get("transHistFilterTranChannel")?e("#Channel_ALL").attr("checked",!0):"WEB"==v.get("transHistFilterTranChannel")?e("#Channel_WEB").attr("checked",!0):"MOB"==v.get("transHistFilterTranChannel")&&e("#Channel_MOB").attr("checked",!0),a.setBeneficiaryTypeDropDown(t),a.setBeneficiaryDropDown(t),a.populateFromAccountDropDown(t),e("input[name='benetype']:checked").removeAttr("checked"),"ALL"==v.get("transHistFilterTranBeneType")?(e("#BeneType_ALL").attr("checked",!0),e(".beneficiary_Iddisp").hide()):"O"==v.get("transHistFilterTranBeneType")?(e("#BeneType_O").attr("checked",!0),e(".beneficiary_Iddisp").show()):"W"==v.get("transHistFilterTranBeneType")?(e("#BeneType_W").attr("checked",!0),e(".beneficiary_Iddisp").show()):"L"==v.get("transHistFilterTranBeneType")?(e("#BeneType_L").attr("checked",!0),e(".beneficiary_Iddisp").show()):"I"==v.get("transHistFilterTranBeneType")?(e("#BeneType_I").attr("checked",!0),e(".beneficiary_Iddisp").show()):"B"==v.get("transHistFilterTranBeneType")&&(e("#BeneType_B").attr("checked",!0),e(".beneficiary_Iddisp").show()),"today"==v.get("transHistFilterTranDuration")?e("#today").attr("checked",!0):"last7"==v.get("transHistFilterTranDuration")?e("#last7").attr("checked",!0):"lastMonth"==v.get("transHistFilterTranDuration")?e("#lastMonth").attr("checked",!0):"last3Month"==v.get("transHistFilterTranDuration")?e("#last3Month").attr("checked",!0):"last6Month"==v.get("transHistFilterTranDuration")?e("#last6Month").attr("checked",!0):"last1year"==v.get("transHistFilterTranDuration")&&e("#last1year").attr("checked",!0),a.getPeriodRange(t),e("#transSearch").modal("show")):"N"==v.get("isFiltered")&&(e("#A").attr("checked",!0),e("#Channel_ALL").attr("checked",!0),e("#BeneType_ALL").attr("checked",!0),a.setBeneficiaryTypeDropDown(),a.setBeneficiaryDropDown(t),a.populateFromAccountDropDown(t),a.getPeriodRange(t),e(".beneficiary_Iddisp").hide(),e("#transSearch").modal("show"))},filterContactList:function(a){a.stopImmediatePropagation();var n=getTransferHistoryDTO();jQuery.expr[":"].contains=function(e,t,a){return jQuery(e).text().toUpperCase().indexOf(a[3].toUpperCase())>=0};var i=a.target.value;n.length>0&&(i.length>0?(e("#page_navigation").hide(),e(".search_clear").is(":visible")||(e(".search_clear").show(),e(".search_clear").on("click",function(){e("#trans_search_box").val(""),e(".nocontacts").hide(),e(".search_clear").hide(),e("#page_navigation").show(),e("#trans_history").html(t.template(h))})),e(".conItems").hide(),e('.conItems:contains("'+i+'")').length>0?(e(".nocontacts").hide(),e('.conItems:contains("'+i+'")').show(),e('.conItems[phonenumber*="'+i+'"]').show()):e(".nocontacts").show()):(e(".search_clear").hide(),e(".nocontacts").hide(),e("#page_navigation").show(),e("#trans_history").html(t.template(h)),e(".conItems").show()))},update:function(e){this.showOtherRecords(e)},showOtherRecords:function(t){showSpinner();var a=this,n=function(e){a.transactionHistryPagination(t)},i=function(e){a.errorresponse()};a.collection=new s([],{pageNo:t});v.get("accountId");a.collection.fetch({data:e.param({access_token:v.get("access_token"),pages:t,channel:v.get("filterChannel"),beneType:v.get("beneficiaryType"),startDate:v.get("transFromDate"),endDate:v.get("transToDate"),beneId:v.get("beneIdValueTH"),acctId:v.get("fromaccidTH")}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?n(e):i(e)},error:i})},transactionHistryPagination:function(a){hideSpinner();var n=this;e("html").removeClass().addClass("app"),n.$el.html(t.template(u));var i=e("#transHistory_filterBtn").find("span").attr("id");enableScroll(i),v.set("isTransHisPagination","true"),v.set("pageno",a);var r=v.get("pageno"),s=parseInt(r)-1,o=e(".page_link.active")[0].attributes[1].value;return e(".page_link[longdesc="+o+"]").removeClass("active"),e(".page_link[longdesc="+s+"]").addClass("active"),e("#trans_history").html(t.template("")),e("#trans_history").html(t.template(h)),this},render:function(){var t=this;v.set("transToDate",""),v.set("fromaccidTH",""),v.set("beneIdValueTH",""),v.set("filterChannel",""),v.set("transFromDate",""),v.set("beneficiaryType","");var a=(v.get("isTransferAccountDetails"),function(e){t.getCreditPrepaidCardsList()}),n=function(e){t.errorresponse()};showSpinner(),t.collection=new o,t.collection.fetch({data:e.param({access_token:v.get("access_token"),trSubTypeId:"MW"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?a(e):n(e)},error:n})},errormsgclear:function(){this.model=new r({url:"json/"}),a.Validation.bind(this);var e=this.$("form").serializeObject();this.model.set(e,{validate:!0})&&this.model.clear()},getCreditPrepaidCardsList:function(){var t=this,a=v.get("isTransferAccountDetails");if("false"==a){var n=function(e){hideSpinner(),t.getAllBillers()},i=function(e){t.errorresponse()};showSpinner(),t.collection=new l([],{}),t.collection.fetch({data:e.param({newversion:"Y",access_token:v.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){if("0000"==ackStatus){var t=v.get("errorcode");n("9999"==t?e:e)}else i(e)},error:i})}else t.getAllBillers()},getAllBillers:function(){var a=this;bckFlag=v.get("trsBackFlg"),v.set("pageno","1"),v.set("tranback","0"),v.set("currentpage","1");var n=v.get("isTransferAccountDetails"),i=function(i){if(hideSpinner(),"false"==n)a.additionalMethodTranDetaitlsGet();else if("Y"!=bckFlag){var r=function(n){hideSpinner(),e("html").removeClass().addClass("app"),a.$el.html(t.template(u));var i=e("#transHistory_filterBtn").find("span").attr("id");enableScroll(i),v.set("isFiltered","N"),a.setBeneficiaryTypeDropDown(),a.setBeneficiaryDropDown(event),a.populateFromAccountDropDown(event),a.getPeriodRange(),e("#trans_history").html(t.template(h))},o=function(e){a.errorresponse()};showSpinner(),a.collection=new s([],{});getDeviceId();a.collection.fetch({data:e.param({access_token:v.get("access_token"),pages:"1",channel:"",beneType:"",startDate:"",endDate:"",beneId:"",acctId:""}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?r(e):o(e)},error:o})}else{var c=v.get("fromaccid"),l=v.get("channel"),d=v.get("beneType"),p=v.get("beneId");transHistFromDate=v.get("transFromDate"),transHistToDate=v.get("transToDate");v.get("beneInsId");e("html").removeClass().addClass("app"),a.$el.html(t.template(u));var m=e("#transHistory_filterBtn").find("span").attr("id");enableScroll(m),v.set("isFiltered","N"),a.setBeneficiaryTypeDropDown(),e("#From_historyAccount").val(c),e("input[name=channel]:checked").val(l),e("#beneficiaryType_Id").val(d),a.setBeneficiaryDropDown(event),a.populateFromAccountDropDown(event),e("#beneficiary_Id").val(p),a.getPeriodRange(),e("#trans_history").html(t.template(h))}},r=function(e){a.errorresponse()};showSpinner(),a.collection=new c,a.collection.fetch({data:e.param({access_token:v.get("access_token"),categoryId:null,billerType:"all"}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?i(e):r(e)},error:r})},additionalMethodTranDetaitlsGet:function(){var a=this;bckFlag=v.get("trsBackFlg");var n=function(n){if(hideSpinner(),v.set("isTransferAccountDetails","true"),e("html").removeClass().addClass("app"),"Y"!=bckFlag){var i=v.get("fromaccid"),r=v.get("channel"),s=v.get("beneType"),o=v.get("beneId");transHistFromDate=v.get("transFromDate"),transHistToDate=v.get("transToDate");v.get("beneInsId");a.$el.html(t.template(u));var c=e("#transHistory_filterBtn").find("span").attr("id");enableScroll(c),v.set("isFiltered","N"),a.setBeneficiaryTypeDropDown(),a.datefunc(event),e("#From_historyAccount").val(i),e("input[name=channel]:checked").val(r),e("#beneficiaryType_Id").val(s),e("#from_date").val(transHistFromDate),e("#to_date").val(transHistToDate),a.setBeneficiaryDropDown(event),a.populateFromAccountDropDown(event),e("#beneficiary_Id").val(o),a.getPeriodRange(),e("#trans_history").html(t.template(h))}else{a.$el.html(t.template(u));var c=e("#transHistory_filterBtn").find("span").attr("id");enableScroll(c),v.set("isFiltered","N"),a.setBeneficiaryTypeDropDown(),a.setBeneficiaryDropDown(),a.populateFromAccountDropDown(),a.getPeriodRange(),e("#trans_history").html(t.template(h))}a.$el.html(t.template(u));var c=e("#transHistory_filterBtn").find("span").attr("id");enableScroll(c),v.set("isFiltered","N"),a.setBeneficiaryTypeDropDown(),a.setBeneficiaryDropDown(event),a.getPeriodRange(),e("#trans_history").html(t.template(h))},i=function(e){a.errorresponse()};showSpinner(),a.collection=new s([],{});getDeviceId();a.collection.fetch({data:e.param({access_token:v.get("access_token"),channel:"",pages:"1",beneType:"",startDate:"",endDate:"",beneId:"",acctId:""}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?n(e):i(e)},error:i})},datefunc:function(t){e(".nativedatepicker").on("touchend",function(t){t.preventDefault();var n,i=e(this),s="",o="",c=(new Date,v.get("device.platform")),l=new Date,d=l.getDate(),p=l.getMonth(),u=l.getFullYear()-1,h=new Date(u,p,d);if(""!==i.val()){var m=i.val(),g=/(\d+)\/(\d+)\/(\d+)/.exec(m),y=new Date(+g[3],+g[2]-1,+g[1]);n=Date.parse(y)}else t.preventDefault(),n=new Date;if("from_date"==t.target.id&&(o="Android"==c?Date.parse(h):h,s="Android"==c?Date.parse(l):l),"to_date"==t.target.id){var f=e("#from_date").val();if(isNull(f))o="Android"==c?Date.parse(h):h,s="Android"==c?Date.parse(l):l;else{var b=f.split("/"),T=b[2],D=b[1],F=b[0],A=new Date(T,D-1,F),I=new Date(T,D,F);I.setMonth(I.getMonth()+2),o="Android"==c?Date.parse(A):A,s=I.getTime()>l.getTime()?"Android"==c?Date.parse(l):l:"Android"==c?Date.parse(I):I}}"number"==typeof n&&(n=new Date(n)),window.plugins.datePicker.show({date:n,mode:"date",minDate:o,maxDate:s,allowOldDates:!0,androidTheme:3,allowFutureDates:!1},function(t){if(t){var n=new Date(t),s=n.getDate(),o=n.getMonth()+1,c=n.getFullYear(),l=""+(9>=s?"0"+s:s)+"/"+(9>=o?"0"+o:o)+"/"+c;i.val(l),this.model=new r({url:"json/"}),a.Validation.bind(this);var d=this.$("form").serializeObject();this.model.set(d,{validate:!0})&&this.model.clear(),e("#Fromdateerror").html(""),e("#todateError").html("")}i.blur()})})},setBeneficiaryTypeDropDown:function(t){var a="";"object"==typeof t&&t.stopImmediatePropagation(),e("#beneficiaryType_Id").html("");var n;n=e("input[name=transType]:checked").val(),"Y"==v.get("isFiltered")&&(n=v.get("transHistFilterTranBeneType")),n=e("input[name=transType]:checked").val(),"A"==n?a+="<div class='box'> <div class='radio'> <label><input type='radio' name='benetype' id='BeneType_ALL' value='ALL' checked>  <div class='row bg'><div class='col-xs-12 p0'><span class='small'>ALL</span></div></div></label></div></div><div class='box'> <div class='radio'> <label><input type='radio' name='benetype' id='BeneType_O' value='O' >  <div class='row bg'><div class='col-xs-12 p0'><span class='small'>Own Account</span></div></div></label></div></div><div class='box'> <div class='radio'> <label><input type='radio' name='benetype' id='BeneType_W' value='W' >  <div class='row bg'><div class='col-xs-12 p0'><span class='small'>Within Bank Beneficiary</span></div></div></label></div></div><div class='box'> <div class='radio'> <label><input type='radio' name='benetype' id='BeneType_L' value='L' >  <div class='row bg'><div class='col-xs-12 p0'><span class='small'>Local Bank Beneficiary</span></div></div></label></div></div><div class='box'> <div class='radio'> <label><input type='radio' name='benetype' id='BeneType_I' value='I' >  <div class='row bg'><div class='col-xs-12 p0'><span class='small'>Wallet Beneficiary</span></div></div></label></div></div><div class='box'> <div class='radio'> <label><input type='radio' name='benetype' id='BeneType_B' value='B' >  <div class='row bg'><div class='col-xs-12 p0'><span class='small'>Bill Payment</span></div></div></label></div></div>":"F"==n?a+="<div class='box'> <div class='radio'> <label><input type='radio' name='benetype' id='BeneType_O' value='O' checked>  <div class='row bg'><div class='col-xs-12 p0'><span class='small'>Own Account</span></div></div></label></div></div><div class='box'> <div class='radio'> <label><input type='radio' name='benetype' id='BeneType_W' value='W' >  <div class='row bg'><div class='col-xs-12 p0'><span class='small'>Within Bank Beneficiary</span></div></div></label></div></div><div class='box'> <div class='radio'> <label><input type='radio' name='benetype' id='BeneType_L' value='L' >  <div class='row bg'><div class='col-xs-12 p0'><span class='small'>Local Bank Beneficiary</span></div></div></label></div></div><div class='box'> <div class='radio'> <label><input type='radio' name='benetype' id='BeneType_I' value='I' >  <div class='row bg'><div class='col-xs-12 p0'><span class='small'>Wallet Beneficiary</span></div></div></label></div></div>":"B"==n&&(a+="<div class='box'> <div class='radio'> <label><input type='radio' name='benetype' id='BeneType_B' value='B' checked>  <div class='row bg'><div class='col-xs-12 p0'><span class='small'>Bill Payment</span></div></div></label></div></div>"),e("#beneficiaryType_Id").append(a);var i=this;i.setBeneficiaryDropDown(t)},setBeneficiaryDropDown:function(t){var a="",n="";e("#beneficiary_Id").html("");var i;if(e("#beneError").html(""),i="Y"==v.get("isFiltered")?v.get("transHistFilterTranBeneType"):e("input[name='benetype']:checked").val(),i=e("input[name='benetype']:checked").val(),"O"==i){e(".beneficiary_Iddisp").show();var r=getAccountDTO(),s=v.get("ccListDTO");n=null!=s&&s.length>0?r.concat(s):r}else if("W"==i)e(".beneficiary_Iddisp").show(),n=isNull(v.get("beneficiaryDTO"))?"":v.get("beneficiaryDTO");else if("L"==i)e(".beneficiary_Iddisp").show(),n=isNull(v.get("beneficiaryLocalDTO"))?"":v.get("beneficiaryLocalDTO");else if("I"==i)e(".beneficiary_Iddisp").show(),n=isNull(v.get("mobileWalletInsttructionList"))?"":v.get("mobileWalletInsttructionList");else if("B"==i)e(".beneficiary_Iddisp").show(),n=isNull(v.get("billerInstruction"))?"":v.get("billerInstruction");else if("ALL"==i){e(".beneficiary_Iddisp").hide();var r=getAccountDTO(),s=v.get("ccListDTO");if(!isNull(s)&&s.length>0)var o=r.concat(s);else var o=r;var c=v.get("beneficiaryDTO"),l=v.get("beneficiaryLocalDTO"),d=v.get("mobileWalletInsttructionList"),p=v.get("billerInstruction");n=o.concat(c).concat(l).concat(d)}a+="Y"==v.get("isFiltered")?"<option selected='selected' beneId='"+v.get("transHistFilterTranBeneId")+"' value='"+v.get("transHistFilterTranBeneVal")+"'>"+v.get("transHistFilterTranBeneHtml")+"</option>":"<option selected='selected' beneId='ALL' value='ALL'>All</option>",isNull(n)&&(a="",a+="<option selected='selected' beneId='ALL' value='ALL'>All</option>"),"Y"==v.get("isFiltered")&&isNull(n)&&(a="",a+="<option selected='selected' beneId='ALL' value='ALL'>All</option>"),"ALL"==i?(e.each(n,function(e,t){"Y"==v.get("isFiltered")?v.get("transHistFilterTranBeneId")!=t.beneInstId?a+="<option beneId='"+t.beneInstId+"' value='"+t.id+"'>"+t.accountNumber+"</option>":(a="",a+="<option beneId='"+t.beneInstId+"' value='"+t.id+"'>"+t.accountNumber+"</option>"):a+="<option beneId='"+t.beneInstId+"' value='"+t.id+"'>"+t.accountNumber+"</option>"}),e.each(p,function(e,t){"Y"==v.get("isFiltered")?v.get("transHistFilterTranBeneId")!=t.id&&(a+="<option beneId='"+t.id+"' value='"+t.id+"'>"+t.mobileNumber+"</option>"):a+="<option beneId='"+t.id+"' value='"+t.id+"'>"+t.mobileNumber+"</option>"})):e.each(n,function(e,t){"B"==i?"Y"==v.get("isFiltered")?v.get("transHistFilterTranBeneId")!=t.id?a+="<option beneId='"+t.id+"' value='"+t.id+"'>"+t.shortName+"|"+t.mobileNumber+"</option>":(a="",a+="<option selected='selected' beneId='ALL' value='ALL'>All</option>",a+="<option beneId='"+t.id+"' value='"+t.id+"'>"+t.shortName+"|"+t.mobileNumber+"</option>"):a+="<option beneId='"+t.id+"' value='"+t.id+"'>"+t.shortName+"|"+t.mobileNumber+"</option>":"O"==i?"Y"==v.get("isFiltered")?v.get("transHistFilterTranBeneId")!=t.beneInstId?a+="<option beneId='"+t.beneInstId+"' value='"+t.id+"'>"+t.accountNumber+"</option>":(a="",a+="<option selected='selected' beneId='ALL' value='ALL'>All</option>",a+="<option beneId='"+t.beneInstId+"' value='"+t.id+"'>"+t.accountNumber+"</option>"):a+="<option beneId='"+t.beneInstId+"' value='"+t.id+"'>"+t.accountNumber+"</option>":"Y"==v.get("isFiltered")?v.get("transHistFilterTranBeneId")!=t.beneInstId?a+="<option beneId='"+t.beneInstId+"' value='"+t.id+"'>"+t.shortName+"|"+t.accountNumber+"</option>":(a="",a+="<option selected='selected' beneId='ALL' value='ALL'>All</option>",a+="<option beneId='"+t.beneInstId+"' value='"+t.id+"'>"+t.shortName+"|"+t.accountNumber+"</option>"):a+="<option beneId='"+t.beneInstId+"' value='"+t.id+"'>"+t.shortName+"|"+t.accountNumber+"</option>"}),e("#beneficiary_Id").html(a)},populateFromAccountDropDown:function(t){"object"==typeof t&&t.stopImmediatePropagation();var a="";e("#From_historyAccount").html("");var n=getAccountDTO(),i=v.get("ccListDTO"),r=v.get("pcListDTO");"Y"==v.get("isFiltered")?"CASA"==v.get("transHistFilterTranFromAccType")?(a+="<option acctype='"+v.get("transHistFilterTranFromAccType")+"' selected='selected' frName='"+v.get("transHistFilterTranFromAccName")+"' value='"+v.get("transHistFilterTranFromAccVal")+"' Accide='"+v.get("transHistFilterTranFromAccIDE")+"' id='"+v.get("transHistFilterTranFromAccId")+"'>"+v.get("transHistFilterTranFromAccNum")+"</option>",a+="<option value='ALL' id='ALL' Accide='ALL'>All</option>"):"CC"==v.get("transHistFilterTranFromAccType")||"PC"==v.get("transHistFilterTranFromAccType")?(a+="<option acctype='"+v.get("transHistFilterTranFromAccType")+"' selected='selected' shName='"+v.get("transHistFilterTranFromAccName")+"' value='"+v.get("transHistFilterTranFromAccVal")+"' Accide='"+v.get("transHistFilterTranFromAccIDE")+"' id='"+v.get("transHistFilterTranFromAccId")+"'>"+v.get("transHistFilterTranFromAccNum")+"</option>",a+="<option value='ALL' id='ALL' Accide='ALL'>All</option>"):"bKash"==v.get("transHistFilterTranFromAccType")?(a+="<option acctype='bKash' selected='selected' frName='bKash' value='bKash' Accide='bKash' id='bKash'>bKash</option>",a+="<option value='ALL' id='ALL' Accide='ALL'>All</option>"):a+="<option value='ALL' selected='selected' id='ALL' Accide='ALL'>All</option>":a+="<option value='ALL' selected='selected' id='ALL' Accide='ALL'>All</option>",e.each(n,function(e,t){"Y"==v.get("isFiltered")?v.get("transHistFilterTranFromAccVal")!==t.id.toString()&&(a+="<option acctype='CASA' frName='"+t.productName+"' value='"+t.id+"' Accide='"+t.id+"' id='"+e+"'>"+t.accountNumber+"</option>"):a+="<option acctype='CASA' frName='"+t.productName+"' value='"+t.id+"' Accide='"+t.id+"' id='"+e+"'>"+t.accountNumber+"</option>"}),e.each(i,function(e,t){"Y"==v.get("isFiltered")?v.get("transHistFilterTranFromAccVal")!==t.id.toString()&&(a+="<option acctype='CC' shName='"+t.productName+"' value='"+t.id+"' Accide='"+t.id+"' id='"+e+"'>"+t.accountNumber+"</option>"):a+="<option acctype='CC' shName='"+t.productName+"' value='"+t.id+"' Accide='"+t.id+"' id='"+e+"'>"+t.accountNumber+"</option>"}),e.each(r,function(e,t){"Y"==v.get("isFiltered")?v.get("transHistFilterTranFromAccVal")!==t.id.toString()&&(a+="<option acctype='PC' shName='"+t.productName+"' value='"+t.id+"' Accide='"+t.id+"' id='"+e+"'>"+t.accountNumber+"</option>"):a+="<option acctype='PC' shName='"+t.productName+"' value='"+t.id+"' Accide='"+t.id+"' id='"+e+"'>"+t.accountNumber+"</option>"}),"Y"==v.get("isFiltered")||(a+="<option acctype='bKash' shName='bKash' value='bKash' Accide='bKash' id='bKash'>bKash</option>"),e("#From_historyAccount").html(a)},getCreditCardDTO:function(){var t=this,a=function(e){hideSpinner(),t.getAllBillers()},n=function(e){t.errorresponse()};showSpinner(),t.collection=new d([],{});getDeviceId();t.collection.fetch({data:e.param({newversion:"Y",access_token:v.get("access_token")}),dataType:"json",type:"POST",cache:!1,success:function(e){if("0000"==ackStatus){var t=v.get("errorcode");a("9999"==t?e:e)}else n(e)},error:n})},gotoBackPage:function(){a.history.navigate("#/wealth")},getPeriodRange:function(t){"object"==typeof t&&t.stopImmediatePropagation();var a,n=this;if(a=e("input[name='duration']:checked").val(),"last7"==a){v.set("periodDtType","last7");var i=n.calculateFromDate();e("#from_date").val(i),v.set("from_date",i)}else if("lastMonth"==a){v.set("periodDtType","lastMonth");var i=n.calculateFromDate();e("#from_date").val(i),v.set("from_date",i)}else if("last3Month"==a){v.set("periodDtType","last3Month");var i=n.calculateFromDate();e("#from_date").val(i),v.set("from_date",i)}else if("last6Month"==a){v.set("periodDtType","last6Month");var i=n.calculateFromDate();e("#from_date").val(i),v.set("from_date",i)}else if("last1year"==a){v.set("periodDtType","last1year");var i=n.calculateFromDate();e("#from_date").val(i),v.set("from_date",i)}var r=new Date,s=r.getDate(),o=r.getMonth()+1,c=r.getFullYear(),l=("00"+s.toString()).slice(-2)+"-"+("00"+o.toString()).slice(-2)+"-"+("0000"+c.toString()).slice(-4);e("#to_date").val(l),v.set("to_date",l),"today"==a&&(e("#from_date").val(l),v.set("from_date",l))},calculateFromDate:function(){var e=this,t=e.dateFunction(),a=t.getMonth()+1,n=t.getDate(),i=t.getFullYear(),r=("00"+n.toString()).slice(-2)+"-"+("00"+a.toString()).slice(-2)+"-"+("0000"+i.toString()).slice(-4);return r},dateFunction:function(){var e=v.get("periodDtType"),t=new Date;if("last7"==e)var a=new Date(t.getFullYear(),t.getMonth(),t.getDate()-7);else if("lastMonth"==e)var a=new Date(t.getFullYear(),t.getMonth()-1,t.getDate());else if("last3Month"==e)var a=new Date(t.getFullYear(),t.getMonth()-3,t.getDate());else if("last6Month"==e)var a=new Date(t.getFullYear(),t.getMonth()-6,t.getDate());else if("last1year"==e)var a=new Date(t.getFullYear()-1,t.getMonth(),t.getDate());return a},gotoViewTransactionList:function(t){t.stopImmediatePropagation();var a=(e("input[name='channel']:checked").val(),this),n=e("#from_date").val(),i=e("#to_date").val(),r="",s="";if(!isNull(n)){var o=n.split("-"),c=o[2],l=o[1],d=o[0];new Date(c,l,d);r=c+"-"+l+"-"+d}if(!isNull(n)){var p=i.split("-"),u=p[2],h=p[1],m=p[0];new Date(u,h,m);s=u+"-"+h+"-"+m}v.set("transFromDate",r),v.set("transToDate",s);var g=e("input[name='channel']:checked").val();v.set("filterChannel",g),a.goTohistrory(t)},goTohistrory:function(n){n.stopImmediatePropagation(),e(".modal-backdrop").hide();var i=e("#From_historyAccount option:selected").attr("Accide");v.set("fromaccid",i);var r=(e("input[name='channel']:checked").val(),e("input[name='benetype']:checked").val());v.set("beneType",r);var o=e("#beneficiary_Id option:selected").val();v.set("beneId",o);var c=e("#beneficiary_Id option:selected").attr("beneId");v.set("beneInsId",c),"ALL"==r&&isNull(c)&&(c=e("#beneficiary_Id option:selected").val());var l="O"==r?o:c,d=e("input[name=transType]:checked").val();""==r?"A"==d?v.set("beneficiaryType",null):"F"==d?v.set("beneficiaryType","FT"):"B"==d&&v.set("beneficiaryType","B"):"ALL"==r&&"F"==d?v.set("beneficiaryType","FT"):v.set("beneficiaryType",r),v.set("beneIdValueTH",l),v.set("fromaccidTH",i);var p=this,m=function(i){hideSpinner(),v.set("isFiltered","Y");var r=e("input[name='transType']:checked").val();v.set("transHistFilterTranType",r);var s=e("input[name='channel']:checked").val();v.set("transHistFilterTranChannel",s);var o=e("input[name='benetype']:checked").val();v.set("transHistFilterTranBeneType",o);var c=e("#beneficiary_Id option:selected").val();v.set("transHistFilterTranBeneVal",c);var l=e("#beneficiary_Id option:selected").html();v.set("transHistFilterTranBeneHtml",l);var d=e("#beneficiary_Id option:selected").attr("beneId");v.set("transHistFilterTranBeneId",d);var m=e("#From_historyAccount option:selected").val();v.set("transHistFilterTranFromAccVal",m);var g=e("#From_historyAccount option:selected").html();v.set("transHistFilterTranFromAccNum",g);var y=e("#From_historyAccount option:selected").attr("acctype");if(v.set("transHistFilterTranFromAccType",y),"CASA"==y){var f=e("#From_historyAccount option:selected").attr("frName");v.set("transHistFilterTranFromAccName",f)}else{var f=e("#From_historyAccount option:selected").attr("shName");v.set("transHistFilterTranFromAccName",f)}var b=e("#From_historyAccount option:selected").attr("Accide");v.set("transHistFilterTranFromAccIDE",b);var T=e("#From_historyAccount option:selected").attr("id");v.set("transHistFilterTranFromAccId",T);var D=e("input[name='duration']:checked").val();v.set("transHistFilterTranDuration",D);var F=location.href;if(F.includes("#/transhistory")){var A=v.get("fromaccid"),I=(v.get("filterChannel"),v.get("beneType")),_=v.get("beneId");transHistFromDate=v.get("transFromDate"),transHistToDate=v.get("transToDate");v.get("beneInsId");e("html").removeClass().addClass("app"),p.$el.html(t.template(u));var w=e("#transHistory_filterBtn").find("span").attr("id");enableScroll(w),p.setBeneficiaryTypeDropDown(),e("#From_historyAccount").val(A),e("#beneficiaryType_Id").val(I),p.setBeneficiaryDropDown(n),p.populateFromAccountDropDown(n),e("#beneficiary_Id").val(_),p.getPeriodRange(),v.set("pageno","1"),e("#trans_history").html(t.template(h))}else v.set("trsBackFlg","Y"),a.history.navigate("#/transhistory")},g=function(e){p.errorresponse()};showSpinner(),p.collection=new s([],{});getDeviceId();p.collection.fetch({data:e.param({access_token:v.get("access_token"),channel:v.get("filterChannel"),beneType:v.get("beneficiaryType"),startDate:v.get("transFromDate"),endDate:v.get("transToDate"),beneId:l,pages:"1",acctId:i}),dataType:"json",type:"POST",cache:!1,success:function(e){"0000"==ackStatus?m(e):g(e)},error:g})},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return a.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return m});