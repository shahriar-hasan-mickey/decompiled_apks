define(["jquery","underscore","Backbone","text!views/more/chart/chart.tpl","collections/chart/spendingAnalysierInitCollections","collections/wealth/accDetailStatementCollections","collections/wealth/ccStatementCollections"],function(e,a,t,n,r,o,s){var d=new EncryptedLocalStorage("secret"),c=t.View.extend({el:"#mobcontent",events:{"click #frmacno":"clearChart","click #frmcard":"clearChart","change #AccDuration":"showCharts","change #CardDuration":"showCharts"},render:function(){var a=this,t=function(e){a.showInputs()},n=function(e){a.errorresponse()};showSpinner(),a.collection=new r,timestamp=(new Date).getTime(),a.collection.fetch({data:e.param({requestid:timestamp,ccstatus:"ACTIVE"}),dataType:"json",type:"POST",timeout:parseInt(d.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?t(e):n(e)},error:n})},showInputs:function(){return hideSpinner(),this.$el.html(a.template(n)).i18n(),this},clearChart:function(){e("#spendinAnalysisDiv").empty(),e("#spendinAnalysisDiv").hide(),e("#spendinAnalysisErrorDiv").hide(),e("#AccDuration").prop("selectedIndex",0),e("#CardDuration").prop("selectedIndex",0)},showCharts:function(){e("#spendinAnalysisDiv").empty(),e("#spendinAnalysisDiv").hide(),e("#spendinAnalysisErrorDiv").hide();var a=this,t="",n="",r=e("#hidPaymentMode").val();"A"==r?(t=e("input[name=frmacno]:checked").val(),n=e("#AccDuration").val()):(t=e("input[name=frmcard]:checked").val(),n=e("#CardDuration").val());var c=t.split("~"),l=c[0],f=function(e){a.errorresponse()};if("A"==r){a.collection=new o([],{});var p=getDeviceId(),u=l+""+p,h=CryptoJS.MD5(u);u=h+"",showSpinner(),a.collection.fetch({data:e.param({appchecksum:u,accountNumber:l,fromDate:"CHATS",toDate:n,frmtxnfromamount:"0",frmtxntoamount:"0"}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(d.get("calltimeout")),success:function(t){if("0000"==ackStatus){var n=d.get("spendingAnalysierList");if(n.length>0){var r=new Array,o=new Array;for(i=0;i<n.length;i++)category=n[i].category,spendingAmount=n[i].spendingAmount,r[i]=category,o[i]=parseFloat(spendingAmount);a.plotGraphAcc(r,o),hideSpinner()}else e("#spendinAnalysisErrorDiv").show(),hideSpinner()}else f(t)},error:f})}else{a.collection=new s([],{id:""});var p=getDeviceId(),u=l+""+p,h=CryptoJS.MD5(u);u=h+"",showSpinner(),a.collection.fetch({data:e.param({appchecksum:u,sortBy:"",accountId:l,accountNumber:l,monthcode:n,transactiontype:"C",requestid:timestamp}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(d.get("calltimeout")),success:function(e){if("0000"==ackStatus){var t=d.get("spendingAnalysierList"),n=new Array,r=new Array;for(i=0;i<t.length;i++)category=t[i].category,spendingAmount=t[i].spendingAmount,n[i]=category,r[i]=parseFloat(spendingAmount);a.plotGraph(n,r),hideSpinner()}else f(e)},error:f})}},plotGraphAcc:function(a,t){e("#spendinAnalysisDiv").show();var n,r=function(){var e=a,n=t,r=[[]];for(k=0;k<e.length;k++)r[0].push([e[k],n[k]]);return r},i=function(){n=jQuery.jqplot("spendinAnalysisDiv",[],{seriesColors:["#D6AE01","#6C4675","#EA899A","#2271B3","#57A639","#5D9B9B","#3F888F","#f2fa00","#ff9500","#001dfa","#ff00a2","#00ff2f","#953579","#4b5de4","#d8b83f","#ff5800","#0085cc","#c747a3","#cddf54","#FBD178","#26B4E3","#bd70c7","#f2fa00"],title:"",dataRenderer:r,grid:{drawBorder:!1,drawGridlines:!1,background:"#ffffff",shadow:!1},axesDefaults:{},seriesDefaults:{shadow:!1,renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0,dataLabels:"percent",dataLabelFormatString:"%.2f%%",dataLabelPositionFactor:1.15,shadow:!1,dataLabelThreshold:0,sliceMargin:5,startAngle:0,dataLabelCenterOn:!0}},legend:{rendererOptions:{numberRows:2,marginTop:10},show:!0,location:"s"}})},o=function(){n=jQuery.jqplot("spendinAnalysisDiv",[],{seriesColors:["#D6AE01","#6C4675","#EA899A","#2271B3","#57A639","#5D9B9B","#3F888F","#f2fa00","#ff9500","#001dfa","#ff00a2","#00ff2f","#953579","#4b5de4","#d8b83f","#ff5800","#0085cc","#c747a3","#cddf54","#FBD178","#26B4E3","#bd70c7","#f2fa00"],title:"",dataRenderer:r,grid:{drawBorder:!1,drawGridlines:!1,background:"#f2f2f2",shadow:!1},axesDefaults:{},seriesDefaults:{shadow:!1,renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0,dataLabels:"percent",dataLabelFormatString:"%.2f%%",dataLabelPositionFactor:1.15,shadow:!1,dataLabelThreshold:0,sliceMargin:5,startAngle:0,dataLabelCenterOn:!0}},legend:{rendererOptions:{numberRows:2,marginTop:10},show:!0,location:"s"}})},s=function(){n=jQuery.jqplot("spendinAnalysisDiv",[],{seriesColors:["#D6AE01","#6C4675","#EA899A","#2271B3","#57A639","#5D9B9B","#3F888F","#f2fa00","#ff9500","#001dfa","#ff00a2","#00ff2f","#953579","#4b5de4","#d8b83f","#ff5800","#0085cc","#c747a3","#cddf54","#FBD178","#26B4E3","#bd70c7","#f2fa00"],title:"",dataRenderer:r,grid:{drawBorder:!1,drawGridlines:!1,background:"#00ab96",shadow:!1},axesDefaults:{},seriesDefaults:{shadow:!1,renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0,dataLabels:"percent",dataLabelFormatString:"%.2f%%",dataLabelPositionFactor:1.15,shadow:!1,dataLabelThreshold:0,sliceMargin:5,startAngle:0,dataLabelCenterOn:!0}},legend:{rendererOptions:{numberRows:2,marginTop:10},show:!0,location:"s"}})},d=function(){n&&n.destroy();var e=getfromStorage("current_theme");"DEF"==e||null==e?i():"LIT"==e?o():"DRK"==e&&s()};setTimeout(function(){d()},500)},plotGraph:function(a,t){e("#spendinAnalysisDiv").show();var n,r=function(){var e=a,n=t,r=[[]];for(k=0;k<e.length;k++)r[0].push([e[k],n[k]]);return r},i=function(){n=jQuery.jqplot("spendinAnalysisDiv",[],{seriesColors:["#D6AE01","#6C4675","#EA899A","#2271B3","#57A639","#5D9B9B","#3F888F","#f2fa00","#ff9500","#001dfa","#ff00a2","#00ff2f","#953579","#4b5de4","#d8b83f","#ff5800","#0085cc","#c747a3","#cddf54","#FBD178","#26B4E3","#bd70c7","#f2fa00"],title:"",dataRenderer:r,grid:{drawBorder:!1,drawGridlines:!1,background:"#ffffff",shadow:!1},axesDefaults:{},seriesDefaults:{shadow:!1,renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0,dataLabels:"percent",dataLabelFormatString:"%.2f%%",dataLabelPositionFactor:1.15,shadow:!1,dataLabelThreshold:0,sliceMargin:5,startAngle:0,dataLabelCenterOn:!0}},legend:{rendererOptions:{numberRows:2,marginTop:10},show:!0,location:"s"}})},o=function(){n&&n.destroy(),i()};setTimeout(function(){o()},500)},errorresponse:function(){hideSpinner(),t.history.navigate("#/exception")}});return c});