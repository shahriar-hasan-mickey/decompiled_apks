define(["jquery","underscore","Backbone","text!views/more/locator.tpl","views/more/locatorSearchResult","collections/locator/locatorSearchResultCollections","text!views/more/locatorCity.tpl"],function(e,t,r,n,i,o,s){var c=new EncryptedLocalStorage("secret"),a=r.View.extend({el:"#mobcontent",events:{submit:"locatorsearchresult","click #city":"selectcity","click #atm":"selectatm"},update:function(){c.set("currentPage",""),c.set("locatorTypeCityOrAtm","atm");var t=this;"en-US"==e.i18n.lng()?language="EN":"en-AR"==e.i18n.lng()&&(language="AR");var r=function(e){t.showRegTemplate()},n=function(e){t.errorresponse()};t.collection=new o([],{}),timestamp=(new Date).getTime(),showSpinner(),t.collection.fetch({data:e.param({paramcode:"ATMBRN",login_type:"postlogin",language:language,requestid:timestamp}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(c.get("calltimeout")),success:function(e){"0000"==ackStatus?r(e):n(e)},error:n})},showRegTemplate:function(e){return hideSpinner(),this.$el.html(t.template(n)).i18n(),this},selectatm:function(){return c.set("locatorTypeCityOrAtm","atm"),hideSpinner(),this.$el.html(t.template(n)).i18n(),this},selectcity:function(){return c.set("locatorTypeCityOrAtm","city"),hideSpinner(),this.$el.html(t.template(s)).i18n(),this},locatorsearchresult:function(t){e("#errorCity").hide(),e("#errorBranch").hide(),t.preventDefault();var r=e("#branch option:selected").val(),n=e("#branch option:selected").text(),i=!1;""==r&&(i=!0,e("#errorBranch").show());var o=e("#selecity option:selected").val();if(1==i)return""==o&&e("#errorCity").show(),!1;c.set("srbranch",r),c.set("srbranchname",n);var s=e("#selecity option:selected").text(),i="false";if(""==o&&(i=!0,e("#errorCity").show()),1==i)return!1;showSpinner(),c.set("srselecity",o),c.set("srselecityname",s);var a=e(".showslideval").text();c.set("distkm",a.substring(0,2)),this.locatorsearchcompile()},locatorsearchcompile:function(){hideSpinner(),r.history.fragment=null,r.history.navigate("#/locatorsearchresview")},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return r.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return a});