define(["jquery","underscore","Backbone","routers/iporouter","collections/more/ipoCollections","collections/more/ipoSubscriptionCollections","text!views/more/ipo/ipoenquiry.tpl"],function(e,t,n,i,a,o,r){var s=new EncryptedLocalStorage("secret"),p=n.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"change #iponame":"enquiryresulttemplate"},initialize:function(){},render:function(){showSpinner();var t=this;timestamp=(new Date).getTime();var n=function(e){t.subscriptioncall()},i=function(e){t.errorresponse()};t.collection=new a([],{}),showSpinner();var o="",r=s.get("lang_id");"en-US"==r?o="EN":"en-AR"==r&&(o="AR"),t.collection.fetch({data:e.param({requestid:timestamp,language:o}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(s.get("calltimeout")),success:function(e){"0000"==ackStatus?n(e):i(e)},error:i})},subscriptioncall:function(){showSpinner();var t=this;timestamp=(new Date).getTime();var n=function(e){t.subscriptiontemplate()},i=function(e){t.errorresponse()};t.collection=new o([],{}),timestamp=(new Date).getTime(),showSpinner();var a="",r=s.get("lang_id");"en-US"==r?a="EN":"en-AR"==r&&(a="AR"),t.collection.fetch({data:e.param({requestid:timestamp,language:a,ipoCompanyName:s.get("ipocode")}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(s.get("calltimeout")),success:function(e){if("0000"==ackStatus)n(e);else if("9999"==ackStatus){var t=s.get("errorcode");hideSpinner(),""==t||"null"==t||null==t?n(e):i(e)}},error:i})},subscriptiontemplate:function(){return hideSpinner(),this.$("#mobcontent").html(t.template(r)).i18n(),this},transactiontemplate:function(){if(!e("#submit").is(":visible")){this.enquiryresulttemplate()}},enquiryresulttemplate:function(){var t=e("#iponame option:selected").val(),n=t.split("~");if(t=n[0],noOfShares=n[1],sharePrice=n[2],minimum=n[3],maximum=n[4],startDate=n[5],endDate=n[6],ipoCompCode=n[7],""==t||"undefined"==t||void 0==t)return e("#ipodetailsview").hide(),!1;e("#noofshares").html("<span>"+noOfShares+"</span>"),e("#shareprice").html("<span>KWD "+checkAmount(e.formatNumber(sharePrice,{format:"#,###.000",locale:"us"}))+"</span>"),e("#minimum").html("<span>"+minimum+"</span>"),e("#maximum").html("<span>"+maximum+"</span>"),e("#startdate").html("<span>"+startDate+"</span>"),e("#enddate").html("<span>"+endDate+"</span>"),showSpinner();var i=this;timestamp=(new Date).getTime();var a=function(e){i.depshow()},r=function(e){i.errorresponse()};i.collection=new o([],{}),timestamp=(new Date).getTime(),showSpinner();var p="",l=s.get("lang_id");"en-US"==l?p="EN":"en-AR"==l&&(p="AR"),s.set("ipocode",ipoCompCode),i.collection.fetch({data:e.param({requestid:timestamp,language:p,ipoCompanyName:s.get("ipocode")}),dataType:"json",type:"POST",cache:!1,timeout:parseInt(s.get("calltimeout")),success:function(e){if("0000"==ackStatus)a(e);else if("9999"==ackStatus){var t=s.get("errorcode");hideSpinner(),""==t||"null"==t||null==t?a(e):r(e)}},error:r})},depshow:function(t){var n=s.get("ipoDependentListDTO"),i="";if(i="<table class='table'><thead><tr><th width='60%'>"+e.i18n.t("app.more.investmentipo.name")+"<th width='30%'>"+e.i18n.t("app.more.investmentipo.relationship")+"</th></tr></thead><tbody>",null!=n){if(n.length>0){for(var a=0;a<n.length;a++)i=i+"<tr  id='selrel' name='selrel' value='"+n[a].dependtName+"~"+n[a].relationship+"'><td id='relname'>"+n[a].dependtName+"</td>	<td id='relationship'>"+n[a].relationship+"</td> </tr>";i+="</tbody></table>"}}else i+="</tbody></table>",i=i+"<tr class='alert alert-info text-center'><span class='msg'>"+e.i18n.t("app.more.investmentipo.noresult")+"</span></tr>";e("#dependentList").html(i),e(".ipodetailsview").show();var o=e("#iponame option:selected").val(),r=o.split("~");return o=r[0],""==o||"undefined"==o||void 0==o?(e("#ipodetailsview").hide(),!1):void hideSpinner()},errorresponse:function(){hideSpinner(),n.history.navigate("#/exception")},disposeView:function(e){return n.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return p});