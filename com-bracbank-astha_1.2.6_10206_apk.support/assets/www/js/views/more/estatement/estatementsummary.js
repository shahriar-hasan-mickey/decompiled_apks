define(["jquery","underscore","Backbone","routers/estatementrouter","collections/transfer/ownAccountTransferCollections","collections/creditcard/creditCardSummaryCollections","collections/more/monthListCollections","text!views/more/estatement/estatementsummary.tpl"],function(e,t,o,n,r,i,c,a){var d,s,l=new EncryptedLocalStorage("secret"),m=o.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"change #acnt":"acnt1","change #ccd":"ccd1","click #frmcard":"loadMonth","click #downloads":"ACCTORCARD"},initialize:function(){},render:function(){l.set("actorcard","");var t=this;showSpinner();var o=function(e){t.creditcardlist()},n=function(e){t.errorresponse()};t.collection=new r([],{});var i=(new Date).getTime(),c=l.get("promoid"),a="";a=c?c:"",t.collection.fetch({data:e.param({status:"",actionFlag:l.get("actionFlgMore"),campainId:a,requestid:i}),dataType:"json",type:"POST",timeout:parseInt(l.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?o(e):n(e)},error:n})},creditcardlist:function(){var t=this;showSpinner();var o=function(e){t.monthlist()},n=function(e){t.errorresponse()};t.collection=new i([],{});var r=(new Date).getTime();t.collection.fetch({data:e.param({status:"",requestid:r}),dataType:"json",type:"POST",timeout:parseInt(l.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?o(e):n(e)},error:n})},monthlist:function(){var t=this;showSpinner();var o=function(e){t.summarytemplate()},n=function(e){t.errorresponse()};t.collection=new c([],{});var r=(new Date).getTime(),i="",a=l.get("lang_id");"en-US"==a?i="EN":"en-AR"==a&&(i="AR");var d=l.get("cccardacctno");t.collection.fetch({data:e.param({emailid:l.get("emailid"),accountNumber:d,language:i,requestid:r,sysparameter:"DEFMNS"}),dataType:"json",type:"POST",timeout:parseInt(l.get("calltimeout")),cache:!1,success:function(e){"0000"==ackStatus?o(e):n(e)},error:n})},summarytemplate:function(){return hideSpinner(),this.$("#mobcontent").html(t.template(a)).i18n(),this},acnt1:function(){s&&(e("#monthlist").prepend("<option value='"+d.value+"'>"+d.text+"</option"),e("#monthlist").prop("selectedIndex",0),s=!1),e("#errorFromAct").hide(),e("#errorFromCard").hide(),e(".creditCard").hide(),e(".fromAcc").show()},ccd1:function(){s&&(e("#monthlist").prepend("<option value='"+d.value+"'>"+d.text+"</option"),e("#monthlist").prop("selectedIndex",0),s=!1),this.loadMonth(),e("#errorFromAct").hide(),e("#errorFromCard").hide(),e(".fromAcc").hide(),e(".creditCard").show()},loadMonth:function(){var t=e("input[name=frmcard]:checked").val();if(void 0!=t){var o=t.split("~"),n=o[4],r=n.split("-");r=r[2];var i=new Date;i=i.getDate(),r>i?(monthCode=e("#monthlist").find("option").eq(0).val().split("~")[0],"00"==monthCode&&(s=!0,d={value:e("#monthlist").find("option").eq(0).val(),text:e("#monthlist").find("option").eq(0).text()},e("#monthlist").find("option").eq(0).remove())):s&&(e("#monthlist").prepend("<option value='"+d.value+"'>"+d.text+"</option"),e("#monthlist").prop("selectedIndex",0),s=!1)}},ACCTORCARD:function(t){e(".payAccount").hasClass("active")?this.acctPDFDownload():this.cardPDFDownload()},acctPDFDownload:function(t){e("#errorFromAct").hide();var o=e("input[name=frmacno]:checked").val();if(void 0==o)return o="",e("#errorFromAct").show(),!1;var n=o.split("~"),o=n[1];monthSelectedIdx=e("#monthlist").prop("selectedIndex");var r=e("#monthlist").val(),i=r.split("~");monthcode=i[0],l.set("SelectedMonthCode",monthcode);var c="",a=l.get("app.context.path");c=a+"account/ministatement/download.pdf";var d=l.get("appSessionId"),s=l.get("device_id"),m=l.get("lang_id"),p=o,h=Encrypt(p),u=getDeviceId(),v=p+""+u,f=CryptoJS.MD5(v);v=f+"";var g="device_id="+s+"&ccMaskedno="+h+"&emailid="+l.get("emailid")+"&appchecksum="+v+"&lang_id="+m+"&accountNumber="+p+"&download=PDF&cardoract=ESACT-"+l.get("SelectedMonthCode"),w=encodeURI(g);fileDownLoadAndViewer(c,w,1,d)},cardPDFDownload:function(t){var o=e("input[name=frmcard]:checked").val();if(void 0==o)return o="",r="",e("#errorFromCard").show(),!1;e("#errorFromCard").hide();var n=o.split("~"),o=n[1],r=n[4];monthSelectedIdx=e("#monthlist").prop("selectedIndex");var i=e("#monthlist").val(),c=i.split("~");monthcode=c[0],1==monthSelectedIdx.length&&(monthSelectedIdx="0"+monthSelectedIdx),monthcode=monthSelectedIdx,l.set("SelectedMonthCode",monthcode);var a="",d=l.get("app.context.path");a=d+"creditcard/ministatement/download.pdf";var s=l.get("appSessionId"),m=l.get("device_id"),p=l.get("lang_id"),h=o,u=Encrypt(h),v=l.get("SelectedMonthCode");v=("0"+monthcode).slice(-2);var f=getDeviceId(),g=h+""+f,w=CryptoJS.MD5(g);g=w+"";var S="device_id="+m+"&ccMaskedno="+u+"&emailid="+l.get("emailid")+"&appchecksum="+g+"&lang_id="+p+"&accountNumber="+h+"&hidperiod="+v+"&download=PDF&cardoract=CCESTMT~"+r,C=encodeURI(S);fileDownLoadAndViewer(a,C,1,s)},errorresponse:function(){hideSpinner(),o.history.navigate("#/exception")},disposeView:function(e){return o.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return m});