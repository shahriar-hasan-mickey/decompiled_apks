define(["jquery","underscore","Backbone","backbonevalidation","routers/morerouter","text!views/more/changeMpin.tpl","text!views/more/changeMpinVerify.tpl","collections/login/ChangeMPINCollections","models/validation/changeMpinValidationModel"],function(e,n,i,r,o,t,a,s,l){var c=new EncryptedLocalStorage("secret"),p=i.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #reviewmpin":"reviewmpin","click #cancel":"cancel"},initialize:function(){},render:function(){showSpinner();var e=this;c.set("currentPage",""),localStorage.setItem("FINALCHECKSUM",""),c.set("newmpin",""),e.listcompile()},listcompile:function(){hideSpinner(),this.$("#mobcontent").html(n.template(t)).i18n()},reviewmpin:function(){e("#commonMpinError").hide(),e("#errorPass").hide(),e("#commonErrorPass").hide(),e("#newErrorPass").hide(),e("#errlength").hide(),this.model=new l({url:"json/"}),this.$(".alert").hide(),i.Validation.bind(this);var n=this.$("form").serializeObject();if(this.model.set(n,{validate:!0})){this.model.clear(),i.Validation.unbind(this);var r=this,o=e("#oldmpin").val();c.set("oldmpin",o);var t=e("#newmpin").val();c.set("newmpin",t);var a=e("#confirmmpin").val();c.set("confirmmpin",a);var s=c.get("mpinval");if(s!=o)return e("#errorPass").show(),hideSpinner(),e("#oldmpin").val(""),e("#newmpin").val(""),e("#confirmmpin").val(""),!1;if(t!=a)return e("#commonErrorPass").show(),hideSpinner(),e("#oldmpin").val(""),e("#newmpin").val(""),e("#confirmmpin").val(""),!1;if(o==t)return e("#newErrorPass").show(),hideSpinner(),e("#oldmpin").val(""),e("#newmpin").val(""),e("#confirmmpin").val(""),!1;if(t.length<6)return e("#minValidError").show(),e("#newmpin").val(""),e("#confirmmpin").val(""),!1;if(a.length<6)return e("#minValidError").show(),e("#newmpin").val(""),e("#confirmmpin").val(""),!1;if(t!=a)return e("#commonError").show(),hideSpinner(),e("#newmpin").val(""),e("#confirmmpin").val(""),!1;for(var p=0,m=e("#newmpin").val(),h=0;5>h;h++){parseInt(m[h])+1;+m[+h+1]==+m[h]+1&&+m[+h+2]==+m[h]+2&&p++}if(p>0)return e("#errorconseq").show(),e("#errorcon").hide(),!1;var p=0,m=e("#newmpin").val();if(m.match(/(.)\1\1/))return e("#errorcon").show(),e("#errorconseq").hide(),!1;getDeviceId();showSpinner(),r.resultpageSuccess()}else hideSpinner(),this.$(".alert-error").fadeIn()},resultpageSuccess:function(){hideSpinner(),i.history.navigate("#/changeMpinSuccess")},resultpageError:function(){i.history.fragment=null,i.history.navigate("#/exception")},cancel:function(){hideSpinner(),i.history.navigate("#/preference")},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return i.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return p});