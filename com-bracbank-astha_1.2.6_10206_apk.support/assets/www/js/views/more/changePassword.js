define(["jquery","underscore","Backbone","backbonevalidation","routers/morerouter","text!views/more/changePassword.tpl","text!views/more/changePasswordVerify.tpl","collections/login/ChangePasswordCollections","models/validation/changepasswordValidationModel"],function(e,r,n,o,i,t,s,a,c){var l=new EncryptedLocalStorage("secret"),d=n.View.extend({el:"#container",e1:"#menuwrapper",e2:"#mobcontent",events:{"click #review":"review","click #confirm":"confirm","click #home":"home","click #cancel":"cancel"},initialize:function(){},render:function(){showSpinner(),l.set("currentPage","");var e=this;e.listcompile()},listcompile:function(){hideSpinner(),this.$("#mobcontent").html(r.template(t)).i18n()},review:function(){e("#errorlength").hide(),e("#errornum").hide(),e("#errorusr").hide(),e("#commonErrorPass").hide(),e("#errorlwr").hide(),e("#errorupr").hide(),e("#errorspc").hide(),e("#errnumber").hide(),e("#errorcon").hide(),e("#errorupr").hide(),e("#errorusrsame").hide(),this.model=new c({url:"json/"}),this.$(".alert").hide(),n.Validation.bind(this);var r=this.$("form").serializeObject();if(this.model.set(r,{validate:!0})){this.model.clear(),n.Validation.unbind(this);var o=this,i=l.get("pwdpolicy"),t=l.get("loginuser_id"),s=e("#newpassword").val();l.set("newpassword",s);var d=e("#confirmpassword").val(),h=e("#oldpassword").val();l.set("oldpassword",h);var u=e("#newpassword").val();if(t==u)return e("#errorusrsame").show(),!1;if(u.length<i.minimumLength)return e("#errorlength").show(),!1;if(h==u)return e("#errorusr").show(),!1;var p=/[0-9]/g,w=u.search(p);if("Y"===i.numeralsMandatory&&"-1"==w)return e("#errnumber").show(),!1;var m=!1,v=!1,g=/[a-z\u0600-\u06FF]/g,f=u.search(g);if("Y"===i.lowercaseMandatory&&"-1"==f)return m=!0,e("#errorspc").show(),!1;var y=/[A-Z\u0600-\u06FF]/g,S=u.search(y);if("Y"===i.uppercaseMandatory&&"-1"==S)return e("#errorupr").show(),v=!0,!1;if(s!=d)return e("#commonErrorPass").show(),hideSpinner(),e("#oldpassword").val(""),e("#newpassword").val(""),e("#confirmpassword").val(""),!1;var V=function(e){o.resultpageSuccess()},b=function(e){o.errorresponse()},E=(new Date).getTime();h=EncryptWithDynamicSalt(h,E),s=EncryptWithDynamicSalt(s,E);var P=getDeviceId();showSpinner(),o.collection=new a([],{}),o.collection.fetch({data:e.param({Validation:"Y",salt:E,newpassword:s,oldpassword:h,access_token:l.get("access_token"),deviceId:P}),dataType:"json",type:"POST",timeout:parseInt(l.get("calltimeout")),cache:!1,success:function(r){var n=l.get("errordesc");l.get("errorcode");"0000"==ackStatus?V(r):(hideSpinner(),e("#commonErrorMsgPass").text(n),e("#commonErrorPass").show())},error:b})}},resultpageSuccess:function(){hideSpinner(),n.history.navigate("#/changepasswordverify")},resultpageError:function(){hideSpinner(),n.history.fragment=null,n.history.navigate("#/exception")},cancel:function(){hideSpinner(),n.history.navigate("#/preference")},errorresponse:function(){hideSpinner(),openErrorPopup()},disposeView:function(e){return n.View.prototype.close=function(){this.unbind(),this.undelegateEvents()},void 0!==this.currentView&&this.currentView.close(),this.currentView=e,this.currentView.delegateEvents(),this.currentView}});return d});